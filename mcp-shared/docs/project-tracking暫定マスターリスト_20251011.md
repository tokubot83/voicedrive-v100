# ProjectTrackingï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¿½è·¡ï¼‰æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ

**æ–‡æ›¸ç•ªå·**: VD-MASTER-PROJECT-TRACKING-20251011
**ä½œæˆæ—¥**: 2025å¹´10æœˆ11æ—¥
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: https://voicedrive-v100.vercel.app/project-tracking
**å‰æ**: DBè¦ä»¶åˆ†ææ›¸ï¼ˆproject-tracking_DBè¦ä»¶åˆ†æ_20251011.mdï¼‰ã«åŸºã¥ã

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ã‚·ã‚¹ãƒ†ãƒ é–“è²¬ä»»åˆ†æ‹…

| é …ç›® | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | VoiceDrive | å‚™è€ƒ |
|------|------------|-----------|------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿ç®¡ç† | âŒ | âœ… | VoiceDriveç®¡è½„ï¼ˆPost ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |
| æŠ•ç¥¨ç®¡ç† | âŒ | âœ… | VoiceDriveç®¡è½„ï¼ˆVote ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |
| ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç† | âŒ | âœ… | VoiceDriveç®¡è½„ï¼ˆComment ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |
| ã‚¹ã‚³ã‚¢è¨ˆç®— | âŒ | âœ… | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹•çš„è¨ˆç®— |
| è·å“¡æƒ…å ± | âœ… | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãŒç®¡ç† |

### å®Ÿè£…ã‚µãƒãƒªãƒ¼

- **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ API**: 0å€‹ï¼ˆè¿½åŠ å®Ÿè£…ä¸è¦ï¼‰
- **VoiceDriveæ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«**: 0å€‹ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œï¼‰
- **VoiceDriveæ–°è¦API**: 4å€‹
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ **: 2å€‹ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰

---

## ğŸ¥ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®å¯¾å¿œ

### APIè¦ä»¶

#### âœ… æ—¢å­˜APIï¼ˆè¿½åŠ å®Ÿè£…ä¸è¦ï¼‰

**çµè«–**: ProjectTrackingãƒšãƒ¼ã‚¸ã¯ **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ APIã‚’ä½¿ç”¨ã—ã¾ã›ã‚“**ã€‚

**ç†ç”±**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ VoiceDrive å†…éƒ¨ã§å®Œçµ
- æŠ•ç¥¨ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚‚ VoiceDrive ç®¡è½„
- è·å“¡æƒ…å ±ã¯æ—¢ã« Post/Comment ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿

---

### çµè«–: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®è¿½åŠ å®Ÿè£…ä¸è¦ âœ…

ProjectTrackingãƒšãƒ¼ã‚¸ã¯ **100% VoiceDriveå†…éƒ¨ã§å®Œçµ** ã—ã¾ã™ã€‚

---

## ğŸ—„ï¸ VoiceDriveå´ã®DBå®Ÿè£…

### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ´»ç”¨

ProjectTrackingãƒšãƒ¼ã‚¸ã¯ **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦** ã§ã™ã€‚æ—¢å­˜ã® Post, Vote, Comment ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¾ã™ã€‚

#### ãƒ†ãƒ¼ãƒ–ãƒ«1: Postï¼ˆæ—¢å­˜ï¼‰

```prisma
model Post {
  id                    String    @id @default(cuid())
  type                  String    // 'improvement' = ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
  content               String
  authorId              String
  anonymityLevel        String
  status                String    @default("active")
  proposalType          String?   // 'operational' | 'communication' | 'innovation' | 'strategic'
  priority              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  author                User      @relation("PostAuthor", fields: [authorId], references: [id], onDelete: Cascade)
  votes                 Vote[]
  comments              Comment[]

  @@index([authorId])
  @@index([type])
  @@index([status])
  @@index([createdAt])

  // ğŸ†• ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([authorId, type, createdAt])  // ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé«˜é€Ÿå–å¾—ç”¨
}
```

**è¿½åŠ ãƒ‡ãƒ¼ã‚¿ä¸è¦** - æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å¯¾å¿œå¯èƒ½ã€‚

---

#### ãƒ†ãƒ¼ãƒ–ãƒ«2: Voteï¼ˆæ—¢å­˜ï¼‰

```prisma
model Vote {
  id        String    @id @default(cuid())
  postId    String
  userId    String
  option    String    // 'strongly-oppose' | 'oppose' | 'neutral' | 'support' | 'strongly-support'
  timestamp DateTime  @default(now())

  post      Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User      @relation("PostVote", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])

  // ğŸ†• ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([userId, timestamp])  // æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé«˜é€Ÿå–å¾—ç”¨
}
```

**è¿½åŠ ãƒ‡ãƒ¼ã‚¿ä¸è¦** - æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å¯¾å¿œå¯èƒ½ã€‚

---

#### ãƒ†ãƒ¼ãƒ–ãƒ«3: Commentï¼ˆæ—¢å­˜ï¼‰

```prisma
model Comment {
  id              String    @id @default(cuid())
  postId          String
  parentId        String?
  authorId        String
  content         String
  commentType     String    // 'proposal' | 'question' | 'support' | 'concern'
  anonymityLevel  String
  privacyLevel    String?
  likes           Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  post            Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  parent          Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies         Comment[] @relation("CommentReplies")
  author          User      @relation("CommentAuthor", fields: [authorId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([parentId])
  @@index([authorId])
}
```

**è¿½åŠ ãƒ‡ãƒ¼ã‚¿ä¸è¦** - æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å¯¾å¿œå¯èƒ½ã€‚

---

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1: Postè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

**ç›®çš„**: ã€Œææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚¿ãƒ–ã®ã‚¯ã‚¨ãƒªé«˜é€ŸåŒ–

**è¿½åŠ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
```prisma
@@index([authorId, type, createdAt])
```

**å¯¾è±¡ã‚¯ã‚¨ãƒª**:
```sql
SELECT * FROM posts
WHERE author_id = ? AND type = 'improvement' AND status = 'active'
ORDER BY created_at DESC
```

**åŠ¹æœ**:
- ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“ã‚’ 80% å‰Šæ¸›ï¼ˆæ¨å®šï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º: ç´„ 5MBï¼ˆ10ä¸‡ä»¶ã®æŠ•ç¨¿æƒ³å®šï¼‰

---

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2: Voteè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

**ç›®çš„**: ã€ŒæŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚¿ãƒ–ã®ã‚¯ã‚¨ãƒªé«˜é€ŸåŒ–

**è¿½åŠ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
```prisma
@@index([userId, timestamp])
```

**å¯¾è±¡ã‚¯ã‚¨ãƒª**:
```sql
SELECT DISTINCT post_id FROM votes
WHERE user_id = ?
ORDER BY timestamp DESC
```

**åŠ¹æœ**:
- ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“ã‚’ 75% å‰Šæ¸›ï¼ˆæ¨å®šï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º: ç´„ 3MBï¼ˆ50ä¸‡ä»¶ã®æŠ•ç¥¨æƒ³å®šï¼‰

---

## ğŸ”„ Prismaãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
npx prisma migrate dev --name add_project_tracking_indexes
```

**ç”Ÿæˆã•ã‚Œã‚‹SQL** (`migrations/xxxxx_add_project_tracking_indexes/migration.sql`):

```sql
-- Post ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
CREATE INDEX "Post_authorId_type_createdAt_idx" ON "posts"("author_id", "type", "created_at");

-- Vote ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
CREATE INDEX "Vote_userId_timestamp_idx" ON "votes"("user_id", "timestamp");
```

**å®Ÿè¡Œæ™‚é–“**: ç´„ 5-10ç§’ï¼ˆãƒ‡ãƒ¼ã‚¿é‡ã«ã‚ˆã‚Šå¤‰å‹•ï¼‰

---

## ğŸŒ VoiceDrive APIå®Ÿè£…

### API 1: GET /api/project-tracking/my-projects

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/project-tracking/my-projects/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { getServerSession } from 'next-auth';

export async function GET(request: NextRequest) {
  try {
    // èªè¨¼ãƒã‚§ãƒƒã‚¯
    const session = await getServerSession();
    if (!session?.user?.id) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }

    const userId = session.user.id;

    // ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    const projects = await prisma.post.findMany({
      where: {
        authorId: userId,
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: {
          select: {
            id: true,
            name: true,
            department: true,
            permissionLevel: true
          }
        },
        votes: true,
        comments: {
          select: { id: true }  // ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®ã¿
        }
      },
      orderBy: { createdAt: 'desc' }
    });

    // æŠ•ç¥¨é›†è¨ˆ
    const projectsWithVoteCounts = projects.map(project => ({
      ...project,
      votes: project.votes.reduce((acc, vote) => {
        acc[vote.option] = (acc[vote.option] || 0) + 1;
        return acc;
      }, {} as Record<string, number>),
      commentCount: project.comments.length
    }));

    return NextResponse.json({
      projects: projectsWithVoteCounts,
      meta: {
        count: projectsWithVoteCounts.length,
        timestamp: new Date().toISOString()
      }
    });
  } catch (error) {
    console.error('[API] Error fetching my projects:', error);
    return NextResponse.json(
      { error: 'Internal Server Error', message: error.message },
      { status: 500 }
    );
  }
}
```

---

### API 2: GET /api/project-tracking/voted-projects

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/project-tracking/voted-projects/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { getServerSession } from 'next-auth';

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession();
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const userId = session.user.id;

    // ã‚¹ãƒ†ãƒƒãƒ—1: æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å–å¾—
    const votes = await prisma.vote.findMany({
      where: { userId },
      select: {
        postId: true,
        option: true  // è‡ªåˆ†ã®æŠ•ç¥¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³
      },
      distinct: ['postId'],
      orderBy: { timestamp: 'desc' }
    });

    if (votes.length === 0) {
      return NextResponse.json({ projects: [], meta: { count: 0 } });
    }

    const postIds = votes.map(v => v.postId);
    const myVoteMap = new Map(votes.map(v => [v.postId, v.option]));

    // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’å–å¾—
    const projects = await prisma.post.findMany({
      where: {
        id: { in: postIds },
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: {
          select: {
            id: true,
            name: true,
            department: true,
            permissionLevel: true
          }
        },
        votes: true,
        comments: {
          select: { id: true }
        }
      }
    });

    // æŠ•ç¥¨é›†è¨ˆ + è‡ªåˆ†ã®æŠ•ç¥¨ã‚’è¿½åŠ 
    const projectsWithVoteCounts = projects.map(project => ({
      ...project,
      votes: project.votes.reduce((acc, vote) => {
        acc[vote.option] = (acc[vote.option] || 0) + 1;
        return acc;
      }, {} as Record<string, number>),
      myVote: myVoteMap.get(project.id),  // è‡ªåˆ†ã®æŠ•ç¥¨
      commentCount: project.comments.length
    }));

    return NextResponse.json({
      projects: projectsWithVoteCounts,
      meta: {
        count: projectsWithVoteCounts.length,
        timestamp: new Date().toISOString()
      }
    });
  } catch (error) {
    console.error('[API] Error fetching voted projects:', error);
    return NextResponse.json(
      { error: 'Internal Server Error', message: error.message },
      { status: 500 }
    );
  }
}
```

---

### API 3: GET /api/project-tracking/joined-projects

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/project-tracking/joined-projects/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { getServerSession } from 'next-auth';

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession();
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const userId = session.user.id;

    // ã‚¹ãƒ†ãƒƒãƒ—1: ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å–å¾—
    const comments = await prisma.comment.findMany({
      where: { authorId: userId },
      select: { postId: true },
      distinct: ['postId'],
      orderBy: { createdAt: 'desc' }
    });

    if (comments.length === 0) {
      return NextResponse.json({ projects: [], meta: { count: 0 } });
    }

    const postIds = comments.map(c => c.postId);

    // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’å–å¾—
    const projects = await prisma.post.findMany({
      where: {
        id: { in: postIds },
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: {
          select: {
            id: true,
            name: true,
            department: true,
            permissionLevel: true
          }
        },
        votes: true,
        comments: {
          where: { authorId: userId },  // è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿
          take: 1,  // æœ€æ–°1ä»¶
          orderBy: { createdAt: 'desc' }
        },
        _count: {
          select: { comments: true }  // å…¨ã‚³ãƒ¡ãƒ³ãƒˆæ•°
        }
      }
    });

    // æŠ•ç¥¨é›†è¨ˆ + ã‚³ãƒ¡ãƒ³ãƒˆæƒ…å ±
    const projectsWithData = projects.map(project => ({
      ...project,
      votes: project.votes.reduce((acc, vote) => {
        acc[vote.option] = (acc[vote.option] || 0) + 1;
        return acc;
      }, {} as Record<string, number>),
      myComments: project.comments,  // è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆ
      commentCount: project._count.comments  // å…¨ã‚³ãƒ¡ãƒ³ãƒˆæ•°
    }));

    return NextResponse.json({
      projects: projectsWithData,
      meta: {
        count: projectsWithData.length,
        timestamp: new Date().toISOString()
      }
    });
  } catch (error) {
    console.error('[API] Error fetching joined projects:', error);
    return NextResponse.json(
      { error: 'Internal Server Error', message: error.message },
      { status: 500 }
    );
  }
}
```

---

### API 4: GET /api/project-tracking/stats

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/project-tracking/stats/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { getServerSession } from 'next-auth';

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession();
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const userId = session.user.id;

    // ä¸¦åˆ—å®Ÿè¡Œã§é«˜é€ŸåŒ–
    const [myPostsCount, votedProjects, commentedProjects, myProjects] = await Promise.all([
      // ææ¡ˆæ•°
      prisma.post.count({
        where: {
          authorId: userId,
          type: 'improvement',
          status: 'active'
        }
      }),

      // æŠ•ç¥¨æ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      prisma.vote.findMany({
        where: { userId },
        select: { postId: true },
        distinct: ['postId']
      }),

      // ã‚³ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      prisma.comment.findMany({
        where: { authorId: userId },
        select: { postId: true },
        distinct: ['postId']
      }),

      // é”æˆæ•°è¨ˆç®—ç”¨ï¼ˆè‡ªåˆ†ãŒææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
      prisma.post.findMany({
        where: {
          authorId: userId,
          type: 'improvement',
          status: 'active'
        },
        include: {
          votes: true
        }
      })
    ]);

    // é”æˆæ•°è¨ˆç®—ï¼ˆã‚¹ã‚³ã‚¢100ä»¥ä¸Šï¼‰
    const achievedCount = myProjects.filter(project => {
      const score = calculateProjectScore(project.votes);
      return score >= 100;
    }).length;

    return NextResponse.json({
      myPostsCount,
      votedPostsCount: votedProjects.length,
      commentedPostsCount: commentedProjects.length,
      achievedCount,
      meta: {
        timestamp: new Date().toISOString()
      }
    });
  } catch (error) {
    console.error('[API] Error fetching stats:', error);
    return NextResponse.json(
      { error: 'Internal Server Error', message: error.message },
      { status: 500 }
    );
  }
}

// ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ˜ãƒ«ãƒ‘ãƒ¼
function calculateProjectScore(votes: any[]): number {
  const voteWeights = {
    'strongly-support': 2,
    'support': 1,
    'neutral': 0,
    'oppose': -1,
    'strongly-oppose': -2
  };

  const voteCounts = votes.reduce((acc, vote) => {
    acc[vote.option] = (acc[vote.option] || 0) + 1;
    return acc;
  }, {} as Record<string, number>);

  const totalScore = Object.entries(voteCounts).reduce((sum, [option, count]) => {
    return sum + (voteWeights[option] || 0) * count;
  }, 0);

  return Math.max(0, totalScore);
}
```

---

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Week 1: DBæœ€é©åŒ–ãƒ»APIå®Ÿè£…ï¼ˆ3æ—¥é–“ï¼‰

| æ—¥ | ã‚¿ã‚¹ã‚¯ | æ‹…å½“ | çŠ¶æ…‹ |
|----|--------|------|------|
| Day 1 | è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ  | Backend | â³ |
| Day 1 | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ | Backend | â³ |
| Day 2 | APIå®Ÿè£…ï¼ˆ4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ | Backend | â³ |
| Day 3 | APIãƒ†ã‚¹ãƒˆ | Backend | â³ |

### Week 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆï¼ˆ1æ—¥é–“ï¼‰

| æ—¥ | ã‚¿ã‚¹ã‚¯ | æ‹…å½“ | çŠ¶æ…‹ |
|----|--------|------|------|
| Day 4 | ãƒšãƒ¼ã‚¸ä¿®æ­£ãƒ»APIçµ±åˆ | Frontend | â³ |
| Day 4 | E2Eãƒ†ã‚¹ãƒˆ | Full Stack | â³ |

---

## âœ… çµ±åˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [ ] Postè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆauthorId, type, createdAtï¼‰
- [ ] Voteè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆuserId, timestampï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡ŒæˆåŠŸ
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹æœæ¸¬å®š

### API
- [ ] GET /api/project-tracking/my-projects å®Ÿè£…å®Œäº†
- [ ] GET /api/project-tracking/voted-projects å®Ÿè£…å®Œäº†
- [ ] GET /api/project-tracking/joined-projects å®Ÿè£…å®Œäº†
- [ ] GET /api/project-tracking/stats å®Ÿè£…å®Œäº†
- [ ] èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] useProjectTracking() ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å®Ÿè£…
- [ ] ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
- [ ] APIå‘¼ã³å‡ºã—çµ±åˆ
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºå®Ÿè£…

### ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] APIçµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] E2Eãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. **DBè¦ä»¶åˆ†ææ›¸**: `project-tracking_DBè¦ä»¶åˆ†æ_20251011.md`
2. **ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸**: `ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md`
3. **æ—¢å­˜Post/Vote/Commentã‚¹ã‚­ãƒ¼ãƒ**: `prisma/schema.prisma`

---

## ğŸ“ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ã¸ã®ç¢ºèªä¾é ¼äº‹é …

### âœ… ç¢ºèªäº‹é …

1. **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ APIä¸è¦ã®ç¢ºèª**
   - ProjectTrackingãƒšãƒ¼ã‚¸ã¯ VoiceDriveå†…éƒ¨ã§å®Œçµ
   - åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®æ–°è¦APIæä¾›ã¯ä¸è¦ã§å•é¡Œãªã„ã‹ï¼Ÿ

2. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ã®ç¢ºèª**
   - Post/Vote/Commentãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ã§å®Ÿè£…
   - åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®ãƒ‡ãƒ¼ã‚¿é€£æºã¯ä¸è¦ã§å•é¡Œãªã„ã‹ï¼Ÿ

3. **è¿½åŠ å®Ÿè£…ä¸è¦ã®ç¢ºèª**
   - ProjectTrackingãƒšãƒ¼ã‚¸ã¯ **VoiceDriveå˜ç‹¬ã§å®Œçµ** ã§å•é¡Œãªã„ã‹ï¼Ÿ

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…æ¨å¥¨äº‹é …

### useProjectTracking ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

```typescript
// VoiceDrive: hooks/useProjectTracking.ts
import useSWR from 'swr';

interface UseProjectTrackingOptions {
  tab: 'posted' | 'voted' | 'joined';
}

export const useProjectTracking = (options: UseProjectTrackingOptions) => {
  const endpoint = {
    posted: '/api/project-tracking/my-projects',
    voted: '/api/project-tracking/voted-projects',
    joined: '/api/project-tracking/joined-projects'
  }[options.tab];

  const { data, error, mutate, isLoading } = useSWR(
    endpoint,
    fetcher,
    {
      refreshInterval: 30000,  // 30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
      revalidateOnFocus: true
    }
  );

  // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—
  const { data: stats } = useSWR('/api/project-tracking/stats', fetcher, {
    refreshInterval: 60000  // 1åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°
  });

  return {
    projects: data?.projects || [],
    stats: stats || {
      myPostsCount: 0,
      votedPostsCount: 0,
      commentedPostsCount: 0,
      achievedCount: 0
    },
    isLoading,
    isError: error,
    refresh: mutate
  };
};
```

### ProjectTracking.tsxä¿®æ­£ä¾‹

```typescript
// VoiceDrive: pages/ProjectTracking.tsx
import { useProjectTracking } from '../hooks/useProjectTracking';

export const ProjectTracking: React.FC = () => {
  const [activeTab, setActiveTab] = useState<'posted' | 'voted' | 'joined'>('posted');

  const { projects, stats, isLoading, isError, refresh } = useProjectTracking({
    tab: activeTab
  });

  if (isLoading) {
    return <LoadingSpinner />;
  }

  if (isError) {
    return <ErrorMessage onRetry={refresh} />;
  }

  return (
    <div className="min-h-screen bg-gray-900">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="bg-gradient-to-r from-indigo-900/50 to-purple-900/50 rounded-2xl p-6 backdrop-blur-xl border border-indigo-500/20 mb-6 m-6">
        <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
          <Rocket className="w-10 h-10" />
          ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½è·¡
        </h1>
        <p className="text-gray-300">
          ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ãƒ¢ãƒ¼ãƒ‰ã§ã®æ´»å‹•çŠ¶æ³
        </p>
      </div>

      {/* çµ±è¨ˆã‚µãƒãƒªãƒ¼ */}
      <div className="mx-6 mb-6">
        <TrackingStats
          myPostsCount={stats.myPostsCount}
          votedPostsCount={stats.votedPostsCount}
          commentedPostsCount={stats.commentedPostsCount}
          achievedCount={stats.achievedCount}
        />
      </div>

      {/* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}
      <div className="mx-6 mb-6">
        <div className="flex gap-2 bg-gray-800/50 rounded-xl p-2">
          <button
            onClick={() => setActiveTab('posted')}
            className={`
              flex-1 px-4 py-3 rounded-lg font-medium transition-all text-base
              ${activeTab === 'posted'
                ? 'bg-indigo-600 text-white shadow-lg'
                : 'text-gray-400 hover:bg-gray-700/50'
              }
            `}
          >
            ğŸš€ ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
          </button>
          <button
            onClick={() => setActiveTab('voted')}
            className={`
              flex-1 px-4 py-3 rounded-lg font-medium transition-all text-base
              ${activeTab === 'voted'
                ? 'bg-indigo-600 text-white shadow-lg'
                : 'text-gray-400 hover:bg-gray-700/50'
              }
            `}
          >
            ğŸ—³ï¸ æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
          </button>
          <button
            onClick={() => setActiveTab('joined')}
            className={`
              flex-1 px-4 py-3 rounded-lg font-medium transition-all text-base
              ${activeTab === 'joined'
                ? 'bg-indigo-600 text-white shadow-lg'
                : 'text-gray-400 hover:bg-gray-700/50'
              }
            `}
          >
            ğŸ‘¥ å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
          </button>
        </div>
      </div>

      {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <div className="mx-6 pb-24">
        <div className="space-y-4">
          {projects.length === 0 ? (
            <EmptyState tab={activeTab} />
          ) : (
            projects.map(project => (
              <TrackingPostCard
                key={project.id}
                post={project}
                postData={getPostData(project)}
                viewType={activeTab === 'posted' ? 'posted' : activeTab === 'voted' ? 'voted' : 'commented'}
              />
            ))
          )}
        </div>
      </div>

      {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}
      <MobileFooter />
      <DesktopFooter />
    </div>
  );
};
```

---

## ğŸ“ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—

**æ¡ä»¶**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ100ä»¶ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ææ¡ˆæ¸ˆã¿
- å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¹³å‡50ä»¶ã®æŠ•ç¥¨

**ç›®æ¨™**:
- APIå¿œç­”æ™‚é–“: < 500ms
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºå®Œäº†: < 1ç§’

**æ¸¬å®šæ–¹æ³•**:
```bash
# Apache Bench
ab -n 100 -c 10 http://localhost:3001/api/project-tracking/my-projects
```

---

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—

**æ¡ä»¶**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ500ä»¶ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æŠ•ç¥¨æ¸ˆã¿

**ç›®æ¨™**:
- APIå¿œç­”æ™‚é–“: < 800ms
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºå®Œäº†: < 1.5ç§’

---

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: çµ±è¨ˆã‚µãƒãƒªãƒ¼å–å¾—

**æ¡ä»¶**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ100ä»¶ææ¡ˆã€500ä»¶æŠ•ç¥¨ã€200ä»¶ã‚³ãƒ¡ãƒ³ãƒˆ

**ç›®æ¨™**:
- APIå¿œç­”æ™‚é–“: < 300ms

---

**æ–‡æ›¸çµ‚äº†**

æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ11æ—¥
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: schema.prismaæ›´æ–°ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼‰
