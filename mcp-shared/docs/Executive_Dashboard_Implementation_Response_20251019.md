# エグゼクティブダッシュボード実装確認事項への回答書

**文書番号**: ED-RESP-2025-1019-001
**作成日**: 2025年10月19日
**作成者**: VoiceDriveチーム
**宛先**: 医療職員管理システムチーム
**件名**: エグゼクティブダッシュボード実装確認事項への回答
**重要度**: 🟡 中
**ステータス**: 回答完了

---

## 📋 エグゼクティブサマリー

医療職員管理システムチームからの確認事項10項目について、VoiceDriveチームの回答をまとめました。

医療チームの詳細な調査と的確な確認事項、誠にありがとうございます。推奨いただいたOption Aを採用し、**Phase 18.5（2026年1月）との同時実装**で進めさせていただきます。

---

## ✅ 確認事項への回答

### 回答-1: データ提供APIのエンドポイント

**回答**: **Option B（新規エンドポイント作成）を採用します**

**理由**:
- エグゼクティブダッシュボード専用の最適化されたデータ構造
- 将来的な機能拡張の柔軟性
- ボイス分析との明確な分離

**決定事項**:
```
新規エンドポイント: GET /api/v1/executive/dashboard-data
```

**追加コスト承認**: ¥80,000-120,000（2-3日）
→ VoiceDrive側で負担します

---

### 回答-2: データ構造の詳細

**回答**: 以下の通り回答します

#### 1. facilityCode
✅ **医療システムの施設コードと一致させます**

**マッピング**:
```
VoiceDrive側          医療システム側
------------------------------------------
"H001"           →    "obara-hospital"
"R001"           →    "tategami-rehabilitation"
"E001"           →    "espoir-tategami"
```

**対応**: VoiceDrive側で医療システムの施設コードに変換してAPIレスポンスに含めます

#### 2. agendaCreated（議題化）
✅ **VoiceDrive側で管理**

**データソース**: VoiceDrive `Post` テーブル
- `agendaLevel` が `DEPT_AGENDA` 以上のもの
- 医療システムからの取得は**不要**

#### 3. committeeSubmitted（委員会提出）
✅ **VoiceDrive側で管理**

**データソース**: VoiceDrive `Post` テーブル
- `agendaLevel` が `FACILITY_AGENDA` 以上のもの
- 医療システムからの取得は**不要**

#### 4. resolved（解決済み）
✅ **VoiceDrive側で判定**

**判定条件**:
- `status` = "resolved" または "completed"
- `approvalStatus` = "approved" かつ実装完了
- 医療システムでの判定は**不要**

#### 5. alerts（アラート）
✅ **VoiceDrive側で判定・生成**

**判定条件**:
```typescript
// VoiceDrive側で実装済みの AnalyticsAlert テーブルから取得
- severity: 'high' | 'medium' | 'low'
- type: 'risk' | 'engagement' | 'delay'
```

**医療システム側の実装**: **不要**

---

### 回答-3: LLM分析の実装タイミング

**回答**: **Option A（Phase 18.5で同時実装）を採用します**

**理由**:
- ボイス分析のLlama 3.2 8B実装と統合
- 開発コストの最適化
- 一貫した分析品質

**実装スケジュール**:
```
2026年1月（Phase 18.5）
  ├─ ボイス分析のLlama 3.2 8B実装
  ├─ エグゼクティブダッシュボードのLLM分析実装
  └─ 統合テスト
```

**それまでの対応**:
- 2025年10月～12月: データ提供APIのみ実装
- LLM分析は2026年1月まで**モック版**で対応
- UI表示は先行実装（ダミーデータ使用）

---

### 回答-4: LLM分析結果の送信方式

**回答**: ボイス分析と同じWebhook方式を採用します

**決定事項**:
```
エンドポイント: POST /api/v1/executive/strategic-insights
送信頻度: 毎週月曜日 02:00 JST
認証方式: HMAC-SHA256署名認証
リトライ機構: 3回、30分間隔
```

**ボイス分析との違い**:
| 項目 | ボイス分析 | エグゼクティブダッシュボード |
|------|-----------|---------------------------|
| **送信頻度** | 毎日 02:00 JST | **毎週月曜日 02:00 JST** |
| **認証方式** | HMAC-SHA256 | HMAC-SHA256（同じ） |
| **リトライ** | 3回、30分間隔 | 3回、30分間隔（同じ） |

**理由**:
- エグゼクティブダッシュボードは**週次分析**が適切
- 戦略的意思決定は日次更新の必要性が低い
- LLMの計算コスト削減

---

### 回答-5: データ保存先と保持期間

**回答**: VoiceDrive側で保存・管理します

**決定事項**:
```
保存先: VoiceDrive PostgreSQL
テーブル名: ExecutiveStrategicInsight
保持期間: 3年間
バックアップ: VoiceDrive側で実施
```

**医療システム側の対応**: **保存不要**
- 分析結果をVoiceDriveに送信後、医療システム側では削除可能
- ログのみ保持（監査用、1年間）

**データ削除ポリシー**:
```
- 3年経過したデータは自動削除
- 削除前に月次レポートとしてアーカイブ保存
```

---

### 回答-6: セキュリティとアクセス権限

**回答**: Level 12+専用、施設別権限制御なし、K-匿名性チェックあり

**決定事項**:

#### アクセス権限
```
対象ユーザー: Level 12+（経営層のみ）
  - Level 12: 副院長
  - Level 13: 院長
  - Level 14: 副理事長（人事部門も含む）
  - Level 15: 理事長
  - Level 16: 戦略企画部門員
  - Level 17: 統括管理部門員
  - Level 18: 理事
```

#### 施設別権限制御
**実装しません**

**理由**:
- 経営層は**全施設のデータを閲覧する必要がある**
- 施設別比較が主要機能のため、制限すると機能が無意味になる
- Level 12+は全員が法人全体の経営責任を持つ

#### K-匿名性チェック
**実装します**

```typescript
最小グループサイズ: 5名以上
- 部門別データ: 5名未満の部門は「その他」に統合
- アラート: 影響人数5名未満は非表示
- 個人特定不可の集計データのみ提供
```

---

### 回答-7: 実装スケジュール

**回答**: Phase 18.5と同時実装（2026年1月）を推奨します

**決定スケジュール**:

#### Phase 1: 準備期間（2025年10月～12月）

**VoiceDrive側**:
```
10月19日～11月8日（3週間）
  ├─ データ提供API実装（GET /api/v1/executive/dashboard-data）
  ├─ 分析結果受信API実装（POST /api/v1/executive/strategic-insights）
  └─ ExecutiveStrategicInsightテーブル作成
```

**医療システム側**:
```
11月11日～12月6日（4週間）
  ├─ レポートセンターページに「エグゼクティブダッシュボード」項目追加
  ├─ データ取得バッチ処理実装
  └─ モック分析結果送信実装（統計ベース）
```

#### Phase 2: 統合テスト（2025年12月）

```
12月9日～12月20日（2週間）
  ├─ データ取得確認
  ├─ モック分析結果受信確認
  └─ UI表示確認
```

#### Phase 3: 暫定リリース（2025年12月末）

```
12月23日～12月31日（1週間）
  └─ モック版でソフトリリース
     - データ提供APIは本番稼働
     - LLM分析はモック版（統計ベース）
```

#### Phase 4: 本格実装（2026年1月、Phase 18.5）

```
2026年1月6日～1月31日（4週間）
  ├─ Llama 3.2 8B連携実装
  ├─ 高度な戦略分析実装
  │   - 施設間比較分析
  │   - 原因特定
  │   - 推奨アクション生成
  │   - ベストプラクティス抽出
  │   - 予測分析
  │   - 中長期戦略提案
  └─ 本番リリース
```

---

### 回答-8: 医療システム側の実装範囲

**回答**: 以下の通り整理します

**正しい理解**:

| 実装項目 | 実装者 | 詳細 |
|---------|--------|------|
| **データ提供API** | **VoiceDrive** | `GET /api/v1/executive/dashboard-data` |
| **分析結果受信API** | **VoiceDrive** | `POST /api/v1/executive/strategic-insights` |
| **ExecutiveStrategicInsightテーブル** | **VoiceDrive** | Prisma schema追加 |
| **レポートセンターページ追加** | **医療システム** | 「エグゼクティブダッシュボード」項目 |
| **データ取得バッチ処理** | **医療システム** | 週次でVoiceDrive APIを呼び出し |
| **LLM分析実装** | **医療システム** | Llama 3.2 8Bで戦略分析 |
| **分析結果送信バッチ処理** | **医療システム** | VoiceDrive APIに送信 |

**訂正内容**:
- ❌ 依頼書で「医療システム側で実装」と記載していたデータ提供API → **VoiceDrive側で実装**
- ✅ 医療システム側は「データ取得バッチ処理」のみ実装

**理由**:
- データ提供APIはVoiceDriveのデータベースにアクセスするため、VoiceDrive側で実装する方が効率的
- 医療システム側は「呼び出し側」として実装

---

### 回答-9: コスト見積もりの妥当性

**回答**: マスタープランに含まれていません。追加コストが発生します。

**追加コスト見積もり（VoiceDrive側）**:

| 項目 | 工数 | コスト |
|------|------|--------|
| **データ提供API実装** | 3日 | ¥120,000 |
| **分析結果受信API実装** | 2日 | ¥80,000 |
| **ExecutiveStrategicInsightテーブル作成** | 1日 | ¥40,000 |
| **UI実装（経営概要タブ）** | 0日 | ¥0（完了済み） |
| **統合テスト** | 1日 | ¥40,000 |
| **合計（VoiceDrive側）** | **7日** | **¥280,000** |

**追加コスト見積もり（医療システム側）**:

| 項目 | 工数 | コスト |
|------|------|--------|
| **レポートセンターページ項目追加** | 1日 | ¥40,000 |
| **データ取得バッチ処理実装** | 2日 | ¥80,000 |
| **LLM分析実装** | 0日 | ¥0（ボイス分析と共通） |
| **分析結果送信バッチ処理実装** | 1日 | ¥40,000 |
| **統合テスト** | 1日 | ¥40,000 |
| **合計（医療システム側）** | **5日** | **¥200,000** |

**総合計**: **¥480,000**

**コスト負担**:
- VoiceDrive側: ¥280,000（VoiceDriveプロジェクト予算から）
- 医療システム側: ¥200,000（医療システムプロジェクト予算から）

**支払い方法**:
- 各チームが自チームの開発コストを負担
- 追加請求なし

---

### 回答-10: ボイス分析との統合

**回答**: **Option A（別ページ）を採用します**

**決定事項**:
```
レポートセンターページ
  ├─ ボイス分析（既存）
  └─ エグゼクティブダッシュボード（新規）
```

**理由**:
1. **依頼書の記載通り**
2. **権限別アクセス制御が明確**
   - ボイス分析: Level 14-17（人事部門）
   - エグゼクティブダッシュボード: Level 12+（経営層）
3. **目的が異なる**
   - ボイス分析: 詳細な職員の声の分析
   - エグゼクティブダッシュボード: 戦略的意思決定支援
4. **将来の拡張性**
   - エグゼクティブダッシュボードには財務サマリー、離職率推移、患者満足度などを追加予定
   - ボイス分析とは独立して拡張

**UI配置**:
```
医療システム レポートセンターページ
├─ 📊 ボイス分析
│   └─ VoiceDriveの投稿データを詳細分析
│       対象: Level 14-17（人事部門）
│
└─ 🏛️ エグゼクティブダッシュボード
    └─ 組織全体の健康状態と戦略的意思決定
        対象: Level 12+（経営層）
```

---

## 📊 確定した実装計画

### 実装範囲サマリー

| フェーズ | 期間 | 実装者 | 内容 |
|---------|------|--------|------|
| **Phase 1** | 2025年10月～11月 | VoiceDrive | API実装（データ提供・分析結果受信） |
| **Phase 1** | 2025年11月～12月 | 医療システム | レポートセンター項目追加・バッチ処理 |
| **Phase 2** | 2025年12月 | 両チーム | 統合テスト（モック版） |
| **Phase 3** | 2025年12月末 | 両チーム | 暫定リリース（モック分析） |
| **Phase 4** | 2026年1月 | 医療システム | Llama 3.2 8B連携（本格実装） |

### コスト確定

| 項目 | VoiceDrive側 | 医療システム側 | 合計 |
|------|-------------|---------------|------|
| **開発コスト** | ¥280,000 | ¥200,000 | **¥480,000** |
| **月額運用コスト** | ¥0 | ¥0 | **¥0** |

**注**: 既存のLightsail統合インスタンスを使用するため、追加の月額運用コストは発生しません

---

## 🔄 次のアクション

### VoiceDriveチーム（即座実行）

✅ **10月19日～11月8日**:
- [ ] データ提供API実装（`GET /api/v1/executive/dashboard-data`）
- [ ] 分析結果受信API実装（`POST /api/v1/executive/strategic-insights`）
- [ ] `ExecutiveStrategicInsight`テーブル作成
- [ ] API仕様書作成（OpenAPI形式）

### 医療システムチーム（VoiceDrive API完成後）

⏳ **11月11日～12月6日**:
- [ ] レポートセンターページに「エグゼクティブダッシュボード」項目追加
- [ ] データ取得バッチ処理実装（週次、月曜日02:00 JST）
- [ ] モック分析結果送信実装（統計ベースの簡易分析）

### 両チーム（統合テスト）

⏳ **12月9日～12月20日**:
- [ ] データ取得APIテスト
- [ ] 分析結果受信APIテスト
- [ ] UI表示確認
- [ ] パフォーマンステスト

### 両チーム（暫定リリース）

⏳ **12月23日～12月31日**:
- [ ] ステージング環境テスト
- [ ] 本番環境デプロイ
- [ ] ソフトリリース（モック版）

### 医療システムチーム（Phase 18.5）

⏳ **2026年1月6日～1月31日**:
- [ ] Llama 3.2 8B連携実装
- [ ] 高度な戦略分析実装
- [ ] 本番リリース

---

## 📝 補足事項

### データ提供APIの詳細仕様

**エンドポイント**: `GET /api/v1/executive/dashboard-data`

**Query Parameters**:
```
period: string (YYYY-MM形式、例: "2025-10")
facilities: string[] (optional、例: ["obara-hospital", "tategami-rehabilitation"])
```

**Response Example**:
```json
{
  "period": "2025-10",
  "generatedAt": "2025-10-19T10:30:00Z",
  "facilities": [
    {
      "facilityCode": "obara-hospital",
      "facilityName": "小原病院",
      "stats": {
        "totalPosts": 342,
        "agendaCreated": 85,
        "committeeSubmitted": 28,
        "resolved": 45,
        "participationRate": 68,
        "resolutionRate": 55,
        "avgResolutionDays": 42
      },
      "departments": [
        {
          "name": "看護部",
          "posts": 128,
          "agendas": 32,
          "activeScore": 85,
          "trend": "up"
        }
      ],
      "alerts": [
        {
          "type": "risk",
          "severity": "high",
          "title": "看護部でネガティブ投稿急増",
          "description": "シフト調整に関する不満が3件連続",
          "department": "看護部",
          "affectedCount": 12
        }
      ],
      "projects": {
        "inProgress": 12,
        "completed": 8,
        "delayed": 3,
        "avgProgress": 65
      }
    }
  ],
  "trends": {
    "monthly": [
      {
        "month": "2025-10",
        "totalPosts": 342,
        "participationRate": 68,
        "resolutionRate": 55
      }
    ]
  }
}
```

### 分析結果送信APIの詳細仕様

**エンドポイント**: `POST /api/v1/executive/strategic-insights`

**Request Headers**:
```
Content-Type: application/json
X-HMAC-Signature: <HMAC-SHA256署名>
X-Timestamp: <Unixタイムスタンプ>
```

**Request Body**: 確認書のPhase 2の分析結果例と同じ

**Response**:
```json
{
  "success": true,
  "insightId": "insight-20251019-001",
  "receivedAt": "2025-10-19T10:30:00Z",
  "processed": true
}
```

---

## 📞 連絡先

**VoiceDriveチーム**
- Slack: `#phase2-integration`
- MCPサーバー: `mcp-shared/docs/`
- 担当者: VoiceDriveプロジェクトリード

**実装に関する質問**:
- API仕様の詳細
- データ構造の確認
- スケジュール調整

---

## 🎯 まとめ

### 確定事項

✅ **新規エンドポイント作成**（Option B）
✅ **Phase 18.5と同時実装**（2026年1月）
✅ **別ページとして実装**（Option A）
✅ **週次分析**（毎週月曜日02:00 JST）
✅ **VoiceDrive側でデータ保存**（3年保持）
✅ **Level 12+専用、施設別権限制御なし、K-匿名性チェックあり**
✅ **追加コスト: ¥480,000**（VoiceDrive ¥280,000 + 医療システム ¥200,000）
✅ **VoiceDrive側でAPI実装、医療システム側でバッチ処理実装**

### スケジュール確定

```
2025年10月19日～11月8日: VoiceDrive側API実装
2025年11月11日～12月6日: 医療システム側バッチ処理実装
2025年12月9日～12月20日: 統合テスト
2025年12月23日～12月31日: 暫定リリース（モック版）
2026年1月6日～1月31日: Llama 3.2 8B連携・本格実装
```

---

**本回答書をご確認いただき、問題なければ実装を開始させていただきます。**

**VoiceDriveチーム**
2025年10月19日
