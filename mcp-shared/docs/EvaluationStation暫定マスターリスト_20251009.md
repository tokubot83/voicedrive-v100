# VoiceDrive 評価ステーション 暫定マスターリスト
**作成日**: 2025年10月9日
**対象**: 医療職員管理システムチーム
**目的**: 評価ステーション（V3評価通知・異議申立）に必要なAPI・Webhook依頼

---

## 📊 概要サマリー

| 項目 | 数量 | 医療システム工数 | 見積金額 |
|------|------|-----------------|---------|
| **医療システムAPI** | 1個（共用） | 0日（共用済み） | ¥0（共用済み） |
| **Webhook（受信）** | 1個 | 4日 | ¥320,000 |
| **Webhook（送信）** | 2個 | 6日 | ¥480,000 |
| **合計** | 3項目 | **10日** | **¥800,000** |

**VoiceDriveチーム工数**: 29日
**実装期間**: 5週間
**開始予定**: 2025年10月14日（月）

**特記事項**: PostManagementと職員情報APIを共用するため、追加APIコストなし

---

## 📝 必要API・Webhook一覧

### API-ES-M-1: 職員基本情報取得API（共用）
**エンドポイント**: `GET /api/employees/:employeeId`
**目的**: 評価通知対象職員の基本情報取得

#### 共用について
- **共用元**: PostManagement（API-PM-M-1）
- **追加費用**: なし（既に実装済み）
- **Phase**: 1

#### レスポンス
```json
{
  "employeeId": "OH-NS-2024-001",
  "name": "山田太郎",
  "department": "看護部",
  "permissionLevel": 3,
  "position": "看護師",
  "email": "yamada@example.com"
}
```

---

### WH-ES-M-1: 評価結果開示通知Webhook（受信）
**エンドポイント**: VoiceDrive側で用意
**VoiceDriveの受信先**: `POST https://voicedrive.app/webhook/evaluation-disclosure`
**目的**: 医療システムで評価が開示されたとき、VoiceDriveに通知

#### 医療システムからの送信データ
```json
{
  "event": "evaluation_disclosure",
  "timestamp": "2025-03-15T10:00:00Z",
  "data": {
    "employeeId": "OH-NS-2024-001",
    "employeeName": "山田太郎",
    "evaluationPeriod": "2025年冬期評価",
    "evaluationPeriodId": "eval_2025_winter",

    // V3評価システム（3軸評価）
    "facilityGrade": "A",      // 施設内評価 (S, A, B, C, D)
    "corporateGrade": "B",     // 法人内評価 (S, A, B, C, D)
    "overallGrade": "A+",      // 総合評価 (S, A+, A, B+, B, C, D)
    "overallScore": 87,        // 総合評価点数 (0-100点)

    "disclosureDate": "2025-03-15",
    "appealDeadline": "2025-03-29",
    "medicalSystemUrl": "https://medical-system.example.com/evaluations/12345",
    "additionalMessage": "総合評価A+おめでとうございます"
  },
  "signature": "HMAC-SHA256-SIGNATURE-HERE"
}
```

#### VoiceDriveからの応答
```json
{
  "success": true,
  "notificationId": "EVAL_1A2B3C",
  "message": "評価通知を受理しました",
  "deliveryMethods": {
    "email": true,
    "push": true,
    "sms": false
  },
  "estimatedDeliveryTime": "2025-03-15T10:01:00Z"
}
```

#### セキュリティ
- **HMAC-SHA256署名**: 共有秘密鍵でリクエストボディを署名
- **タイムスタンプ検証**: 5分以内のリクエストのみ受け付け
- **IPホワイトリスト**: 医療システムサーバーIPのみ許可

#### Phase
**Phase 1** - Week 1-2

#### 見積
- **工数**: 4日
- **金額**: ¥320,000
- **優先度**: 最高

#### 実装内容
1. **Webhookエンドポイント作成** (2日)
   - リクエスト受信・署名検証
   - データバリデーション
   - VoiceDrive DB保存

2. **評価通知送信処理** (1日)
   - メール通知生成
   - プッシュ通知生成
   - テンプレート適用

3. **テスト・デバッグ** (1日)
   - 医療システムとの結合テスト
   - エラーハンドリング確認

---

### WH-ES-V-1: 異議申立受理通知Webhook（送信）
**エンドポイント**: 医療システム側で用意
**医療システムの受信先**: `POST https://medical-system.example.com/webhook/appeal-submitted`
**目的**: 職員がVoiceDriveで異議申立を提出したとき、医療システムに通知

#### VoiceDriveからの送信データ
```json
{
  "event": "appeal_submitted",
  "timestamp": "2025-03-20T14:30:00Z",
  "data": {
    "appealId": "APPEAL_XYZ123",
    "employeeId": "OH-NS-2024-001",
    "employeeName": "山田太郎",
    "evaluationPeriodId": "eval_2025_winter",
    "evaluationPeriod": "2025年冬期評価",

    // 異議申立内容
    "appealCategory": "ACHIEVEMENT_OVERSIGHT",  // CALCULATION_ERROR | ACHIEVEMENT_OVERSIGHT | CRITERIA_MISINTERPRETATION | OTHER
    "appealReason": "以下の成果が評価に反映されていません：\n1. プロジェクトAのリーダーとして売上20%増を達成\n2. 新人教育プログラムを立ち上げ、満足度90%を獲得",
    "specificPoints": [
      "プロジェクトAの成功（売上20%増）",
      "新人教育プログラムの立ち上げ",
      "患者満足度調査で部署1位"
    ],
    "originalScore": 82,
    "requestedScore": 88,
    "evidenceDocuments": [
      "https://voicedrive-storage.example.com/evidence/project_a_report.pdf",
      "https://voicedrive-storage.example.com/evidence/patient_satisfaction.pdf"
    ],
    "desiredOutcome": "上記成果を評価に反映し、適正な評価点数への修正を希望します",
    "submittedAt": "2025-03-20T14:30:00Z"
  },
  "signature": "HMAC-SHA256-SIGNATURE-HERE"
}
```

#### 医療システムからの応答
```json
{
  "success": true,
  "medicalSystemAppealId": "MS-APPEAL-001",
  "assignedReviewer": "評価審査委員会",
  "expectedResponseDate": "2025-04-05T23:59:59Z",
  "message": "異議申立を受理しました。審査を開始します。"
}
```

#### Phase
**Phase 2** - Week 3-4

#### 見積
- **工数**: 4日
- **金額**: ¥320,000
- **優先度**: 高

#### 実装内容
1. **Webhookエンドポイント作成** (2日)
   - リクエスト受信・署名検証
   - データバリデーション
   - 医療システムDB保存

2. **審査ワークフロー連携** (1日)
   - 審査担当者自動アサイン
   - 審査期限設定（標準14日）
   - 審査ステータス管理

3. **テスト・デバッグ** (1日)
   - VoiceDriveとの結合テスト
   - エラーハンドリング確認

---

### WH-ES-V-2: 異議申立取り下げ通知Webhook（送信）
**エンドポイント**: 医療システム側で用意
**医療システムの受信先**: `POST https://medical-system.example.com/webhook/appeal-withdrawn`
**目的**: 職員がVoiceDriveで異議申立を取り下げたとき、医療システムに通知

#### VoiceDriveからの送信データ
```json
{
  "event": "appeal_withdrawn",
  "timestamp": "2025-03-25T16:00:00Z",
  "data": {
    "appealId": "APPEAL_XYZ123",
    "medicalSystemAppealId": "MS-APPEAL-001",
    "employeeId": "OH-NS-2024-001",
    "employeeName": "山田太郎",
    "withdrawalReason": "評価について上司と面談し、納得しました",
    "withdrawnAt": "2025-03-25T16:00:00Z"
  },
  "signature": "HMAC-SHA256-SIGNATURE-HERE"
}
```

#### 医療システムからの応答
```json
{
  "success": true,
  "message": "異議申立の取り下げを確認しました"
}
```

#### Phase
**Phase 2** - Week 3-4

#### 見積
- **工数**: 2日
- **金額**: ¥160,000
- **優先度**: 中

#### 実装内容
1. **Webhookエンドポイント作成** (1日)
   - リクエスト受信・署名検証
   - 審査ステータス更新

2. **テスト・デバッグ** (1日)
   - VoiceDriveとの結合テスト
   - エラーハンドリング確認

---

## 📅 実装スケジュール

### Phase 1: 評価通知受信・表示（Week 1-2）

| 週 | VoiceDrive作業 | 医療システム作業 | 成果物 |
|----|---------------|-----------------|--------|
| **Week 1** | EvaluationNotificationテーブル追加<br>EvaluationStation UI実装 | **WH-ES-M-1実装開始**<br>評価開示Webhook | 評価通知DB構造完成 |
| **Week 2** | Webhook受信エンドポイント実装<br>通知送信機能（メール・プッシュ） | WH-ES-M-1テスト完了 | 評価通知受信・表示動作 |

**医療システム成果物**: WH-ES-M-1稼働（¥320,000）

---

### Phase 2: 異議申立・フィードバック面談（Week 3-4）

| 週 | VoiceDrive作業 | 医療システム作業 | 成果物 |
|----|---------------|-----------------|--------|
| **Week 3** | Appealテーブル追加<br>異議申立フォーム実装<br>異議申立API実装 | **WH-ES-V-1実装**<br>異議申立受理Webhook | 異議申立機能動作 |
| **Week 4** | フィードバック面談予約統合<br>証拠書類アップロード | **WH-ES-V-2実装**<br>異議申立取り下げWebhook | 医療システムへ申立通知 |

**医療システム成果物**:
- WH-ES-V-1稼働（¥320,000）
- WH-ES-V-2稼働（¥160,000）

---

### Phase 3: 通知設定・高度機能（Week 5）

| 週 | VoiceDrive作業 | 医療システム作業 | 成果物 |
|----|---------------|-----------------|--------|
| **Week 5** | NotificationSettingsテーブル追加<br>通知設定UI実装<br>統計・分析機能<br>統合テスト | 結合テスト参加 | 全機能完成<br>本番リリース準備完了 |

**医療システム成果物**: 結合テスト完了

---

## 🔍 確認事項（医療システムチームへ）

### 技術的確認

#### 1. V3評価システム実装状況
**Q**: V3評価システム（100点満点制・3軸評価）は医療システムで既に稼働していますか？
**確認内容**:
- 100点満点制の評価計算ロジック
- 3軸評価（施設内・法人内・総合）の算出方法
- 7段階グレード（S, A+, A, B+, B, C, D）の判定ロジック
- グレード境界値（例: A+は90-94点）

#### 2. 評価開示処理タイミング
**Q**: 評価開示時のWebhook送信は自動化されていますか？
**確認内容**:
- 評価開示ボタンクリック時に即座に送信か
- 一斉開示時のバッチ処理での送信か
- リトライ処理の実装予定
- タイムアウト設定

#### 3. 異議申立審査ワークフロー
**Q**: 医療システム側に異議申立の審査ワークフローは存在しますか？
**確認内容**:
- 審査担当者のアサイン方法（自動 or 手動）
- 審査期限の設定（標準14日以内など）
- 審査結果のVoiceDriveへのフィードバック方法（Webhook or 手動）
- 審査中のステータス管理

#### 4. 評価期間ID
**Q**: 評価期間を一意に識別するIDは医療システムで管理されていますか？
**確認内容**:
- evaluationPeriodIdの命名規則（例: eval_2025_winter）
- 複数年度・複数施設の管理方法
- IDの一意性保証

#### 5. 証拠書類ストレージ
**Q**: 異議申立の証拠書類（PDF等）はどこに保存しますか？
**確認内容**:
- **Option A**: VoiceDrive側ストレージに保存してURLを医療システムへ送信
- **Option B**: 医療システム側でアップロード・保存を管理
- **Option C**: 共有ストレージ（AWS S3等）を使用
- アクセス権限の管理方法

---

### 運用的確認

#### 6. 評価開示タイミング
**Q**: 評価開示は年何回、いつ実施されますか？
**検討内容**:
- 冬期評価の開示日（例: 3月15日）
- 夏期評価の開示日（例: 9月15日）
- 一斉開示か部署ごと段階的開示か
- 開示時間帯（業務時間内 or 時間外）

#### 7. 異議申立期限
**Q**: 異議申立期限は14日間で確定ですか？
**検討内容**:
- 標準期限（開示から14日後の23:59:59）
- 延長申請の可否・手続き
- 期限超過後の申立受付可否（緊急時等）
- 休日・祝日の扱い

#### 8. 異議申立審査結果のフィードバック
**Q**: 審査結果はVoiceDriveにどのようにフィードバックしますか？
**検討内容**:
- **Option A**: Webhook通知で自動送信（推奨）
- **Option B**: 医療システムの管理画面から手動登録
- **Option C**: VoiceDriveが医療システムAPIを定期的にポーリング
- 修正後の評価点数の反映方法

#### 9. フィードバック面談の調整
**Q**: フィードバック面談予約は医療システムとVoiceDriveのどちらで管理しますか？
**検討内容**:
- VoiceDriveで予約 → 医療システムへ通知のみ
- 医療システムでスケジュール管理・承認
- カレンダー統合の要否（Outlook, Google Calendar等）
- 面談室予約システムとの連携

#### 10. 通知チャネル
**Q**: メール・プッシュ以外の通知チャネル（SMS等）は必要ですか？
**検討内容**:
- SMS通知の要否（緊急時のみ等）
- 職員の連絡先情報（メール・電話番号）の管理主体
- 通知失敗時のフォールバック（例: メール失敗→SMS）
- 通知送信コストの負担主体

---

### データ連携確認

#### 11. 評価データの保持期間
**Q**: VoiceDriveでミラーリングした評価データの保持期間はどのくらいですか？
**確認内容**:
- 全履歴を永続保存か
- 直近3年分のみ保存か
- 医療システムとの同期方法（差分同期 or 全量同期）
- データ削除ポリシー

#### 12. 職員退職時の処理
**Q**: 職員退職時、VoiceDriveの評価データはどう処理しますか？
**確認内容**:
- 退職後も本人が閲覧可能にするか
- 即座に削除するか
- 匿名化して統計データとして保存するか
- 退職後のアカウント無効化タイミング

#### 13. 異議申立の匿名性
**Q**: 異議申立は匿名で提出可能ですか？
**確認内容**:
- 実名のみか（現行案）
- 匿名オプションの有無
- 審査担当者への情報開示範囲
- 匿名申立の場合の連絡方法

#### 14. 評価修正時の通知
**Q**: 異議申立が認容されて評価が修正された場合、VoiceDriveへの通知は必要ですか？
**確認内容**:
- 自動Webhook通知の要否
- 修正内容の詳細表示（修正前→修正後）
- 修正履歴の保存・閲覧可否
- 再通知のタイミング

#### 15. グレード境界値の調整
**Q**: グレード判定の境界値（例: A+は90-94点）は変更される可能性がありますか？
**確認内容**:
- 固定値か動的調整か
- 年度ごとの変更の有無
- VoiceDriveへの設定同期方法（API or 手動設定）
- 境界値変更時の過去データの扱い

---

## 💰 見積詳細

### 医療システムチーム工数内訳

| 項目 | 作業内容 | 工数 | 単価 | 金額 |
|------|---------|------|------|------|
| **WH-ES-M-1** | 評価結果開示Webhook受信エンドポイント実装 | 4日 | ¥80,000/日 | ¥320,000 |
| **WH-ES-V-1** | 異議申立受理Webhook送信エンドポイント実装 | 4日 | ¥80,000/日 | ¥320,000 |
| **WH-ES-V-2** | 異議申立取り下げWebhook送信エンドポイント実装 | 2日 | ¥80,000/日 | ¥160,000 |
| **合計** | - | **10日** | - | **¥800,000** |

### VoiceDriveチーム工数内訳

| Phase | 作業内容 | 工数 |
|-------|---------|------|
| **Phase 1** | 評価通知受信・表示 | 10日 |
| **Phase 2** | 異議申立・面談 | 12日 |
| **Phase 3** | 通知設定・分析 | 7日 |
| **合計** | - | **29日** |

---

## 📦 成果物一覧

### VoiceDrive側成果物
1. **EvaluationNotificationテーブル**
   - 3軸評価フィールド（facilityGrade, corporateGrade, overallGrade）
   - 通知ステータス管理
   - 異議申立連携

2. **Appealテーブル**
   - 異議申立内容・証拠書類
   - 審査ステータス・履歴

3. **AppealHistoryテーブル**
   - 異議申立アクション履歴

4. **NotificationSettingsテーブル**
   - 個人通知設定管理

5. **EvaluationViewLogテーブル**
   - 評価閲覧ログ

6. **UI実装**
   - EvaluationStation（ダッシュボード・履歴・対応申立）
   - 3軸グレード表示コンポーネント
   - 異議申立フォーム（AppealFormV3）
   - 通知設定画面

### 医療システム側成果物
1. **WH-ES-M-1**: 評価結果開示Webhook受信エンドポイント
2. **WH-ES-V-1**: 異議申立受理Webhook送信エンドポイント
3. **WH-ES-V-2**: 異議申立取り下げWebhook送信エンドポイント

---

## 🚀 次のステップ

### 1. 確認事項回答（Week 0 - 10/9-10/11）
- [ ] 技術的確認5項目の回答
- [ ] 運用的確認5項目の回答
- [ ] データ連携確認5項目の回答
- [ ] V3評価システム仕様書の共有

### 2. キックオフミーティング（10/11 14:00-15:00）
- [ ] V3評価システム（3軸評価）の詳細確認
- [ ] Webhook連携仕様の最終調整
- [ ] 異議申立審査ワークフローの確認
- [ ] 実装スケジュール最終調整
- [ ] 担当者アサイン

### 3. Phase 1 開始（10/14-）
- [ ] 医療システムチーム: WH-ES-M-1実装開始
- [ ] VoiceDriveチーム: EvaluationNotificationテーブル追加
- [ ] 週次進捗会議設定（毎週金曜15:00-16:00）

---

## 📞 連絡先

**VoiceDriveチーム**
- プロジェクトリード: [担当者名]
- 技術リード: [担当者名]
- Slack: #voicedrive-evaluation-station

**医療システムチーム**
- API/Webhook担当: [担当者名]
- 評価システム担当: [担当者名]
- Slack: #medical-system-evaluation

---

## 📚 関連ドキュメント

1. **EvaluationStation_DB要件分析_20251009.md** - 詳細設計書（本依頼の根拠）
2. **V3評価システム仕様書** - 3軸評価・100点満点制の詳細（要共有）
3. **異議申立審査ワークフロー図** - 審査プロセスの詳細（要共有）
4. **グレード判定基準表** - 7段階グレードの境界値（要共有）

---

**作成者**: Claude (AI Assistant)
**承認者**: VoiceDrive開発リーダー
**最終更新**: 2025年10月9日 17:00

**重要**: この暫定マスターリストは医療システムチームとの協議後、最終版に更新されます。
