# VoiceDrive 統合テスト実施依頼書

**発行日**: 2025年10月4日 18:00
**発行元**: VoiceDriveシステム開発チーム
**宛先**: 医療職員管理システム開発チーム
**件名**: アカウントレベル統一 統合テスト実施のご依頼

---

## 🎯 依頼の目的

VoiceDriveシステム側で25レベル権限システムの実装が完了しました。
医療職員管理システムとVoiceDriveシステムの連携が正しく動作することを確認するため、**統合テスト**の実施をお願いいたします。

**簡単に言うと**:
> 医療システムのAPI（`POST /api/v1/calculate-level`）とVoiceDriveシステムが正しく通信できるか、レベル計算が正しいか、を一緒に確認したいです。

---

## 📋 統合テストで確認したいこと

| No. | 確認項目 | 具体的な内容 |
|-----|---------|------------|
| 1 | **API疎通確認** | VoiceDriveから医療APIを呼び出せるか |
| 2 | **レベル計算の正確性** | 職員情報を送ると正しいレベルが返ってくるか |
| 3 | **全25レベル対応** | 1～18、1.5～4.5、97～99すべて対応できるか |
| 4 | **エラーハンドリング** | API障害時にVoiceDrive側フォールバック機能が動作するか |
| 5 | **認証・セキュリティ** | JWT認証が正しく動作するか |

---

## 🔧 医療チーム側でご準備いただきたいもの

### 1. API接続情報の提供

以下の情報をVoiceDriveチームに共有してください。

```yaml
# 必要な接続情報
API_BASE_URL: "https://medical-system.example.com/api/v1"  # 本番環境URL
JWT_TOKEN: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."      # 認証トークン
FACILITY_ID: "FACILITY_001"                               # 施設ID（テスト用）
```

**提供方法**:
- Slackダイレクトメッセージ
- または暗号化メール

### 2. テストデータの準備

医療システム側で以下のテスト用職員データをご準備ください。

| 職員ID | 職種 | 経験年数 | リーダー業務 | 期待されるレベル | 用途 |
|-------|------|---------|------------|--------------|------|
| TEST_STAFF_001 | 看護師 | 1年 | なし | **1** (新人) | 基本レベル確認 |
| TEST_STAFF_002 | 看護師 | 1年 | **あり** | **1.5** (新人リーダー) | 0.5刻みレベル確認 |
| TEST_STAFF_003 | 看護師 | 5年 | なし | **3** (中堅) | 中堅レベル確認 |
| TEST_STAFF_004 | 看護師 | 15年 | なし | **4** (ベテラン) | ベテランレベル確認 |
| TEST_STAFF_005 | 看護師 | 15年 | **あり** | **4.5** (ベテランリーダー) | 最高0.5刻み確認 |
| TEST_STAFF_006 | 医師 | 20年 | - | **10** (部長) | 医師レベル確認 |
| TEST_STAFF_007 | 人事 | 10年 | - | **15** (人事マネージャー) | 人事レベル確認 |
| TEST_STAFF_008 | 役員 | - | - | **18** (理事) | 最高レベル確認 |
| TEST_STAFF_097 | 健診担当 | - | - | **97** (健診) | 特別権限確認 |
| TEST_STAFF_098 | 産業医 | - | - | **98** (産業医) | 特別権限確認 |
| TEST_STAFF_099 | システム | - | - | **99** (管理者) | 最高権限確認 |

**合計**: 11件のテストデータ

### 3. APIエンドポイントの稼働確認

統合テスト前に、以下のエンドポイントが稼働していることをご確認ください。

```bash
# ヘルスチェック（あれば）
GET https://medical-system.example.com/api/v1/health

# レベル計算API
POST https://medical-system.example.com/api/v1/calculate-level
```

---

## 🚀 VoiceDrive側の準備状況

すでに完了している実装：

| 項目 | 状態 | 詳細 |
|-----|------|------|
| **DB設計変更** | ✅ 完了 | DECIMAL型、25種類対応 |
| **型定義** | ✅ 完了 | TypeScript型定義370行 |
| **APIクライアント** | ✅ 完了 | 医療API連携実装済み |
| **フォールバック機能** | ✅ 完了 | API障害時の代替計算 |
| **ローカルテスト** | ✅ 完了 | 20テスト、100%合格 |
| **既存データ移行** | ✅ 完了 | 4ユーザー、100%成功 |

**VoiceDrive側の統合テスト用スクリプト**:
- ✅ `scripts/integration-test-with-medical-api.cjs` 作成済み
- ✅ `scripts/check-data-types.cjs` 作成済み
- ✅ `tests/25-level-integration.test.cjs` 作成済み

---

## 📅 統合テストの実施手順（ステップバイステップ）

### Step 1: 事前準備（医療チーム）【30分】

```bash
# 1. テストデータ登録
# 医療システムDBに上記11件のテストデータを登録

# 2. APIサーバー起動確認
curl -X GET https://medical-system.example.com/api/v1/health

# 3. 接続情報をVoiceDriveチームに共有
# - API_BASE_URL
# - JWT_TOKEN
# - FACILITY_ID
```

### Step 2: 接続設定（VoiceDriveチーム）【15分】

```bash
# VoiceDriveチームが実施
# 1. 環境変数設定
export MEDICAL_API_URL="https://medical-system.example.com/api/v1"
export JWT_TOKEN="医療チームから受領したトークン"

# 2. 接続確認
node scripts/check-api-connection.cjs
```

### Step 3: 統合テスト実行（両チーム合同）【1時間】

```bash
# VoiceDriveチームが実行、医療チームがログ確認

# テスト1: API疎通確認
node scripts/test-api-connection.cjs

# テスト2: 全25レベル計算確認
node scripts/integration-test-with-medical-api.cjs

# テスト3: エラーハンドリング確認
node scripts/test-fallback-mechanism.cjs
```

### Step 4: 結果確認・報告（両チーム）【30分】

```bash
# テスト結果レポート自動生成
node scripts/generate-integration-test-report.cjs

# 出力先: mcp-shared/logs/integration-test-YYYYMMDD.md
```

---

## 📊 成功基準

以下の条件をすべて満たせば統合テスト合格とします。

| No. | 基準 | 合格条件 |
|-----|------|---------|
| 1 | **API疎通率** | 100%（全リクエスト成功） |
| 2 | **レベル計算精度** | 100%（期待値と実際の値が一致） |
| 3 | **全レベル対応** | 11件すべてのテストデータで正しいレベルが返る |
| 4 | **レスポンスタイム** | 平均 < 500ms（許容範囲） |
| 5 | **エラーハンドリング** | API障害時にフォールバックが動作 |

---

## 🗓️ 統合テスト実施スケジュール（提案）

### オプション1: 最短スケジュール

| 日時 | 作業内容 | 担当 | 所要時間 |
|-----|---------|------|---------|
| **10/5 (土) 10:00-11:00** | テストデータ準備・接続情報共有 | 医療チーム | 1時間 |
| **10/5 (土) 11:00-11:15** | VoiceDrive側接続設定 | VoiceDriveチーム | 15分 |
| **10/5 (土) 11:15-12:15** | 統合テスト実行（合同） | 両チーム | 1時間 |
| **10/5 (土) 12:15-12:45** | 結果確認・報告書作成 | 両チーム | 30分 |

**合計所要時間**: 2時間45分

### オプション2: 余裕を持ったスケジュール

| 日時 | 作業内容 | 担当 |
|-----|---------|------|
| **10/7 (月) 終日** | テストデータ準備 | 医療チーム |
| **10/8 (火) 10:00-12:00** | 統合テスト実行（合同） | 両チーム |
| **10/9 (水) 10:00-11:00** | 追加検証・報告書作成 | 両チーム |

---

## 💬 よくある質問（FAQ）

### Q1: テストデータは本番環境に作成する必要がありますか？

**A**: いいえ、**ステージング環境または開発環境**で問題ありません。本番環境への影響を避けるため、テスト専用環境でのテストをお勧めします。

### Q2: JWT認証トークンの有効期限はどのくらい必要ですか？

**A**: テスト実施日を含めて**3日間有効**なトークンをご用意ください。予備日も含めて余裕を持った期限設定をお願いします。

### Q3: テストに失敗した場合、どうすればいいですか？

**A**: 両チーム合同でエラーログを確認し、原因を特定します。VoiceDrive側の問題であればその場で修正、医療システム側の問題であれば次回テストまでに修正をお願いします。

### Q4: 11件のテストデータ作成が難しい場合は？

**A**: 最低限以下の**5件**でも統合テストは実施可能です。
- Level 1 (新人)
- Level 1.5 (新人リーダー)
- Level 4.5 (ベテランリーダー)
- Level 18 (理事)
- Level 99 (システム管理者)

### Q5: 統合テスト中にVoiceDriveシステムは停止しますか？

**A**: いいえ、**開発環境でのテスト**のため、本番VoiceDriveシステムは影響を受けません。

---

## 📞 連絡先・サポート

### VoiceDrive開発チーム

- **Slack**: `#voicedrive-integration-test`
- **メール**: voicedrive-dev@example.com
- **緊急連絡**: [担当者名] (内線xxxx)

### 質問・不明点がある場合

Slackチャンネル `#voicedrive-integration-test` にてお気軽にご質問ください。
統合テスト実施日時の調整も同チャンネルで行います。

---

## ✅ 医療チーム様へのアクション依頼（まとめ）

以下の3点をご対応いただけますと、統合テストを開始できます。

| No. | アクション | 期限 | 方法 |
|-----|----------|------|------|
| 1 | **接続情報の共有** | なるべく早く | Slack DM または暗号化メール |
| 2 | **テストデータ準備** | 統合テスト前日まで | 医療システムDB登録（11件または5件） |
| 3 | **統合テスト日時調整** | 今週中 | Slack `#voicedrive-integration-test` |

---

## 📎 添付資料

- [VoiceDrive実装完了報告書](./VoiceDrive_Account_Level_Unification_Response_20251004.md)
- [25レベル権限システム仕様書](./MEDICAL_SYSTEM_25_LEVEL_SPECIFICATION.md)
- [統合テストスクリプト](../../scripts/integration-test-with-medical-api.cjs)

---

## 📝 変更履歴

| 日付 | バージョン | 変更内容 |
|-----|----------|---------|
| 2025-10-04 | 1.0 | 初版作成 |

---

**VoiceDrive開発チーム一同、統合テストの実施を楽しみにしております。**
**ご協力のほど、よろしくお願いいたします。**
