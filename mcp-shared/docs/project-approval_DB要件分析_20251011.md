# ProjectApprovalï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªï¼‰DBè¦ä»¶åˆ†æ

**æ–‡æ›¸ç•ªå·**: VD-DB-ANALYSIS-PROJECT-APPROVAL-20251011
**ä½œæˆæ—¥**: 2025å¹´10æœˆ11æ—¥
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: https://voicedrive-v100.vercel.app/project-approval
**å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼**: æ‰¿èªæ¨©é™ã‚’æŒã¤ãƒªãƒ¼ãƒ€ãƒ¼ãƒ»ç®¡ç†è€…ï¼ˆæ¨©é™ãƒ¬ãƒ™ãƒ« 3.5+ï¼‰
**ãƒšãƒ¼ã‚¸ç›®çš„**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆã‚’æ‰¿èªãƒ»å´ä¸‹ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã‚’åˆ¤æ–­ã™ã‚‹

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ãƒšãƒ¼ã‚¸æ¦‚è¦
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªç®¡ç†**: ã‚¹ã‚³ã‚¢ã«åŸºã¥ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆPENDING/TEAM/DEPARTMENT/FACILITY/ORGANIZATIONï¼‰ã‚’åˆ¤å®š
- **æ¨©é™ãƒ™ãƒ¼ã‚¹è¡¨ç¤º**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦æ‰¿èªå¯èƒ½ãƒ»é–²è¦§å¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **æ‰¿èªã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹æ‰¿èªã€ä¿ç•™ã€å´ä¸‹ã€ç·Šæ€¥ä»‹å…¥ã€ãƒãƒ¼ãƒ ç·¨æˆé–‹å§‹
- **ã‚¹ã‚³ã‚¢è¨ˆç®—**: æŠ•ç¥¨æ•°ï¼ˆå¼·ãè³›æˆ+2ã€è³›æˆ+1ã€ä¸­ç«‹0ã€åå¯¾-1ã€å¼·ãåå¯¾-2ï¼‰ã‹ã‚‰ã‚¹ã‚³ã‚¢ã‚’å‹•çš„è¨ˆç®—
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡æ¨å®š**: ã‚¹ã‚³ã‚¢ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã‹ã‚‰æ¨å®šãƒãƒ¼ãƒ è¦æ¨¡ã‚’ç®—å‡º

### ãƒ‡ãƒ¼ã‚¿è²¬ä»»åˆ†ç•Œ
| ãƒ‡ãƒ¼ã‚¿ | è²¬ä»»ã‚·ã‚¹ãƒ†ãƒ  | ç†ç”± |
|--------|------------|------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿ï¼ˆPostï¼‰ | VoiceDrive | VoiceDriveã§ç®¡ç† |
| æŠ•ç¥¨ï¼ˆVoteï¼‰ | VoiceDrive | VoiceDriveã§ç®¡ç† |
| ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆCommentï¼‰ | VoiceDrive | VoiceDriveã§ç®¡ç† |
| æ‰¿èªå±¥æ­´ | VoiceDrive | ğŸ†• æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«å¿…è¦ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | VoiceDrive | Post.statusã§ç®¡ç† |
| è·å“¡æ¨©é™æƒ…å ± | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | User.permissionLevelã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |

### ä¸è¶³é …ç›®ã‚µãƒãƒªãƒ¼
- **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«**: 1å€‹ï¼ˆProjectApproval - æ‰¿èªå±¥æ­´ç®¡ç†ï¼‰
- **ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ**: 1å€‹ï¼ˆPost - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼‰
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ **: 2å€‹ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨ï¼‰
- **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ API**: 0å€‹ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã§å¯¾å¿œå¯èƒ½ï¼‰

---

## ğŸ¯ ãƒšãƒ¼ã‚¸æ©Ÿèƒ½è©³ç´°åˆ†æ

### 1. ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤ºï¼ˆLines 191-209ï¼‰

**æ©Ÿèƒ½**: ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã¨æ¨©é™ãƒ¬ãƒ™ãƒ«æƒ…å ±ã‚’è¡¨ç¤º

**è¡¨ç¤ºé …ç›®**:
- ã‚¿ã‚¤ãƒˆãƒ«: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èª"
- ã‚¢ã‚¤ã‚³ãƒ³: Rocket ğŸš€
- èª¬æ˜æ–‡: "ç®¡è½„ç¯„å›²ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆã‚’ç¢ºèªãƒ»æ‰¿èª"
- æ¨©é™ãƒ¬ãƒ™ãƒ«è¡¨ç¤º:
  - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãƒ¬ãƒ™ãƒ«ï¼ˆä¾‹: "ãƒ¬ãƒ™ãƒ« 8"ï¼‰
  - æ‰¿èªå¯èƒ½ãƒ¬ãƒ™ãƒ«æ•°ï¼ˆä¾‹: "æ‰¿èªå¯èƒ½: 3ãƒ¬ãƒ™ãƒ«"ï¼‰
  - é–²è¦§å¯èƒ½ãƒ¬ãƒ™ãƒ«æ•°ï¼ˆä¾‹: "é–²è¦§å¯èƒ½: 5ãƒ¬ãƒ™ãƒ«"ï¼‰

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- `User.permissionLevel`: ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãƒ¬ãƒ™ãƒ«ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- `ProjectPermissionService.getApprovableLevels()`: æ‰¿èªå¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ãƒªã‚¹ãƒˆ
- `ProjectPermissionService.getViewableLevels()`: é–²è¦§å¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ãƒªã‚¹ãƒˆ

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### 2. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆLines 212-273ï¼‰

**æ©Ÿèƒ½**: è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

**ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç¨®åˆ¥**:

#### A. æ¨©é™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆLines 224-252ï¼‰
- **æ‰¿èªå¯èƒ½** (`approvable`): è‡ªåˆ†ãŒæ‰¿èªã§ãã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿è¡¨ç¤º
- **å…¨ã¦** (`viewable`): é–²è¦§æ¨©é™ã®ã‚ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¨ã¦è¡¨ç¤º

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯** (Lines 66-73):
```typescript
if (filter === 'approvable') {
  return permission.canApprove;  // æ‰¿èªå¯èƒ½
} else {
  return permission.canView;     // é–²è¦§å¯èƒ½
}
```

#### B. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆLines 256-270ï¼‰
- **ã™ã¹ã¦ã®ãƒ¬ãƒ™ãƒ«** (`all`): å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã‚’è¡¨ç¤º
- **å€‹åˆ¥ãƒ¬ãƒ™ãƒ«é¸æŠ**: PENDING, TEAM, DEPARTMENT, FACILITY, ORGANIZATION, STRATEGIC

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š** (Lines 47-49, 244-250):
```typescript
const projectLevel = projectPermissionService.getProjectLevelFromScore(score);
// ã‚¹ã‚³ã‚¢ 0-99: PENDING
// ã‚¹ã‚³ã‚¢ 100-199: TEAM
// ã‚¹ã‚³ã‚¢ 200-399: DEPARTMENT
// ã‚¹ã‚³ã‚¢ 400-799: FACILITY
// ã‚¹ã‚³ã‚¢ 800+: ORGANIZATION
```

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- `Post`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿
- `Vote`: æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¹ã‚³ã‚¢è¨ˆç®—ç”¨ï¼‰
- `User.permissionLevel`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãƒ¬ãƒ™ãƒ«

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆLines 276-310ï¼‰

**æ©Ÿèƒ½**: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º

**è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿** (Lines 149-182):
```typescript
interface ProjectData {
  post: Post;                      // æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿
  currentScore: number;            // ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ï¼ˆå‹•çš„è¨ˆç®—ï¼‰
  projectLevel: ProjectLevel;      // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«
  permission: ProjectPermission;   // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™æƒ…å ±
  totalVotes: number;              // ç·æŠ•ç¥¨æ•°
  supportRate: number;             // æ”¯æŒç‡ï¼ˆ%ï¼‰
  projectScale?: ProjectScale;     // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡
  estimatedTeamSize?: number;      // æ¨å®šãƒãƒ¼ãƒ è¦æ¨¡
}
```

**ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯** (Lines 150-153):
```typescript
const currentScore = calculateScore(
  convertVotesToEngagements(post.votes || {}),
  post.proposalType
);
```

**æŠ•ç¥¨é‡ã¿ä»˜ã‘** (ProjectScoringã‚µãƒ¼ãƒ“ã‚¹):
- å¼·ãè³›æˆ (`strongly-support`): +2
- è³›æˆ (`support`): +1
- ä¸­ç«‹ (`neutral`): 0
- åå¯¾ (`oppose`): -1
- å¼·ãåå¯¾ (`strongly-oppose`): -2

**æ”¯æŒç‡è¨ˆç®—** (Lines 162-167):
```typescript
const supportVotes = (post.votes['strongly-support'] || 0) + (post.votes['support'] || 0);
const supportRate = totalVotes > 0 ? Math.round((supportVotes / totalVotes) * 100) : 0;
```

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡æ¨å®š** (Lines 170-171):
```typescript
const estimatedTeamSize = Math.max(5, Math.floor(totalVotes * 0.3));
const projectScale = getProjectScale(projectLevel, estimatedTeamSize);
```

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- `Post`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿
- `Vote`: æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿
- `Comment`: ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
- `User`: æŠ•ç¨¿è€…æƒ…å ±

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰è©³ç´°ï¼ˆProjectApprovalCardï¼‰

#### A. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«è¡¨ç¤ºï¼ˆLines 44-100ï¼‰

**ãƒ¬ãƒ™ãƒ«è¨­å®š**:
```typescript
const levelConfig = {
  'PENDING': {
    label: 'ã‚¢ã‚¤ãƒ‡ã‚¢æ¤œè¨ä¸­',
    icon: 'ğŸ’¡',
    color: 'gray',
    threshold: '0-99ç‚¹'
  },
  'TEAM': {
    label: 'ãƒãƒ¼ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
    icon: 'ğŸ‘¥',
    color: 'blue',
    threshold: '100-199ç‚¹'
  },
  'DEPARTMENT': {
    label: 'éƒ¨ç½²ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
    icon: 'ğŸ¢',
    color: 'green',
    threshold: '200-399ç‚¹'
  },
  'FACILITY': {
    label: 'æ–½è¨­ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
    icon: 'ğŸ¥',
    color: 'yellow',
    threshold: '400-799ç‚¹'
  },
  'ORGANIZATION': {
    label: 'æ³•äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
    icon: 'ğŸ›ï¸',
    color: 'purple',
    threshold: '800ç‚¹ä»¥ä¸Š'
  },
  'STRATEGIC': {
    label: 'æˆ¦ç•¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ',
    icon: 'â­',
    color: 'pink',
    threshold: 'æˆ¦ç•¥æŒ‡å®š'
  }
};
```

#### B. æ¨©é™ãƒãƒƒã‚¸è¡¨ç¤ºï¼ˆLines 111-117ï¼‰

**ãƒãƒƒã‚¸ç¨®é¡** (ProjectPermissionService):
- **æ‰¿èªè€…** (`approver`): "âœ… æ‰¿èªè€…" - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹ã‚’æ‰¿èªã§ãã‚‹
- **æ‰¿èªè€…ï¼ˆä»£è¡Œï¼‰** (`approver`): "âœ… æ‰¿èªè€…ï¼ˆä»£è¡Œï¼‰" - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰¿èªè€…
- **ä¸Šä½è€…ï¼ˆé–²è¦§ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼‰** (`supervisor`): "ğŸ‘ï¸ ä¸Šä½è€…ï¼ˆé–²è¦§ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼‰" - ã‚¢ãƒ‰ãƒã‚¤ã‚¹å¯èƒ½
- **å‚è€ƒé–²è¦§** (`observer`): "ğŸ“– å‚è€ƒé–²è¦§" - é–²è¦§ã®ã¿
- **å‚è€ƒé–²è¦§ï¼ˆå­¦ç¿’ï¼‰** (`observer`): "ğŸ“– å‚è€ƒé–²è¦§ï¼ˆå­¦ç¿’ï¼‰" - å­¦ç¿’ç›®çš„ã®é–²è¦§

#### C. åŸºæœ¬æƒ…å ±è¡¨ç¤ºï¼ˆLines 155-168ï¼‰

**è¡¨ç¤ºé …ç›®**:
- ç·æŠ•ç¥¨æ•° (`totalVotes`)
- æ”¯æŒç‡ (`supportRate`) - ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸
- ã‚³ãƒ¡ãƒ³ãƒˆæ•° (`post.comments.length`)

#### D. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡æƒ…å ±ï¼ˆLines 137-152ï¼‰

**è¡¨ç¤ºé …ç›®**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡åŒºåˆ†ï¼ˆå°è¦æ¨¡/ä¸­è¦æ¨¡/å¤§è¦æ¨¡/è¶…å¤§è¦æ¨¡ï¼‰
- æ¨å®šãƒãƒ¼ãƒ è¦æ¨¡ï¼ˆäººæ•°ï¼‰

---

### 5. æ‰¿èªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆLines 170-257ï¼‰

#### A. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹æ‰¿èªï¼ˆLines 174-180ï¼‰

**æ©Ÿèƒ½**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ­£å¼ã«é–‹å§‹ã™ã‚‹

**è¡¨ç¤ºæ¡ä»¶**:
- `permission.canApprove === true`

**å‡¦ç†å†…å®¹** (Lines 79-91):
```typescript
handleApprove(postId: string) {
  // TODO: APIå‘¼ã³å‡ºã—
  // 1. Post.statusã‚’'approved'ã«æ›´æ–°
  // 2. ProjectApprovalãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
  // 3. AuditLogã«è¨˜éŒ²
  AuditService.log({
    action: 'PROJECT_APPROVED',
    targetId: postId,
    severity: 'high'
  });
}
```

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°**:
- `Post.status`: 'active' â†’ 'approved'
- ğŸ†• `ProjectApproval`: æ‰¿èªå±¥æ­´ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
- `AuditLog`: ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²

#### B. ãƒãƒ¼ãƒ ç·¨æˆã¸ï¼ˆLines 183-191ï¼‰

**æ©Ÿèƒ½**: ãƒãƒ¼ãƒ ç·¨æˆãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã™ã‚‹

**è¡¨ç¤ºæ¡ä»¶**:
- `permission.canApprove === true`
- `permission.canFormTeam === true`
- `projectLevel !== 'PENDING'`

**å‡¦ç†å†…å®¹** (Lines 135-146):
```typescript
handleFormTeam(postId: string) {
  // TODO: ãƒãƒ¼ãƒ ç·¨æˆãƒšãƒ¼ã‚¸ã¸é·ç§»
  // é·ç§»å…ˆ: /team-formation/{postId}
  AuditService.log({
    action: 'PROJECT_TEAM_FORMATION_STARTED',
    targetId: postId,
    severity: 'medium'
  });
}
```

#### C. ä¿ç•™ãƒ»å´ä¸‹ï¼ˆLines 194-207ï¼‰

**æ©Ÿèƒ½**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿ç•™ã¾ãŸã¯å´ä¸‹ã™ã‚‹

**è¡¨ç¤ºæ¡ä»¶**:
- `permission.canApprove === true`

**å‡¦ç†å†…å®¹**:
```typescript
// ä¿ç•™ (Lines 107-119)
handleHold(postId: string, reason: string) {
  // TODO: APIå‘¼ã³å‡ºã—
  // 1. Post.statusã‚’'on_hold'ã«æ›´æ–°
  // 2. ProjectApprovalãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆstatus: 'held'ï¼‰
  // 3. ä¿ç•™ç†ç”±ã‚’è¨˜éŒ²
  AuditService.log({
    action: 'PROJECT_HELD',
    targetId: postId,
    severity: 'low',
    details: { reason }
  });
}

// å´ä¸‹ (Lines 93-105)
handleReject(postId: string, reason: string) {
  // TODO: APIå‘¼ã³å‡ºã—
  // 1. Post.statusã‚’'rejected'ã«æ›´æ–°
  // 2. ProjectApprovalãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆstatus: 'rejected'ï¼‰
  // 3. å´ä¸‹ç†ç”±ã‚’è¨˜éŒ²
  AuditService.log({
    action: 'PROJECT_REJECTED',
    targetId: postId,
    severity: 'medium',
    details: { reason }
  });
}
```

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°**:
- `Post.status`: 'active' â†’ 'on_hold' or 'rejected'
- ğŸ†• `ProjectApproval`: æ‰¿èªå±¥æ­´ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
- `AuditLog`: ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²

#### D. ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒœã‚¿ãƒ³ï¼ˆLines 212-218ï¼‰

**æ©Ÿèƒ½**: ä¸Šä½è€…ãŒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹

**è¡¨ç¤ºæ¡ä»¶**:
- `permission.canComment === true`
- `permission.canApprove === false`

**å‡¦ç†å†…å®¹**:
```typescript
// TODO: ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
// Comment.commentType = 'proposal' ã¾ãŸã¯ 'support'
```

#### E. ç·Šæ€¥ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ï¼ˆLines 221-256ï¼‰

**æ©Ÿèƒ½**: ä¸Šä½è€…ãŒæ¨©é™å¤–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç·Šæ€¥ä»‹å…¥ã™ã‚‹

**è¡¨ç¤ºæ¡ä»¶**:
- `permission.canEmergencyOverride === true`
- `permission.canApprove === false`

**å‡¦ç†å†…å®¹** (Lines 121-133):
```typescript
handleEmergencyOverride(postId: string) {
  // TODO: APIå‘¼ã³å‡ºã—
  // 1. Post.statusã‚’'approved'ã«æ›´æ–°ï¼ˆç·Šæ€¥æ‰¿èªï¼‰
  // 2. ProjectApprovalãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆisEmergencyOverride: trueï¼‰
  // 3. ç›£æŸ»ãƒ­ã‚°ã«é‡è¦åº¦criticalã§è¨˜éŒ²
  AuditService.log({
    action: 'PROJECT_EMERGENCY_OVERRIDE',
    targetId: postId,
    severity: 'critical',
    details: { reason: 'ä¸Šä½è€…ã«ã‚ˆã‚‹ç·Šæ€¥ä»‹å…¥' }
  });
}
```

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°**:
- `Post.status`: 'active' â†’ 'approved'
- ğŸ†• `ProjectApproval`: æ‰¿èªå±¥æ­´ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆ`isEmergencyOverride: true`ï¼‰
- `AuditLog`: ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ï¼ˆseverity: 'critical'ï¼‰

---

### 6. ç©ºçŠ¶æ…‹è¡¨ç¤ºï¼ˆLines 277-286ï¼‰

**æ©Ÿèƒ½**: ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ã«è©²å½“ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¨®é¡**:
- æ‰¿èªå¯èƒ½ãƒ¢ãƒ¼ãƒ‰: "æ‰¿èªå¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“"
- é–²è¦§ãƒ¢ãƒ¼ãƒ‰: "é–²è¦§å¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“"

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºã®ã¿ï¼‰

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### çµè«–: 1ã¤ã®æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã¨1ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µãŒå¿…è¦ âš ï¸

ProjectApprovalãƒšãƒ¼ã‚¸ã¯ã€æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆPost, Vote, Comment, Userï¼‰ã«åŠ ãˆã¦ã€**æ‰¿èªå±¥æ­´ã‚’ç®¡ç†ã™ã‚‹æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«**ãŒå¿…è¦ã§ã™ã€‚

---

### ğŸ†• æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«1: ProjectApprovalï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªå±¥æ­´ï¼‰

**ç›®çš„**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‰¿èªãƒ»å´ä¸‹ãƒ»ä¿ç•™ã®å±¥æ­´ã‚’è¨˜éŒ²ã—ã€èª°ãŒã„ã¤ã©ã®ã‚ˆã†ãªç†ç”±ã§åˆ¤æ–­ã—ãŸã‹ã‚’è¿½è·¡ã™ã‚‹

```prisma
// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªå±¥æ­´
model ProjectApproval {
  id                  String    @id @default(cuid())

  // å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
  postId              String    @map("post_id")

  // æ‰¿èªè€…æƒ…å ±
  approverId          String    @map("approver_id")          // User.id
  approverName        String    @map("approver_name")        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆè¡¨ç¤ºç”¨ï¼‰
  approverLevel       Float     @map("approver_level")       // æ‰¿èªæ™‚ã®æ¨©é™ãƒ¬ãƒ™ãƒ«

  // æ‰¿èªæƒ…å ±
  action              String                                  // 'approved' | 'rejected' | 'held' | 'emergency_override'
  reason              String?   @db.Text                      // ç†ç”±ï¼ˆå´ä¸‹ãƒ»ä¿ç•™æ™‚ï¼‰
  comment             String?   @db.Text                      // ã‚³ãƒ¡ãƒ³ãƒˆ

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ï¼ˆæ‰¿èªæ™‚ç‚¹ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰
  projectLevel        String    @map("project_level")         // 'PENDING' | 'TEAM' | 'DEPARTMENT' | 'FACILITY' | 'ORGANIZATION'
  projectScore        Int       @map("project_score")         // æ‰¿èªæ™‚ã®ã‚¹ã‚³ã‚¢
  totalVotes          Int       @map("total_votes")           // æ‰¿èªæ™‚ã®ç·æŠ•ç¥¨æ•°
  supportRate         Float     @map("support_rate")          // æ‰¿èªæ™‚ã®æ”¯æŒç‡ï¼ˆ%ï¼‰

  // ç·Šæ€¥ä»‹å…¥ãƒ•ãƒ©ã‚°
  isEmergencyOverride Boolean   @default(false) @map("is_emergency_override")

  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  post                Post      @relation("PostApprovals", fields: [postId], references: [id], onDelete: Cascade)
  approver            User      @relation("ProjectApprover", fields: [approverId], references: [id])

  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([postId])
  @@index([approverId])
  @@index([action])
  @@index([projectLevel])
  @@index([createdAt])
  @@index([postId, createdAt])  // æ‰¿èªå±¥æ­´ã‚’æ™‚ç³»åˆ—ã§å–å¾—
  @@map("project_approvals")
}
```

**ç”¨é€”**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªå±¥æ­´ã®è¨˜éŒ²
- æ‰¿èªè€…ã®è¿½è·¡
- æ‰¿èªæ™‚ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ…‹ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜
- ç·Šæ€¥ä»‹å…¥ã®è¨˜éŒ²ï¼ˆç›£æŸ»ç”¨ï¼‰

---

### ğŸ”§ ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ1: Postï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ‹¡å¼µï¼‰

**ç›®çš„**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç®¡ç†ã™ã‚‹

```prisma
model Post {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

  // ğŸ†• ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆproject-approvalçµ±åˆ 2025-10-11ï¼‰
  approvalStatus      String?   @default("pending") @map("approval_status")
  // 'pending' | 'approved' | 'rejected' | 'on_hold' | 'team_formation'

  approvedAt          DateTime? @map("approved_at")      // æ‰¿èªæ—¥æ™‚
  approvedBy          String?   @map("approved_by")      // æ‰¿èªè€…User.id
  rejectedAt          DateTime? @map("rejected_at")      // å´ä¸‹æ—¥æ™‚
  rejectedBy          String?   @map("rejected_by")      // å´ä¸‹è€…User.id
  rejectionReason     String?   @db.Text @map("rejection_reason")  // å´ä¸‹ç†ç”±

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  approvals           ProjectApproval[] @relation("PostApprovals")

  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([approvalStatus])
  @@index([approvedAt])
}
```

**è¿½åŠ ç†ç”±**:
- ç¾åœ¨ã®`Post.status`ã¯'active'/'archived'/'deleted'ã®ã¿
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¥é€”ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- æ‰¿èªãƒ»å´ä¸‹ã®å±¥æ­´ã‚’åŠ¹ç‡çš„ã«è¿½è·¡

---

### ğŸ“Š User ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

```prisma
model User {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

  // ProjectApprovalçµ±åˆå®Ÿè£…ï¼ˆ2025-10-11ï¼‰
  projectApprovals    ProjectApproval[]  @relation("ProjectApprover")
}
```

---

### ğŸ” è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1: Postæ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹Ã—ä½œæˆæ—¥

```prisma
model Post {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

  @@index([approvalStatus, createdAt])  // ğŸ†• æ‰¿èªå¾…ã¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—ç”¨
}
```

**ç”¨é€”**: æ‰¿èªå¾…ã¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–°ã—ã„é †ã«å–å¾—
```sql
SELECT * FROM posts
WHERE approval_status = 'pending' AND type = 'improvement'
ORDER BY created_at DESC
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2: ProjectApprovalæ‰¿èªè€…Ã—ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«

```prisma
model ProjectApproval {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

  @@index([approverId, projectLevel])  // ğŸ†• æ‰¿èªè€…åˆ¥ãƒ¬ãƒ™ãƒ«åˆ¥çµ±è¨ˆå–å¾—ç”¨
}
```

**ç”¨é€”**: æ‰¿èªè€…ã®æ‰¿èªå±¥æ­´ã‚’å–å¾—
```sql
SELECT project_level, COUNT(*) as count
FROM project_approvals
WHERE approver_id = ?
GROUP BY project_level
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

### ãƒ•ãƒ­ãƒ¼1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èª

```mermaid
sequenceDiagram
    participant User as æ‰¿èªè€…
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    participant Audit as AuditService

    User->>VD: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹æ‰¿èªãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>VD: æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆpermission.canApproveï¼‰
    VD->>DB: Post.update({ approvalStatus: 'approved', approvedAt, approvedBy })
    DB-->>VD: æ›´æ–°å®Œäº†
    VD->>DB: ProjectApproval.create({ action: 'approved', postId, approverId, ... })
    DB-->>VD: ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆå®Œäº†
    VD->>Audit: AuditLogè¨˜éŒ²ï¼ˆaction: 'PROJECT_APPROVED', severity: 'high'ï¼‰
    VD->>User: æ‰¿èªå®Œäº†é€šçŸ¥
    VD->>User: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
```

---

### ãƒ•ãƒ­ãƒ¼2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå´ä¸‹

```mermaid
sequenceDiagram
    participant User as æ‰¿èªè€…
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    participant Audit as AuditService

    User->>VD: å´ä¸‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>User: å´ä¸‹ç†ç”±å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
    User->>VD: å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦é€ä¿¡
    VD->>VD: æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆpermission.canApproveï¼‰
    VD->>DB: Post.update({ approvalStatus: 'rejected', rejectedAt, rejectedBy, rejectionReason })
    DB-->>VD: æ›´æ–°å®Œäº†
    VD->>DB: ProjectApproval.create({ action: 'rejected', reason, ... })
    DB-->>VD: ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆå®Œäº†
    VD->>Audit: AuditLogè¨˜éŒ²ï¼ˆaction: 'PROJECT_REJECTED', severity: 'medium'ï¼‰
    VD->>User: å´ä¸‹å®Œäº†é€šçŸ¥
```

---

### ãƒ•ãƒ­ãƒ¼3: ç·Šæ€¥ä»‹å…¥

```mermaid
sequenceDiagram
    participant User as ä¸Šä½è€…
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    participant Audit as AuditService

    User->>VD: ç·Šæ€¥ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>User: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºï¼ˆç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ã®è­¦å‘Šï¼‰
    User->>VD: å®Ÿè¡Œã‚’ç¢ºèª
    VD->>VD: æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆpermission.canEmergencyOverrideï¼‰
    VD->>DB: Post.update({ approvalStatus: 'approved', approvedAt, approvedBy })
    DB-->>VD: æ›´æ–°å®Œäº†
    VD->>DB: ProjectApproval.create({ action: 'emergency_override', isEmergencyOverride: true, ... })
    DB-->>VD: ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆå®Œäº†
    VD->>Audit: AuditLogè¨˜éŒ²ï¼ˆaction: 'PROJECT_EMERGENCY_OVERRIDE', severity: 'critical'ï¼‰
    VD->>User: ç·Šæ€¥æ‰¿èªå®Œäº†é€šçŸ¥ï¼ˆé‡è¦æ“ä½œã¨ã—ã¦è¨˜éŒ²ã•ã‚ŒãŸæ—¨ã‚’è¡¨ç¤ºï¼‰
```

---

### ãƒ•ãƒ­ãƒ¼4: ãƒãƒ¼ãƒ ç·¨æˆé–‹å§‹

```mermaid
sequenceDiagram
    participant User as æ‰¿èªè€…
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    participant Team as ãƒãƒ¼ãƒ ç·¨æˆãƒšãƒ¼ã‚¸

    User->>VD: ãƒãƒ¼ãƒ ç·¨æˆã¸ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>VD: æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆpermission.canFormTeamï¼‰
    VD->>DB: Post.update({ approvalStatus: 'team_formation' })
    DB-->>VD: æ›´æ–°å®Œäº†
    VD->>DB: ProjectApproval.create({ action: 'approved', ... })
    DB-->>VD: ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆå®Œäº†
    VD->>Team: /team-formation/{postId} ã¸é·ç§»
    Team-->>User: ãƒãƒ¼ãƒ ç·¨æˆç”»é¢è¡¨ç¤º
```

---

## ğŸ”„ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ é€£æº

### å¿…è¦ãªAPI

| API | ç”¨é€” | é »åº¦ | å‚™è€ƒ |
|-----|------|------|------|
| ãªã— | - | - | **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ APIã¯ä¸è¦** |

**çµè«–**: ProjectApprovalãƒšãƒ¼ã‚¸ã¯ **VoiceDriveå†…éƒ¨ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å®Œçµ** ã—ã¾ã™ã€‚åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã¯ä¸è¦ã§ã™ã€‚

**ç†ç”±**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆPostï¼‰ã¯ VoiceDrive ãŒç®¡ç†
- æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ï¼ˆVoteï¼‰ã¯ VoiceDrive ãŒç®¡ç†
- æ‰¿èªãƒ‡ãƒ¼ã‚¿ï¼ˆProjectApprovalï¼‰ã¯ VoiceDrive ãŒç®¡ç†
- è·å“¡æƒ…å ±ï¼ˆUserï¼‰ã¯æ—¢ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿ï¼ˆæ¨©é™ãƒ¬ãƒ™ãƒ«å«ã‚€ï¼‰

---

## ğŸ¨ ã‚µãƒ¼ãƒ“ã‚¹å±¤è¨­è¨ˆ

### ProjectApprovalService

```typescript
class ProjectApprovalService {
  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ‰¿èª
  async approveProject(
    postId: string,
    approverId: string,
    comment?: string
  ): Promise<{ post: Post; approval: ProjectApproval }> {
    // 1. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const approver = await prisma.user.findUnique({ where: { id: approverId } });
    if (!approver) throw new Error('æ‰¿èªè€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    const post = await prisma.post.findUnique({
      where: { id: postId },
      include: { votes: true }
    });
    if (!post) throw new Error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 3. ã‚¹ã‚³ã‚¢è¨ˆç®—
    const score = this.calculateScore(post.votes);
    const projectLevel = this.getProjectLevel(score);

    // 4. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const permission = projectPermissionService.getPermission(approver, projectLevel);
    if (!permission.canApprove) {
      throw new Error('ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‰¿èªã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
    }

    // 5. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    return prisma.$transaction(async (tx) => {
      // 5-1. Postæ›´æ–°
      const updatedPost = await tx.post.update({
        where: { id: postId },
        data: {
          approvalStatus: 'approved',
          approvedAt: new Date(),
          approvedBy: approverId
        }
      });

      // 5-2. ProjectApprovalä½œæˆ
      const totalVotes = post.votes.length;
      const supportVotes = post.votes.filter(v =>
        v.option === 'strongly-support' || v.option === 'support'
      ).length;
      const supportRate = totalVotes > 0 ? (supportVotes / totalVotes) * 100 : 0;

      const approval = await tx.projectApproval.create({
        data: {
          postId,
          approverId,
          approverName: approver.name,
          approverLevel: approver.permissionLevel.toNumber(),
          action: 'approved',
          comment,
          projectLevel,
          projectScore: score,
          totalVotes,
          supportRate,
          isEmergencyOverride: false
        }
      });

      return { post: updatedPost, approval };
    });
  }

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå´ä¸‹
  async rejectProject(
    postId: string,
    approverId: string,
    reason: string
  ): Promise<{ post: Post; approval: ProjectApproval }> {
    // 1. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const approver = await prisma.user.findUnique({ where: { id: approverId } });
    if (!approver) throw new Error('æ‰¿èªè€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    const post = await prisma.post.findUnique({
      where: { id: postId },
      include: { votes: true }
    });
    if (!post) throw new Error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 3. ã‚¹ã‚³ã‚¢è¨ˆç®—
    const score = this.calculateScore(post.votes);
    const projectLevel = this.getProjectLevel(score);

    // 4. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const permission = projectPermissionService.getPermission(approver, projectLevel);
    if (!permission.canApprove) {
      throw new Error('ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å´ä¸‹ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
    }

    // 5. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    return prisma.$transaction(async (tx) => {
      // 5-1. Postæ›´æ–°
      const updatedPost = await tx.post.update({
        where: { id: postId },
        data: {
          approvalStatus: 'rejected',
          rejectedAt: new Date(),
          rejectedBy: approverId,
          rejectionReason: reason
        }
      });

      // 5-2. ProjectApprovalä½œæˆ
      const totalVotes = post.votes.length;
      const supportVotes = post.votes.filter(v =>
        v.option === 'strongly-support' || v.option === 'support'
      ).length;
      const supportRate = totalVotes > 0 ? (supportVotes / totalVotes) * 100 : 0;

      const approval = await tx.projectApproval.create({
        data: {
          postId,
          approverId,
          approverName: approver.name,
          approverLevel: approver.permissionLevel.toNumber(),
          action: 'rejected',
          reason,
          projectLevel,
          projectScore: score,
          totalVotes,
          supportRate,
          isEmergencyOverride: false
        }
      });

      return { post: updatedPost, approval };
    });
  }

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿ç•™
  async holdProject(
    postId: string,
    approverId: string,
    reason: string
  ): Promise<{ post: Post; approval: ProjectApproval }> {
    // 1. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const approver = await prisma.user.findUnique({ where: { id: approverId } });
    if (!approver) throw new Error('æ‰¿èªè€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    const post = await prisma.post.findUnique({
      where: { id: postId },
      include: { votes: true }
    });
    if (!post) throw new Error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 3. ã‚¹ã‚³ã‚¢è¨ˆç®—
    const score = this.calculateScore(post.votes);
    const projectLevel = this.getProjectLevel(score);

    // 4. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const permission = projectPermissionService.getPermission(approver, projectLevel);
    if (!permission.canApprove) {
      throw new Error('ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿ç•™ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
    }

    // 5. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    return prisma.$transaction(async (tx) => {
      // 5-1. Postæ›´æ–°
      const updatedPost = await tx.post.update({
        where: { id: postId },
        data: {
          approvalStatus: 'on_hold'
        }
      });

      // 5-2. ProjectApprovalä½œæˆ
      const totalVotes = post.votes.length;
      const supportVotes = post.votes.filter(v =>
        v.option === 'strongly-support' || v.option === 'support'
      ).length;
      const supportRate = totalVotes > 0 ? (supportVotes / totalVotes) * 100 : 0;

      const approval = await tx.projectApproval.create({
        data: {
          postId,
          approverId,
          approverName: approver.name,
          approverLevel: approver.permissionLevel.toNumber(),
          action: 'held',
          reason,
          projectLevel,
          projectScore: score,
          totalVotes,
          supportRate,
          isEmergencyOverride: false
        }
      });

      return { post: updatedPost, approval };
    });
  }

  // ç·Šæ€¥ä»‹å…¥
  async emergencyOverride(
    postId: string,
    approverId: string
  ): Promise<{ post: Post; approval: ProjectApproval }> {
    // 1. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const approver = await prisma.user.findUnique({ where: { id: approverId } });
    if (!approver) throw new Error('æ‰¿èªè€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    const post = await prisma.post.findUnique({
      where: { id: postId },
      include: { votes: true }
    });
    if (!post) throw new Error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // 3. ã‚¹ã‚³ã‚¢è¨ˆç®—
    const score = this.calculateScore(post.votes);
    const projectLevel = this.getProjectLevel(score);

    // 4. æ¨©é™ãƒã‚§ãƒƒã‚¯
    const permission = projectPermissionService.getPermission(approver, projectLevel);
    if (!permission.canEmergencyOverride) {
      throw new Error('ç·Šæ€¥ä»‹å…¥ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
    }

    // 5. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    return prisma.$transaction(async (tx) => {
      // 5-1. Postæ›´æ–°
      const updatedPost = await tx.post.update({
        where: { id: postId },
        data: {
          approvalStatus: 'approved',
          approvedAt: new Date(),
          approvedBy: approverId
        }
      });

      // 5-2. ProjectApprovalä½œæˆ
      const totalVotes = post.votes.length;
      const supportVotes = post.votes.filter(v =>
        v.option === 'strongly-support' || v.option === 'support'
      ).length;
      const supportRate = totalVotes > 0 ? (supportVotes / totalVotes) * 100 : 0;

      const approval = await tx.projectApproval.create({
        data: {
          postId,
          approverId,
          approverName: approver.name,
          approverLevel: approver.permissionLevel.toNumber(),
          action: 'emergency_override',
          comment: 'ä¸Šä½è€…ã«ã‚ˆã‚‹ç·Šæ€¥ä»‹å…¥',
          projectLevel,
          projectScore: score,
          totalVotes,
          supportRate,
          isEmergencyOverride: true
        }
      });

      return { post: updatedPost, approval };
    });
  }

  // æ‰¿èªå¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
  async getApprovableProjects(
    userId: string,
    filter: {
      projectLevel?: ProjectLevel;
      limit?: number;
      offset?: number;
    } = {}
  ): Promise<Post[]> {
    const user = await prisma.user.findUnique({ where: { id: userId } });
    if (!user) throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

    // æ‰¿èªå¯èƒ½ãƒ¬ãƒ™ãƒ«ã‚’å–å¾—
    const approvableLevels = projectPermissionService.getApprovableLevels(user);
    const levelStrings = approvableLevels.map(l => l.projectLevel);

    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    const posts = await prisma.post.findMany({
      where: {
        type: 'improvement',
        status: 'active',
        approvalStatus: 'pending',
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚¹ã‚³ã‚¢è¨ˆç®—å¾Œï¼‰
      },
      include: {
        author: true,
        votes: true,
        comments: {
          select: { id: true }
        }
      },
      orderBy: { createdAt: 'desc' },
      take: filter.limit || 50,
      skip: filter.offset || 0
    });

    // ã‚¹ã‚³ã‚¢ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    return posts.filter(post => {
      const score = this.calculateScore(post.votes);
      const projectLevel = this.getProjectLevel(score);

      // ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨
      if (filter.projectLevel && projectLevel !== filter.projectLevel) {
        return false;
      }

      // æ‰¿èªå¯èƒ½ãƒ¬ãƒ™ãƒ«ãƒã‚§ãƒƒã‚¯
      return levelStrings.includes(projectLevel);
    });
  }

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ã‚³ã‚¢è¨ˆç®—
  private calculateScore(votes: Vote[]): number {
    const weights = {
      'strongly-support': 2,
      'support': 1,
      'neutral': 0,
      'oppose': -1,
      'strongly-oppose': -2
    };

    return votes.reduce((sum, vote) => {
      return sum + (weights[vote.option] || 0);
    }, 0);
  }

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š
  private getProjectLevel(score: number): ProjectLevel {
    if (score >= 800) return 'ORGANIZATION';
    if (score >= 400) return 'FACILITY';
    if (score >= 200) return 'DEPARTMENT';
    if (score >= 100) return 'TEAM';
    return 'PENDING';
  }
}
```

---

## ğŸ“‹ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ

### 1. POST /api/project-approval/approve
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‰¿èªã™ã‚‹

**Request**:
```json
{
  "postId": "post-001",
  "comment": "ãƒãƒ¼ãƒ ç·¨æˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„"
}
```

**Response**:
```json
{
  "success": true,
  "post": {
    "id": "post-001",
    "approvalStatus": "approved",
    "approvedAt": "2025-10-11T10:00:00Z",
    "approvedBy": "user-1"
  },
  "approval": {
    "id": "approval-001",
    "action": "approved",
    "projectLevel": "DEPARTMENT",
    "projectScore": 250,
    "totalVotes": 50,
    "supportRate": 85.2
  }
}
```

---

### 2. POST /api/project-approval/reject
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å´ä¸‹ã™ã‚‹

**Request**:
```json
{
  "postId": "post-002",
  "reason": "äºˆç®—ãŒç¢ºä¿ã§ããªã„ãŸã‚ã€æ¥å¹´åº¦ã«å†æ¤œè¨"
}
```

**Response**:
```json
{
  "success": true,
  "post": {
    "id": "post-002",
    "approvalStatus": "rejected",
    "rejectedAt": "2025-10-11T10:05:00Z",
    "rejectedBy": "user-1",
    "rejectionReason": "äºˆç®—ãŒç¢ºä¿ã§ããªã„ãŸã‚ã€æ¥å¹´åº¦ã«å†æ¤œè¨"
  },
  "approval": {
    "id": "approval-002",
    "action": "rejected",
    "reason": "äºˆç®—ãŒç¢ºä¿ã§ããªã„ãŸã‚ã€æ¥å¹´åº¦ã«å†æ¤œè¨"
  }
}
```

---

### 3. POST /api/project-approval/hold
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿ç•™ã™ã‚‹

**Request**:
```json
{
  "postId": "post-003",
  "reason": "ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã®èª¿æ•´ãŒå¿…è¦"
}
```

**Response**:
```json
{
  "success": true,
  "post": {
    "id": "post-003",
    "approvalStatus": "on_hold"
  },
  "approval": {
    "id": "approval-003",
    "action": "held",
    "reason": "ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã®èª¿æ•´ãŒå¿…è¦"
  }
}
```

---

### 4. POST /api/project-approval/emergency-override
ç·Šæ€¥ä»‹å…¥ï¼ˆä¸Šä½è€…å°‚ç”¨ï¼‰

**Request**:
```json
{
  "postId": "post-004"
}
```

**Response**:
```json
{
  "success": true,
  "post": {
    "id": "post-004",
    "approvalStatus": "approved",
    "approvedAt": "2025-10-11T10:10:00Z",
    "approvedBy": "user-18"
  },
  "approval": {
    "id": "approval-004",
    "action": "emergency_override",
    "isEmergencyOverride": true,
    "comment": "ä¸Šä½è€…ã«ã‚ˆã‚‹ç·Šæ€¥ä»‹å…¥"
  },
  "warning": "ã“ã®æ“ä½œã¯ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã—ãŸï¼ˆé‡è¦åº¦: criticalï¼‰"
}
```

---

### 5. GET /api/project-approval/approvable
æ‰¿èªå¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—

**Request**:
```http
GET /api/project-approval/approvable?projectLevel=DEPARTMENT&limit=20&offset=0
```

**Response**:
```json
{
  "projects": [
    {
      "id": "post-005",
      "type": "improvement",
      "proposalType": "operational",
      "content": "æ–°äººæ•™è‚²ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä½“ç³»åŒ–ã¨ãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ã®å°å…¥",
      "author": {
        "id": "user-2",
        "name": "ç”°ä¸­æ¬¡éƒ",
        "department": "çœ‹è­·éƒ¨"
      },
      "currentScore": 250,
      "projectLevel": "DEPARTMENT",
      "totalVotes": 50,
      "supportRate": 85.2,
      "estimatedTeamSize": 15,
      "projectScale": "medium",
      "permission": {
        "canApprove": true,
        "canFormTeam": true,
        "role": "approver",
        "badge": "âœ… æ‰¿èªè€…"
      }
    }
  ],
  "pagination": {
    "limit": 20,
    "offset": 0,
    "totalCount": 45
  }
}
```

---

### 6. GET /api/project-approval/history/:postId
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‰¿èªå±¥æ­´å–å¾—

**Request**:
```http
GET /api/project-approval/history/post-001
```

**Response**:
```json
{
  "postId": "post-001",
  "history": [
    {
      "id": "approval-001",
      "action": "approved",
      "approver": {
        "id": "user-1",
        "name": "å±±ç”°å¤ªéƒ",
        "permissionLevel": 8
      },
      "projectLevel": "DEPARTMENT",
      "projectScore": 250,
      "totalVotes": 50,
      "supportRate": 85.2,
      "isEmergencyOverride": false,
      "createdAt": "2025-10-11T10:00:00Z"
    }
  ]
}
```

---

## ğŸ“… å®Ÿè£…è¨ˆç”»

### Phase 1: DBãƒ»ã‚µãƒ¼ãƒ“ã‚¹å±¤å®Ÿè£…ï¼ˆ2æ—¥é–“ï¼‰

**Day 1**:
- [x] DBè¦ä»¶åˆ†ææ›¸ä½œæˆ â† ä»Šã“ã“
- [ ] ProjectApprovalãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ï¼ˆPrisma schemaæ›´æ–°ï¼‰
- [ ] Postæ‹¡å¼µãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆapprovalStatusç­‰ï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] ProjectApprovalService å®Ÿè£…
  - approveProject()
  - rejectProject()
  - holdProject()
  - emergencyOverride()
  - getApprovableProjects()
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ

**Day 2**:
- [ ] APIå®Ÿè£…
  - POST /api/project-approval/approve
  - POST /api/project-approval/reject
  - POST /api/project-approval/hold
  - POST /api/project-approval/emergency-override
  - GET /api/project-approval/approvable
  - GET /api/project-approval/history/:postId
- [ ] APIãƒ†ã‚¹ãƒˆ

---

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆï¼ˆ1æ—¥é–“ï¼‰

**Day 3**:
- [ ] ProjectApprovalPage.tsx ä¿®æ­£
  - getDemoPosts() â†’ APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
  - handleApprove() å®Ÿè£…
  - handleReject() å®Ÿè£…
  - handleHold() å®Ÿè£…
  - handleEmergencyOverride() å®Ÿè£…
  - handleFormTeam() å®Ÿè£…
- [ ] useProjectApproval() ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ä½œæˆ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- [ ] ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å®Ÿè£…ï¼ˆå´ä¸‹ç†ç”±å…¥åŠ›ã€ç·Šæ€¥ä»‹å…¥è­¦å‘Šï¼‰

---

### Phase 3: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ1æ—¥é–“ï¼‰

**Day 4**:
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆå„ãƒ¬ãƒ™ãƒ«ã§ã®è¡¨ç¤ºãƒ»æ“ä½œç¢ºèªï¼‰
- [ ] ç›£æŸ»ãƒ­ã‚°ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

---

**åˆè¨ˆ**: 4æ—¥é–“ï¼ˆ1é€±é–“ä»¥å†…ï¼‰

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [ ] ProjectApprovalãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] Post.approvalStatus ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] Post.approvedAt ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] Post.approvedBy ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] Post.rejectedAt ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] Post.rejectedBy ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] Post.rejectionReason ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- [ ] è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆPost: approvalStatus + createdAtï¼‰
- [ ] è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆProjectApproval: approverId + projectLevelï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### ã‚µãƒ¼ãƒ“ã‚¹å±¤
- [ ] ProjectApprovalService å®Ÿè£…
- [ ] approveProject() å®Ÿè£…
- [ ] rejectProject() å®Ÿè£…
- [ ] holdProject() å®Ÿè£…
- [ ] emergencyOverride() å®Ÿè£…
- [ ] getApprovableProjects() å®Ÿè£…
- [ ] calculateScore() å®Ÿè£…
- [ ] getProjectLevel() å®Ÿè£…

### API
- [ ] POST /api/project-approval/approve å®Ÿè£…
- [ ] POST /api/project-approval/reject å®Ÿè£…
- [ ] POST /api/project-approval/hold å®Ÿè£…
- [ ] POST /api/project-approval/emergency-override å®Ÿè£…
- [ ] GET /api/project-approval/approvable å®Ÿè£…
- [ ] GET /api/project-approval/history/:postId å®Ÿè£…

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] APIçµ±åˆï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰
- [ ] useProjectApproval() ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤º
- [ ] ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å®Ÿè£…
- [ ] æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼é€šçŸ¥å®Ÿè£…

### ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- [ ] APIçµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆ
- [ ] ç›£æŸ»ãƒ­ã‚°ç¢ºèª

---

## ğŸ“ è£œè¶³äº‹é …

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®šåŸºæº–

**âš ï¸ 2025-10-11æ›´æ–°**: çµ„ç¹”éšå±¤ã«åˆã‚ã›ã¦æ‰¿èªè€…ãƒ¬ãƒ™ãƒ«ã‚’èª¿æ•´

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ« | ã‚¹ã‚³ã‚¢ç¯„å›² | æ‰¿èªè€…ãƒ¬ãƒ™ãƒ« | æ‰¿èªè€…å½¹è· | ä»£è¡Œå¯èƒ½ãƒ¬ãƒ™ãƒ« | èª¬æ˜ |
|------------------|-----------|------------|-----------|--------------|------|
| PENDING | 0-99ç‚¹ | **6ï¼ˆä¸»ä»»ï¼‰** | ä¸»ä»» | 5ï¼ˆå‰¯ä¸»ä»»ï¼‰ | ã‚¢ã‚¤ãƒ‡ã‚¢æ¤œè¨ä¸­ |
| TEAM | 100-199ç‚¹ | **8ï¼ˆå¸«é•·ï¼‰** | å¸«é•·ãƒ»ç§‘é•· | 7ï¼ˆå‰¯å¸«é•·ï¼‰ | ãƒãƒ¼ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ5-15åï¼‰ |
| DEPARTMENT | 200-399ç‚¹ | **10ï¼ˆéƒ¨é•·ï¼‰** | éƒ¨é•·ãƒ»åŒ»å±€é•· | 9ï¼ˆå‰¯éƒ¨é•·ï¼‰ | éƒ¨ç½²ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ15-30åï¼‰ |
| FACILITY | 400-799ç‚¹ | **11ï¼ˆäº‹å‹™é•·ï¼‰** | äº‹å‹™é•· | ãªã— | æ–½è¨­ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ30-60åï¼‰ |
| ORGANIZATION | 800ç‚¹ä»¥ä¸Š | **13ï¼ˆé™¢é•·ï¼‰** | é™¢é•·ãƒ»æ–½è¨­é•· | 12ï¼ˆå‰¯é™¢é•·ï¼‰ | æ³•äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ60åä»¥ä¸Šï¼‰ |
| STRATEGIC | æˆ¦ç•¥æŒ‡å®š | **18ï¼ˆç†äº‹é•·ï¼‰** | ç†äº‹é•· | ãªã— | æˆ¦ç•¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆç†äº‹é•·æ‰¿èªï¼‰ |

**å¤‰æ›´ç†ç”±**:
- ä¸»ä»»ï¼ˆ6ï¼‰ã¯ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦ã‚¢ã‚¤ãƒ‡ã‚¢æ®µéšã®åˆ¤æ–­ã«é©ä»»
- å¸«é•·ï¼ˆ8ï¼‰ã¯ãƒãƒ¼ãƒ ï¼ˆ5-15åï¼‰ã‚’çµ±æ‹¬ã™ã‚‹ç«‹å ´ã§é©åˆ‡
- éƒ¨é•·ï¼ˆ10ï¼‰ã¯éƒ¨ç½²æ¨ªæ–­ï¼ˆ15-30åï¼‰ã®æ‰¿èªæ¨©é™ã‚’æŒã¤
- äº‹å‹™é•·ï¼ˆ11ï¼‰ã¯æ–½è¨­å…¨ä½“ã®äºˆç®—ãƒ»ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã®è²¬ä»»è€…

### æ¨©é™åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

**æ‰¿èªè€…ï¼ˆApproverï¼‰**:
- `userLevel === responsibility.targetPermissionLevel`
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹ã‚’æ‰¿èªã§ãã‚‹

**ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰¿èªè€…**:
- `userLevel >= responsibility.minPermissionLevel && userLevel < responsibility.targetPermissionLevel`
- æœ¬æ¥ã®æ‰¿èªè€…ãŒä¸åœ¨ã®å ´åˆã«æ‰¿èªå¯èƒ½

**ä¸Šä½ç›£ç£è€…ï¼ˆSupervisorï¼‰**:
- `userLevel > responsibility.targetPermissionLevel && (userLevel - targetLevel) <= 2`
- ã‚¢ãƒ‰ãƒã‚¤ã‚¹å¯èƒ½ã€ç·Šæ€¥ä»‹å…¥å¯èƒ½

**å‚è€ƒé–²è¦§è€…ï¼ˆObserverï¼‰**:
- `userLevel > responsibility.targetPermissionLevel && (userLevel - targetLevel) > 2`
- ã¾ãŸã¯ `userLevel < responsibility.targetPermissionLevel && userLevel >= (minLevel - 2)`
- é–²è¦§ã®ã¿

### ç›£æŸ»ãƒ­ã‚°é‡è¦åº¦

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | severity | ç†ç”± |
|----------|----------|------|
| PROJECT_APPROVED | high | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹ã¯é‡è¦ãªæ„æ€æ±ºå®š |
| PROJECT_REJECTED | medium | å´ä¸‹ã‚‚è¨˜éŒ²ãŒå¿…è¦ |
| PROJECT_HELD | low | ä¿ç•™ã¯ä¸€æ™‚çš„ãªåˆ¤æ–­ |
| PROJECT_EMERGENCY_OVERRIDE | critical | æ¨©é™å¤–ã®ä»‹å…¥ã¯æœ€é‡è¦ |
| PROJECT_TEAM_FORMATION_STARTED | medium | ãƒãƒ¼ãƒ ç·¨æˆé–‹å§‹ |

---

**æ–‡æ›¸çµ‚äº†**

æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ11æ—¥
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆä½œæˆ
