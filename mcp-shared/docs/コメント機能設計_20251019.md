# コメント機能設計
作成日: 2025年10月19日

## コンセプト

**投稿から最高議題化までのプロセスで、関係者がコメントを残すことで意思決定の透明性を確保する**

---

## コメントの種類

### 1. 一般コメント（全職員）
```
誰が: 全職員（閲覧権限のある職員）
いつ: いつでも
目的: 質問・意見・賛成理由・懸念事項の共有

例:
【看護師B】
「夜勤3名体制は賛成です。急変時の対応が安心になります。」

【看護師C】
「人員確保の見通しはありますか？」
```

### 2. 管理職コメント（判断時）
```
誰が: 主任・師長・副看護部長・事務長・事務局長
いつ: 承認/却下/昇格の判断時
目的: 判断理由の明確化

例:
【主任コメント（師長に推薦時）】
「夜勤帯の安全確保は急務です。部署として優先度が高いと判断しました。」

【師長コメント（部署議題承認時）】
「予算確保の見通しが立ちました。試験的に3ヶ月間実施します。」

【副看護部長コメント（却下時）】
「現在の予算状況では施設全体での実施は困難です。
ただし、部署独自の取り組みとして進める価値はあると考えます。」
```

### 3. 協議コメント（判断前の相談）
```
誰が: 管理職同士
いつ: 判断前
目的: 関係者間の協議の可視化

例:
【事務長が院長に相談】
「院長、この案件について施設議題化を検討していますが、ご意見をお聞かせください。」

【院長の返信】
「施設独自の取り組みとして進める価値はあります。予算は確保できます。」

【事務長の最終判断】
「院長とも協議の上、施設議題として承認します。」
```

---

## コメント機能の実装

### データ構造

```typescript
interface PostComment {
  id: string;
  postId: string;
  userId: string;
  user: User;
  content: string;
  commentType: CommentType;
  createdAt: Date;
  updatedAt?: Date;

  // 判断時コメントの場合
  decisionType?: 'approve' | 'reject' | 'escalate';
  agendaLevel?: AgendaLevel;

  // 協議コメント（管理職専用）
  isPrivate?: boolean; // trueの場合、管理職のみ閲覧可能
  mentionedUsers?: User[]; // @メンション機能
}

type CommentType =
  | 'general'           // 一般コメント
  | 'decision'          // 判断時コメント
  | 'consultation';     // 協議コメント（管理職専用）
```

### コメント表示の例

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
投稿: 夜勤看護師3名体制の提案
現在: 100点（施設議題） - 副看護部長の判断待ち
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【投稿内容】
現在、夜勤帯は看護師2名体制ですが、患者急変時の対応が困難です...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
コメント（25件）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 判断履歴

【50点到達】2025年10月15日
┌─────────────────────────┐
│ 主任（Level 3.5）→ 師長に推薦           │
│                                          │
│ 「夜勤帯の安全確保は急務です。          │
│  部署として優先度が高いと判断しました。」│
└─────────────────────────┘

【師長が部署議題承認】2025年10月18日
┌─────────────────────────┐
│ 師長（Level 7）→ 部署議題として承認     │
│                                          │
│ 「予算確保の見通しが立ちました。        │
│  試験的に3ヶ月間実施します。」          │
└─────────────────────────┘

【100点到達】2025年10月19日
┌─────────────────────────┐
│ 副看護部長の判断待ち                     │
└─────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💬 一般コメント（22件）

【田中花子（投稿者）】2025年10月10日 12:00
「夜勤帯の急変対応が不安です。3名体制を検討していただけないでしょうか。」

【看護師B】2025年10月11日 09:30
「賛成です！夜勤2名では急変時にナースコールに対応できません。」

【看護師C】2025年10月11日 14:20
「人員確保の見通しはありますか？」
  ↓
  【主任の返信】2025年10月12日 10:00
  「現在、新人看護師2名が夜勤研修中です。来月から夜勤に入れる予定です。」

【リハビリ科D】2025年10月13日 16:00
「他部署ですが、夜間リハビリの依頼がしやすくなるので賛成します。」

【看護師E】2025年10月14日 08:30
「賛成！患者さんの安全が第一です。」

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔒 管理職協議（3件）※管理職のみ閲覧可能

【副看護部長】2025年10月19日 10:00
「@院長 @事務長
この案件について施設議題として承認するか検討中です。
予算面でのご意見をお聞かせください。」

【院長】2025年10月19日 11:30
「安全面では必要性を感じます。予算は確保できます。」

【事務長】2025年10月19日 13:00
「施設全体での展開は難しいですが、医療療養病棟のみであれば可能です。」
```

---

## コメント機能の実装箇所

### 1. 投稿詳細ページ

```typescript
// コメントセクションの表示
<CommentSection postId={postId}>
  {/* 判断履歴 */}
  <DecisionHistory comments={decisionComments} />

  {/* 一般コメント */}
  <GeneralComments comments={generalComments} />

  {/* 管理職協議（管理職のみ表示） */}
  {isManager && (
    <ConsultationComments comments={consultationComments} />
  )}

  {/* コメント投稿フォーム */}
  <CommentForm
    postId={postId}
    currentUser={currentUser}
    onSubmit={handleCommentSubmit}
  />
</CommentSection>
```

### 2. 判断画面でのコメント入力

```typescript
// 主任の判断画面
<DecisionForm>
  <h2>部署議題の承認/却下</h2>

  {/* 判断ボタン */}
  <div className="decision-buttons">
    <button onClick={() => setDecision('recommend')}>
      師長に推薦
    </button>
    <button onClick={() => setDecision('reject')}>
      却下
    </button>
  </div>

  {/* 判断理由コメント（必須） */}
  <textarea
    placeholder="判断理由を入力してください（この内容は全職員に公開されます）"
    value={decisionComment}
    onChange={(e) => setDecisionComment(e.target.value)}
    required
  />

  {/* 協議コメント（任意・管理職のみ閲覧） */}
  <textarea
    placeholder="管理職への補足説明（任意・管理職のみ閲覧）"
    value={consultationComment}
    onChange={(e) => setConsultationComment(e.target.value)}
  />
</DecisionForm>
```

### 3. 通知へのコメント反映

```typescript
// 師長への通知
【通知】師長（Level 7）に通知
  タイトル: 「部署議題の承認依頼」
  メッセージ: 「主任が『夜勤看護師3名体制の提案』を部署議題として推薦しました。

              主任コメント:
              『夜勤帯の安全確保は急務です。
               部署として優先度が高いと判断しました。』

              部署議題として承認するか、施設議題に昇格するか、却下するかを判断してください。」
  アクション: [承認/昇格/却下画面を開く]
```

---

## コメント機能の価値

### 1. プロセスの可視化

```
従来:
「主任が却下した」← 理由不明

VoiceDrive:
「主任が却下した」
理由: 「現在の人員配置では実現が困難です。
      来年度の予算編成時に再検討します。」
```

### 2. 協議プロセスの透明化

```
従来:
副看護部長が単独で判断（裏で誰と話したか不明）

VoiceDrive:
副看護部長が院長・事務長と協議
  ↓
協議コメントが残る（管理職は閲覧可能）
  ↓
組織としての意思決定プロセスが見える
```

### 3. 職員の声が届く

```
一般職員のコメント:
「賛成です！夜勤2名では急変時にナースコールに対応できません。」
  ↓
主任が判断時にこのコメントを参考にする
  ↓
判断理由に反映される:
「職員からも強い要望があり、安全面での必要性が高いと判断しました。」
```

### 4. 学習効果

```
投稿者:
「なるほど、却下されたのは予算不足が理由か。
 次回は予算試算を明確にして提案しよう。」

他の職員:
「こういう提案の仕方をすれば通りやすいんだな。」

管理職:
「他の管理職がどういう判断理由を書いているか参考になる。」
```

---

## 実装優先度

### Phase 1（必須）
- ✅ 一般コメント機能
- ✅ 判断時コメント（必須入力）
- ✅ コメント表示（投稿詳細ページ）

### Phase 2（推奨）
- 🔄 協議コメント（管理職専用）
- 🔄 @メンション機能
- 🔄 コメント通知

### Phase 3（オプション）
- 💡 コメントへの返信（スレッド形式）
- 💡 コメントの編集・削除
- 💡 コメントの「いいね」機能

---

## まとめ

### 職員の投稿から最高議題化までのプロセス

```
【完全に可視化されたプロセス】

1. 投稿 → 一般職員がコメント
   「賛成！」「人員確保は？」

2. 30点 → 主任・師長に通知
   （コメントで質疑応答）

3. 50点 → 主任が判断コメント付きで推薦
   「部署として優先度が高い」

4. 師長が判断コメント付きで承認
   「予算確保の見通しが立った」

5. 100点 → 副看護部長が協議コメントで院長・事務長と相談
   （管理職のみ閲覧可能）

6. 副看護部長が判断コメント付きで承認
   「施設として重要案件と判断」

7. 委員会提出 → 全職員に通知
   「承認されました」

【結果】
- 全ての判断に理由がある
- 職員の声が反映されている
- 協議プロセスも見える
- 次回の改善に活かせる
```

**これが「組織診断ツールとしてのVoiceDrive」の完成形です。**

---

次のステップ: このコメント機能を実装しますか？
