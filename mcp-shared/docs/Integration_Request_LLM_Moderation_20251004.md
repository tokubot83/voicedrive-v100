# LLMコンテンツモデレーション統合テスト連携作業依頼書

**発信日**: 2025年10月4日
**発信元**: VoiceDriveシステム開発チーム
**宛先**: 医療職員管理システム開発チーム
**件名**: LLMコンテンツモデレーション統合テスト実施のお願い

---

## 📋 エグゼクティブサマリー

VoiceDriveチームは、貴チームからご提案いただいたLlama 3.2 8B ローカルLLMを活用したコンテンツモデレーションシステムの統合準備が完了いたしました。

統合テストの実施に向けて、以下の連携作業をお願いしたく、本依頼書を作成いたしました。

---

## ✅ VoiceDrive側実装完了内容

### Phase 1: クライアント側モデレーション（完了）

**実装期間**: 2025年10月1日～10月4日

#### 実装機能
1. **ClientModerationService** (400行)
   - 禁止フレーズ検出（100種類以上）
   - 代替表現提案（40種類以上）
   - 建設性スコア算出（0-100）
   - 300msデバウンスによるリアルタイムチェック
   - **サーバー負荷**: ゼロ

2. **PostReportService** (350行)
   - 7種類の通報理由
   - 閾値ベースアラート（1/3/5/10件）
   - 完全匿名保護
   - 管理者自動通知

3. **UI統合**
   - ComposeFormにリアルタイム警告表示
   - 全投稿タイプに通報ボタン統合
   - 25レベル権限システム対応

**Git Commit**: `f76e55d` (2025-10-04)

---

### Phase 2: LLM API連携基盤（準備完了）

**実装期間**: 2025年10月4日

#### 実装機能

1. **型定義システム** (`src/types/llmModeration.ts`)
   ```typescript
   - LLMModerationRequest/Result
   - 11種類の違反タイプ定義
   - ハイブリッドモデレーション結果型
   ```

2. **LLMModerationService** (400行)
   - API呼び出し（タイムアウト3秒、リトライ2回）
   - レスポンスキャッシュ（5分間）
   - 統計情報収集
   - ヘルスチェック機能
   - フォールバック機能

3. **HybridModerationService** (300行)
   - クライアント + LLM統合判定
   - 3層モデレーションアーキテクチャ
   - 自動フォールバック戦略

4. **MockLLMAPIServer** (350行)
   - 開発・テスト用モックAPI
   - Llama 3.2 8B動作シミュレート
   - 300-800ms処理時間再現

5. **ドキュメント**
   - `.env.example` - 環境変数テンプレート
   - `docs/PHASE2_LLM_INTEGRATION.md` - 統合ガイド

**Git Commit**: `c5e133e` (2025-10-04)

---

## 🏗️ ハイブリッドモデレーションアーキテクチャ

```
ユーザー投稿
    ↓
┌─────────────────────────────┐
│ Layer 1: クライアント側      │
│ ・即座チェック（300ms）      │
│ ・禁止フレーズ検出          │
│ ・代替表現提案              │
│ ・サーバー負荷ゼロ          │
└─────────────────────────────┘
    ↓
┌─────────────────────────────┐
│ Layer 2: LLM API詳細分析     │
│ ・Llama 3.2 8B              │
│ ・文脈理解・ニュアンス検出   │
│ ・2秒以内レスポンス         │
│ ・信頼度70-95%              │
└─────────────────────────────┘
    ↓
┌─────────────────────────────┐
│ Layer 3: 統合判定            │
│ ・両結果を統合              │
│ ・より厳しい判定を採用       │
│ ・API障害時は自動フォールバック│
└─────────────────────────────┘
    ↓
最終判定（投稿可否）
```

---

## 🎯 医療チーム実装依頼内容

### 1. LLM APIエンドポイント実装

#### エンドポイント仕様

**URL**: `POST /api/moderate`

**リクエストボディ**:
```json
{
  "content": "チェック対象テキスト",
  "context": {
    "postType": "improvement" | "community" | "report",
    "authorLevel": 3,
    "department": "看護部"
  },
  "options": {
    "checkSensitivity": "low" | "medium" | "high",
    "language": "ja",
    "includeExplanation": true
  }
}
```

**レスポンスボディ**:
```json
{
  "allowed": false,
  "severity": "none" | "low" | "medium" | "high" | "critical",
  "confidence": 87,
  "violations": [
    {
      "type": "personal_attack",
      "severity": "high",
      "description": "特定の個人への攻撃的な表現が検出されました",
      "extractedText": "バカ",
      "startIndex": 10,
      "endIndex": 12,
      "confidence": 92
    }
  ],
  "explanation": "以下の理由により投稿をブロックしました：特定の個人への攻撃的な表現が検出されました。",
  "suggestedEdits": [
    "改善の余地があると考えます"
  ],
  "metadata": {
    "modelVersion": "llama-3.2-8b-v1.0",
    "processingTime": 1847,
    "timestamp": "2025-10-04T12:34:56Z"
  }
}
```

#### 違反タイプ定義

```typescript
type LLMViolationType =
  | 'personal_attack'       // 個人攻撃
  | 'defamation'            // 誹謗中傷
  | 'harassment'            // ハラスメント（パワハラ・セクハラ等）
  | 'discrimination'        // 差別的表現
  | 'privacy_violation'     // プライバシー侵害
  | 'inappropriate_content' // 不適切なコンテンツ
  | 'threatening'           // 脅迫的表現
  | 'hate_speech'          // ヘイトスピーチ
  | 'misinformation'       // 誤情報・デマ
  | 'spam'                 // スパム
  | 'other';               // その他
```

### 2. パフォーマンス要件

| 指標 | 目標値 | 必須/推奨 |
|------|--------|----------|
| 平均応答時間 | 2秒以内 | 必須 |
| P95応答時間 | 3秒以内 | 推奨 |
| タイムアウト | 3秒 | 必須 |
| 信頼度 | 70-95% | 推奨 |
| 可用性 | 99% | 推奨 |
| 同時接続数 | 100接続 | 推奨 |

### 3. セキュリティ要件

- ✅ **認証**: API Key認証（Bearerトークン）
- ✅ **通信**: HTTPS必須（本番環境）
- ✅ **データ保持**: 投稿内容の保存禁止
- ✅ **ログ**: アクセスログのみ（内容は非保持）
- ✅ **プライバシー**: ローカルLLM処理（外部送信なし）

### 4. インフラ要件

- **環境**: AWS Lightsail（貴チーム提案通り）
- **モデル**: Llama 3.2 8B
- **推論エンジン**: llama.cpp または同等
- **リソース**:
  - メモリ: 16GB以上推奨
  - CPU: 8コア以上推奨
  - GPU: オプション（高速化のため）

---

## 🧪 統合テスト計画

### Week 9: 接続テスト

**VoiceDrive側作業**:
- [ ] モックLLMから実API切り替え
- [ ] 環境変数設定
- [ ] 接続確認

**医療チーム側作業**:
- [ ] API実装完了
- [ ] 開発環境デプロイ
- [ ] エンドポイント公開
- [ ] API Key発行

**合同作業**:
- [ ] 接続テスト実施
- [ ] 基本動作確認
- [ ] エラーハンドリング確認

### Week 10: 機能テスト

**テストケース**:

1. **正常系テスト**
   ```
   - 問題ない投稿 → allowed: true
   - 建設的な提案 → severity: none
   - 適切な表現 → confidence: 高
   ```

2. **異常系テスト**
   ```
   - 個人攻撃 → personal_attack検出
   - ハラスメント → harassment検出
   - 差別表現 → discrimination検出
   ```

3. **境界値テスト**
   ```
   - 長文（1000文字以上）
   - 特殊文字含む
   - 多言語混在
   ```

4. **パフォーマンステスト**
   ```
   - レスポンス時間測定
   - 同時接続数テスト
   - キャッシュ効果測定
   ```

### Week 11: 負荷テスト

**シナリオ**:
- 同時100ユーザー
- 1分間に300リクエスト
- 24時間連続稼働

**測定項目**:
- 平均応答時間
- P95/P99応答時間
- エラー率
- リソース使用率

### Week 12: 統合受入テスト

**確認事項**:
- [ ] 全機能正常動作
- [ ] パフォーマンス要件達成
- [ ] セキュリティ要件達成
- [ ] ドキュメント整備
- [ ] 運用手順確認

---

## 📅 提案スケジュール

| 期間 | フェーズ | VoiceDrive | 医療チーム | 合同 |
|------|---------|-----------|-----------|------|
| Week 5-8 | 実装 | 待機・準備 | ✅ API実装<br>✅ デプロイ | - |
| Week 9 | 接続テスト | ✅ API統合 | ✅ サポート | ✅ 接続確認 |
| Week 10 | 機能テスト | ✅ テスト実施 | ✅ 問題対応 | ✅ 結果検証 |
| Week 11 | 負荷テスト | ✅ 負荷生成 | ✅ 性能調整 | ✅ 分析 |
| Week 12 | 受入テスト | ✅ 最終確認 | ✅ 最終確認 | ✅ Go/No-Go判定 |

---

## 📦 提供資料

### VoiceDriveから医療チームへ提供

1. **技術ドキュメント**
   - ✅ API仕様書: `docs/PHASE2_LLM_INTEGRATION.md`
   - ✅ 型定義: `src/types/llmModeration.ts`
   - ✅ 環境変数テンプレート: `.env.example`

2. **テストツール**
   - ✅ モックLLM実装: `src/services/MockLLMAPIServer.ts`
   - ✅ 統合テストスクリプト（準備予定）

3. **サンプルデータ**
   - 正常系テストケース（100件）
   - 異常系テストケース（50件）
   - 境界値テストケース（30件）

### 医療チームからVoiceDriveへ提供依頼

1. **API情報**
   - [ ] エンドポイントURL
   - [ ] API Key
   - [ ] レート制限情報
   - [ ] メンテナンス予定

2. **技術情報**
   - [ ] モデルバージョン情報
   - [ ] 処理時間目安
   - [ ] エラーコード一覧

3. **運用情報**
   - [ ] 監視ダッシュボードURL
   - [ ] 障害時連絡先
   - [ ] エスカレーションフロー

---

## 🔧 開発環境情報

### VoiceDrive開発環境

```
エンドポイント: http://localhost:3001
フレームワーク: React + TypeScript
モデレーションサービス: src/services/HybridModerationService.ts
環境変数: .env (ローカル)
```

### 医療チーム開発環境（想定）

```
エンドポイント: http://medical-llm-api:8000/api/moderate
インフラ: AWS Lightsail
モデル: Llama 3.2 8B
推論エンジン: llama.cpp
```

---

## 📞 連絡体制

### VoiceDriveチーム窓口

| 役割 | 担当者 | 連絡先 | 対応時間 |
|------|--------|--------|---------|
| プロジェクトリード | （氏名） | voicedrive-lead@example.com | 平日9-18時 |
| 技術責任者 | （氏名） | voicedrive-tech@example.com | 平日9-20時 |
| 統合テスト担当 | （氏名） | voicedrive-test@example.com | 平日9-18時 |
| 緊急対応 | （氏名） | voicedrive-emergency@example.com | 24/7 |

### 医療チーム窓口（記入依頼）

| 役割 | 担当者 | 連絡先 | 対応時間 |
|------|--------|--------|---------|
| プロジェクトリード | | | |
| API開発責任者 | | | |
| インフラ担当 | | | |
| 緊急対応 | | | |

### コミュニケーション手段

- **日常連絡**: Slack #llm-integration
- **定例会議**: 毎週月曜 10:00-11:00
- **技術相談**: Zoom（随時）
- **緊急連絡**: 電話/SMS

---

## ✅ 合意事項確認

以下の事項についてご確認・合意をお願いいたします。

### 技術仕様
- [ ] API仕様書の内容に合意
- [ ] パフォーマンス要件に合意
- [ ] セキュリティ要件に合意
- [ ] エラーハンドリング方式に合意

### スケジュール
- [ ] Week 5-8: API実装完了目標に合意
- [ ] Week 9: 接続テスト実施に合意
- [ ] Week 10: 機能テスト実施に合意
- [ ] Week 11-12: 負荷・受入テストに合意

### 体制
- [ ] 連絡窓口の設定に合意
- [ ] 定例会議の開催に合意
- [ ] 緊急時対応体制に合意

### その他
- [ ] データプライバシーポリシーに合意
- [ ] 運用・保守方針に合意
- [ ] ドキュメント管理方法に合意

---

## 📝 次のアクション

### 医療チーム様へのお願い

1. **本依頼書のレビュー**（1週間以内）
   - API仕様の確認・修正提案
   - スケジュールの調整
   - 不明点の質問

2. **実装開始準備**（Week 5開始前）
   - 開発環境の準備
   - 必要なリソースの確保
   - 担当者のアサイン

3. **キックオフミーティング**（Week 5初日）
   - 詳細仕様の最終確認
   - 開発スケジュールの調整
   - 課題・リスクの共有

### VoiceDriveチーム作業

1. **サンプルデータ準備**（Week 5中）
   - テストケース作成
   - 期待値データ準備

2. **統合テスト環境構築**（Week 8中）
   - テスト環境セットアップ
   - モニタリング設定

3. **待機・サポート体制確立**（Week 9-12）
   - 統合テスト対応
   - 問題解決支援

---

## 🙏 結びに

VoiceDriveチームは、貴チームのご提案を受けて、LLMコンテンツモデレーションシステムの統合準備を完了いたしました。

本システムは、医療法人における安全なSNS運営と職員の健全なコミュニケーション促進に大きく貢献するものと確信しております。

統合テストの成功に向けて、今後とも緊密に連携させていただきたく、何卒よろしくお願い申し上げます。

ご不明な点やご要望がございましたら、お気軽にお問い合わせください。

---

**VoiceDriveシステム開発チーム一同**

**作成日**: 2025年10月4日
**ドキュメントバージョン**: v1.0
**Git Commit**: `c5e133e`

---

## 📎 添付資料

1. `docs/PHASE2_LLM_INTEGRATION.md` - 詳細統合ガイド
2. `src/types/llmModeration.ts` - TypeScript型定義
3. `.env.example` - 環境変数テンプレート
4. `src/services/MockLLMAPIServer.ts` - モック実装参考

**GitHub Repository**: https://github.com/tokubot83/voicedrive-v100
