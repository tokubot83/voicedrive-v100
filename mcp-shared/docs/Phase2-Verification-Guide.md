# Phase 2 動作確認ガイド

**作成日**: 2025年10月26日
**目的**: Phase 2（医療システム連携監視）が正しく動作していることを確認

---

## ✅ 開発サーバーの起動確認

### 現在の状態

```
✅ 開発サーバーが起動しました
URL: http://localhost:5173/
```

---

## 📋 Phase 2動作確認手順

### Step 1: ブラウザでアクセス

1. ブラウザ（Chrome/Edge推奨）を開く
2. 以下のURLにアクセス:
   ```
   http://localhost:5173/
   ```

### Step 2: ログイン

**管理者アカウント**（Level 99が必要）:
- Email: `admin@voicedrive.local`
- Password: （開発環境のデフォルトパスワード）

または、データベースに存在するLevel 99のアカウント

### Step 3: SystemMonitorPageへ移動

1. ログイン後、サイドバーを確認
2. 「システム監視」または「System Monitor」メニューをクリック
3. SystemMonitorPageが表示される

**URL**: `http://localhost:5173/admin/system-monitor`

### Step 4: 「医療システム連携」タブを確認

1. ページ上部のタブバーを確認
2. 以下のタブが表示されているはず:
   - 概要
   - データベース
   - セキュリティ
   - 業務KPI
   - API
   - スケジューラ
   - 通知
   - **医療システム連携** ← これがPhase 2

3. 「医療システム連携」タブをクリック

---

## 🔍 Phase 2の20項目を確認

### セクション1: 接続性ステータス

**表示される項目**:
```
Webhookエンドポイント健全性
└─ healthy / warning / critical

最終Webhook受信
└─ YYYY-MM-DD HH:mm:ss または「まだ受信なし」

最終受信からの経過時間
└─ X分前 / X時間前 / X日前

エラー率トレンド
└─ improving / stable / degrading
```

**確認ポイント**:
- ✅ カードが表示される
- ✅ ステータスに応じた色分け（healthy=緑、warning=黄、critical=赤）
- ✅ データが表示される（テストデータまたは「データなし」）

---

### セクション2: Webhook受信統計（24時間）

**表示される項目**:
```
24時間以内の受信件数: X件

イベントタイプ別統計:
├─ employee.created
│  ├─ 件数: X件
│  ├─ 成功率: XX%
│  └─ 平均処理時間: XXXms
├─ employee.photo.updated
│  ├─ 件数: X件
│  ├─ 成功率: XX%
│  └─ 平均処理時間: XXXms
└─ employee.photo.deleted
   ├─ 件数: X件
   ├─ 成功率: XX%
   └─ 平均処理時間: XXXms

署名検証失敗: X件
処理エラー: X件
重複イベント: X件
```

**確認ポイント**:
- ✅ カードが表示される
- ✅ 3つのイベントタイプが表示される
- ✅ 各統計が正しく計算されている

---

### セクション3: データ同期統計

**表示される項目**:
```
総ユーザー数: X人
写真あり職員数: X人
写真同期率: XX%
24時間以内の同期件数: X件
同期エラー件数: X件
最終同期日時: YYYY-MM-DD HH:mm:ss
```

**確認ポイント**:
- ✅ カードが表示される
- ✅ 同期率が正しく計算されている（写真あり / 総数 × 100）
- ✅ 最終同期日時が表示される

---

### セクション4: 直近のエラー（エラーがある場合）

**表示される項目**:
```
エラーリスト:
├─ タイムスタンプ: YYYY-MM-DD HH:mm:ss
├─ イベントタイプ: employee.created
└─ エラーメッセージ: XXX
```

**確認ポイント**:
- ✅ エラーがある場合のみカードが表示される
- ✅ エラー詳細が読める
- ⚠️ エラーがない場合は表示されない（正常）

---

## 📸 スクリーンショット取得

### 取得するスクリーンショット

1. **全体画面**: 医療システム連携タブ全体
2. **接続性ステータス**: カードをズーム
3. **Webhook統計**: カードをズーム
4. **データ同期統計**: カードをズーム
5. **エラーリスト**: エラーがある場合のみ
6. **概要タブ**: Phase 1も動作していることを示す

### 保存先

```
mcp-shared/docs/screenshots/phase2/
```

詳細は `README-Phase2-Screenshots.md` を参照

---

## 🐛 トラブルシューティング

### 問題1: 「医療システム連携」タブが表示されない

**原因**:
- Level 99でログインしていない
- SystemMonitorPageEnhanced.tsxが読み込まれていない

**解決方法**:
1. Level 99のアカウントでログインし直す
2. ブラウザのキャッシュをクリア（Ctrl + Shift + R）
3. 開発サーバーを再起動

---

### 問題2: データが「0件」と表示される

**原因**:
- WebhookLogテーブルにデータがない（正常）
- 医療システムからWebhookを受信していない

**解決方法**:
- これは正常な状態です
- 「0件」でもUIが表示されていればPhase 2は正しく動作しています
- 実際のWebhookを受信すればデータが更新されます

---

### 問題3: エラーが表示される

**よくあるエラー**:
```
Failed to fetch integration metrics
```

**原因**:
- MonitoringService.getIntegrationMetrics()がエラー
- データベース接続エラー

**解決方法**:
1. ブラウザのコンソールを確認（F12）
2. データベースが起動しているか確認
3. Prismaクライアントが生成されているか確認
   ```bash
   npx prisma generate
   ```

---

## ✅ 確認完了のチェックリスト

### UI表示確認

- [ ] 「医療システム連携」タブが表示される
- [ ] 接続性ステータスカードが表示される
- [ ] Webhook受信統計カードが表示される
- [ ] データ同期統計カードが表示される
- [ ] データが表示される（0件でもOK）
- [ ] エラーなく動作する

### スクリーンショット取得

- [ ] 全体画面を撮影
- [ ] 接続性ステータスを撮影
- [ ] Webhook統計を撮影
- [ ] データ同期統計を撮影
- [ ] エラーリストを撮影（エラーがある場合）
- [ ] 概要タブを撮影

### ファイル保存

- [ ] スクリーンショットを `mcp-shared/docs/screenshots/phase2/` に保存
- [ ] ファイル名が統一されている
- [ ] 高解像度で保存されている

---

## 🎯 次のステップ

Phase 2の動作確認が完了したら:

1. ✅ Slackで医療システムチームに通知（済）
2. ✅ Phase 2の動作確認（今ここ）
3. ⏭️ 環境変数の準備（次）
4. ⏭️ Phase 2.5ブランチ作成
5. ⏭️ 型定義ファイル作成

---

**作成者**: VoiceDriveチーム
**最終更新**: 2025年10月26日
**参照**: SystemMonitorPageEnhanced.tsx
