# IdeaVoiceTrackingPageï¼ˆè‡ªå‹•ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ï¼‰DBè¦ä»¶åˆ†æ

**åˆ†ææ—¥**: 2025å¹´10æœˆ26æ—¥
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: IdeaVoiceTrackingPageï¼ˆURL: `/auto-projectization`ï¼‰
**ãƒšãƒ¼ã‚¸ç¨®åˆ¥**: **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸**ï¼ˆæ³¨æ„: è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç³»ãƒšãƒ¼ã‚¸ã¨ã¯åˆ¥ï¼‰
**å®Ÿè£…çŠ¶æ…‹**: âœ… Phase 1-3 å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

## ğŸ“‹ ãƒšãƒ¼ã‚¸æ¦‚è¦

### ãƒšãƒ¼ã‚¸ã®ç›®çš„
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸã€Œã‚¢ã‚¤ãƒ‡ã‚¢å£°ã€ã®è‡ªå‹•ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é€²æ—ã‚’è¿½è·¡ãƒ»å¯è¦–åŒ–ã™ã‚‹ãƒšãƒ¼ã‚¸ã€‚ã‚¹ã‚³ã‚¢ãŒ100ç‚¹ã«é”ã™ã‚‹ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã•ã‚Œã€ã•ã‚‰ã«ã‚¹ã‚³ã‚¢ãŒä¸ŠãŒã‚‹ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ãŒæ®µéšçš„ã«ä¸Šæ˜‡ã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½
1. **çµ±è¨ˆæƒ…å ±è¡¨ç¤º**
   - ç·ã‚¢ã‚¤ãƒ‡ã‚¢æ•°
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å¾…ã¡ä»¶æ•°
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ¸ˆã¿ä»¶æ•°
   - å¹³å‡ã‚¹ã‚³ã‚¢

2. **ã‚¢ã‚¤ãƒ‡ã‚¢ä¸€è¦§è¡¨ç¤º**
   - æŠ•ç¨¿å†…å®¹
   - ç¾åœ¨ã®ã‚¹ã‚³ã‚¢
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸
   - æ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã®é€²æ—ãƒãƒ¼
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é”æˆè¡¨ç¤º

3. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ç®¡ç†**
   - PENDINGï¼ˆæ¤œè¨ä¸­ï¼‰: ã‚¹ã‚³ã‚¢ < 100
   - TEAMï¼ˆãƒãƒ¼ãƒ ï¼‰: 100-199
   - DEPARTMENTï¼ˆéƒ¨ç½²ï¼‰: 200-399
   - FACILITYï¼ˆæ–½è¨­ï¼‰: 400-799
   - ORGANIZATIONï¼ˆæ³•äººï¼‰: 800+
   - STRATEGICï¼ˆæˆ¦ç•¥ï¼‰: ç‰¹åˆ¥æŒ‡å®š

---

## ğŸ¯ ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹

### é‡è¦: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ç‰¹æ€§

**ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã§ã™ã€‚è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç³»ãƒšãƒ¼ã‚¸ã¨ã¯å®Œå…¨ã«åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ä½“ç³»ã‚’æŒã¡ã¾ã™ã€‚**

### ãƒ‡ãƒ¼ã‚¿æ‰€æœ‰æ¨©: 100% VoiceDrive

å‚ç…§: [ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸](./ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md) - **ã‚«ãƒ†ã‚´ãƒªãƒ¼6: VoiceDriveæ´»å‹•ãƒ‡ãƒ¼ã‚¿**

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | ãƒã‚¹ã‚¿ãƒ¼æ‰€æœ‰ | ç†ç”± |
|-----------|-------------|------|
| æŠ•ç¨¿ï¼ˆPostï¼‰ | VoiceDrive | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆãƒ»ã‚¢ã‚¤ãƒ‡ã‚¢æŠ•ç¨¿ã¯VoiceDriveå›ºæœ‰æ©Ÿèƒ½ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å±¥æ­´ï¼ˆProjectizedHistoryï¼‰ | VoiceDrive | è‡ªå‹•ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã¯VoiceDriveç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯ |
| ãƒ¬ãƒ™ãƒ«é·ç§»å±¥æ­´ï¼ˆProjectLevelHistoryï¼‰ | VoiceDrive | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã¯VoiceDriveç‹¬è‡ªæ¦‚å¿µ |
| æŠ•ç¥¨ï¼ˆVoteï¼‰ | VoiceDrive | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ´»å‹•ã¯VoiceDriveæ©Ÿèƒ½ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ±ï¼ˆUserï¼‰ | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | è·å“¡ãƒã‚¹ã‚¿ãƒ¼ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç®¡ç† |
| æ‰€å±æƒ…å ±ï¼ˆUserDepartmentï¼‰ | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | çµ„ç¹”æ§‹é€ ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç®¡ç† |

### çµ±åˆæ–¹é‡
- **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®å–å¾—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ±ã€æ‰€å±æƒ…å ±ã®ã¿
- **VoiceDriveç‹¬è‡ªç®¡ç†**: æŠ•ç¨¿ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã€ãƒ¬ãƒ™ãƒ«é·ç§»ã€æŠ•ç¥¨
- **ãƒ‡ãƒ¼ã‚¿é€£æº**: ä¸è¦ï¼ˆVoiceDriveå†…ã§å®Œçµï¼‰

---

## ğŸ“Š ç¾åœ¨ã®å®Ÿè£…çŠ¶æ…‹åˆ†æ

### âœ… å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ï¼ˆPhase 1-3å®Œäº†ï¼‰

#### Phase 1: åŸºæœ¬æ©Ÿèƒ½
- âœ… æŠ•ç¨¿ä¸€è¦§å–å¾—API
- âœ… ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š
- âœ… çµ±è¨ˆæƒ…å ±è¡¨ç¤º

#### Phase 2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ç®¡ç†
- âœ… ProjectizationServiceå®Ÿè£…
- âœ… ProjectizedHistoryè¨˜éŒ²
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é€šçŸ¥
- âœ… é–¾å€¤åˆ¤å®šï¼ˆã‚¹ã‚³ã‚¢100ï¼‰

#### Phase 3: ãƒ¬ãƒ™ãƒ«é·ç§»ç®¡ç†
- âœ… ProjectLevelTransitionServiceå®Ÿè£…
- âœ… ProjectLevelHistoryè¨˜éŒ²
- âœ… ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—é€šçŸ¥
- âœ… é€²æ—ãƒãƒ¼è¡¨ç¤º

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è©³ç´°åˆ†æ

### 1. çµ±è¨ˆæƒ…å ±è¡¨ç¤º

#### 1.1 ç·ã‚¢ã‚¤ãƒ‡ã‚¢æ•°
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
const ideas = await prisma.post.findMany({
  where: {
    authorId: userId,
    type: 'improvement', // ã‚¢ã‚¤ãƒ‡ã‚¢å£°ã®ã¿
    deletedAt: null
  }
});
const totalIdeas = ideas.length;
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `Post`
**å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- `id` (ä¸»ã‚­ãƒ¼)
- `authorId` (ãƒ¦ãƒ¼ã‚¶ãƒ¼ID)
- `type` (æŠ•ç¨¿ã‚¿ã‚¤ãƒ—)
- `deletedAt` (å‰Šé™¤æ—¥æ™‚)

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 1.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å¾…ã¡ä»¶æ•°
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
const pendingIdeas = ideas.filter(idea => {
  const score = calculateScore(idea.votes); // useProjectScoring
  return score < 100; // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é–¾å€¤
});
const pendingCount = pendingIdeas.length;
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `Post`, `Vote`
**å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- Post: `id`, `authorId`, `type`, `deletedAt`
- Vote: `postId`, `voteOption` (strongly-support, support, neutral, oppose, strongly-oppose)

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 1.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ¸ˆã¿ä»¶æ•°
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
const projectizedIdeas = ideas.filter(idea => {
  const score = calculateScore(idea.votes);
  return score >= 100;
});
const projectizedCount = projectizedIdeas.length;
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `Post`, `Vote`
**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 1.4 å¹³å‡ã‚¹ã‚³ã‚¢
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
const totalScore = ideas.reduce((sum, idea) => {
  const score = calculateScore(idea.votes);
  return sum + score;
}, 0);
const averageScore = totalScore / ideas.length;
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `Post`, `Vote`
**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

### 2. ã‚¢ã‚¤ãƒ‡ã‚¢ä¸€è¦§è¡¨ç¤º

#### 2.1 æŠ•ç¨¿åŸºæœ¬æƒ…å ±
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
const ideas = await prisma.post.findMany({
  where: {
    authorId: userId,
    type: 'improvement',
    deletedAt: null
  },
  include: {
    author: {
      select: {
        id: true,
        name: true,
        avatarUrl: true
      }
    },
    votes: {
      select: {
        voteOption: true,
        userId: true,
        createdAt: true
      }
    }
  },
  orderBy: { createdAt: 'desc' }
});
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `Post`, `User`, `Vote`
**å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- Post: `id`, `content`, `authorId`, `type`, `createdAt`, `deletedAt`
- User: `id`, `name`, `avatarUrl`
- Vote: `postId`, `voteOption`, `userId`, `createdAt`

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 2.2 ç¾åœ¨ã®ã‚¹ã‚³ã‚¢è¨ˆç®—
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: src/hooks/useProjectScoring.ts
const calculateScore = (votes: Vote[]): number => {
  const weights = {
    'strongly-support': 20,
    'support': 10,
    'neutral': 0,
    'oppose': -10,
    'strongly-oppose': -20
  };

  return votes.reduce((total, vote) => {
    return total + (weights[vote.voteOption] || 0);
  }, 0);
};
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `Vote`
**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 2.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: src/services/ProjectPermissionService.ts
export function getProjectLevelFromScore(score: number): ProjectLevel {
  if (score >= 800) return 'ORGANIZATION';
  if (score >= 400) return 'FACILITY';
  if (score >= 200) return 'DEPARTMENT';
  if (score >= 100) return 'TEAM';
  return 'PENDING';
}
```

**ãƒ­ã‚¸ãƒƒã‚¯**: VoiceDriveå†…éƒ¨è¨ˆç®—ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦ï¼‰
**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 2.4 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å±¥æ­´
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: ProjectizedHistory
const projectizedHistory = await prisma.projectizedHistory.findFirst({
  where: { postId },
  orderBy: { projectizedAt: 'desc' }
});

const isProjectized = projectizedHistory !== null;
const projectizedAt = projectizedHistory?.projectizedAt;
const projectizedScore = projectizedHistory?.projectizedScore;
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `ProjectizedHistory`
**å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- `id` (ä¸»ã‚­ãƒ¼)
- `postId` (æŠ•ç¨¿ID)
- `projectizedAt` (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ—¥æ™‚)
- `projectizedScore` (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ™‚ã‚¹ã‚³ã‚¢)
- `projectLevel` (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«)
- `previousScore` (å‰å›ã‚¹ã‚³ã‚¢)
- `scoreIncrement` (ã‚¹ã‚³ã‚¢å¢—åˆ†)
- `isNotified` (é€šçŸ¥æ¸ˆã¿ãƒ•ãƒ©ã‚°)
- `notifiedAt` (é€šçŸ¥æ—¥æ™‚)

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 2.5 ãƒ¬ãƒ™ãƒ«é·ç§»å±¥æ­´
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: ProjectLevelHistory
const levelHistory = await prisma.projectLevelHistory.findMany({
  where: { postId },
  orderBy: { upgradedAt: 'desc' }
});

const latestLevel = levelHistory[0]?.toLevel;
const levelTransitions = levelHistory.length;
```

**ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«**: `ProjectLevelHistory`
**å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- `id` (ä¸»ã‚­ãƒ¼)
- `postId` (æŠ•ç¨¿ID)
- `fromLevel` (å¤‰æ›´å‰ãƒ¬ãƒ™ãƒ«)
- `toLevel` (å¤‰æ›´å¾Œãƒ¬ãƒ™ãƒ«)
- `fromScore` (å¤‰æ›´å‰ã‚¹ã‚³ã‚¢)
- `toScore` (å¤‰æ›´å¾Œã‚¹ã‚³ã‚¢)
- `upgradedAt` (ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ—¥æ™‚)

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

#### 2.6 æ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã®é€²æ—
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: ãƒ­ã‚¸ãƒƒã‚¯è¨ˆç®—ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦ï¼‰
const thresholds = [
  { level: 'TEAM', score: 100 },
  { level: 'DEPARTMENT', score: 200 },
  { level: 'FACILITY', score: 400 },
  { level: 'ORGANIZATION', score: 800 }
];

const currentLevel = getProjectLevelFromScore(score);
const nextThreshold = thresholds.find(t => t.score > score);

if (nextThreshold) {
  const progress = ((score - currentThreshold) / (nextThreshold.score - currentThreshold)) * 100;
  const pointsNeeded = nextThreshold.score - score;
}
```

**ãƒ­ã‚¸ãƒƒã‚¯**: VoiceDriveå†…éƒ¨è¨ˆç®—ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦ï¼‰
**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

## ğŸ“ ä½¿ç”¨ä¸­ã®DBãƒ†ãƒ¼ãƒ–ãƒ«

### 1. Postï¼ˆæŠ•ç¨¿ï¼‰
**æ‰€æœ‰**: VoiceDrive
**ç”¨é€”**: ã‚¢ã‚¤ãƒ‡ã‚¢å£°ã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿

```prisma
model Post {
  id                String              @id @default(cuid())
  content           String
  authorId          String              @map("author_id")
  type              String              // 'improvement'
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  deletedAt         DateTime?           @map("deleted_at")

  author            User                @relation("UserPosts", fields: [authorId], references: [id])
  votes             Vote[]              @relation("PostVotes")
  projectizedHistory ProjectizedHistory[] @relation("PostProjectizedHistory")
  levelHistory      ProjectLevelHistory[] @relation("PostLevelHistory")

  @@index([authorId])
  @@index([type])
  @@index([createdAt])
  @@map("posts")
}
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

### 2. Voteï¼ˆæŠ•ç¥¨ï¼‰
**æ‰€æœ‰**: VoiceDrive
**ç”¨é€”**: ã‚¹ã‚³ã‚¢è¨ˆç®—ã®ãŸã‚ã®æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿

```prisma
model Vote {
  id           String   @id @default(cuid())
  postId       String   @map("post_id")
  userId       String   @map("user_id")
  voteOption   String   @map("vote_option") // strongly-support, support, neutral, oppose, strongly-oppose
  createdAt    DateTime @default(now()) @map("created_at")

  post         Post     @relation("PostVotes", fields: [postId], references: [id], onDelete: Cascade)
  user         User     @relation("UserVotes", fields: [userId], references: [id])

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@map("votes")
}
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

### 3. ProjectizedHistoryï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å±¥æ­´ï¼‰
**æ‰€æœ‰**: VoiceDrive
**ç”¨é€”**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é”æˆã®è¨˜éŒ²

```prisma
model ProjectizedHistory {
  id                String    @id @default(cuid())
  postId            String    @map("post_id")
  projectizedAt     DateTime  @default(now()) @map("projectized_at")
  projectizedScore  Int       @map("projectized_score")
  projectLevel      String    @map("project_level")
  previousScore     Int?      @map("previous_score")
  scoreIncrement    Int       @map("score_increment")
  isNotified        Boolean   @default(false) @map("is_notified")
  notifiedAt        DateTime? @map("notified_at")

  post              Post      @relation("PostProjectizedHistory", fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([projectizedAt])
  @@map("projectized_history")
}
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

### 4. ProjectLevelHistoryï¼ˆãƒ¬ãƒ™ãƒ«é·ç§»å±¥æ­´ï¼‰
**æ‰€æœ‰**: VoiceDrive
**ç”¨é€”**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã®é·ç§»è¨˜éŒ²

```prisma
model ProjectLevelHistory {
  id          String    @id @default(cuid())
  postId      String    @map("post_id")
  fromLevel   String?   @map("from_level")
  toLevel     String    @map("to_level")
  fromScore   Int       @map("from_score")
  toScore     Int       @map("to_score")
  upgradedAt  DateTime  @default(now()) @map("upgraded_at")

  post        Post      @relation("PostLevelHistory", fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([upgradedAt])
  @@map("project_level_history")
}
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

### 5. Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
**æ‰€æœ‰**: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
**ç”¨é€”**: æŠ•ç¨¿è€…æƒ…å ±è¡¨ç¤º

```prisma
model User {
  id          String   @id @default(cuid())
  name        String
  avatarUrl   String?  @map("avatar_url")

  posts       Post[]   @relation("UserPosts")
  votes       Vote[]   @relation("UserVotes")

  @@map("users")
}
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ é€£æºï¼‰

---

## ğŸ” ä¸è¶³é …ç›®åˆ†æ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«
**çµæœ**: âŒ ä¸è¶³ãªã—

ã™ã¹ã¦ã®å¿…è¦ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨:
- âœ… Post
- âœ… Vote
- âœ… ProjectizedHistory
- âœ… ProjectLevelHistory
- âœ… User

---

### ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
**çµæœ**: âŒ ä¸è¶³ãªã—

ã™ã¹ã¦ã®å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨:
- âœ… Post: id, content, authorId, type, createdAt, deletedAt
- âœ… Vote: id, postId, userId, voteOption, createdAt
- âœ… ProjectizedHistory: id, postId, projectizedAt, projectizedScore, projectLevel, previousScore, scoreIncrement, isNotified, notifiedAt
- âœ… ProjectLevelHistory: id, postId, fromLevel, toLevel, fromScore, toScore, upgradedAt
- âœ… User: id, name, avatarUrl

---

### APIãƒ»ã‚µãƒ¼ãƒ“ã‚¹
**çµæœ**: âŒ ä¸è¶³ãªã—

ã™ã¹ã¦ã®å¿…è¦API/ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨:
- âœ… `ProjectizationService.ts` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ç®¡ç†
- âœ… `ProjectLevelTransitionService.ts` - ãƒ¬ãƒ™ãƒ«é·ç§»ç®¡ç†
- âœ… `ProjectPermissionService.ts` - ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
- âœ… `useProjectScoring.ts` - ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ•ãƒƒã‚¯

---

### ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
**çµæœ**: âŒ ä¸è¶³ãªã—

ã™ã¹ã¦ã®å¿…è¦ãƒ­ã‚¸ãƒƒã‚¯ãŒå®Ÿè£…æ¸ˆã¿:
- âœ… ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆæŠ•ç¥¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³åˆ¥ã®é‡ã¿ä»˜ã‘ï¼‰
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–åˆ¤å®šï¼ˆé–¾å€¤100ï¼‰
- âœ… ãƒ¬ãƒ™ãƒ«åˆ¤å®šï¼ˆã‚¹ã‚³ã‚¢åŒºé–“åˆ¥ï¼‰
- âœ… é€²æ—è¨ˆç®—ï¼ˆæ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã®ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å±¥æ­´è¨˜éŒ²
- âœ… ãƒ¬ãƒ™ãƒ«é·ç§»å±¥æ­´è¨˜éŒ²
- âœ… é€šçŸ¥ç”Ÿæˆ

---

## ğŸ“ ã‚µãƒ¼ãƒ“ã‚¹å±¤å®Ÿè£…çŠ¶æ³

### ProjectizationService.ts
**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: [src/services/ProjectizationService.ts](../../src/services/ProjectizationService.ts)

#### ä¸»è¦é–¢æ•°

**1. checkAndRecordProjectization**
```typescript
/**
 * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è¨˜éŒ²
 * @param postId - æŠ•ç¨¿ID
 * @param currentScore - ç¾åœ¨ã®ã‚¹ã‚³ã‚¢
 * @returns ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–çµæœ
 */
export async function checkAndRecordProjectization(
  postId: string,
  currentScore: number
): Promise<ProjectizationResult>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**2. getProjectizationStatus**
```typescript
/**
 * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–çŠ¶æ…‹ã‚’å–å¾—
 * @param postId - æŠ•ç¨¿ID
 * @returns ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–çŠ¶æ…‹
 */
export async function getProjectizationStatus(
  postId: string
): Promise<ProjectizationStatus>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**3. createProjectizationNotification**
```typescript
/**
 * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é€šçŸ¥ã‚’ä½œæˆ
 * @param userId - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
 * @param postId - æŠ•ç¨¿ID
 * @param projectLevel - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«
 * @param score - ã‚¹ã‚³ã‚¢
 */
export async function createProjectizationNotification(
  userId: string,
  postId: string,
  projectLevel: string,
  score: number
): Promise<void>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

### ProjectLevelTransitionService.ts
**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: [src/services/ProjectLevelTransitionService.ts](../../src/services/ProjectLevelTransitionService.ts)

#### ä¸»è¦é–¢æ•°

**1. trackLevelTransition**
```typescript
/**
 * ãƒ¬ãƒ™ãƒ«é·ç§»ã‚’è¿½è·¡
 * @param postId - æŠ•ç¨¿ID
 * @param newScore - æ–°ã‚¹ã‚³ã‚¢
 * @returns ãƒ¬ãƒ™ãƒ«é·ç§»çµæœ
 */
export async function trackLevelTransition(
  postId: string,
  newScore: number
): Promise<LevelTransitionResult>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**2. getLevelTransitionHistory**
```typescript
/**
 * ãƒ¬ãƒ™ãƒ«é·ç§»å±¥æ­´ã‚’å–å¾—
 * @param postId - æŠ•ç¨¿ID
 * @returns ãƒ¬ãƒ™ãƒ«é·ç§»å±¥æ­´
 */
export async function getLevelTransitionHistory(
  postId: string
): Promise<ProjectLevelHistory[]>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**3. createLevelUpNotification**
```typescript
/**
 * ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—é€šçŸ¥ã‚’ä½œæˆ
 * @param userId - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
 * @param postId - æŠ•ç¨¿ID
 * @param fromLevel - å¤‰æ›´å‰ãƒ¬ãƒ™ãƒ«
 * @param toLevel - å¤‰æ›´å¾Œãƒ¬ãƒ™ãƒ«
 * @param score - ã‚¹ã‚³ã‚¢
 */
export async function createLevelUpNotification(
  userId: string,
  postId: string,
  fromLevel: string | null,
  toLevel: string,
  score: number
): Promise<void>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…çŠ¶æ³

### IdeaVoiceTrackingPage.tsx
**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: [src/pages/IdeaVoiceTrackingPage.tsx](../../src/pages/IdeaVoiceTrackingPage.tsx)

#### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

**1. çµ±è¨ˆæƒ…å ±ã‚«ãƒ¼ãƒ‰**
```typescript
// ç·ã‚¢ã‚¤ãƒ‡ã‚¢æ•°
<StatCard
  title="ç·ã‚¢ã‚¤ãƒ‡ã‚¢æ•°"
  value={ideas.length}
  icon="ğŸ’¡"
  color="blue"
/>

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å¾…ã¡
<StatCard
  title="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–å¾…ã¡"
  value={pendingCount}
  icon="â³"
  color="yellow"
/>

// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ¸ˆã¿
<StatCard
  title="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ¸ˆã¿"
  value={projectizedCount}
  icon="âœ…"
  color="green"
/>

// å¹³å‡ã‚¹ã‚³ã‚¢
<StatCard
  title="å¹³å‡ã‚¹ã‚³ã‚¢"
  value={averageScore.toFixed(1)}
  icon="ğŸ“Š"
  color="purple"
/>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸**
```typescript
const levelConfig = {
  'PENDING': { label: 'ã‚¢ã‚¤ãƒ‡ã‚¢æ¤œè¨ä¸­', icon: 'ğŸ’¡', color: 'text-gray-400' },
  'TEAM': { label: 'ãƒãƒ¼ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', icon: 'ğŸ‘¥', color: 'text-blue-400' },
  'DEPARTMENT': { label: 'éƒ¨ç½²ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', icon: 'ğŸ¢', color: 'text-green-400' },
  'FACILITY': { label: 'æ–½è¨­ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', icon: 'ğŸ¥', color: 'text-yellow-400' },
  'ORGANIZATION': { label: 'æ³•äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', icon: 'ğŸ›ï¸', color: 'text-purple-400' },
  'STRATEGIC': { label: 'æˆ¦ç•¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', icon: 'â­', color: 'text-pink-400' }
};

<LevelBadge level={currentLevel} config={levelConfig[currentLevel]} />
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**3. é€²æ—ãƒãƒ¼**
```typescript
// æ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã®é€²æ—
const progress = calculateProgress(score, currentLevel, nextLevel);

<ProgressBar
  current={score}
  target={nextThreshold}
  percentage={progress}
  label={`æ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã‚ã¨ ${pointsNeeded}pt`}
/>
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

**4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–é”æˆè¡¨ç¤º**
```typescript
{isProjectized && (
  <ProjectizedBadge
    projectizedAt={projectizedAt}
    projectizedScore={projectizedScore}
  />
)}
```

**å®Ÿè£…çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼] â†’ [IdeaVoiceTrackingPage]
                â†“
         [useProjectScoring]
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                     â†“
[Post + Vote]    [ProjectizationService]
    â†“                     â†“
[ã‚¹ã‚³ã‚¢è¨ˆç®—]    [ProjectizedHistoryç™»éŒ²]
    â†“                     â†“
[ãƒ¬ãƒ™ãƒ«åˆ¤å®š]    [ProjectLevelTransitionService]
    â†“                     â†“
[é€²æ—è¨ˆç®—]      [ProjectLevelHistoryç™»éŒ²]
    â†“                     â†“
[çµ±è¨ˆè¡¨ç¤º]            [é€šçŸ¥ç”Ÿæˆ]
```

---

## âœ… çµè«–

### å®Ÿè£…å®Œäº†çŠ¶æ…‹
**Phase 1-3: ã™ã¹ã¦å®Œå…¨å®Ÿè£…æ¸ˆã¿ âœ…**

1. âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«**: ã™ã¹ã¦å­˜åœ¨
2. âœ… **ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: ã™ã¹ã¦å­˜åœ¨
3. âœ… **APIãƒ»ã‚µãƒ¼ãƒ“ã‚¹**: ã™ã¹ã¦å®Ÿè£…æ¸ˆã¿
4. âœ… **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**: ã™ã¹ã¦å®Ÿè£…æ¸ˆã¿
5. âœ… **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: ã™ã¹ã¦å®Ÿè£…æ¸ˆã¿

### ä¸è¶³é …ç›®
**ãªã— âŒ**

### ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»
- **VoiceDriveæ‰€æœ‰**: Post, Vote, ProjectizedHistory, ProjectLevelHistory
- **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ æ‰€æœ‰**: Userï¼ˆåŸºæœ¬æƒ…å ±ã®ã¿ï¼‰
- **çµ±åˆæ–¹é‡**: VoiceDriveå†…ã§å®Œçµï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ é€£æºä¸è¦ï¼‰

### é‡è¦äº‹é …
**ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã§ã™ã€‚è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç³»ãƒšãƒ¼ã‚¸ã¨ã¯åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†ä½“ç³»ã‚’æŒã¡ã¾ã™ã€‚**

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã¯VoiceDriveç‹¬è‡ªæ©Ÿèƒ½
- ã‚¹ã‚³ã‚¢è¨ˆç®—ã¯VoiceDriveç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯
- ãƒ¬ãƒ™ãƒ«ç®¡ç†ã¯VoiceDriveç‹¬è‡ªæ¦‚å¿µ
- åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ãƒ‡ãƒ¼ã‚¿é€£æºã¯ä¸è¦

---

**åˆ†æå®Œäº†æ—¥**: 2025å¹´10æœˆ26æ—¥
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆä½œæˆ

---

## ğŸ“ å‚è€ƒè³‡æ–™

- [IdeaVoiceTrackingPage.tsx](../../src/pages/IdeaVoiceTrackingPage.tsx)
- [ProjectizationService.ts](../../src/services/ProjectizationService.ts)
- [ProjectLevelTransitionService.ts](../../src/services/ProjectLevelTransitionService.ts)
- [ProjectPermissionService.ts](../../src/services/ProjectPermissionService.ts)
- [useProjectScoring.ts](../../src/hooks/useProjectScoring.ts)
- [schema.prisma](../../prisma/schema.prisma)
- [ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸](./ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md)
