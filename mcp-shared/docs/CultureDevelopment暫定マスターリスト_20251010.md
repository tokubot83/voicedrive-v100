# CultureDevelopment 暫定マスターリスト

**作成日**: 2025年10月10日
**対象ページ**: CultureDevelopmentPage (https://voicedrive-v100.vercel.app/culture-development)
**対象権限**: Level 14-17（人事部門専用）
**実装期間**: 5日間（DB構築2日 + サービス層移行2日 + UI統合1日）

---

## 📋 概要

- **目的**: 組織文化診断と改善施策管理のDB基盤構築
- **スコープ**: 7テーブル（診断3 + 施策4）+ サービス層DB版移行
- **前提条件**:
  - MySQL移行完了後の実装を想定
  - 既存APIのみ使用（新規API不要）
  - VoiceDrive単独管理（医療システム依存度低）

---

## 🎯 実装フェーズ

### Phase 1: DB構築（2日）

#### タスク1-1: テーブル作成（4時間）
- [ ] `CultureAssessment`テーブルをschema.prismaに追加
- [ ] `CultureDimension`テーブルをschema.prismaに追加
- [ ] `CultureIndicator`テーブルをschema.prismaに追加
- [ ] `DepartmentCultureScore`テーブルをschema.prismaに追加
- [ ] `CultureInitiative`テーブルをschema.prismaに追加
- [ ] `InitiativeKPI`テーブルをschema.prismaに追加
- [ ] `InitiativeMilestone`テーブルをschema.prismaに追加
- [ ] Userモデルに`ownedInitiatives`リレーション追加
- [ ] インデックス設定（全テーブル）

#### タスク1-2: マイグレーション実行（1時間）
- [ ] Prisma migrate実行
- [ ] マイグレーションファイル検証
- [ ] ロールバック手順確認

#### タスク1-3: 初期データ投入スクリプト作成（3時間）
- [ ] デモ診断データ（2025年9月分）作成
- [ ] 文化次元データ（5次元）作成
- [ ] 指標データ（15指標：3指標 × 5次元）作成
- [ ] 部門別スコアデータ（3部門）作成
- [ ] デモ施策データ（3施策）作成
- [ ] KPIデータ（6件：施策3 × 平均2KPI）作成
- [ ] マイルストーンデータ（8件）作成

#### タスク1-4: データ投入・検証（3時間）
- [ ] シードスクリプト実行
- [ ] Prisma Studio で全データ確認
- [ ] リレーション動作確認（全7テーブル）
- [ ] データ整合性チェック（JSON構造検証）
- [ ] クエリパフォーマンステスト

---

### Phase 2: サービス層移行（2日）

#### タスク2-1: 診断関連メソッドDB版実装（4時間）
- [ ] `getAssessment()`メソッド：CultureAssessment取得（Dimension, Indicator, DepartmentScore含む）
- [ ] `getSummary()`メソッド：サマリー計算ロジックDB版に変更
- [ ] 診断データ作成機能実装（createAssessment）
- [ ] トレンド計算ロジック実装（前回診断との比較）

#### タスク2-2: 施策関連メソッドDB版実装（4時間）
- [ ] `getAllInitiatives()`メソッド：CultureInitiative取得（KPI, Milestone含む）
- [ ] `getFilteredInitiatives()`メソッド：フィルタリングロジックPrismaクエリに変換
- [ ] `getInitiativeById()`メソッド：個別施策取得
- [ ] 施策CRUD操作実装（作成・更新・削除）

#### タスク2-3: KPI・マイルストーン管理実装（3時間）
- [ ] KPI作成・更新・削除機能
- [ ] KPI達成率自動計算ロジック
- [ ] マイルストーン作成・更新・削除機能
- [ ] マイルストーン進捗率自動計算ロジック
- [ ] 施策全体進捗率計算（マイルストーン完了状況から）

#### タスク2-4: 統合テスト（2時間）
- [ ] 全メソッド動作確認（CRUD操作）
- [ ] エラーハンドリング確認（データなし、不正JSON等）
- [ ] パフォーマンステスト（複数診断・施策読み込み）

---

### Phase 3: UI統合（1日）

#### タスク3-1: UI統合（4時間）
- [ ] CultureDevelopmentPage.tsxのservice呼び出しを維持（内部がDBに変更されているため）
- [ ] ローディング状態の適切な表示
- [ ] エラーハンドリング確認（データなし、ネットワークエラー）
- [ ] タブ切り替え動作確認（診断↔施策）

#### タスク3-2: E2Eテスト（4時間）
- [ ] Level 14-17ユーザーでの全操作確認
- [ ] 文化診断タブ全要素表示確認
  - [ ] サマリーカード4つ
  - [ ] 文化次元別スコア（5次元）
  - [ ] 部門別スコア（3部門）
- [ ] 改善施策タブ全要素表示確認
  - [ ] 施策一覧（3施策）
  - [ ] 施策詳細（KPI、マイルストーン、進捗バー）
  - [ ] 成果表示（完了施策）
- [ ] フィルタリング機能確認（status, priority）
- [ ] エッジケーステスト（データなし、権限外アクセス等）

---

## 🔗 依存関係

### 前提条件
1. ✅ PersonalStation API実装済み（User情報取得）
2. ✅ CommitteeManagement API実装済み（複数職員一括取得）
3. ⏳ MySQL移行完了（医療システムチーム）

### 並行作業可能
- Phase 1とPhase 2は独立（Phase 1完了後にPhase 2開始）
- Phase 3はPhase 2完了後に開始

---

## 📊 成功基準

### 機能要件
- [ ] Level 14-17ユーザーが全データを閲覧可能
- [ ] 文化診断タブが全情報を正確表示
- [ ] 改善施策タブが全施策を正確表示
- [ ] サマリーカード4つが正確計算・表示
- [ ] 施策フィルタリングが高速動作（100件で1秒以内）

### 非機能要件
- [ ] 応答時間：全クエリ500ms以内
- [ ] データ整合性：JSON型フィールドのバリデーション100%
- [ ] セキュリティ：Level 14-17のみアクセス可能
- [ ] プライバシー保護：部門別スコアは5名以上のみ

---

## ⚠️ リスクと対策

### リスク1: 複雑なリレーション構造

- **内容**: 7テーブル、3階層のリレーション（Assessment → Dimension → Indicator）
- **対策**: Prisma includeで一括取得、N+1問題を回避
- **影響度**: 中（適切なクエリ設計で対応可能）

### リスク2: JSON型フィールドの多用

- **内容**: targetDimensions, targetDepartments, teamMembers等がJSON型
- **対策**: Zodでバリデーション、TypeScript型定義で安全性確保
- **影響度**: 低（MySQL 8.0のJSON型は効率的）

### リスク3: 診断データの手動入力負荷

- **内容**: 文化診断結果を手動入力する場合、人事部の負担が大きい
- **対策**: Phase 3以降で診断フォーム機能を実装、自動スコア計算
- **影響度**: 中（Phase 1では初期データのみ、後で自動化）

---

## 📅 スケジュール

| フェーズ | 期間 | 開始条件 | 完了条件 |
|---------|------|----------|----------|
| Phase 1: DB構築 | 2日 | MySQL移行完了 | Prisma migrate成功、初期データ投入完了 |
| Phase 2: サービス層移行 | 2日 | Phase 1完了 | 全メソッドDB接続、CRUD操作動作確認 |
| Phase 3: UI統合 | 1日 | Phase 2完了 | E2Eテスト全項目合格 |

**合計**: 5日間

---

## 🎓 学習ポイント

### 新規実装項目
1. **階層的リレーション**: Assessment → Dimension → Indicator の3階層
2. **JSON型活用**: 配列・オブジェクト混在データの効率的保存
3. **進捗率自動計算**: マイルストーン完了状況から施策進捗を算出

### 技術的チャレンジ
1. **複雑なSummary計算**: 診断スコア、施策進捗、改善率を統合計算
2. **トレンド分析**: 前回診断との比較ロジック実装
3. **プライバシー保護**: 部門別スコアの最小グループサイズ5名保証

---

## 🔄 今後の拡張予定

### Phase 3以降の機能
1. **診断フォーム機能**: 職員が診断アンケートに回答、自動スコア計算
2. **施策進捗レポート**: 週次・月次の自動レポート生成
3. **ダッシュボード拡張**: トレンドグラフ、予測分析
4. **通知機能**: 施策期限アラート、マイルストーン完了通知
5. **CSV/PDFエクスポート**: 診断結果・施策レポートのダウンロード

### 医療システムとの連携強化
1. **V3評価データ連携**: 評価結果と文化スコアの相関分析
2. **面談データ連携**: 面談内容と文化課題のマッピング
3. **投稿データ連携**: VoiceDrive投稿カテゴリと文化次元の相関分析

---

## 📞 問い合わせ先

### VoiceDriveチーム
- 実装相談: #voicedrive-dev
- DB設計相談: #database-design

### 医療システムチーム
- API連携: #mcp-integration
- データ連携: #data-integration

---

**最終更新**: 2025年10月10日
**次回レビュー**: 医療チームからの質問回答受領時
