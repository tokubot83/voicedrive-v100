# UserManagementPage æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ

**æ–‡æ›¸ç•ªå·**: UMP-MASTER-2025-1026-001
**ä½œæˆæ—¥**: 2025å¹´10æœˆ26æ—¥
**ä½œæˆè€…**: VoiceDriveãƒãƒ¼ãƒ 
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: UserManagementPage (admin/)
**å‚ç…§æ–‡æ›¸**: UserManagementPage_DBè¦ä»¶åˆ†æ_20251026.md

---

## ğŸ“‹ ã‚µãƒãƒªãƒ¼

### ãƒ‡ãƒ¼ã‚¿é …ç›®ç·æ•°
- **å…¨31é …ç›®**
- åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒã‚¹ã‚¿ãƒ¼: **15é …ç›®** (48%)
- VoiceDriveãƒã‚¹ã‚¿ãƒ¼: **16é …ç›®** (52%)
- åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥: **15é …ç›®**

### è²¬ä»»åˆ†æ‹…ã®åŸå‰‡
ğŸ”µ **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ **: è·å“¡åŸºæœ¬æƒ…å ±ã€çµ„ç¹”æƒ…å ±ã€é›‡ç”¨æƒ…å ±ã€æ¨©é™æƒ…å ±
ğŸŸ¢ **VoiceDrive**: åŒæœŸç®¡ç†ã€VoiceDriveæ´»å‹•ãƒ‡ãƒ¼ã‚¿ã€VoiceDriveå›ºæœ‰è¨­å®š

---

## ğŸ“Š å…¨ãƒ‡ãƒ¼ã‚¿é …ç›®ãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ

| # | ãƒ‡ãƒ¼ã‚¿é …ç›® | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | ãƒ‡ãƒ¼ã‚¿å‹ | ãƒã‚¹ã‚¿ãƒ¼ | è¡¨ç¤ºç®‡æ‰€ | ç·¨é›†å¯å¦ | å‚™è€ƒ |
|---|----------|------------|---------|---------|---------|---------|------|
| **1. åŸºæœ¬æƒ…å ±** |
| 1-1 | VoiceDriveå†…éƒ¨ID | `User.id` | String | ğŸŸ¢ VD | ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ã¿ï¼‰ | âŒ | cuid() |
| 1-2 | è·å“¡ID | `User.employeeId` | String | ğŸ”µ MS | - | âŒ | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ IDã€VDã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| 1-3 | æ°å | `User.name` | String | ğŸ”µ MS | ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¤œç´¢ | âŒ | VDã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€WebhookåŒæœŸ |
| 1-4 | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | `User.email` | String | ğŸ”µ MS | ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¤œç´¢ | âŒ | VDã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€WebhookåŒæœŸ |
| 1-5 | éƒ¨ç½² | `User.department` | String? | ğŸ”µ MS | ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¤œç´¢ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | âŒ | VDã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€WebhookåŒæœŸ |
| 1-6 | å½¹è· | `User.position` | String? | ğŸ”µ MS | ãƒ†ãƒ¼ãƒ–ãƒ« | âŒ | VDã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€WebhookåŒæœŸ |
| 1-7 | æ–½è¨­ID | `User.facilityId` | String? | ğŸ”µ MS | - | âŒ | VDã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€WebhookåŒæœŸ |
| **2. æ¨©é™æƒ…å ±** |
| 2-1 | æ¨©é™ãƒ¬ãƒ™ãƒ« | `User.permissionLevel` | Decimal | ğŸ”µ MS | ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€çµ±è¨ˆã‚«ãƒ¼ãƒ‰ | âŒ | 1.0-25.0ã€V3è©•ä¾¡ã‹ã‚‰ç®—å‡º |
| 2-2 | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¨®åˆ¥ | `User.accountType` | String | ğŸ”µ MS | - | âŒ | NEW_STAFF, MID_CAREERç­‰ |
| 2-3 | ãƒªãƒ¼ãƒ€ãƒ¼è³‡æ ¼ | `User.canPerformLeaderDuty` | Boolean | ğŸ”µ MS | - | âŒ | V3è©•ä¾¡ã‹ã‚‰ç®—å‡º |
| 2-4 | è·ç¨®ã‚«ãƒ†ã‚´ãƒª | `User.professionCategory` | String? | ğŸ”µ MS | - | âŒ | nurse, doctorç­‰ |
| 2-5 | ä¸Šå¸ID | `User.parentId` | String? | ğŸ”µ MS | - | âŒ | çµ„ç¹”éšå±¤ |
| **3. é›‡ç”¨æƒ…å ±** |
| 3-1 | æœ‰åŠ¹/ç„¡åŠ¹ | `User.isActive` | Boolean | ğŸ”µ MS | ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€çµ±è¨ˆã‚«ãƒ¼ãƒ‰ | âŒ | é€€è·æ™‚falseã€WebhookåŒæœŸ |
| 3-2 | é€€è·ãƒ•ãƒ©ã‚° | `User.isRetired` | Boolean | ğŸ”µ MS | - | âŒ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆfalse |
| 3-3 | é€€è·æ—¥ | `User.retirementDate` | DateTime? | ğŸ”µ MS | - | âŒ | é€€è·æ™‚è¨­å®šã€WebhookåŒæœŸ |
| **4. åŒæœŸç®¡ç†ï¼ˆğŸ†• Phase 2è¿½åŠ ï¼‰** |
| 4-1 | åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `User.syncStatus` | Enum | ğŸŸ¢ VD | ãƒ†ãƒ¼ãƒ–ãƒ« | âŒ | synced/pending/error/never_synced |
| 4-2 | æœ€çµ‚åŒæœŸæ—¥æ™‚ | `User.lastSyncedAt` | DateTime? | ğŸŸ¢ VD | ãƒ†ãƒ¼ãƒ–ãƒ« | âŒ | MM/DD HH:mmè¡¨ç¤º |
| 4-3 | åŒæœŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | `User.syncErrorMessage` | String? | ğŸŸ¢ VD | ãƒ†ãƒ¼ãƒ–ãƒ« | âŒ | ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿20æ–‡å­—ã¾ã§è¡¨ç¤º |
| **5. VoiceDriveæ´»å‹•ãƒ‡ãƒ¼ã‚¿** |
| 5-1 | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ | `User.lastLoginAt` | DateTime? | ğŸŸ¢ VD | ãƒ†ãƒ¼ãƒ–ãƒ« | âŒ | MM/DD HH:mmè¡¨ç¤º |
| 5-2 | ãƒ­ã‚°ã‚¤ãƒ³å›æ•° | `User.loginCount` | Int | ğŸŸ¢ VD | - | âŒ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0 |
| 5-3 | ä½œæˆæ—¥æ™‚ | `User.createdAt` | DateTime | ğŸŸ¢ VD | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ã¿ | âŒ | VDç™»éŒ²æ—¥æ™‚ |
| 5-4 | æ›´æ–°æ—¥æ™‚ | `User.updatedAt` | DateTime | ğŸŸ¢ VD | - | âŒ | è‡ªå‹•æ›´æ–° |
| **6. VoiceDriveå›ºæœ‰è¨­å®šï¼ˆğŸ†• Phase 3æº–å‚™å®Œäº†ï¼‰** |
| 6-1 | ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®š | `voiceDriveSettings.emailNotifications` | Boolean | ğŸŸ¢ VD | è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« | âœ… | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆtrue |
| 6-2 | ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥è¨­å®š | `voiceDriveSettings.pushNotifications` | Boolean | ğŸŸ¢ VD | è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« | âœ… | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆtrue |
| 6-3 | é€±æ¬¡ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆ | `voiceDriveSettings.weeklyDigest` | Boolean | ğŸŸ¢ VD | è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« | âœ… | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆtrue |
| 6-4 | ãƒ†ãƒ¼ãƒè¨­å®š | `voiceDriveSettings.theme` | Enum | ğŸŸ¢ VD | è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« | âœ… | light/dark/auto |
| **7. çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆè¨ˆç®—å€¤ï¼‰** |
| 7-1 | ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° | (è¨ˆç®—å€¤) | Int | ğŸŸ¢ VD | çµ±è¨ˆã‚«ãƒ¼ãƒ‰ | - | users.length |
| 7-2 | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° | (è¨ˆç®—å€¤) | Int | ğŸŸ¢ VD | çµ±è¨ˆã‚«ãƒ¼ãƒ‰ | - | isActive=trueã®ã‚«ã‚¦ãƒ³ãƒˆ |
| 7-3 | ç„¡åŠ¹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° | (è¨ˆç®—å€¤) | Int | ğŸŸ¢ VD | çµ±è¨ˆã‚«ãƒ¼ãƒ‰ | - | isActive=falseã®ã‚«ã‚¦ãƒ³ãƒˆ |
| 7-4 | ç®¡ç†è€…æ•° | (è¨ˆç®—å€¤) | Int | ğŸŸ¢ VD | çµ±è¨ˆã‚«ãƒ¼ãƒ‰ | - | permissionLevel>=10ã®ã‚«ã‚¦ãƒ³ãƒˆ |

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

### ãƒ•ãƒ­ãƒ¼1: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  â†’ VoiceDriveï¼ˆWebhookï¼‰

**ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ**:
- è·å“¡å…¥ç¤¾
- è·å“¡æƒ…å ±å¤‰æ›´ï¼ˆéƒ¨ç½²ç•°å‹•ã€æ˜‡é€²ã€æ¨©é™å¤‰æ›´ï¼‰
- è·å“¡é€€è·

**åŒæœŸå¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ï¼ˆ15é …ç›®ï¼‰:
1. `employeeId`
2. `name`
3. `email`
4. `department`
5. `position`
6. `facilityId`
7. `permissionLevel`
8. `accountType`
9. `canPerformLeaderDuty`
10. `professionCategory`
11. `parentId`
12. `isActive`
13. `isRetired`
14. `retirementDate`
15. `updatedAt`

**Webhookãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¾‹**:
```json
{
  "eventType": "employee.updated",
  "timestamp": "2025-10-26T10:00:00Z",
  "employeeId": "EMP-2025-001",
  "data": {
    "name": "å±±ç”°å¤ªéƒ",
    "email": "yamada@example.com",
    "department": "çœ‹è­·éƒ¨",
    "position": "çœ‹è­·å¸«",
    "facilityId": "obara-hospital",
    "permissionLevel": 6.0,
    "accountType": "NEW_STAFF",
    "canPerformLeaderDuty": false,
    "professionCategory": "nurse",
    "parentId": "EMP-2020-015",
    "isActive": true,
    "isRetired": false,
    "retirementDate": null
  }
}
```

**VoiceDriveå‡¦ç†**:
```typescript
// Webhookå—ä¿¡æ™‚
await prisma.user.update({
  where: { employeeId: data.employeeId },
  data: {
    name: data.name,
    email: data.email,
    department: data.department,
    position: data.position,
    permissionLevel: data.permissionLevel,
    isActive: data.isActive,
    retirementDate: data.retirementDate,
    syncStatus: 'synced',
    lastSyncedAt: new Date(),
    syncErrorMessage: null
  }
});
```

---

### ãƒ•ãƒ­ãƒ¼2: VoiceDrive â†’ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAPIå‘¼ã³å‡ºã—ï¼‰

**ãƒˆãƒªã‚¬ãƒ¼**:
- å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼åŒæœŸãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
- å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€æ‹¬åŒæœŸãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
- å®šæœŸãƒãƒƒãƒï¼ˆæ—¥æ¬¡ 03:00 JSTï¼‰

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
1. `GET /api/employees/{employeeId}` - å€‹åˆ¥å–å¾—
2. `GET /api/employees` - å…¨ä»¶å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒ³ã‚°ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```http
GET /api/employees/EMP-2025-001
Authorization: Bearer {jwt_token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "employeeId": "EMP-2025-001",
  "name": "å±±ç”°å¤ªéƒ",
  "email": "yamada@example.com",
  "department": "çœ‹è­·éƒ¨",
  "position": "çœ‹è­·å¸«",
  "facilityId": "obara-hospital",
  "permissionLevel": 6.0,
  "accountType": "NEW_STAFF",
  "canPerformLeaderDuty": false,
  "professionCategory": "nurse",
  "parentId": "EMP-2020-015",
  "isActive": true,
  "isRetired": false,
  "retirementDate": null,
  "hireDate": "2025-04-01",
  "yearsOfService": 0.6,
  "updatedAt": "2025-10-26T10:00:00Z"
}
```

---

### ãƒ•ãƒ­ãƒ¼3: VoiceDriveå†…éƒ¨å‡¦ç†

**ãƒˆãƒªã‚¬ãƒ¼**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³
- VoiceDriveå›ºæœ‰è¨­å®šå¤‰æ›´

**æ›´æ–°å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ï¼ˆ7é …ç›®ï¼‰:
1. `lastLoginAt` - ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«æ›´æ–°
2. `loginCount` - ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
3. `syncStatus` - åŒæœŸå‡¦ç†æ™‚ã«æ›´æ–°
4. `lastSyncedAt` - åŒæœŸæˆåŠŸæ™‚ã«æ›´æ–°
5. `syncErrorMessage` - åŒæœŸã‚¨ãƒ©ãƒ¼æ™‚ã«è¨­å®š
6. `voiceDriveSettings` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šå¤‰æ›´æ™‚ã«æ›´æ–°
7. `updatedAt` - è‡ªå‹•æ›´æ–°ï¼ˆPrismaï¼‰

**å‡¦ç†ä¾‹**:
```typescript
// ãƒ­ã‚°ã‚¤ãƒ³æ™‚
await prisma.user.update({
  where: { id: userId },
  data: {
    lastLoginAt: new Date(),
    loginCount: { increment: 1 }
  }
});

// VoiceDriveå›ºæœ‰è¨­å®šå¤‰æ›´æ™‚
await prisma.user.update({
  where: { id: userId },
  data: {
    voiceDriveSettings: {
      emailNotifications: true,
      pushNotifications: false,
      weeklyDigest: true,
      theme: 'dark'
    }
  }
});
```

---

## ğŸ” ãƒ‡ãƒ¼ã‚¿é …ç›®è©³ç´°ä»•æ§˜

### 1. åŸºæœ¬æƒ…å ±

#### 1-1. VoiceDriveå†…éƒ¨ID
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.id`
- **å‹**: `String` (cuid())
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ã¿
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **å‚™è€ƒ**: VoiceDriveå†…éƒ¨ã§ä½¿ç”¨ã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã«ã¯å…¬é–‹ã—ãªã„

---

#### 1-2. è·å“¡ID
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.employeeId`
- **å‹**: `String` (UNIQUE)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **å‚™è€ƒ**: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãŒç™ºè¡Œã€VoiceDriveã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã¿
- **ä¾‹**: `EMP-2025-001`, `OH-NS-2024-001`

---

#### 1-3. æ°å
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.name`
- **å‹**: `String` (NOT NULL)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã§ç·¨é›†ï¼‰
- **åŒæœŸæ–¹æ³•**: Webhook `employee.updated`
- **ä¾‹**: `å±±ç”°å¤ªéƒ`, `ä½è—¤èŠ±å­`

---

#### 1-4. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.email`
- **å‹**: `String` (UNIQUE)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã§ç·¨é›†ï¼‰
- **åŒæœŸæ–¹æ³•**: Webhook `employee.updated`
- **ä¾‹**: `yamada@obara-hospital.jp`

---

#### 1-5. éƒ¨ç½²
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.department`
- **å‹**: `String?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã§ç·¨é›†ï¼‰
- **åŒæœŸæ–¹æ³•**: Webhook `employee.department_changed`
- **ä¾‹**: `çœ‹è­·éƒ¨`, `ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç§‘`, `åŒ»äº‹èª²`

---

#### 1-6. å½¹è·
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.position`
- **å‹**: `String?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã§ç·¨é›†ï¼‰
- **åŒæœŸæ–¹æ³•**: Webhook `employee.updated`
- **ä¾‹**: `çœ‹è­·å¸«`, `ä¸»ä»»`, `å¸«é•·`, `ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…`

---

#### 1-7. æ–½è¨­ID
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.facilityId`
- **å‹**: `String?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **åŒæœŸæ–¹æ³•**: Webhook `employee.updated`
- **ä¾‹**: `obara-hospital`, `obara-clinic-1`

---

### 2. æ¨©é™æƒ…å ±

#### 2-1. æ¨©é™ãƒ¬ãƒ™ãƒ«
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.permissionLevel`
- **å‹**: `Decimal` (1.0 - 25.0)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ï¼ˆV3è©•ä¾¡ã‹ã‚‰ç®—å‡ºï¼‰
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€æ¨©é™ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€çµ±è¨ˆã‚«ãƒ¼ãƒ‰ï¼ˆç®¡ç†è€…æ•°ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã§è‡ªå‹•ç®—å‡ºï¼‰
- **åŒæœŸæ–¹æ³•**: Webhook `employee.permission_changed`
- **ç‰¹æ®Šå€¤**: `99.0` = Level Xï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ï¼‰
- **è¡¨ç¤ºå½¢å¼**: ãƒãƒƒã‚¸ï¼ˆè‰²åˆ†ã‘ï¼‰
  - Level X (99): ç´«
  - Level 18: èµ¤
  - Level 13: ã‚ªãƒ¬ãƒ³ã‚¸
  - Level 10: é»„
  - Level 8: ç·‘
  - Level 6: é’
  - ãã®ä»–: ã‚°ãƒ¬ãƒ¼

---

#### 2-2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¨®åˆ¥
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.accountType`
- **å‹**: `String`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **å€¤**: `NEW_STAFF`, `MID_CAREER`, `LEADER`, `MANAGER`, `EXECUTIVE`

---

#### 2-3. ãƒªãƒ¼ãƒ€ãƒ¼è³‡æ ¼
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.canPerformLeaderDuty`
- **å‹**: `Boolean`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ï¼ˆV3è©•ä¾¡ã‹ã‚‰ç®—å‡ºï¼‰
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `false`

---

#### 2-4. è·ç¨®ã‚«ãƒ†ã‚´ãƒª
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.professionCategory`
- **å‹**: `String?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **å€¤**: `nurse`, `doctor`, `therapist`, `admin`, `support`

---

#### 2-5. ä¸Šå¸ID
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.parentId`
- **å‹**: `String?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **å‚™è€ƒ**: çµ„ç¹”éšå±¤ã€æ‰¿èªãƒ•ãƒ­ãƒ¼ç”¨

---

### 3. é›‡ç”¨æƒ…å ±

#### 3-1. æœ‰åŠ¹/ç„¡åŠ¹
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.isActive`
- **å‹**: `Boolean`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€çµ±è¨ˆã‚«ãƒ¼ãƒ‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `true`
- **å¤‰æ›´ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: é€€è·æ™‚ã«`false`
- **åŒæœŸæ–¹æ³•**: Webhook `employee.retired`
- **è¡¨ç¤ºå½¢å¼**: ãƒãƒƒã‚¸
  - æœ‰åŠ¹: ç·‘è‰² `bg-green-500/20 text-green-400`
  - ç„¡åŠ¹: èµ¤è‰² `bg-red-500/20 text-red-400`

---

#### 3-2. é€€è·ãƒ•ãƒ©ã‚°
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.isRetired`
- **å‹**: `Boolean`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `false`
- **å‚™è€ƒ**: `isActive`ã¨åŒæœŸï¼ˆé€€è·æ™‚ã«ä¸¡æ–¹`false`/`true`ï¼‰

---

#### 3-3. é€€è·æ—¥
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.retirementDate`
- **å‹**: `DateTime?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸ”µ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯
- **åŒæœŸæ–¹æ³•**: Webhook `employee.retired`

---

### 4. åŒæœŸç®¡ç†ï¼ˆğŸ†• Phase 2è¿½åŠ ï¼‰

#### 4-1. åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.syncStatus`
- **å‹**: `Enum('synced', 'pending', 'error', 'never_synced')`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆåŒæœŸçŠ¶æ…‹åˆ—ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `'never_synced'`
- **å€¤ã®æ„å‘³**:
  - `synced`: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨åŒæœŸæ¸ˆã¿ï¼ˆç·‘ï¼‰
  - `pending`: åŒæœŸå¾…ã¡ï¼ˆé»„ï¼‰
  - `error`: åŒæœŸã‚¨ãƒ©ãƒ¼ï¼ˆèµ¤ï¼‰
  - `never_synced`: æœªåŒæœŸï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰
- **è¡¨ç¤ºå½¢å¼**: ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒãƒƒã‚¸
  - `synced`: âœ… CheckCircleï¼ˆç·‘ï¼‰
  - `error`: âŒ XCircleï¼ˆèµ¤ï¼‰
  - `pending`: â³ Clockï¼ˆé»„ï¼‰
  - `never_synced`: âš ï¸ AlertTriangleï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰

---

#### 4-2. æœ€çµ‚åŒæœŸæ—¥æ™‚
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.lastSyncedAt`
- **å‹**: `DateTime?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆåŒæœŸçŠ¶æ…‹åˆ—ã®ä¸‹ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
- **æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: åŒæœŸæˆåŠŸæ™‚
- **è¡¨ç¤ºå½¢å¼**: `MM/DD HH:mm`ï¼ˆä¾‹: `10/26 14:30`ï¼‰

---

#### 4-3. åŒæœŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.syncErrorMessage`
- **å‹**: `String?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿ã€20æ–‡å­—ã¾ã§ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•è¨­å®šï¼‰
- **è¨­å®šã‚¿ã‚¤ãƒŸãƒ³ã‚°**: åŒæœŸã‚¨ãƒ©ãƒ¼æ™‚
- **ä¾‹**: `Webhookç½²åæ¤œè¨¼ã‚¨ãƒ©ãƒ¼`, `APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ`, `ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼`

---

### 5. VoiceDriveæ´»å‹•ãƒ‡ãƒ¼ã‚¿

#### 5-1. æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.lastLoginAt`
- **å‹**: `DateTime?` (NULLå¯)
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³åˆ—ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
- **æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³æ™‚
- **è¡¨ç¤ºå½¢å¼**: `MM/DD HH:mm`ï¼ˆä¾‹: `10/05 14:30`ï¼‰
- **NULLæ™‚ã®è¡¨ç¤º**: `-`

---

#### 5-2. ãƒ­ã‚°ã‚¤ãƒ³å›æ•°
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.loginCount`
- **å‹**: `Int`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `0`
- **æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«+1

---

#### 5-3. ä½œæˆæ—¥æ™‚
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.createdAt`
- **å‹**: `DateTime`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ã¿
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•è¨­å®šï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `now()`
- **å‚™è€ƒ**: VoiceDriveã¸ã®ç™»éŒ²æ—¥æ™‚

---

#### 5-4. æ›´æ–°æ—¥æ™‚
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `User.updatedAt`
- **å‹**: `DateTime`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: éè¡¨ç¤ºï¼ˆå†…éƒ¨å‚ç…§ã®ã¿ï¼‰
- **ç·¨é›†å¯å¦**: âŒ ä¸å¯ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
- **æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ™‚ï¼ˆPrisma `@updatedAt`ï¼‰

---

### 6. VoiceDriveå›ºæœ‰è¨­å®šï¼ˆğŸ†• Phase 3æº–å‚™å®Œäº†ï¼‰

#### 6-1. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®š
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `voiceDriveSettings.emailNotifications`
- **å‹**: `Boolean`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
- **ç·¨é›†å¯å¦**: âœ… **å¯**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒç·¨é›†ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `true`
- **èª¬æ˜**: ã‚¢ã‚¤ãƒ‡ã‚¢ãƒœã‚¤ã‚¹ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã€ã‚³ãƒ¡ãƒ³ãƒˆé€šçŸ¥ã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡

---

#### 6-2. ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥è¨­å®š
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `voiceDriveSettings.pushNotifications`
- **å‹**: `Boolean`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
- **ç·¨é›†å¯å¦**: âœ… **å¯**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒç·¨é›†ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `true`
- **èª¬æ˜**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®æœ‰åŠ¹/ç„¡åŠ¹

---

#### 6-3. é€±æ¬¡ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆ
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `voiceDriveSettings.weeklyDigest`
- **å‹**: `Boolean`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
- **ç·¨é›†å¯å¦**: âœ… **å¯**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒç·¨é›†ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `true`
- **èª¬æ˜**: æ¯é€±æœˆæ›œæœã«å…ˆé€±ã®ã‚µãƒãƒªãƒ¼ãƒ¡ãƒ¼ãƒ«ã‚’å—ä¿¡

---

#### 6-4. ãƒ†ãƒ¼ãƒè¨­å®š
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `voiceDriveSettings.theme`
- **å‹**: `Enum('light', 'dark', 'auto')`
- **ãƒã‚¹ã‚¿ãƒ¼**: ğŸŸ¢ VoiceDrive
- **è¡¨ç¤ºç®‡æ‰€**: è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
- **ç·¨é›†å¯å¦**: âœ… **å¯**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒç·¨é›†ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `'auto'`
- **èª¬æ˜**: UIãƒ†ãƒ¼ãƒï¼ˆãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯/è‡ªå‹•ï¼‰

---

### 7. çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆè¨ˆç®—å€¤ï¼‰

#### 7-1. ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- **è¨ˆç®—å¼**: `users.length`
- **è¡¨ç¤ºç®‡æ‰€**: çµ±è¨ˆã‚«ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: VoiceDrive `User`ãƒ†ãƒ¼ãƒ–ãƒ«

---

#### 7-2. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- **è¨ˆç®—å¼**: `users.filter(u => u.isActive).length`
- **è¡¨ç¤ºç®‡æ‰€**: çµ±è¨ˆã‚«ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: VoiceDrive `User.isActive`

---

#### 7-3. ç„¡åŠ¹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- **è¨ˆç®—å¼**: `users.filter(u => !u.isActive).length`
- **è¡¨ç¤ºç®‡æ‰€**: çµ±è¨ˆã‚«ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: VoiceDrive `User.isActive`

---

#### 7-4. ç®¡ç†è€…æ•°
- **è¨ˆç®—å¼**: `users.filter(u => u.permissionLevel >= 10).length`
- **è¡¨ç¤ºç®‡æ‰€**: çµ±è¨ˆã‚«ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: VoiceDrive `User.permissionLevel`

---

## ğŸ“‹ Prisma Schemaæ‹¡å¼µæ¡ˆ

```prisma
model User {
  id                            String                          @id @default(cuid())
  employeeId                    String                          @unique
  email                         String                          @unique
  name                          String
  department                    String?
  facilityId                    String?
  role                          String?
  avatar                        String?
  accountType                   String
  permissionLevel               Decimal
  canPerformLeaderDuty          Boolean                         @default(false)
  professionCategory            String?
  parentId                      String?
  budgetApprovalLimit           Float?
  stakeholderCategory           String?
  position                      String?
  expertise                     Int?
  hierarchyLevel                Int?
  isRetired                     Boolean                         @default(false)
  retirementDate                DateTime?
  anonymizedId                  String?
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime                        @updatedAt
  lastLoginAt                   DateTime?
  loginCount                    Int                             @default(0)

  // ğŸ†• Phase 2: åŒæœŸç®¡ç†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  syncStatus                    SyncStatus                      @default(never_synced) @map("sync_status")
  lastSyncedAt                  DateTime?                       @map("last_synced_at")
  syncErrorMessage              String?                         @map("sync_error_message")

  // ğŸ†• Phase 3: VoiceDriveå›ºæœ‰è¨­å®š
  voiceDriveSettings            Json?                           @map("voicedrive_settings")

  // ... æ—¢å­˜ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

  @@index([syncStatus])
  @@map("users")
}

// ğŸ†• åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹Enum
enum SyncStatus {
  synced
  pending
  error
  never_synced
}
```

---

## ğŸ¯ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: åŒæœŸåŸºç›¤æ§‹ç¯‰ï¼ˆ2é€±é–“ï¼‰

#### Week 1: DBãƒ»ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
- [ ] Prisma schemaæ‹¡å¼µ
  - [ ] `syncStatus` Enumè¿½åŠ 
  - [ ] `User.syncStatus`, `User.lastSyncedAt`, `User.syncErrorMessage`è¿½åŠ 
  - [ ] `User.voiceDriveSettings` JSONè¿½åŠ 
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] `MedicalSystemClient.ts`å®Ÿè£…
  - [ ] `getAllEmployees()`
  - [ ] `getEmployee(employeeId)`
- [ ] `UserSyncService.ts`å®Ÿè£…
  - [ ] `syncSingleUser(userId)`
  - [ ] `syncAllUsers()`

#### Week 2: APIãƒ»UIçµ±åˆ
- [ ] `userManagementRoutes.ts`å®Ÿè£…
  - [ ] `GET /api/admin/users`
  - [ ] `POST /api/admin/users/:userId/sync`
  - [ ] `POST /api/admin/users/sync-all`
- [ ] UserManagementPage APIçµ±åˆ
  - [ ] `loadUsers()`ã‚’APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
  - [ ] `handleSyncSingleUser()`ã‚’å®Ÿè£…
  - [ ] `handleSyncAllUsers()`ã‚’å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

---

### Phase 2: Webhookçµ±åˆï¼ˆ1é€±é–“ï¼‰

#### Week 3: Webhookå®Ÿè£…
- [ ] Webhookå—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - [ ] `POST /api/webhooks/employee-created`
  - [ ] `POST /api/webhooks/employee-updated`
  - [ ] `POST /api/webhooks/employee-retired`
- [ ] HMAC-SHA256ç½²åæ¤œè¨¼
- [ ] Webhookå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
  - [ ] `User.upsert()`
  - [ ] `syncStatus='synced'`è¨­å®š
- [ ] ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

---

### Phase 3: VoiceDriveå›ºæœ‰è¨­å®šï¼ˆ1é€±é–“ï¼‰

#### Week 4: è¨­å®šæ©Ÿèƒ½å®Ÿè£…
- [ ] è¨­å®šç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«UIå®Ÿè£…
- [ ] è¨­å®šAPIå®Ÿè£…
  - [ ] `PUT /api/users/:userId/settings`
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
- [ ] é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ é€£æº
- [ ] ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ é€£æº
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

---

## ğŸ“ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | ä½œæˆæ—¥ |
|------------|------------|--------|
| **DBè¦ä»¶åˆ†æ** | `mcp-shared/docs/UserManagementPage_DBè¦ä»¶åˆ†æ_20251026.md` | 10/26 |
| **æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ** | `mcp-shared/docs/UserManagementPageæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251026.md` | 10/26 |
| **ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸** | `mcp-shared/docs/ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md` | 10/8 |
| **PersonalStation DBè¦ä»¶åˆ†æ** | `mcp-shared/docs/PersonalStation_DBè¦ä»¶åˆ†æ_20251008.md` | 10/8 |
| **Dashboard DBè¦ä»¶åˆ†æ** | `mcp-shared/docs/Dashboard_DBè¦ä»¶åˆ†æ_20251009.md` | 10/9 |

---

**æ–‡æ›¸çµ‚äº†**

æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ26æ—¥
ä½œæˆè€…: VoiceDriveãƒãƒ¼ãƒ 
æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼: Phase 1å®Ÿè£…é–‹å§‹æ™‚
