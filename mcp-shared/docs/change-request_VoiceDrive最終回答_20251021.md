# キャリアコース変更申請 VoiceDrive最終回答

**文書番号**: VD-FINAL-2025-1021-001
**作成日**: 2025年10月21日
**最終更新**: 2025年10月21日
**作成者**: VoiceDriveチーム
**対象**: 医療職員管理システムチーム
**参照文書**:
- MED-INFO-2025-1021-003（医療システム連絡）
- MED-RES-2025-1021-002（追加質問への回答）
- MED-IMPL-2025-1021-004（Phase 5-4実装指示書）

---

## 📋 エグゼクティブサマリー

医療システムチームからいただいた以下の連絡・回答に対する最終回答です。

### 受領ドキュメント

| 文書番号 | タイトル | 受領日 |
|---------|---------|--------|
| MED-RES-2025-1021-001 | 医療システム確認結果 | 2025-10-21 |
| MED-RES-2025-1021-002 | 追加質問への回答 | 2025-10-21 |
| MED-INFO-2025-1021-003 | スケジュール確定連絡 | 2025-10-21 |
| MED-IMPL-2025-1021-004 | Phase 5-4実装指示書 | 2025-10-21 |

### VoiceDrive回答サマリー

| 項目 | 回答 |
|------|------|
| **スケジュール承認** | ✅ 承認（11/6-11/8統合テスト参加） |
| **API提供開始日** | ✅ 10/29（火）9:00開始で問題なし |
| **準備作業** | ✅ 10/29までに完了予定 |

---

## 1. 医療システム側からの依頼事項への回答

### 依頼-1: スケジュール確認

**医療システムからの質問**:
> 以下のスケジュールでVoiceDrive側の都合は問題ありませんか？
> - 10/29（火）API提供開始
> - 11/6（水）9:00 統合テストキックオフ
> - 11/7（木）終日 統合テスト実施
> - 11/8（金）15:00 統合テスト完了報告

#### VoiceDrive回答: ✅ すべて承認します

| 日付 | 内容 | VoiceDrive参加 | 準備状況 |
|------|------|---------------|---------|
| **10/29（火）9:00** | API提供開始 | - | ✅ 準備完了予定 |
| **11/6（水）9:00-10:00** | 統合テストキックオフ | ✅ **参加** | ✅ 参加確定 |
| **11/7（木）9:00-17:00** | 統合テスト実施 | ✅ **参加** | ✅ 参加確定 |
| **11/8（金）15:00-16:00** | 統合テスト完了報告 | ✅ **参加** | ✅ 参加確定 |

#### 参加者

**VoiceDriveチーム**:
- プロジェクトリード: [担当者名]
- 技術担当（フロントエンド）: [担当者名]
- 技術担当（API統合）: [担当者名]

**スケジュール調整**: 不要（上記日程で確定）

---

### 依頼-2: 開発環境準備確認

**医療システムからの依頼**:
> 10/29のAPI提供開始までに、以下の準備をお願いします：
> 1. 型定義の更新
> 2. Supabase Storage設定確認
> 3. 認証フロー確認

#### VoiceDrive回答: ✅ すべて10/29までに完了予定

##### 準備-1: 型定義の更新

**対象ファイル**: `src/types/career-course.ts`

**変更内容**: テーブル名を医療システム側の命名規則に統一

| VoiceDrive提案 | 医療システム実装 | 対応 |
|----------------|------------------|------|
| `career_course_definitions` | `course_definitions` | ✅ 更新 |
| `career_course_selections` | `staff_career_courses` | ✅ 更新 |
| `career_course_change_requests` | `course_change_requests` | ✅ 更新 |

**予定工数**: 0.5日
**完了予定**: 10/24（木）
**担当者**: [技術担当者名]

##### 準備-2: Supabase Storage設定

**設定内容**:
- バケット名: `career-course-attachments`
- 公開設定: プライベートバケット
- RLS設定: ユーザー自身のファイルのみアクセス可能

**予定工数**: 0.5日
**完了予定**: 10/25（金）
**担当者**: [技術担当者名]

**確認事項**:
- [ ] バケット作成完了
- [ ] RLSポリシー設定完了
- [ ] アクセス権限テスト完了

##### 準備-3: 認証フロー確認

**確認内容**:
- Supabase JWT認証の実装確認
- `Authorization: Bearer {token}` ヘッダーの付与確認
- 既存のVoiceDrive認証との統合確認

**予定工数**: 0.5日
**完了予定**: 10/25（金）
**担当者**: [技術担当者名]

**実装方針**:
```typescript
// 既存のVoiceDrive認証を使用
const { data: { session } } = await supabase.auth.getSession();

// 医療システムAPIへのリクエスト
const response = await fetch(`${MEDICAL_API_URL}/api/career-course/change-request`, {
  headers: {
    'Authorization': `Bearer ${session.access_token}`,
    'Content-Type': 'application/json',
  },
  // ...
});
```

---

## 2. VoiceDrive側の準備スケジュール

### 全体スケジュール

| 日付 | 作業内容 | 担当 | 状態 |
|------|---------|------|------|
| **10/21（月）** | 本回答書作成・送付 | プロジェクトリード | ✅ 完了 |
| **10/24（木）** | 型定義更新 | 技術担当 | ⏳ 予定 |
| **10/25（金）** | Supabase Storage設定 | 技術担当 | ⏳ 予定 |
| **10/25（金）** | 認証フロー確認 | 技術担当 | ⏳ 予定 |
| **10/29（火）** | API接続テスト開始 | 技術担当 | ⏳ 予定 |
| **11/6（水）** | 統合テストキックオフ | 全員 | ⏳ 予定 |
| **11/7（木）** | 統合テスト実施 | 技術担当 | ⏳ 予定 |
| **11/8（金）** | 統合テスト完了報告 | 全員 | ⏳ 予定 |

### VoiceDrive側の準備完了基準

- [ ] 型定義更新完了（10/24）
- [ ] Supabase Storage設定完了（10/25）
- [ ] 認証フロー確認完了（10/25）
- [ ] 環境変数設定完了（10/29）
- [ ] Dev環境API接続テスト完了（10/29-11/5）

---

## 3. 統合テスト期間（11/6-11/8）のVoiceDrive側作業

### 11/6（水）: 統合テストキックオフ

**時間**: 9:00～10:00
**参加**: VoiceDriveチーム全員

**準備事項**:
- [ ] ChangeRequestPage.tsx のAPI接続準備完了
- [ ] 認証フロー実装確認
- [ ] エラーハンドリング実装確認
- [ ] テスト環境セットアップ完了

### 11/7（木）: 統合テスト実施

**時間**: 9:00～17:00
**参加**: 技術担当

**VoiceDrive側のテスト項目**:

| No | テスト内容 | 期待結果 | 優先度 |
|----|-----------|---------|--------|
| 1 | コース変更申請（正常系） | 申請作成成功、pending状態 | 🔴 高 |
| 2 | ファイルアップロード（PDF） | アップロード成功、URL取得 | 🔴 高 |
| 3 | 年1回制限チェック | 制限エラー表示 | 🟡 中 |
| 4 | 特例変更・添付なし | 添付必須エラー | 🟡 中 |
| 5 | ファイルアップロード（大容量） | 10MB超過エラー | 🟡 中 |
| 6 | ファイルアップロード（不正拡張子） | 拡張子エラー | 🟡 中 |
| 7 | 認証エラー（トークンなし） | 401 Unauthorized | 🟡 中 |
| 8 | 認証エラー（無効トークン） | 401 Unauthorized | 🟡 中 |
| 9 | ネットワークエラー | エラー表示・リトライ可能 | 🟢 低 |
| 10 | ローディング状態 | スピナー表示 | 🟢 低 |

**成果物**:
- テスト結果レポート
- バグ報告リスト
- 修正依頼リスト

### 11/8（金）: 統合テスト完了報告

**時間**: 15:00～16:00
**参加**: VoiceDriveチーム全員

**報告内容**:
- テスト結果サマリー
- 発見したバグ・問題点
- リリース可否判定（VoiceDrive側）
- 残課題の確認

---

## 4. API仕様の最終確認

### 使用するエンドポイント

医療システム側の追加回答（MED-RES-2025-1021-002）で提供されるエンドポイントを使用します。

| No | エンドポイント | メソッド | 用途 | 実装優先度 |
|----|--------------|---------|------|-----------|
| 1 | `/api/career-courses/definitions` | GET | コース定義一覧取得 | 🔴 高 |
| 2 | `/api/my-page` | GET | マイページ情報取得 | 🔴 高 |
| 3 | `/api/career-course/change-request` | POST | コース変更申請送信 | 🔴 高 |
| 4 | `/api/career-course/my-requests` | GET | 申請履歴取得 | 🟡 中 |
| 5 | `/api/career-course/upload-attachment` | POST | ファイルアップロード | 🟡 中 |

### ベースURL

**開発環境**: `http://localhost:3000`（医療システム開発サーバー）
**Dev環境**: 10/22提供予定のURL使用

### 認証方式

**Supabase JWT認証**を使用（既存VoiceDrive認証と同じ）

```typescript
headers: {
  'Authorization': `Bearer ${session.access_token}`,
  'Content-Type': 'application/json',
}
```

---

## 5. ファイルストレージの確認

### Supabase Storage設定

**バケット名**: `career-course-attachments`
**公開設定**: プライベート（RLS設定）

### ファイル制限

| 項目 | 制限値 | 確認 |
|------|--------|------|
| **ファイルサイズ** | 10MB | ✅ 了解 |
| **許可拡張子** | PDF, JPG, JPEG, PNG | ✅ 了解 |
| **保管期間** | 無期限（申請記録として保管） | ✅ 了解 |

### RLSポリシー

- ユーザーは自分のファイルのみアップロード・閲覧可能
- 人事部は全ファイル閲覧可能

**確認**: ✅ VoiceDrive側でRLS設定実施予定（10/25）

---

## 6. 技術的な質問・確認事項

### 質問-1: Dev環境URLの提供予定

**質問内容**:
医療システム連絡（MED-INFO-2025-1021-003）では「10/22までにDev環境URL提供」とありますが、提供予定時刻を教えていただけますでしょうか？

**理由**:
VoiceDrive側の環境変数設定とAPI接続テストをスムーズに開始したいため。

**希望回答期限**: 10/22（火）中

---

### 質問-2: OpenAPI仕様書の提供予定

**質問内容**:
「10/24までにOpenAPI仕様書作成予定」とありますが、作成完了次第、Slack等で共有いただけますでしょうか？

**理由**:
API仕様の詳細確認と、VoiceDrive側の型定義の最終チェックを行いたいため。

**希望回答期限**: 10/24（木）中

---

### 質問-3: テストデータの提供

**質問内容**:
統合テスト用のテストデータ（職員情報、コース選択状況）を事前に提供いただけますでしょうか？

**希望内容**:
- テスト用職員アカウント（3-5アカウント）
- 各アカウントの現在のコース選択状況
- ログイン認証情報（Supabase認証用）

**理由**:
VoiceDrive側でAPI接続テストを事前に実施し、統合テスト期間の効率化を図りたいため。

**希望提供日**: 10/29（火）（API提供開始日）

---

## 7. 今後のコミュニケーション

### 連絡窓口

**VoiceDriveチーム**:
- プロジェクトリード: [担当者名]
- 技術担当: [担当者名]
- Slack: #phase5-career-course

### 連絡方法

| 緊急度 | 連絡方法 | 対応時間 |
|--------|---------|---------|
| **緊急** | Slack DM | 1時間以内 |
| **通常** | Slack #phase5-career-course | 当日中 |
| **正式** | ドキュメント（mcp-shared/docs/） | 2営業日以内 |

### 定例ミーティング提案

**提案**: 統合テスト期間中の日次ミーティング

| 日付 | 時間 | 内容 |
|------|------|------|
| 11/6（水） | 9:00-10:00 | キックオフ（既定） |
| 11/6（水） | 17:00-17:30 | 進捗確認 |
| 11/7（木） | 17:00-17:30 | 進捗確認 |
| 11/8（金） | 15:00-16:00 | 完了報告（既定） |

**参加**: 両チームの技術担当
**形式**: オンライン（Slack Huddle or Zoom）

---

## 8. まとめ

### VoiceDrive回答サマリー

| 項目 | 回答 | 詳細 |
|------|------|------|
| **スケジュール承認** | ✅ 承認 | 11/6-11/8統合テスト参加確定 |
| **準備作業** | ✅ 10/29までに完了 | 型定義、Storage、認証確認 |
| **API提供開始日** | ✅ 10/29（火）9:00 | 問題なし |
| **技術的質問** | 3件 | Dev環境URL、OpenAPI、テストデータ |

### 次のアクション

#### VoiceDrive側（即時）
- [x] 本回答書を医療システムチームへ送付（本日中）

#### VoiceDrive側（10/29まで）
- [ ] 型定義更新（10/24）
- [ ] Supabase Storage設定（10/25）
- [ ] 認証フロー確認（10/25）
- [ ] Dev環境API接続テスト（10/29-11/5）

#### 医療システム側への依頼（回答希望）
- [ ] Dev環境URL提供（10/22）
- [ ] OpenAPI仕様書提供（10/24）
- [ ] テストデータ提供（10/29）

---

## 9. 感謝とお礼

医療システムチームの皆様

キャリアコース変更申請機能の実装に向けた詳細な分析・回答、および実装指示書の作成、誠にありがとうございます。

特に以下の点について感謝申し上げます：

1. **迅速な対応**: VoiceDriveからの質問に対する即日回答
2. **詳細な実装指示書**: Phase 5-4実装指示書（80ページ超）の作成
3. **柔軟な調整**: テーブル命名規則の統一対応
4. **明確なスケジュール**: 統合テストまでの詳細スケジュール提示

上記のスケジュールと準備内容で、VoiceDrive側の実装をスムーズに進めることができます。

引き続きよろしくお願いいたします。

---

**VoiceDriveチーム一同**

2025年10月21日

---

**改訂履歴**

| 版 | 日付 | 変更内容 | 作成者 |
|----|------|---------|--------|
| 1.0 | 2025-10-21 | 初版作成 | VoiceDriveチーム |
