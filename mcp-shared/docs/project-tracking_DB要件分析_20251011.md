# ProjectTrackingï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¿½è·¡ï¼‰DBè¦ä»¶åˆ†æ

**æ–‡æ›¸ç•ªå·**: VD-DB-ANALYSIS-PROJECT-TRACKING-20251011
**ä½œæˆæ—¥**: 2025å¹´10æœˆ11æ—¥
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: https://voicedrive-v100.vercel.app/project-tracking
**å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼**: å…¨è·å“¡ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ãƒ¢ãƒ¼ãƒ‰åˆ©ç”¨è€…ï¼‰
**ãƒšãƒ¼ã‚¸ç›®çš„**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ãƒ¢ãƒ¼ãƒ‰ã§ã®æ´»å‹•çŠ¶æ³ã‚’è¿½è·¡ãƒ»ç¢ºèª

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ãƒšãƒ¼ã‚¸æ¦‚è¦
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ´»å‹•ã®è¿½è·¡**: ææ¡ˆãƒ»æŠ•ç¥¨ãƒ»å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€è¦§è¡¨ç¤º
- **çµ±è¨ˆã‚µãƒãƒªãƒ¼**: ææ¡ˆæ•°ã€æŠ•ç¥¨æ•°ã€ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã€é”æˆæ•°ã®4æŒ‡æ¨™ã‚’è¡¨ç¤º
- **3ã¤ã®ãƒ“ãƒ¥ãƒ¼**: ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **ã‚¹ã‚³ã‚¢è¡¨ç¤º**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ã‚³ã‚¢ã¨ãƒ¬ãƒ™ãƒ«ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
- **é€²æ—è¿½è·¡**: å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾çŠ¶ï¼ˆã‚¹ã‚³ã‚¢ã€æŠ•ç¥¨ç‡ã€ãƒ¬ãƒ™ãƒ«ï¼‰ã‚’å¯è¦–åŒ–

### ãƒ‡ãƒ¼ã‚¿è²¬ä»»åˆ†ç•Œ
| ãƒ‡ãƒ¼ã‚¿ | è²¬ä»»ã‚·ã‚¹ãƒ†ãƒ  | ç†ç”± |
|--------|------------|------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿ | VoiceDrive | Post ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç† |
| æŠ•ç¥¨å±¥æ­´ | VoiceDrive | Vote ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç† |
| ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´ | VoiceDrive | Comment ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç† |
| ã‚¹ã‚³ã‚¢è¨ˆç®— | VoiceDrive | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹•çš„è¨ˆç®— |
| è·å“¡æƒ…å ± | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | æ¨©é™ãƒ¬ãƒ™ãƒ«ç­‰ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å–å¾— |

### ä¸è¶³é …ç›®ã‚µãƒãƒªãƒ¼
- **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«**: 0å€‹ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½ï¼‰
- **ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ**: 0å€‹ï¼ˆæ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å¯¾å¿œå¯èƒ½ï¼‰
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ **: 2å€‹ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨ï¼‰
- **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ API**: 0å€‹ï¼ˆæ—¢å­˜APIã§å¯¾å¿œå¯èƒ½ï¼‰

---

## ğŸ¯ ãƒšãƒ¼ã‚¸æ©Ÿèƒ½è©³ç´°åˆ†æ

### 1. ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤ºï¼ˆLines 78-86ï¼‰

**æ©Ÿèƒ½**: ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã‚’è¡¨ç¤º

**è¡¨ç¤ºé …ç›®**:
- ã‚¿ã‚¤ãƒˆãƒ«: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½è·¡"
- ã‚¢ã‚¤ã‚³ãƒ³: Rocket
- èª¬æ˜æ–‡: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–ãƒ¢ãƒ¼ãƒ‰ã§ã®æ´»å‹•çŠ¶æ³"

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- ãªã—ï¼ˆé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰

**ä¸è¶³é …ç›®**:
- ãªã—

---

### 2. çµ±è¨ˆã‚µãƒãƒªãƒ¼è¡¨ç¤ºï¼ˆLines 88-96ï¼‰

**æ©Ÿèƒ½**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ´»å‹•ã®çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º

**è¡¨ç¤ºé …ç›®** (TrackingStats ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ):
- ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•° (`myPostsCount`)
- æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•° (`votedPostsCount`)
- ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•° (`commentedPostsCount`)
- é”æˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•° (`achievedCount`) - ã‚¹ã‚³ã‚¢100ä»¥ä¸Š

**å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
```typescript
interface TrackingStats {
  myPostsCount: number;        // è‡ªåˆ†ãŒæŠ•ç¨¿ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°
  votedPostsCount: number;     // è‡ªåˆ†ãŒæŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°
  commentedPostsCount: number; // è‡ªåˆ†ãŒã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°
  achievedCount: number;       // é”æˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°ï¼ˆã‚¹ã‚³ã‚¢100+ï¼‰
}
```

**ãƒ‡ãƒ¼ã‚¿å–å¾—æ–¹æ³•**:
- `myPostsCount`: `Post` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ `authorId = currentUser.id` AND `type = 'improvement'` ã§ã‚«ã‚¦ãƒ³ãƒˆ
- `votedPostsCount`: `Vote` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ `userId = currentUser.id` ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª `postId` ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
- `commentedPostsCount`: `Comment` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ `authorId = currentUser.id` ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª `postId` ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
- `achievedCount`: ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã†ã¡ã€ã‚¹ã‚³ã‚¢è¨ˆç®—çµæœãŒ100ä»¥ä¸Šã®ã‚‚ã®ã‚’ã‚«ã‚¦ãƒ³ãƒˆ

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### 3. ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆLines 98-138ï¼‰

**æ©Ÿèƒ½**: 3ã¤ã®ãƒ“ãƒ¥ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆ

**ã‚¿ãƒ–é …ç›®**:
1. **ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** (`posted`)
   - è‡ªåˆ†ãŒæŠ•ç¨¿ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
   - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: `Post` ãƒ†ãƒ¼ãƒ–ãƒ« WHERE `authorId = currentUser.id` AND `type = 'improvement'`

2. **æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** (`voted`)
   - è‡ªåˆ†ãŒæŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
   - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: `Post` ãƒ†ãƒ¼ãƒ–ãƒ« JOIN `Vote` WHERE `Vote.userId = currentUser.id`

3. **å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** (`joined`)
   - è‡ªåˆ†ãŒã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
   - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: `Post` ãƒ†ãƒ¼ãƒ–ãƒ« JOIN `Comment` WHERE `Comment.authorId = currentUser.id`

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆLines 142-203ï¼‰

**æ©Ÿèƒ½**: é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€è¦§è¡¨ç¤º

**è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿** (Lines 216-260ã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Š):
```typescript
interface Post {
  id: string;
  type: 'improvement';
  proposalType: 'operational' | 'communication' | 'innovation' | 'strategic';
  content: string;
  author: {
    id: string;
    name: string;
    department: string;
    permissionLevel: number;
  };
  anonymityLevel: string;
  timestamp: Date;
  votes: Record<VoteOption, number>;  // æŠ•ç¥¨é›†è¨ˆ
  comments: Comment[];
}
```

**è¡¨ç¤ºè¦ç´ ** (TrackingPostCard):
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒˆãƒ«ï¼ˆcontentï¼‰
- æŠ•ç¨¿è€…æƒ…å ±ï¼ˆåŒ¿ååº¦ã«ã‚ˆã‚Šè¡¨ç¤ºåˆ¶å¾¡ï¼‰
- æŠ•ç¨¿æ—¥æ™‚
- ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ï¼ˆå‹•çš„è¨ˆç®—ï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆã‚¹ã‚³ã‚¢ã‹ã‚‰åˆ¤å®šï¼‰
- æŠ•ç¥¨æ•°ãƒ»æ”¯æŒç‡
- ã‚³ãƒ¡ãƒ³ãƒˆæ•°

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- VoiceDrive: `Post` ãƒ†ãƒ¼ãƒ–ãƒ«
- VoiceDrive: `Vote` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæŠ•ç¥¨é›†è¨ˆç”¨ï¼‰
- VoiceDrive: `Comment` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæ•°ç”¨ï¼‰
- VoiceDrive: `User` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæŠ•ç¨¿è€…æƒ…å ±ï¼‰

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### 5. ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆLines 46-73ï¼‰

**æ©Ÿèƒ½**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ã‚³ã‚¢ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—

**è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯** (Lines 47-50):
```typescript
const currentScore = calculateScore(
  convertVotesToEngagements(post.votes || {}),
  post.proposalType
);
```

**ã‚¹ã‚³ã‚¢è¨ˆç®—ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿**:
- æŠ•ç¥¨æ•°ï¼ˆstrongly-support, support, neutral, oppose, strongly-opposeï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆoperational, communication, innovation, strategicï¼‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š** (Lines 41-43):
```typescript
const projectLevel = projectPermissionService.getProjectLevelFromScore(score);
```

**ãƒ¬ãƒ™ãƒ«åˆ¤å®šåŸºæº–**:
- Level 1: ã‚¹ã‚³ã‚¢ 0-49ï¼ˆéƒ¨é–€ãƒ¬ãƒ™ãƒ«ï¼‰
- Level 2: ã‚¹ã‚³ã‚¢ 50-99ï¼ˆæ–½è¨­ãƒ¬ãƒ™ãƒ«ï¼‰
- Level 3: ã‚¹ã‚³ã‚¢ 100+ï¼ˆçµ„ç¹”ãƒ¬ãƒ™ãƒ«ï¼‰

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã§è¨ˆç®—å¯èƒ½ï¼‰

---

### 6. ç©ºçŠ¶æ…‹è¡¨ç¤ºï¼ˆLines 144-149, 165-170, 186-191ï¼‰

**æ©Ÿèƒ½**: ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**3ã¤ã®ç©ºçŠ¶æ…‹**:
1. ææ¡ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã—: "ã¾ã ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆãŒã‚ã‚Šã¾ã›ã‚“"
2. æŠ•ç¥¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã—: "ã¾ã æŠ•ç¥¨ã—ã¦ã„ã¾ã›ã‚“"
3. å‚åŠ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã—: "ã¾ã å‚åŠ ã—ã¦ã„ã¾ã›ã‚“"

**ä¸è¶³é …ç›®**:
- ãªã—ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºã®ã¿ï¼‰

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### çµè«–: æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦ âœ…

ProjectTrackingãƒšãƒ¼ã‚¸ã¯**æ—¢å­˜ã®DBãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆPost, Vote, Comment, Userï¼‰ã®ã¿ã§å®Ÿè£…å¯èƒ½**ã§ã™ã€‚

#### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ´»ç”¨

**1. Post ãƒ†ãƒ¼ãƒ–ãƒ«**
```prisma
model Post {
  id                    String    @id @default(cuid())
  type                  String    // 'improvement' = ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
  content               String
  authorId              String
  proposalType          String?   // 'operational' | 'communication' | 'innovation' | 'strategic'
  anonymityLevel        String
  status                String    @default("active")
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  author                User      @relation("PostAuthor", fields: [authorId], references: [id])
  votes                 Vote[]
  comments              Comment[]

  @@index([authorId])
  @@index([type])
  @@index([createdAt])
}
```

**2. Vote ãƒ†ãƒ¼ãƒ–ãƒ«**
```prisma
model Vote {
  id        String    @id @default(cuid())
  postId    String
  userId    String
  option    String    // 'strongly-oppose' | 'oppose' | 'neutral' | 'support' | 'strongly-support'
  timestamp DateTime  @default(now())

  post      Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User      @relation("PostVote", fields: [userId], references: [id])

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
}
```

**3. Comment ãƒ†ãƒ¼ãƒ–ãƒ«**
```prisma
model Comment {
  id              String    @id @default(cuid())
  postId          String
  authorId        String
  content         String
  commentType     String    // 'proposal' | 'question' | 'support' | 'concern'
  anonymityLevel  String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  post            Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  author          User      @relation("CommentAuthor", fields: [authorId], references: [id])

  @@index([postId])
  @@index([authorId])
}
```

---

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 

ProjectTrackingãƒšãƒ¼ã‚¸ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ æ¨å¥¨:

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1: æŠ•ç¨¿è€…Ã—ã‚¿ã‚¤ãƒ—Ã—ä½œæˆæ—¥

```prisma
model Post {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

  @@index([authorId, type, createdAt])  // ğŸ†• è¿½åŠ æ¨å¥¨
}
```

**ç”¨é€”**: ã€Œææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚¿ãƒ–ã§ã®é«˜é€Ÿã‚¯ã‚¨ãƒª
```sql
SELECT * FROM posts
WHERE author_id = ? AND type = 'improvement'
ORDER BY created_at DESC
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2: æŠ•ç¥¨è€…Ã—ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

```prisma
model Vote {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

  @@index([userId, timestamp])  // ğŸ†• è¿½åŠ æ¨å¥¨
}
```

**ç”¨é€”**: ã€ŒæŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚¿ãƒ–ã§ã®é«˜é€Ÿã‚¯ã‚¨ãƒª
```sql
SELECT DISTINCT post_id FROM votes
WHERE user_id = ?
ORDER BY timestamp DESC
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

### ãƒ•ãƒ­ãƒ¼1: ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

    User->>VD: "ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>DB: SELECT * FROM Post WHERE authorId = ? AND type = 'improvement'
    DB-->>VD: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
    VD->>DB: å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŠ•ç¥¨æ•°ã‚’å–å¾—ï¼ˆVote ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
    DB-->>VD: æŠ•ç¥¨é›†è¨ˆãƒ‡ãƒ¼ã‚¿
    VD->>VD: ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
    VD->>VD: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š
    VD-->>User: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆã‚¹ã‚³ã‚¢ãƒ»ãƒ¬ãƒ™ãƒ«ä»˜ãï¼‰
```

---

### ãƒ•ãƒ­ãƒ¼2: æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

    User->>VD: "æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>DB: SELECT DISTINCT postId FROM Vote WHERE userId = ?
    DB-->>VD: æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDãƒªã‚¹ãƒˆ
    VD->>DB: SELECT * FROM Post WHERE id IN (?)
    DB-->>VD: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
    VD->>DB: å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŠ•ç¥¨æ•°ã‚’å–å¾—
    DB-->>VD: æŠ•ç¥¨é›†è¨ˆãƒ‡ãƒ¼ã‚¿
    VD->>VD: ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ»ãƒ¬ãƒ™ãƒ«åˆ¤å®š
    VD-->>User: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§è¡¨ç¤º
```

---

### ãƒ•ãƒ­ãƒ¼3: å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant VD as VoiceDrive
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

    User->>VD: "å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
    VD->>DB: SELECT DISTINCT postId FROM Comment WHERE authorId = ?
    DB-->>VD: ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDãƒªã‚¹ãƒˆ
    VD->>DB: SELECT * FROM Post WHERE id IN (?)
    DB-->>VD: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
    VD->>DB: å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ï¼ˆè‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ï¼‰
    DB-->>VD: ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
    VD->>VD: ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ»ãƒ¬ãƒ™ãƒ«åˆ¤å®š
    VD-->>User: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆè‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆå¼·èª¿ï¼‰
```

---

## ğŸ”„ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ é€£æº

### å¿…è¦ãªAPI

| API | ç”¨é€” | é »åº¦ | å‚™è€ƒ |
|-----|------|------|------|
| ãªã— | - | - | **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ APIã¯ä¸è¦** |

**çµè«–**: ProjectTrackingãƒšãƒ¼ã‚¸ã¯ **VoiceDriveå†…éƒ¨ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§å®Œçµ** ã—ã¾ã™ã€‚åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã¯ä¸è¦ã§ã™ã€‚

**ç†ç”±**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆPostï¼‰ã¯ VoiceDrive ãŒç®¡ç†
- æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ï¼ˆVoteï¼‰ã¯ VoiceDrive ãŒç®¡ç†
- ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆCommentï¼‰ã¯ VoiceDrive ãŒç®¡ç†
- è·å“¡æƒ…å ±ï¼ˆUserï¼‰ã¯æ—¢ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿ï¼ˆæŠ•ç¨¿æ™‚ã«å–å¾—æ¸ˆã¿ï¼‰

---

## ğŸ¨ ã‚µãƒ¼ãƒ“ã‚¹å±¤è¨­è¨ˆ

### ProjectTrackingService

```typescript
class ProjectTrackingService {
  // ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
  async getMyProjects(userId: string): Promise<Post[]> {
    return prisma.post.findMany({
      where: {
        authorId: userId,
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: true,
        votes: true,
        comments: {
          select: { id: true }  // ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®ã¿
        }
      },
      orderBy: { createdAt: 'desc' }
    });
  }

  // æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
  async getVotedProjects(userId: string): Promise<Post[]> {
    // ã‚¹ãƒ†ãƒƒãƒ—1: æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å–å¾—
    const votes = await prisma.vote.findMany({
      where: { userId },
      select: { postId: true },
      distinct: ['postId'],
      orderBy: { timestamp: 'desc' }
    });

    const postIds = votes.map(v => v.postId);

    // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’å–å¾—
    return prisma.post.findMany({
      where: {
        id: { in: postIds },
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: true,
        votes: true,
        comments: {
          select: { id: true }
        }
      }
    });
  }

  // å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
  async getJoinedProjects(userId: string): Promise<Post[]> {
    // ã‚¹ãƒ†ãƒƒãƒ—1: ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å–å¾—
    const comments = await prisma.comment.findMany({
      where: { authorId: userId },
      select: { postId: true },
      distinct: ['postId'],
      orderBy: { createdAt: 'desc' }
    });

    const postIds = comments.map(c => c.postId);

    // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’å–å¾—
    return prisma.post.findMany({
      where: {
        id: { in: postIds },
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: true,
        votes: true,
        comments: {
          where: { authorId: userId },  // è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿
          take: 1
        }
      }
    });
  }

  // çµ±è¨ˆã‚µãƒãƒªãƒ¼å–å¾—
  async getTrackingStats(userId: string): Promise<TrackingStats> {
    // ææ¡ˆæ•°
    const myPostsCount = await prisma.post.count({
      where: {
        authorId: userId,
        type: 'improvement',
        status: 'active'
      }
    });

    // æŠ•ç¥¨æ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
    const votedPostsCount = await prisma.vote.count({
      where: { userId },
      distinct: ['postId']
    });

    // ã‚³ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
    const commentedPostsCount = await prisma.comment.count({
      where: { authorId: userId },
      distinct: ['postId']
    });

    // é”æˆæ•°ï¼ˆã‚¹ã‚³ã‚¢100ä»¥ä¸Šï¼‰- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¨ˆç®—
    // ã“ã“ã§ã¯ææ¡ˆæ•°ã‚’è¿”ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const myProjects = await this.getMyProjects(userId);
    const achievedCount = myProjects.filter(project => {
      const score = this.calculateProjectScore(project);
      return score >= 100;
    }).length;

    return {
      myPostsCount,
      votedPostsCount,
      commentedPostsCount,
      achievedCount
    };
  }

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  private calculateProjectScore(post: Post): number {
    if (!post.votes || post.votes.length === 0) return 0;

    const voteWeights = {
      'strongly-support': 2,
      'support': 1,
      'neutral': 0,
      'oppose': -1,
      'strongly-oppose': -2
    };

    const voteCounts = post.votes.reduce((acc, vote) => {
      acc[vote.option] = (acc[vote.option] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);

    const totalScore = Object.entries(voteCounts).reduce((sum, [option, count]) => {
      return sum + (voteWeights[option] || 0) * count;
    }, 0);

    return Math.max(0, totalScore);
  }
}
```

---

## ğŸ“‹ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ

### 1. GET /api/project-tracking/my-projects
ææ¡ˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—

**Response**:
```json
{
  "projects": [
    {
      "id": "post-001",
      "type": "improvement",
      "proposalType": "operational",
      "content": "æ–°äººæ•™è‚²ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä½“ç³»åŒ–ã¨ãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ã®å°å…¥",
      "author": {
        "id": "user-1",
        "name": "å±±ç”°å¤ªéƒ",
        "department": "çœ‹è­·éƒ¨",
        "permissionLevel": 3.5
      },
      "anonymityLevel": "department_only",
      "timestamp": "2025-10-01T10:00:00Z",
      "votes": {
        "strongly-support": 12,
        "support": 18,
        "neutral": 3,
        "oppose": 1,
        "strongly-oppose": 0
      },
      "commentCount": 5
    }
  ]
}
```

---

### 2. GET /api/project-tracking/voted-projects
æŠ•ç¥¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—

**Response**:
```json
{
  "projects": [
    {
      "id": "post-002",
      "type": "improvement",
      "proposalType": "communication",
      "content": "å¤šè·ç¨®ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®å®šæœŸé–‹å‚¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
      "author": {
        "id": "user-2",
        "name": "ç”°ä¸­æ¬¡éƒ",
        "department": "åŒ»ç™‚ç›¸è«‡éƒ¨",
        "permissionLevel": 5
      },
      "anonymityLevel": "facility_all",
      "timestamp": "2025-09-15T14:30:00Z",
      "votes": {
        "strongly-support": 25,
        "support": 32,
        "neutral": 5,
        "oppose": 2,
        "strongly-oppose": 0
      },
      "myVote": "strongly-support",  // è‡ªåˆ†ã®æŠ•ç¥¨
      "commentCount": 8
    }
  ]
}
```

---

### 3. GET /api/project-tracking/joined-projects
å‚åŠ ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—

**Response**:
```json
{
  "projects": [
    {
      "id": "post-003",
      "type": "improvement",
      "proposalType": "innovation",
      "content": "æ‚£è€…å®‰å…¨ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Šã‚·ã‚¹ãƒ†ãƒ ã®æ”¹å–„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
      "author": {
        "id": "user-3",
        "name": "ä½è—¤ç¾å’²",
        "department": "åŒ»ç™‚å®‰å…¨éƒ¨",
        "permissionLevel": 5
      },
      "anonymityLevel": "facility_department",
      "timestamp": "2025-09-20T11:00:00Z",
      "votes": {
        "strongly-support": 18,
        "support": 24,
        "neutral": 4,
        "oppose": 1,
        "strongly-oppose": 0
      },
      "myComments": [
        {
          "id": "comment-1",
          "content": "ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Šã®å¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä¸‹ã’ã‚‹å·¥å¤«ãŒå¿…è¦ã§ã™ã­ã€‚",
          "commentType": "proposal",
          "timestamp": "2025-09-22T09:15:00Z",
          "likes": 5
        }
      ],
      "commentCount": 12
    }
  ]
}
```

---

### 4. GET /api/project-tracking/stats
çµ±è¨ˆã‚µãƒãƒªãƒ¼å–å¾—

**Response**:
```json
{
  "myPostsCount": 3,
  "votedPostsCount": 12,
  "commentedPostsCount": 8,
  "achievedCount": 1
}
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ»æ•´åˆæ€§

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚³ã‚¢è¨ˆç®—

ProjectTrackingãƒšãƒ¼ã‚¸ã§ã¯ã€ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’ **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹•çš„ã«å®Ÿè¡Œ** ã—ã¾ã™ã€‚

**ç†ç”±**:
- æŠ•ç¥¨æ•°ã¯é »ç¹ã«å¤‰å‹•ã™ã‚‹
- ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¯è»½é‡ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ååˆ†ï¼‰
- DBã«ä¿å­˜ã™ã‚‹ã¨æ›´æ–°ã‚³ã‚¹ãƒˆãŒé«˜ã„

**å®Ÿè£…ä¾‹**:
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: useProjectScoring ãƒ•ãƒƒã‚¯
const { calculateScore, convertVotesToEngagements } = useProjectScoring();

const currentScore = calculateScore(
  convertVotesToEngagements(post.votes || {}),
  post.proposalType
);
```

**å°†æ¥çš„ãªæœ€é©åŒ–æ¡ˆ**:
- é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯ Redis ã«ã‚¹ã‚³ã‚¢ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆTTL 5åˆ†ï¼‰
- ãƒãƒƒãƒå‡¦ç†ã§å®šæœŸçš„ã«ã‚¹ã‚³ã‚¢ã‚’å†è¨ˆç®—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°

---

## ğŸ“… å®Ÿè£…è¨ˆç”»

### Phase 1: APIå®Ÿè£…ï¼ˆ2æ—¥é–“ï¼‰

**Day 1**:
- [x] DBè¦ä»¶åˆ†ææ›¸ä½œæˆ â† ä»Šã“ã“
- [ ] ProjectTrackingService å®Ÿè£…
  - getMyProjects()
  - getVotedProjects()
  - getJoinedProjects()
  - getTrackingStats()
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ

**Day 2**:
- [ ] APIå®Ÿè£…
  - GET /api/project-tracking/my-projects
  - GET /api/project-tracking/voted-projects
  - GET /api/project-tracking/joined-projects
  - GET /api/project-tracking/stats
- [ ] APIãƒ†ã‚¹ãƒˆ

---

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆï¼ˆ1æ—¥é–“ï¼‰

**Day 3**:
- [ ] ProjectTracking.tsx ä¿®æ­£
  - getDemoMyProjects() â†’ APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
  - getDemoVotedProjects() â†’ APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
  - getDemoJoinedProjects() â†’ APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
- [ ] useProjectTracking() ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ä½œæˆ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

---

### Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆ1æ—¥é–“ï¼‰

**Day 4**:
- [ ] è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
  - Post: (authorId, type, createdAt)
  - Vote: (userId, timestamp)
- [ ] ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ©Ÿèƒ½è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

---

**åˆè¨ˆ**: 4æ—¥é–“ï¼ˆ1é€±é–“ä»¥å†…ï¼‰

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [ ] è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆPostï¼‰
- [ ] è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆVoteï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### ã‚µãƒ¼ãƒ“ã‚¹å±¤
- [ ] ProjectTrackingService å®Ÿè£…
- [ ] getMyProjects() å®Ÿè£…
- [ ] getVotedProjects() å®Ÿè£…
- [ ] getJoinedProjects() å®Ÿè£…
- [ ] getTrackingStats() å®Ÿè£…
- [ ] calculateProjectScore() å®Ÿè£…

### API
- [ ] GET /api/project-tracking/my-projects å®Ÿè£…
- [ ] GET /api/project-tracking/voted-projects å®Ÿè£…
- [ ] GET /api/project-tracking/joined-projects å®Ÿè£…
- [ ] GET /api/project-tracking/stats å®Ÿè£…

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] APIçµ±åˆï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰
- [ ] useProjectTracking() ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤º

### ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- [ ] APIçµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

---

## ğŸ“ è£œè¶³äº‹é …

### ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

**é‡ã¿ä»˜ã‘**:
```typescript
const voteWeights = {
  'strongly-support': +2,
  'support': +1,
  'neutral': 0,
  'oppose': -1,
  'strongly-oppose': -2
};
```

**è¨ˆç®—å¼**:
```typescript
score = (å¼·ãè³›æˆ Ã— 2) + (è³›æˆ Ã— 1) + (ä¸­ç«‹ Ã— 0) + (åå¯¾ Ã— -1) + (å¼·ãåå¯¾ Ã— -2)
```

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š**:
```typescript
if (score >= 100) return 'organization';  // çµ„ç¹”ãƒ¬ãƒ™ãƒ«
if (score >= 50) return 'facility';       // æ–½è¨­ãƒ¬ãƒ™ãƒ«
return 'department';                      // éƒ¨é–€ãƒ¬ãƒ™ãƒ«
```

### ãƒšãƒ¼ã‚¸ãƒ³ã‚°å®Ÿè£…ï¼ˆå°†æ¥çš„ãªæ‹¡å¼µï¼‰

```typescript
// API: ãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œ
async getMyProjects(userId: string, page: number = 1, limit: number = 20): Promise<{
  projects: Post[];
  pagination: {
    page: number;
    limit: number;
    totalCount: number;
    totalPages: number;
  };
}> {
  const skip = (page - 1) * limit;

  const [projects, totalCount] = await prisma.$transaction([
    prisma.post.findMany({
      where: {
        authorId: userId,
        type: 'improvement',
        status: 'active'
      },
      include: {
        author: true,
        votes: true,
        comments: { select: { id: true } }
      },
      orderBy: { createdAt: 'desc' },
      skip,
      take: limit
    }),
    prisma.post.count({
      where: {
        authorId: userId,
        type: 'improvement',
        status: 'active'
      }
    })
  ]);

  return {
    projects,
    pagination: {
      page,
      limit,
      totalCount,
      totalPages: Math.ceil(totalCount / limit)
    }
  };
}
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆå°†æ¥çš„ãªæœ€é©åŒ–ï¼‰

```typescript
// Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¾‹
async getTrackingStats(userId: string): Promise<TrackingStats> {
  const cacheKey = `tracking-stats:${userId}`;

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }

  // DB ã‹ã‚‰å–å¾—
  const stats = await this.calculateStats(userId);

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜ï¼ˆTTL 5åˆ†ï¼‰
  await redis.setex(cacheKey, 300, JSON.stringify(stats));

  return stats;
}
```

---

**æ–‡æ›¸çµ‚äº†**

æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ11æ—¥
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆä½œæˆ
