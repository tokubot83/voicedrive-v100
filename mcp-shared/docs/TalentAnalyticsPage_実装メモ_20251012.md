# TalentAnalyticsPageï¼ˆè­°é¡Œãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰å®Ÿè£…ãƒ¡ãƒ¢

**ä½œæˆæ—¥**: 2025å¹´10æœˆ12æ—¥
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: TalentAnalyticsPage (`src/pages/TalentAnalyticsPage.tsx`)
**ç¾åœ¨ã®çŠ¶æ…‹**: é–‹ç™ºä¸­ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆ77è¡Œï¼‰

---

## ğŸ“‹ ç¾çŠ¶

### ç¾åœ¨ã®å®Ÿè£…

`TalentAnalyticsPage.tsx`ã¯ç¾åœ¨**ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã¿**ã§ã€å®Ÿéš›ã®æ©Ÿèƒ½ã¯æœªå®Ÿè£…ï¼š

```typescript
// ç¾åœ¨ã®å†…å®¹ï¼ˆ77è¡Œï¼‰
- ãƒ˜ãƒƒãƒ€ãƒ¼: "ã‚¿ãƒ¬ãƒ³ãƒˆåˆ†æ"
- é–‹ç™ºä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- äºˆå®šæ©Ÿèƒ½ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ3ã‚«ãƒ¼ãƒ‰ï¼‰:
  1. ã‚¹ã‚­ãƒ«åˆ†æ
  2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆæ¸¬
  3. é©æ€§ãƒãƒƒãƒãƒ³ã‚°
```

---

## ğŸ¯ å®Ÿè£…ã™ã¹ãå†…å®¹ï¼ˆProjectTalentAnalyticsPageã¨åŒç­‰ï¼‰

### è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç‰ˆã®äººæåˆ†ææ©Ÿèƒ½

**ProjectTalentAnalyticsPage**ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰ã¨åŒæ§˜ã®æ©Ÿèƒ½ã‚’ã€è­°é¡Œãƒ¢ãƒ¼ãƒ‰ï¼ˆé€šå¸¸æŠ•ç¨¿ï¼‰ã«å®Ÿè£…ï¼š

#### 1. **æ¦‚è¦ã‚¿ãƒ–**
- ç·å‚åŠ è€…æ•°ï¼ˆæŠ•ç¨¿è€…ãƒ»æŠ•ç¥¨è€…ï¼‰
- å¹³å‡å‚åŠ æ•°ï¼ˆæŠ•ç¨¿æ•°ãƒ»æŠ•ç¥¨æ•°ï¼‰
- å¤šæ§˜æ€§ã‚¹ã‚³ã‚¢ï¼ˆè·ç¨®ãƒ»ä¸–ä»£ãƒ»éšå±¤ã®å¤šæ§˜æ€§ï¼‰
- æˆé•·ç‡ï¼ˆå‰æœŸæ¯”ï¼‰
- è·ç¨®åˆ¥å‚åŠ çŠ¶æ³
- ä¸–ä»£åˆ¥å‚åŠ çŠ¶æ³

#### 2. **éƒ¨é–€åˆ¥åˆ†å¸ƒã‚¿ãƒ–**
- éƒ¨é–€åˆ¥æŠ•ç¨¿ãƒ»æŠ•ç¥¨å‚åŠ ç‡
- éƒ¨é–€ç·äººæ•° vs å‚åŠ è€…æ•°
- å¹³å‡æŠ•ç¨¿æ•°ãƒ»æŠ•ç¥¨æ•°

#### 3. **å‚åŠ ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¿ãƒ–**
- æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•ï¼ˆæœˆæ¬¡ãƒ»å››åŠæœŸãƒ»å¹´æ¬¡ï¼‰

#### 4. **è‚²æˆåŠ¹æœã‚¿ãƒ–**
- æŠ•ç¨¿å“è³ªã®å‘ä¸Š
- è­°è«–ã¸ã®ç©æ¥µçš„å‚åŠ åº¦

---

## ğŸ” ãƒ‡ãƒ¼ã‚¿åŒæ„ã‚·ã‚¹ãƒ†ãƒ é€£æºï¼ˆæœ€é‡è¦ï¼‰

### æ—¢å­˜ã®å®Ÿè£…ã‚’æ´»ç”¨

VoiceDriveã«ã¯**ãƒ‡ãƒ¼ã‚¿åŒæ„ã‚·ã‚¹ãƒ†ãƒ **ãŒæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼š

- **DataConsentãƒ¢ãƒ¼ãƒ€ãƒ«**: åˆå›æŠ•ç¨¿æ™‚ã«è¡¨ç¤º
- **DataConsentãƒ†ãƒ¼ãƒ–ãƒ«**: åŒæ„çŠ¶æ³ã‚’ç®¡ç†
- **analyticsConsent = true**: åˆ†æåŒæ„æ¸ˆã¿è·å“¡ã®ã¿ã‚’å¯¾è±¡

### è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç‰ˆã®å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

```typescript
// 1. åŒæ„æ¸ˆã¿è·å“¡ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
const consentedUsers = await prisma.dataConsent.findMany({
  where: { analyticsConsent: true },
  select: { userId: true }
});

// 2. æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆï¼ˆåŒæ„æ¸ˆã¿ã®ã¿ï¼‰
const posts = await prisma.post.findMany({
  where: {
    authorId: { in: consentedUsers.map(c => c.userId) },
    createdAt: { gte: periodStart, lte: periodEnd }
  },
  include: {
    author: {
      select: {
        age: true,
        generation: true,
        professionCategory: true,
        hierarchyLevel: true,
      }
    }
  }
});

// 3. æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆï¼ˆåŒæ„æ¸ˆã¿ã®ã¿ï¼‰
const votes = await prisma.vote.findMany({
  where: {
    userId: { in: consentedUsers.map(c => c.userId) },
    createdAt: { gte: periodStart, lte: periodEnd }
  },
  include: {
    user: {
      select: {
        age: true,
        generation: true,
        professionCategory: true,
        hierarchyLevel: true,
      }
    }
  }
});
```

---

## ğŸ“Š å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãã®ã¾ã¾ä½¿ç”¨å¯èƒ½ï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ« | ç”¨é€” | çŠ¶æ…‹ |
|---------|------|------|
| `Post` | æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ | âœ… OK |
| `Vote` | æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ | âœ… OK |
| `User` | è·å“¡åŸºæœ¬æƒ…å ± | âœ… OKï¼ˆage, generationè¿½åŠ æ¸ˆã¿ï¼‰ |
| `DataConsent` | åŒæ„çŠ¶æ³ | âœ… OK |

### æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆProjectTalentAnalyticsã¨å…±ç”¨ï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ« | ç”¨é€” | çŠ¶æ…‹ |
|---------|------|------|
| `ProjectParticipationStats` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚åŠ çµ±è¨ˆ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `ProjectParticipationByProfession` | è·ç¨®åˆ¥çµ±è¨ˆ | âœ… å®Ÿè£…æ¸ˆã¿ |
| **ğŸ†• `TopicParticipationStats`** | **è­°é¡Œå‚åŠ çµ±è¨ˆ** | âŒ **è¦è¿½åŠ ** |
| **ğŸ†• `TopicParticipationByProfession`** | **è­°é¡Œè·ç¨®åˆ¥çµ±è¨ˆ** | âŒ **è¦è¿½åŠ ** |

---

## ğŸ› ï¸ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ MEDIUMï¼‰

```prisma
// VoiceDrive: prisma/schema.prisma

// è­°é¡Œå‚åŠ çµ±è¨ˆ - å…¨ä½“çµ±è¨ˆ
model TopicParticipationStats {
  id                      String    @id @default(cuid())
  periodType              String                                // 'month' | 'quarter' | 'year'
  periodStart             DateTime  @map("period_start")
  periodEnd               DateTime  @map("period_end")

  // æŠ•ç¨¿çµ±è¨ˆ
  totalPosters            Int       @default(0) @map("total_posters")
  totalPosts              Int       @default(0) @map("total_posts")
  averagePostsPerPerson   Float     @default(0) @map("avg_posts_per_person")

  // æŠ•ç¥¨çµ±è¨ˆ
  totalVoters             Int       @default(0) @map("total_voters")
  totalVotes              Int       @default(0) @map("total_votes")
  averageVotesPerPerson   Float     @default(0) @map("avg_votes_per_person")

  // å¤šæ§˜æ€§ã‚¹ã‚³ã‚¢ï¼ˆ0-100ï¼‰
  diversityScore          Float     @default(0) @map("diversity_score")
  professionDiversityScore Float    @default(0) @map("profession_diversity_score")
  generationDiversityScore Float    @default(0) @map("generation_diversity_score")
  hierarchyDiversityScore Float    @default(0) @map("hierarchy_diversity_score")

  // æˆé•·ç‡ï¼ˆå‰æœŸæ¯”%ï¼‰
  growthRate              Float?    @map("growth_rate")
  posterGrowthRate        Float?    @map("poster_growth_rate")
  voterGrowthRate         Float?    @map("voter_growth_rate")

  calculatedAt            DateTime  @default(now()) @map("calculated_at")
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")

  @@unique([periodType, periodStart, periodEnd])
  @@index([periodType])
  @@map("topic_participation_stats")
}

// è­°é¡Œå‚åŠ çµ±è¨ˆï¼ˆè·ç¨®åˆ¥ï¼‰
model TopicParticipationByProfession {
  id                String    @id @default(cuid())
  periodType        String
  periodStart       DateTime  @map("period_start")
  periodEnd         DateTime  @map("period_end")

  professionCode    String    @map("profession_code")
  professionName    String    @map("profession_name")
  professionGroup   String    @map("profession_group")

  posterCount       Int       @default(0) @map("poster_count")
  postCount         Int       @default(0) @map("post_count")
  voterCount        Int       @default(0) @map("voter_count")
  voteCount         Int       @default(0) @map("vote_count")
  percentage        Float     @default(0) @map("percentage")

  calculatedAt      DateTime  @default(now()) @map("calculated_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@unique([periodType, periodStart, periodEnd, professionCode])
  @@index([periodType])
  @@index([professionCode])
  @@map("topic_participation_by_profession")
}
```

### Phase 2: é›†è¨ˆã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ MEDIUMï¼‰

```typescript
// src/services/TopicAnalyticsService.ts

export async function calculateTopicParticipationStats(
  periodType: 'month' | 'quarter' | 'year',
  periodStart: Date,
  periodEnd: Date
): Promise<TopicParticipationStatsData> {

  // 1. åŒæ„æ¸ˆã¿è·å“¡ã®ã¿å–å¾—
  const consentedUsers = await prisma.dataConsent.findMany({
    where: { analyticsConsent: true },
    select: { userId: true }
  });
  const consentedIdSet = new Set(consentedUsers.map(c => c.userId));

  // 2. æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
  const posts = await prisma.post.findMany({
    where: {
      authorId: { in: Array.from(consentedIdSet) },
      createdAt: { gte: periodStart, lte: periodEnd }
    },
    include: { author: true }
  });

  // 3. æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
  const votes = await prisma.vote.findMany({
    where: {
      userId: { in: Array.from(consentedIdSet) },
      createdAt: { gte: periodStart, lte: periodEnd }
    },
    include: { user: true }
  });

  // 4. çµ±è¨ˆè¨ˆç®—
  const uniquePosters = new Set(posts.map(p => p.authorId)).size;
  const uniqueVoters = new Set(votes.map(v => v.userId)).size;
  const averagePostsPerPerson = uniquePosters > 0 ? posts.length / uniquePosters : 0;
  const averageVotesPerPerson = uniqueVoters > 0 ? votes.length / uniqueVoters : 0;

  // 5. å¤šæ§˜æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆProjectTalentAnalyticsã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
  const diversityScore = await calculateDiversityScore([...posts.map(p => p.author), ...votes.map(v => v.user)]);

  return {
    totalPosters: uniquePosters,
    totalPosts: posts.length,
    averagePostsPerPerson,
    totalVoters: uniqueVoters,
    totalVotes: votes.length,
    averageVotesPerPerson,
    diversityScore: diversityScore.overall,
    professionDiversityScore: diversityScore.profession,
    generationDiversityScore: diversityScore.generation,
    hierarchyDiversityScore: diversityScore.hierarchy,
  };
}
```

### Phase 3: UIå®Ÿè£…ï¼ˆå„ªå…ˆåº¦: ğŸŸ¡ MEDIUMï¼‰

`TalentAnalyticsPage.tsx`ã‚’`ProjectTalentAnalyticsPage.tsx`ã¨åŒæ§˜ã®UIã«ç½®ãæ›ãˆï¼š

```typescript
// src/pages/TalentAnalyticsPage.tsx
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

const TalentAnalyticsPage: React.FC = () => {
  const [activeTab, setActiveTab] = useState<TabType>('overview');
  const [selectedPeriod, setSelectedPeriod] = useState<'month' | 'quarter' | 'year'>('quarter');
  const [stats, setStats] = useState<TopicParticipationStatsData | null>(null);

  useEffect(() => {
    // APIå‘¼ã³å‡ºã—
    fetchTopicParticipationStats(selectedPeriod).then(setStats);
  }, [selectedPeriod]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
      {/* ProjectTalentAnalyticsPageã¨åŒæ§˜ã®UI */}
      {/* æ¦‚è¦ã‚¿ãƒ– */}
      {/* éƒ¨é–€åˆ¥åˆ†å¸ƒã‚¿ãƒ– */}
      {/* å‚åŠ ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¿ãƒ– */}
      {/* è‚²æˆåŠ¹æœã‚¿ãƒ– */}
    </div>
  );
};
```

---

## ğŸš€ å„ªå…ˆåº¦ã¨å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### ç¾æ™‚ç‚¹ã§ã®å„ªå…ˆåº¦: ğŸŸ¡ MEDIUM

**ç†ç”±**:
- `ProjectTalentAnalyticsPage`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰ã®å®Ÿè£…ãŒå…ˆ
- è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç‰ˆã¯`ProjectTalentAnalyticsPage`å®Œæˆå¾Œã«ç€æ‰‹
- ãƒ‡ãƒ¼ã‚¿åŒæ„ã‚·ã‚¹ãƒ†ãƒ ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ãªã®ã§ã€é€£æºã¯å®¹æ˜“

### æ¨å¥¨å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Phase | å†…å®¹ | æœŸé–“ | å„ªå…ˆåº¦ |
|-------|------|------|--------|
| **Phase 1** | ProjectTalentAnalyticsPageå®Œæˆ | 2025å¹´11æœˆæœ«ã¾ã§ | ğŸ”´ HIGH |
| **Phase 2** | TalentAnalyticsPageå®Ÿè£…é–‹å§‹ | 2025å¹´12æœˆï½ | ğŸŸ¡ MEDIUM |
| **Phase 3** | TalentAnalyticsPageå®Œæˆ | 2026å¹´1æœˆæœ«ã¾ã§ | ğŸŸ¡ MEDIUM |

---

## ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### Phase 1å®Œäº†å¾Œï¼ˆ2025å¹´11æœˆæœ«ï½ï¼‰

1. **`TopicParticipationStats`ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ **
2. **`TopicParticipationByProfession`ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ **
3. **`TopicAnalyticsService`å®Ÿè£…**
4. **TalentAnalyticsPageã®UIå®Ÿè£…**
5. **ãƒ‡ãƒ¼ã‚¿åŒæ„ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆ**

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [ProjectTalentAnalyticsPage.tsx](../../src/pages/ProjectTalentAnalyticsPage.tsx)
- [project-talent-analytics_DBè¦ä»¶åˆ†æ_20251012.md](./project-talent-analytics_DBè¦ä»¶åˆ†æ_20251012.md)
- [project-talent-analyticsæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251012.md](./project-talent-analyticsæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251012.md)
- [DataConsentModal.tsx](../../src/components/consent/DataConsentModal.tsx)
- [DataConsent schema](../../prisma/schema.prisma) (341-357è¡Œç›®)

---

**æ–‡æ›¸ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… ãƒ¡ãƒ¢ä½œæˆå®Œäº†
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ProjectTalentAnalyticsPageå®Œæˆå¾Œã«æœ¬æ ¼å®Ÿè£…
**å„ªå…ˆåº¦**: ğŸŸ¡ MEDIUMï¼ˆProjectTalentAnalyticsPageã®å¾Œï¼‰
