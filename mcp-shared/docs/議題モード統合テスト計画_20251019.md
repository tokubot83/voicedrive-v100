# è­°é¡Œãƒ¢ãƒ¼ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆè¨ˆç”»

**ä½œæˆæ—¥**: 2025å¹´10æœˆ19æ—¥

---

## 1. ãƒ†ã‚¹ãƒˆå®Ÿæ–½å¯èƒ½æ€§

### VoiceDriveã‚·ã‚¹ãƒ†ãƒ å˜ç‹¬ã§ã®å®Ÿæ–½å¯å¦

**çµè«–**: âœ… **å˜ç‹¬ã§ãƒ†ã‚¹ãƒˆå¯èƒ½**ï¼ˆåˆ¶é™ã‚ã‚Šï¼‰

### ãƒ†ã‚¹ãƒˆå¯èƒ½ç¯„å›²

| æ©Ÿèƒ½ | å˜ç‹¬ãƒ†ã‚¹ãƒˆå¯å¦ | å‚™è€ƒ |
|-----|--------------|------|
| åˆ¤æ–­å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ | âœ… å¯èƒ½ | AgendaDecisionServiceå…¨ãƒ¡ã‚½ãƒƒãƒ‰ |
| DBæ›´æ–° | âœ… å¯èƒ½ | PrismaçµŒç”±ã§Postãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–° |
| APIå‘¼ã³å‡ºã— | âœ… å¯èƒ½ | `/api/agenda/decision`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| UIè¡¨ç¤º | âœ… å¯èƒ½ | ãƒœã‚¿ãƒ³è¡¨ç¤ºã€ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º |
| é€šçŸ¥é€ä¿¡ | âš ï¸ éƒ¨åˆ†çš„ | NotificationServiceå‘¼ã³å‡ºã—ã¯å‹•ä½œã™ã‚‹ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆãŒç©º |
| å®Ÿéš›ã®é€šçŸ¥é…ä¿¡ | âŒ æœªå®Ÿè£… | ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ãŒTODO |

---

## 2. äº‹å‰æº–å‚™

### 2.1 Prisma Migrateå®Ÿè¡Œ

```bash
# Schemaå¤‰æ›´ã‚’DBã«é©ç”¨
npm run prisma:migrate

# ã¾ãŸã¯
npx prisma migrate dev --name add-agenda-decision-fields
```

### 2.2 ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™

```sql
-- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆå„ãƒ¬ãƒ™ãƒ«ï¼‰
INSERT INTO User (id, employeeId, email, name, department, facilityId, permissionLevel, accountType)
VALUES
  ('test-supervisor-1', 'SUP001', 'supervisor@test.com', 'ä¸»ä»»ãƒ†ã‚¹ãƒˆå¤ªéƒ', 'çœ‹è­·éƒ¨Aç—…æ£Ÿ', 'facility-1', 3.5, 'staff'),
  ('test-manager-1', 'MGR001', 'manager@test.com', 'å¸«é•·ãƒ†ã‚¹ãƒˆèŠ±å­', 'çœ‹è­·éƒ¨Aç—…æ£Ÿ', 'facility-1', 7, 'staff'),
  ('test-deputy-1', 'DEP001', 'deputy@test.com', 'å‰¯çœ‹è­·éƒ¨é•·ãƒ†ã‚¹ãƒˆ', 'çœ‹è­·éƒ¨', 'facility-1', 8, 'staff'),
  ('test-affairs-1', 'AFF001', 'affairs@test.com', 'äº‹å‹™é•·ãƒ†ã‚¹ãƒˆ', 'ç·å‹™éƒ¨', 'facility-1', 11, 'staff'),
  ('test-director-1', 'DIR001', 'director@test.com', 'æ³•äººçµ±æ‹¬äº‹å‹™å±€é•·ãƒ†ã‚¹ãƒˆ', 'æ³•äººæœ¬éƒ¨', 'facility-1', 18, 'executive');

-- ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ä½œæˆï¼ˆ50ç‚¹ã®æŠ•ç¨¿ï¼‰
INSERT INTO Post (id, type, content, authorId, anonymityLevel, status, agendaScore, agendaLevel, agendaStatus)
VALUES
  ('test-post-50', 'proposal', 'ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ï¼š50ç‚¹åˆ°é”', 'test-author-1', 'full', 'active', 50, 'DEPT_AGENDA', 'pending');

-- ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ä½œæˆï¼ˆ100ç‚¹ã®æŠ•ç¨¿ï¼‰
INSERT INTO Post (id, type, content, authorId, anonymityLevel, status, agendaScore, agendaLevel, agendaStatus)
VALUES
  ('test-post-100', 'proposal', 'ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ï¼š100ç‚¹åˆ°é”', 'test-author-1', 'full', 'active', 100, 'FACILITY_AGENDA', 'pending_deputy_director_review');
```

---

## 3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 3.1 Level 3.5ï¼ˆä¸»ä»»ï¼‰ã®åˆ¤æ–­ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 1-1: å¸«é•·ã«æ¨è–¦

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-50`
- agendaScore: 50
- agendaStatus: `pending`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-50",
    "decisionType": "recommend_to_manager",
    "deciderId": "test-supervisor-1",
    "reason": "éƒ¨ç½²å…¨ä½“ã§æ¤œè¨ã™ã‚‹ä¾¡å€¤ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "å¸«é•·ã¸ã®æ¨è–¦ãŒå®Œäº†ã—ã¾ã—ãŸ",
  "post": {
    "id": "test-post-50",
    "agendaStatus": "recommended_to_manager",
    "agendaDecisionBy": "test-supervisor-1",
    "agendaDecisionReason": "éƒ¨ç½²å…¨ä½“ã§æ¤œè¨ã™ã‚‹ä¾¡å€¤ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚"
  },
  "notificationsSent": 2
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`recommended_to_manager`ã«æ›´æ–°
- [ ] `agendaDecisionBy`ãŒ`test-supervisor-1`ã«è¨­å®š
- [ ] `agendaDecisionAt`ãŒç¾åœ¨æ™‚åˆ»ã«è¨­å®š
- [ ] `agendaDecisionReason`ãŒä¿å­˜
- [ ] æŠ•ç¨¿è€…ã¨å¸«é•·ã«é€šçŸ¥é€ä¿¡ï¼ˆãƒ­ã‚°ç¢ºèªï¼‰

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 1-2: ä¸»ä»»ã«ã‚ˆã‚‹å´ä¸‹

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-50-reject`
- agendaScore: 50
- agendaStatus: `pending`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-50-reject",
    "decisionType": "reject_by_supervisor",
    "deciderId": "test-supervisor-1",
    "reason": "å®Ÿç¾å¯èƒ½æ€§ãŒä½ã„ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "å´ä¸‹ãŒå®Œäº†ã—ã¾ã—ãŸ",
  "post": {
    "agendaStatus": "rejected_by_supervisor",
    "status": "rejected"
  },
  "notificationsSent": 1
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`rejected_by_supervisor`ã«æ›´æ–°
- [ ] `status`ãŒ`rejected`ã«æ›´æ–°
- [ ] æŠ•ç¨¿è€…ã®ã¿ã«é€šçŸ¥é€ä¿¡

---

### 3.2 Level 7ï¼ˆå¸«é•·ï¼‰ã®åˆ¤æ–­ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 2-1: éƒ¨ç½²è­°é¡Œæ‰¿èª

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-50-recommended`
- agendaStatus: `recommended_to_manager`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-50-recommended",
    "decisionType": "approve_as_dept_agenda",
    "deciderId": "test-manager-1",
    "reason": "éƒ¨ç½²ã®é‡è¦èª²é¡Œã¨ã—ã¦å–ã‚Šä¸Šã’ã¾ã™ã€‚"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "éƒ¨ç½²è­°é¡Œã¨ã—ã¦æ‰¿èªã•ã‚Œã¾ã—ãŸ",
  "post": {
    "agendaStatus": "approved_as_dept_agenda",
    "agendaLevel": "DEPT_AGENDA"
  },
  "notificationsSent": 5
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`approved_as_dept_agenda`ã«æ›´æ–°
- [ ] `agendaLevel`ãŒ`DEPT_AGENDA`ã«è¨­å®š
- [ ] æŠ•ç¨¿è€…ã¨éƒ¨ç½²å†…å…¨å“¡ã«é€šçŸ¥é€ä¿¡

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 2-2: æ–½è¨­è­°é¡Œã«æ˜‡æ ¼

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-50-escalate`
- agendaStatus: `recommended_to_manager`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-50-escalate",
    "decisionType": "escalate_to_facility",
    "deciderId": "test-manager-1",
    "reason": "æ–½è¨­å…¨ä½“ã§æ¤œè¨ã™ã¹ãé‡è¦èª²é¡Œã§ã™ã€‚"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "æ–½è¨­è­°é¡Œã«æ˜‡æ ¼ã—ã¾ã—ãŸ",
  "post": {
    "agendaStatus": "escalated_to_facility",
    "agendaLevel": "FACILITY_AGENDA",
    "agendaVotingDeadline": "2026-01-18T..." // 60æ—¥å¾Œ
  }
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`escalated_to_facility`ã«æ›´æ–°
- [ ] `agendaLevel`ãŒ`FACILITY_AGENDA`ã«æ›´æ–°
- [ ] `agendaVotingDeadline`ãŒ60æ—¥å¾Œã«è¨­å®š
- [ ] æ–½è¨­å†…å…¨è·å“¡ã«é€šçŸ¥é€ä¿¡

---

### 3.3 Level 8ï¼ˆå‰¯çœ‹è­·éƒ¨é•·ï¼‰ã®åˆ¤æ–­ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 3-1: å§”å“¡ä¼šæå‡ºæ‰¿èª

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-100`
- agendaScore: 100
- agendaStatus: `pending_deputy_director_review`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-100",
    "decisionType": "approve_for_committee",
    "deciderId": "test-deputy-1",
    "reason": "åŒ»ç™‚å®‰å…¨å§”å“¡ä¼šã§è­°è«–ã™ã¹ãå†…å®¹ã§ã™ã€‚",
    "committeeId": "safety-committee"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "å§”å“¡ä¼šæå‡ºãŒæ‰¿èªã•ã‚Œã¾ã—ãŸ",
  "post": {
    "agendaStatus": "approved_for_committee"
  }
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`approved_for_committee`ã«æ›´æ–°
- [ ] æ–½è¨­å†…å…¨è·å“¡ã«é€šçŸ¥é€ä¿¡

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 3-2: å´ä¸‹ï¼ˆæ•‘æ¸ˆãƒ•ãƒ­ãƒ¼ç™ºå‹•ï¼‰

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-100-reject`
- agendaScore: 100
- agendaStatus: `pending_deputy_director_review`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-100-reject",
    "decisionType": "reject_by_deputy_director",
    "deciderId": "test-deputy-1",
    "reason": "æ–½è¨­è­°é¡Œã¨ã—ã¦ã¯å„ªå…ˆåº¦ãŒä½ã„ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "å´ä¸‹ã•ã‚Œã¾ã—ãŸã€‚å¸«é•·ã«ã‚ˆã‚‹æ•‘æ¸ˆå¾…ã¡ã§ã™",
  "post": {
    "agendaStatus": "pending_rescue_by_manager"
  }
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`pending_rescue_by_manager`ã«æ›´æ–°
- [ ] å¸«é•·ã«æ•‘æ¸ˆåˆ¤æ–­ã®é€šçŸ¥é€ä¿¡

---

### 3.4 æ•‘æ¸ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 4-1: å¸«é•·ã«ã‚ˆã‚‹æ•‘æ¸ˆæ‰¿èª

**å‰ææ¡ä»¶**:
- æŠ•ç¨¿ID: `test-post-100-rescue`
- agendaStatus: `pending_rescue_by_manager`

**å®Ÿè¡Œ**:
```bash
curl -X POST http://localhost:3001/api/agenda/decision \
  -H "Content-Type: application/json" \
  -d '{
    "postId": "test-post-100-rescue",
    "decisionType": "rescue_as_dept_agenda",
    "deciderId": "test-manager-1",
    "reason": "éƒ¨ç½²ãƒ¬ãƒ™ãƒ«ã§ã¯é‡è¦ãªèª²é¡Œãªã®ã§æ•‘æ¸ˆã—ã¾ã™ã€‚"
  }'
```

**æœŸå¾…çµæœ**:
```json
{
  "success": true,
  "message": "éƒ¨ç½²è­°é¡Œã¨ã—ã¦æ‰¿èªã•ã‚Œã¾ã—ãŸï¼ˆæ•‘æ¸ˆï¼‰",
  "post": {
    "agendaStatus": "approved_as_dept_agenda",
    "agendaLevel": "DEPT_AGENDA",
    "agendaRescueLevel": 7
  }
}
```

**æ¤œè¨¼é …ç›®**:
- [ ] `agendaStatus`ãŒ`approved_as_dept_agenda`ã«æ›´æ–°
- [ ] `agendaRescueLevel`ãŒ`7`ã«è¨­å®š
- [ ] éƒ¨ç½²å†…å…¨å“¡ã«é€šçŸ¥é€ä¿¡

---

## 4. UIãƒ†ã‚¹ãƒˆ

### 4.1 ãƒœã‚¿ãƒ³è¡¨ç¤ºãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 5-1: Level 3.5ï¼ˆä¸»ä»»ï¼‰ã®ãƒœã‚¿ãƒ³è¡¨ç¤º

**å®Ÿè¡Œæ‰‹é †**:
1. ä¸»ä»»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ`test-supervisor-1`ï¼‰
2. æŠ•ç¨¿ç®¡ç†ç”»é¢ã‚’é–‹ã
3. 50ç‚¹ã®æŠ•ç¨¿ã‚’è¡¨ç¤º

**æœŸå¾…çµæœ**:
- [ ] âœ… å¸«é•·ã«æ¨è–¦ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] âŒ å´ä¸‹ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä»–ã®ãƒœã‚¿ãƒ³ã¯è¡¨ç¤ºã•ã‚Œãªã„

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 5-2: Level 7ï¼ˆå¸«é•·ï¼‰ã®ãƒœã‚¿ãƒ³è¡¨ç¤º

**å®Ÿè¡Œæ‰‹é †**:
1. å¸«é•·ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ`test-manager-1`ï¼‰
2. æŠ•ç¨¿ç®¡ç†ç”»é¢ã‚’é–‹ã
3. `recommended_to_manager`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æŠ•ç¨¿ã‚’è¡¨ç¤º

**æœŸå¾…çµæœ**:
- [ ] âœ… éƒ¨ç½²è­°é¡Œæ‰¿èªãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] â¬†ï¸ æ–½è¨­è­°é¡Œã«æ˜‡æ ¼ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] âŒ å´ä¸‹ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 5-3: æ•‘æ¸ˆãƒ•ãƒ­ãƒ¼æ™‚ã®ãƒœã‚¿ãƒ³è¡¨ç¤º

**å®Ÿè¡Œæ‰‹é †**:
1. å¸«é•·ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
2. `pending_rescue_by_manager`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æŠ•ç¨¿ã‚’è¡¨ç¤º

**æœŸå¾…çµæœ**:
- [ ] âœ… éƒ¨ç½²è­°é¡Œæ‰¿èªãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆæ•‘æ¸ˆï¼‰
- [ ] âŒ å®Œå…¨å´ä¸‹ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ğŸ†˜ æ•‘æ¸ˆåˆ¤æ–­ãŒå¿…è¦ã§ã™ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

### 4.2 ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 6-1: åˆ¤æ–­ç†ç”±å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«

**å®Ÿè¡Œæ‰‹é †**:
1. âœ… å¸«é•·ã«æ¨è–¦ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã

**æœŸå¾…çµæœ**:
- [ ] ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¿ã‚¤ãƒˆãƒ«ã«ã€Œâœ… å¸«é•·ã«æ¨è–¦ã€ãŒè¡¨ç¤º
- [ ] æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤º
- [ ] åˆ¤æ–­ç†ç”±å…¥åŠ›æ¬„ãŒè¡¨ç¤ºï¼ˆå¿…é ˆï¼‰
- [ ] ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã¨é€ä¿¡ãƒœã‚¿ãƒ³ãŒè¡¨ç¤º

---

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 6-2: å§”å“¡ä¼šé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆLevel 8ï¼‰

**å®Ÿè¡Œæ‰‹é †**:
1. å‰¯çœ‹è­·éƒ¨é•·ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
2. âœ… å§”å“¡ä¼šæå‡ºæ‰¿èªãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**æœŸå¾…çµæœ**:
- [ ] åˆ¤æ–­ç†ç”±å…¥åŠ›æ¬„ãŒè¡¨ç¤º
- [ ] æå‡ºå…ˆå§”å“¡ä¼šã®é¸æŠè‚¢ãŒè¡¨ç¤º
  - åŒ»ç™‚å®‰å…¨å§”å“¡ä¼š
  - æ„ŸæŸ“å¯¾ç­–å§”å“¡ä¼š
  - åŒ»ç™‚ã®è³ªå‘ä¸Šå§”å“¡ä¼š
  - å€«ç†å§”å“¡ä¼š
  - é‹å–¶å§”å“¡ä¼š

---

## 5. é€šçŸ¥é€ä¿¡ãƒ†ã‚¹ãƒˆï¼ˆåˆ¶é™ã‚ã‚Šï¼‰

### ç¾åœ¨ã®åˆ¶é™äº‹é …

âš ï¸ **ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ãŒæœªå®Ÿè£…**ã®ãŸã‚ã€ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ç©ºé…åˆ—ã‚’è¿”å´:
- `getManagersByDepartment()`
- `getDepartmentMembersByDept()`
- `getDeputyDirectorsByFacility()`
- `getFacilityMembers()`
- `getGeneralAffairsByFacility()`
- `getCorporationMembers()`

### ãƒ†ã‚¹ãƒˆå¯èƒ½ç¯„å›²

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 7-1: é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—ç¢ºèª

**å®Ÿè¡Œæ‰‹é †**:
1. åˆ¤æ–­ã‚’å®Ÿè¡Œ
2. ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
```
[AgendaLevelNotification] ä¸»ä»»å–å¾—: çœ‹è­·éƒ¨Aç—…æ£Ÿ
[AgendaLevelNotification] éƒ¨ç½²ãƒ¡ãƒ³ãƒãƒ¼å–å¾—: çœ‹è­·éƒ¨Aç—…æ£Ÿ
```

**æ¤œè¨¼é …ç›®**:
- [ ] é€šçŸ¥ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ï¼ˆãƒ­ã‚°ç¢ºèªï¼‰
- [ ] `notificationsSent`ã‚«ã‚¦ãƒ³ãƒˆãŒè¿”å´ã•ã‚Œã‚‹ï¼ˆç¾çŠ¶ã¯0ã¾ãŸã¯æŠ•ç¨¿è€…ã®ã¿ï¼‰

---

## 6. å®Œå…¨ãªãƒ†ã‚¹ãƒˆå®Ÿæ–½ã®ãŸã‚ã®è¿½åŠ å®Ÿè£…

### 6.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

**å¯¾å¿œãŒå¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰**:

```typescript
// src/services/AgendaLevelNotificationService.ts

private async getManagersByDepartment(department: string | undefined): Promise<User[]> {
  if (!department) return [];

  return await prisma.user.findMany({
    where: {
      department,
      permissionLevel: 3.5,
      isRetired: false,
    },
  });
}

private async getDepartmentMembersByDept(department: string | undefined): Promise<User[]> {
  if (!department) return [];

  return await prisma.user.findMany({
    where: {
      department,
      isRetired: false,
    },
  });
}

private async getDeputyDirectorsByFacility(facilityId: string | undefined): Promise<User[]> {
  if (!facilityId) return [];

  return await prisma.user.findMany({
    where: {
      facilityId,
      permissionLevel: 8,
      isRetired: false,
    },
  });
}

private async getFacilityMembers(facilityId: string | undefined): Promise<User[]> {
  if (!facilityId) return [];

  return await prisma.user.findMany({
    where: {
      facilityId,
      isRetired: false,
    },
  });
}

private async getGeneralAffairsByFacility(facilityId: string | undefined): Promise<User[]> {
  if (!facilityId) return [];

  return await prisma.user.findMany({
    where: {
      facilityId,
      permissionLevel: 11,
      isRetired: false,
    },
  });
}

private async getCorporationMembers(): Promise<User[]> {
  return await prisma.user.findMany({
    where: {
      isRetired: false,
    },
  });
}
```

---

## 7. ãƒ†ã‚¹ãƒˆå®Ÿæ–½æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ç’°å¢ƒæº–å‚™

```bash
# 1. Prisma Migrateå®Ÿè¡Œ
npm run prisma:migrate

# 2. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥

```bash
# 3. ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æŠ•ç¨¿ã‚’ä½œæˆ
npx prisma studio
# ã¾ãŸã¯ SQLç›´æ¥å®Ÿè¡Œ
```

### ã‚¹ãƒ†ãƒƒãƒ—3: APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# 4. curlã¾ãŸã¯Postmanã§APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ 1-1ã‹ã‚‰é †ã«å®Ÿè¡Œ
```

### ã‚¹ãƒ†ãƒƒãƒ—4: UIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# 5. ãƒ–ãƒ©ã‚¦ã‚¶ã§ç”»é¢ç¢ºèª
# http://localhost:3001/proposal-management
```

### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ­ã‚°ç¢ºèª

```bash
# 6. ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã§é€šçŸ¥é€ä¿¡ã‚’ç¢ºèª
# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«é€šçŸ¥ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹
```

---

## 8. åŒ»ç™‚è·å“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆ

### çµ±åˆãŒå¿…è¦ãªæ©Ÿèƒ½

ç¾çŠ¶ã€VoiceDriveã‚·ã‚¹ãƒ†ãƒ å˜ç‹¬ã§ã¯ä»¥ä¸‹ã¯å®Œå…¨ã«ãƒ†ã‚¹ãƒˆã§ãã¾ã›ã‚“:

1. **å®Ÿéš›ã®é€šçŸ¥é…ä¿¡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ãŒæœªå®Ÿè£…
2. **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸ**: MCPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã®ãƒ‡ãƒ¼ã‚¿é€£æº

### çµ±åˆãƒ†ã‚¹ãƒˆæ™‚ã«å¿…è¦ãªä½œæ¥­

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…**: ä¸Šè¨˜6.1ã®å®Ÿè£…
2. **MCPã‚µãƒ¼ãƒãƒ¼é€£æº**: é¢è«‡ã‚¿ã‚¤ãƒ—è¨­å®šãªã©ã®åŒæœŸç¢ºèª
3. **é€šçŸ¥é…ä¿¡ç¢ºèª**: å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ãŒå±Šãã‹ç¢ºèª

---

## 9. ã¾ã¨ã‚

### VoiceDriveå˜ç‹¬ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

- âœ… **åˆ¤æ–­å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯**: å®Œå…¨ãƒ†ã‚¹ãƒˆå¯èƒ½
- âœ… **DBæ›´æ–°**: å®Œå…¨ãƒ†ã‚¹ãƒˆå¯èƒ½
- âœ… **APIå‘¼ã³å‡ºã—**: å®Œå…¨ãƒ†ã‚¹ãƒˆå¯èƒ½
- âœ… **UIè¡¨ç¤º**: å®Œå…¨ãƒ†ã‚¹ãƒˆå¯èƒ½
- âš ï¸ **é€šçŸ¥é€ä¿¡**: éƒ¨åˆ†çš„ï¼ˆãƒ­ã‚°ç¢ºèªã®ã¿ï¼‰

### å®Œå…¨ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªè¿½åŠ å®Ÿè£…

- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ6.1ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### æ¨å¥¨ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼

1. **Phase 1**: VoiceDriveå˜ç‹¬ã§åŸºæœ¬å‹•ä½œç¢ºèªï¼ˆç¾åœ¨å¯èƒ½ï¼‰
2. **Phase 2**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…å¾Œã€é€šçŸ¥é…ä¿¡ç¢ºèª
3. **Phase 3**: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆ

---

**çµè«–**:
- VoiceDriveã‚·ã‚¹ãƒ†ãƒ å˜ç‹¬ã§**åŸºæœ¬çš„ãªçµ±åˆãƒ†ã‚¹ãƒˆã¯å®Ÿæ–½å¯èƒ½**
- é€šçŸ¥é…ä¿¡ã®å®Œå…¨ãƒ†ã‚¹ãƒˆã«ã¯**ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ãŒå¿…è¦**
- **æ¨å¥¨**: ã¾ãšVoiceDriveå˜ç‹¬ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¤œè¨¼ã—ã€ãã®å¾Œãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã‚’å®Ÿè£…ã—ã¦å®Œå…¨ãƒ†ã‚¹ãƒˆå®Ÿæ–½
