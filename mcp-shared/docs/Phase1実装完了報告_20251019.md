# Phase 1 å®Ÿè£…å®Œäº†å ±å‘Š

**ä½œæˆæ—¥**: 2025å¹´10æœˆ19æ—¥
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **å®Œäº†**

---

## å®Ÿè£…å†…å®¹

### Phase 1-1: Prisma Migrateå®Ÿè¡Œ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `prisma/schema.prisma`

**è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
```prisma
// ğŸ†• è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç®¡ç†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
agendaStatus                 String?   @default("pending") @map("agenda_status")
agendaDecisionBy             String?   @map("agenda_decision_by")
agendaDecisionAt             DateTime? @map("agenda_decision_at")
agendaDecisionReason         String?   @map("agenda_decision_reason")
agendaRescueLevel            Int?      @map("agenda_rescue_level")
agendaVotingDeadline         DateTime? @map("agenda_voting_deadline")
```

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**: `npx prisma db push --accept-data-loss`

**çµæœ**: DBã‚¹ã‚­ãƒ¼ãƒæ›´æ–°æˆåŠŸ

---

### Phase 1-2: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/seed-agenda-test-data.ts`

**ä½œæˆãƒ‡ãƒ¼ã‚¿**:

#### ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ11åï¼‰

| ID | åå‰ | éƒ¨ç½² | ãƒ¬ãƒ™ãƒ« | å½¹è· |
|----|------|------|--------|------|
| test-author-1 | ãƒ†ã‚¹ãƒˆæŠ•ç¨¿è€… | çœ‹è­·éƒ¨Aç—…æ£Ÿ | 1 | ä¸€èˆ¬è·å“¡ |
| test-member-1~3 | ãƒ¡ãƒ³ãƒãƒ¼1~3 | çœ‹è­·éƒ¨Aç—…æ£Ÿ | 1 | ä¸€èˆ¬è·å“¡ |
| test-supervisor-1 | ä¸»ä»»ãƒ†ã‚¹ãƒˆå¤ªéƒ | çœ‹è­·éƒ¨Aç—…æ£Ÿ | 3.5 | ä¸»ä»» |
| test-manager-1 | å¸«é•·ãƒ†ã‚¹ãƒˆèŠ±å­ | çœ‹è­·éƒ¨Aç—…æ£Ÿ | 7 | å¸«é•· |
| test-deputy-1 | å‰¯çœ‹è­·éƒ¨é•·ãƒ†ã‚¹ãƒˆ | çœ‹è­·éƒ¨ | 8 | å‰¯çœ‹è­·éƒ¨é•· |
| test-affairs-1 | äº‹å‹™é•·ãƒ†ã‚¹ãƒˆ | ç·å‹™éƒ¨ | 11 | äº‹å‹™é•· |
| test-director-1 | æ³•äººçµ±æ‹¬äº‹å‹™å±€é•·ãƒ†ã‚¹ãƒˆ | æ³•äººæœ¬éƒ¨ | 18 | æ³•äººçµ±æ‹¬äº‹å‹™å±€é•· |
| test-member-f2-1~2 | æ–½è¨­2ãƒ¡ãƒ³ãƒãƒ¼1~2 | çœ‹è­·éƒ¨ | 1 | ä¸€èˆ¬è·å“¡ï¼ˆæ³•äººé€šçŸ¥ãƒ†ã‚¹ãƒˆç”¨ï¼‰ |

#### ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ï¼ˆ10ä»¶ï¼‰

| ID | ã‚¹ã‚³ã‚¢ | ãƒ¬ãƒ™ãƒ« | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ç”¨é€” |
|----|--------|--------|-----------|------|
| test-post-50 | 50 | DEPT_AGENDA | pending | ä¸»ä»»åˆ¤æ–­å¾…ã¡ |
| test-post-50-rec | 52 | DEPT_AGENDA | recommended_to_manager | å¸«é•·åˆ¤æ–­å¾…ã¡ |
| test-post-100 | 100 | FACILITY_AGENDA | pending_deputy_director_review | å‰¯çœ‹è­·éƒ¨é•·åˆ¤æ–­å¾…ã¡ |
| test-post-300 | 300 | CORP_REVIEW | pending_general_affairs_review | äº‹å‹™é•·åˆ¤æ–­å¾…ã¡ |
| test-post-600 | 600 | CORP_AGENDA | pending_general_affairs_director_review | æ³•äººçµ±æ‹¬äº‹å‹™å±€é•·åˆ¤æ–­å¾…ã¡ |
| test-post-29 | 29 | DEPT_REVIEW | pending | 30ç‚¹åˆ°é”ãƒ†ã‚¹ãƒˆç”¨ |
| test-post-49 | 49 | DEPT_REVIEW | pending_supervisor_review | 50ç‚¹åˆ°é”ãƒ†ã‚¹ãƒˆç”¨ |
| test-post-99 | 99 | DEPT_AGENDA | escalated_to_facility | 100ç‚¹åˆ°é”ãƒ†ã‚¹ãƒˆç”¨ |
| test-post-50-reject | 50 | DEPT_AGENDA | pending | å´ä¸‹ãƒ†ã‚¹ãƒˆç”¨ |
| test-post-100-rescue | 100 | FACILITY_AGENDA | pending_rescue_by_manager | æ•‘æ¸ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆç”¨ |

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**: `npx tsx scripts/seed-agenda-test-data.ts`

**çµæœ**: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥æˆåŠŸ

---

### Phase 1-3: ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/AgendaLevelNotificationService.ts`

**å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰**:

```typescript
// Prisma importè¿½åŠ 
import { prisma } from '@/lib/prisma';

// 6ã¤ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…
âœ… getManagersByDepartment(department) // ä¸»ä»»ï¼ˆLevel 3.5ï¼‰å–å¾—
âœ… getDepartmentMembersByDept(department) // éƒ¨ç½²ãƒ¡ãƒ³ãƒãƒ¼å–å¾—
âœ… getDeputyDirectorsByFacility(facilityId) // å‰¯çœ‹è­·éƒ¨é•·ï¼ˆLevel 8ï¼‰å–å¾—
âœ… getFacilityMembers(facilityId) // æ–½è¨­ãƒ¡ãƒ³ãƒãƒ¼å–å¾—
âœ… getGeneralAffairsByFacility(facilityId) // äº‹å‹™é•·ï¼ˆLevel 11ï¼‰å–å¾—
âœ… getCorporationMembers() // æ³•äººå†…å…¨è·å“¡å–å¾—
```

**ç‰¹å¾´**:
- Prismaã‚¯ã‚¨ãƒªã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
- `isRetired: false`æ¡ä»¶ã§é€€è·è€…ã‚’é™¤å¤–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- ãƒ­ã‚°å‡ºåŠ›ã§å–å¾—ä»¶æ•°ã‚’ç¢ºèªå¯èƒ½

---

## å‹•ä½œç¢ºèª

### ç¢ºèªã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç¢ºèª
npx tsx scripts/seed-agenda-test-data.ts

# å‡ºåŠ›ä¾‹
=== ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ ===
ä¸»ä»»ãƒ†ã‚¹ãƒˆå¤ªéƒï¼ˆLevel 3.5ï¼‰ - çœ‹è­·éƒ¨Aç—…æ£Ÿ
å¸«é•·ãƒ†ã‚¹ãƒˆèŠ±å­ï¼ˆLevel 7ï¼‰ - çœ‹è­·éƒ¨Aç—…æ£Ÿ
å‰¯çœ‹è­·éƒ¨é•·ãƒ†ã‚¹ãƒˆï¼ˆLevel 8ï¼‰ - çœ‹è­·éƒ¨
äº‹å‹™é•·ãƒ†ã‚¹ãƒˆï¼ˆLevel 11ï¼‰ - ç·å‹™éƒ¨
æ³•äººçµ±æ‹¬äº‹å‹™å±€é•·ãƒ†ã‚¹ãƒˆï¼ˆLevel 18ï¼‰ - æ³•äººæœ¬éƒ¨
+ ãƒ¡ãƒ³ãƒãƒ¼6å

=== ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ä¸€è¦§ ===
29ç‚¹ â†’ 30ç‚¹åˆ°é”ãƒ†ã‚¹ãƒˆç”¨
49ç‚¹ â†’ 50ç‚¹åˆ°é”ãƒ†ã‚¹ãƒˆç”¨
50ç‚¹ â†’ ä¸»ä»»åˆ¤æ–­å¾…ã¡
52ç‚¹ â†’ å¸«é•·åˆ¤æ–­å¾…ã¡
99ç‚¹ â†’ 100ç‚¹åˆ°é”ãƒ†ã‚¹ãƒˆç”¨
100ç‚¹ â†’ å‰¯çœ‹è­·éƒ¨é•·åˆ¤æ–­å¾…ã¡
100ç‚¹ â†’ æ•‘æ¸ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆç”¨
300ç‚¹ â†’ äº‹å‹™é•·åˆ¤æ–­å¾…ã¡
600ç‚¹ â†’ æ³•äººçµ±æ‹¬äº‹å‹™å±€é•·åˆ¤æ–­å¾…ã¡
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: Phase 2

Phase 1ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼š

âœ… **åˆ¤æ–­å‡¦ç†ãŒå®Ÿè¡Œå¯èƒ½**
- AgendaDecisionServiceçµŒç”±ã§åˆ¤æ–­å®Ÿè¡Œ
- DBã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæ›´æ–°ã•ã‚Œã‚‹

âœ… **é€šçŸ¥ãŒé€ä¿¡å¯èƒ½**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ãŒå‹•ä½œ
- NotificationServiceçµŒç”±ã§å®Ÿéš›ã«é€šçŸ¥é€ä¿¡

âœ… **ãƒ†ã‚¹ãƒˆãŒå®Ÿæ–½å¯èƒ½**
- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ãŒç”¨æ„æ¸ˆã¿
- APIãƒ†ã‚¹ãƒˆãŒå®Ÿæ–½ã§ãã‚‹çŠ¶æ…‹

---

## Phase 2: çµ±åˆãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

1. **ä¸»ä»»ã®åˆ¤æ–­ãƒ†ã‚¹ãƒˆ**
   - âœ… å¸«é•·ã«æ¨è–¦
   - âŒ å´ä¸‹

2. **å¸«é•·ã®åˆ¤æ–­ãƒ†ã‚¹ãƒˆ**
   - âœ… éƒ¨ç½²è­°é¡Œæ‰¿èª
   - â¬†ï¸ æ–½è¨­è­°é¡Œã«æ˜‡æ ¼
   - âŒ å´ä¸‹

3. **å‰¯çœ‹è­·éƒ¨é•·ã®åˆ¤æ–­ãƒ†ã‚¹ãƒˆ**
   - âœ… å§”å“¡ä¼šæå‡ºæ‰¿èª
   - â¬†ï¸ æ³•äººæ¤œè¨ã«æ˜‡æ ¼
   - âŒ å´ä¸‹ï¼ˆæ•‘æ¸ˆãƒ•ãƒ­ãƒ¼ç™ºå‹•ï¼‰

4. **æ•‘æ¸ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ**
   - å¸«é•·ã«ã‚ˆã‚‹éƒ¨ç½²è­°é¡Œæ•‘æ¸ˆ
   - å®Œå…¨å´ä¸‹

### ãƒ†ã‚¹ãƒˆæ–¹æ³•

**APIãƒ†ã‚¹ãƒˆ**: curlã¾ãŸã¯Postman
**UIãƒ†ã‚¹ãƒˆ**: ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿéš›ã«æ“ä½œ
**é€šçŸ¥ç¢ºèª**: ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã§ç¢ºèª

---

## ã¾ã¨ã‚

âœ… **Phase 1: å®Œäº†**
- DBæº–å‚™
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

â†’ **Phase 2: çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½**
â†’ **Phase 3ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰: ã‚¹ã‚³ã‚¢åˆ°é”æ™‚ã®è‡ªå‹•é€šçŸ¥å®Ÿè£…**

**ç¾æ™‚ç‚¹ã§ã€åˆ¤æ–­æ™‚ã®é€šçŸ¥æ©Ÿèƒ½ã¯å®Œå…¨ã«å‹•ä½œå¯èƒ½ãªçŠ¶æ…‹ã§ã™ã€‚**
