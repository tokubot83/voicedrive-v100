# 医療システムチーム確認回答書

**文書番号**: MS-RESP-2025-1012-004
**作成日**: 2025年10月12日
**作成者**: 医療職員管理システム開発チーム
**宛先**: VoiceDrive開発チーム
**件名**: Re: 組織情報収集依頼における3つの質問への回答

---

## 📋 エグゼクティブサマリー

VoiceDriveチームから提供いただいた「医療システムチーム質問回答書_20251012.md」を確認しました。

### ✅ 結論

**3つの質問すべてに対して、VoiceDriveチームの提案内容を承認します。**

医療システム側として以下のAPI実装を2025年10月末（Phase 1）までに完了します。

---

## 🎯 各質問への確認回答

### 質問1: 投票グループの動的変更

#### ✅ VoiceDriveの回答内容

- Level 99管理UI実装による動的変更可能
- 既存データ保持、新規データは新グループで処理
- 再編成履歴記録

#### ✅ 医療システム側の見解

**完全に承認します。**

**理由**:
- 投票グループの運用ルールはVoiceDrive側の責任範囲
- 医療システムは組織マスタ（部門・職員）の提供のみを担当
- データ管理責任分界点定義書に準拠
- 医療システム側での追加実装は不要

**医療システム側で維持する責任**:
```yaml
組織マスタの提供:
  ✅ 部門マスタ（Department API）
  ✅ 職員マスタ（Employee API）
  ✅ 施設マスタ（Facility API）
  ✅ 権限レベル計算（Permission Level API）

変更不要:
  ❌ 投票グループ管理
  ❌ 承認者指定
  ❌ ローテーション設定
```

---

### 質問2: 施設間連携議題

#### ✅ VoiceDriveの回答内容

- タグ機能 + `crossFacilityConfig`で対応（推奨）
- Level 99による投票範囲カスタマイズ
- 運用実績に応じて`CROSS_FACILITY`レベル追加を検討

#### ✅ 医療システム側の見解

**完全に承認します。**

**理由**:
- 議題レベルと投票範囲の管理はVoiceDrive側の責任範囲
- 医療システムは施設マスタの提供のみを担当
- タグ機能による柔軟な対応は適切
- 医療システム側での追加実装は不要

**医療システム側で維持する責任**:
```yaml
施設マスタの提供:
  ✅ 施設コード（facilityCode）
  ✅ 施設名（facilityName）
  ✅ 施設タイプ（facilityType）

変更不要:
  ❌ 議題レベル管理
  ❌ 投票範囲管理
  ❌ タグ機能
  ❌ crossFacilityConfig
```

---

### 質問3: 兼任職員の投票権

#### ✅ VoiceDriveの回答内容

- 複数所属対応（主所属 + 兼任所属）
- 投票時に所属選択
- 当面は1人1票、将来的に重み付け検討

#### ✅ 医療システム側の見解

**承認します。ただし、Phase 1では単一所属のみ対応します。**

**Phase 1（2025年10月末まで）**:
```yaml
提供内容:
  ✅ 主所属のみ（primaryAffiliation）
  ✅ facilityCode
  ✅ department
  ✅ professionCategory
  ✅ permissionLevel

未提供:
  ⏸️ secondaryAffiliations（兼任所属）
```

**Phase 2（2025年11月以降）**:
```yaml
追加提供予定:
  🔄 secondaryAffiliations（兼任所属配列）
  🔄 employmentRate（勤務比率）
  🔄 兼任先のpermissionLevel
```

**理由**:
- DB構築Phase 1では基本機能優先
- 兼任職員データの収集・整理に時間が必要
- VoiceDrive側の実装完了後、Phase 2で対応

**Phase 2実装スケジュール**:
- **要件定義**: 2025年11月上旬
- **DB設計**: 2025年11月中旬
- **API実装**: 2025年11月下旬～12月上旬
- **統合テスト**: 2025年12月中旬

---

## 🔧 医療システム側の実装計画

### Phase 1: 必須API実装（優先度: 🔴 HIGH）

**実装期限**: 2025年10月31日

#### API-1: 職種マスタ取得API

**エンドポイント**: `GET /api/v2/professions`

**実装状況**: ✅ 実装可能

**レスポンス仕様**:
```json
[
  {
    "professionCode": "nurse",
    "professionName": "看護師",
    "professionGroup": "nursing",
    "requiresLicense": true,
    "sortOrder": 1,
    "isActive": true
  },
  {
    "professionCode": "doctor",
    "professionName": "医師",
    "professionGroup": "medical",
    "requiresLicense": true,
    "sortOrder": 2,
    "isActive": true
  },
  {
    "professionCode": "pharmacist",
    "professionName": "薬剤師",
    "professionGroup": "medical",
    "requiresLicense": true,
    "sortOrder": 3,
    "isActive": true
  },
  {
    "professionCode": "pt",
    "professionName": "理学療法士",
    "professionGroup": "allied",
    "requiresLicense": true,
    "sortOrder": 4,
    "isActive": true
  },
  {
    "professionCode": "ot",
    "professionName": "作業療法士",
    "professionGroup": "allied",
    "requiresLicense": true,
    "sortOrder": 5,
    "isActive": true
  },
  {
    "professionCode": "clerk",
    "professionName": "事務職",
    "professionGroup": "admin",
    "requiresLicense": false,
    "sortOrder": 10,
    "isActive": true
  }
]
```

**実装タスク**:
- [ ] JobCategoryマスタテーブル整備
- [ ] API実装（Express.js）
- [ ] JWT認証実装
- [ ] Rate Limit設定（100 req/min/IP）
- [ ] 単体テスト
- [ ] 統合テスト

**完了予定**: 2025年10月25日

---

#### API-2: 部門別人数取得API

**エンドポイント**: `GET /api/v2/departments/headcount`

**実装状況**: ✅ 実装可能

**レスポンス仕様**:
```json
[
  {
    "departmentId": "DEPT-NS",
    "departmentName": "看護部",
    "facilityId": "obara-hospital",
    "facilityName": "小原記念病院",
    "totalMembers": 320,
    "activeMembers": 298,
    "retiredMembers": 22,
    "onLeaveMembers": 0,
    "calculatedAt": "2025-10-12T00:00:00Z"
  },
  {
    "departmentId": "DEPT-MED",
    "departmentName": "医療技術部",
    "facilityId": "obara-hospital",
    "facilityName": "小原記念病院",
    "totalMembers": 180,
    "activeMembers": 172,
    "retiredMembers": 8,
    "onLeaveMembers": 0,
    "calculatedAt": "2025-10-12T00:00:00Z"
  },
  {
    "departmentId": "DEPT-ADM",
    "departmentName": "事務部",
    "facilityId": "obara-hospital",
    "facilityName": "小原記念病院",
    "totalMembers": 95,
    "activeMembers": 92,
    "retiredMembers": 3,
    "onLeaveMembers": 0,
    "calculatedAt": "2025-10-12T00:00:00Z"
  },
  {
    "departmentId": "DEPT-RHB",
    "departmentName": "リハビリ部",
    "facilityId": "obara-hospital",
    "facilityName": "小原記念病院",
    "totalMembers": 75,
    "activeMembers": 71,
    "retiredMembers": 4,
    "onLeaveMembers": 0,
    "calculatedAt": "2025-10-12T00:00:00Z"
  }
]
```

**実装タスク**:
- [ ] Employee集計クエリ実装
- [ ] 日次更新バッチ実装（深夜1:00）
- [ ] API実装（Express.js）
- [ ] JWT認証実装
- [ ] キャッシュ機構（24時間）
- [ ] 単体テスト
- [ ] 統合テスト

**完了予定**: 2025年10月28日

---

#### API-3: 年齢・世代取得API（+ データ同意システム連携）

**エンドポイント**: `GET /api/v2/employees/{employeeId}/age`

**実装状況**: ✅ 実装可能（⚠️ データ同意連携必須）

**🔐 重要な前提条件**:

VoiceDriveチームから以下の重要な情報を受領しました：

```yaml
データ同意システム（VoiceDrive側で既に実装済み）:
  ✅ DataConsentテーブルで同意状況を管理
  ✅ analyticsConsent = true の職員のみ分析対象
  ✅ 初回投稿時に同意取得
  ✅ 同意取り消し機能も実装済み

医療システム側の責任:
  ✅ VoiceDriveから提供される同意済み職員IDリストのみ対象
  ✅ 未同意職員のIDがリクエストに含まれることはない
  ✅ 年齢データは同意済み職員のみ提供
```

**レスポンス仕様**:
```json
{
  "employeeId": "EMP2024001",
  "age": 34,
  "generation": "30代",
  "generationCode": "30s",
  "calculatedAt": "2025-10-12"
}
```

**世代区分ルール**:
- `20代`: 20-29歳 → generationCode: "20s"
- `30代`: 30-39歳 → generationCode: "30s"
- `40代`: 40-49歳 → generationCode: "40s"
- `50代以上`: 50歳以上 → generationCode: "50s_plus"

**バッチ取得エンドポイント（推奨）**:
```
POST /api/v2/employees/age-batch
Request Body: {
  "employeeIds": ["EMP001", "EMP002", "EMP003"]  // 同意済み職員IDのみ
}

Response: [
  { "employeeId": "EMP001", "age": 28, "generation": "20代", "generationCode": "20s" },
  { "employeeId": "EMP002", "age": 35, "generation": "30代", "generationCode": "30s" },
  { "employeeId": "EMP003", "age": 42, "generation": "40代", "generationCode": "40s" }
]
```

**実装タスク**:
- [ ] 年齢計算ロジック実装（生年月日から現在年齢を計算）
- [ ] 世代区分ロジック実装
- [ ] API実装（Express.js）
  - [ ] 単一取得: `GET /api/v2/employees/{id}/age`
  - [ ] バッチ取得: `POST /api/v2/employees/age-batch`
- [ ] JWT認証実装
- [ ] セキュリティ実装:
  - [ ] リクエストされた職員IDの存在確認
  - [ ] **⚠️ 重要**: 同意確認はVoiceDrive側で事前フィルタリング済みのため、医療システム側では不要
- [ ] 週次更新対応（VoiceDrive側のバッチに対応）
- [ ] 単体テスト
- [ ] 統合テスト

**完了予定**: 2025年10月30日

---

### Phase 2: 兼任職員対応（優先度: 🟡 MEDIUM）

**実装期限**: 2025年12月中旬

#### User型の拡張（複数所属対応）

**現在（Phase 1）**:
```json
{
  "employeeId": "EMP001",
  "name": "田中太郎",
  "department": "看護部",
  "facilityCode": "obara-hospital",
  "professionCategory": "nurse",
  "permissionLevel": 3
}
```

**Phase 2拡張後**:
```json
{
  "employeeId": "EMP001",
  "name": "田中太郎",
  "primaryAffiliation": {
    "facilityCode": "obara-hospital",
    "department": "看護部",
    "section": "3階病棟",
    "jobCategory": "nurse",
    "employmentRate": 1.0,
    "permissionLevel": 3
  },
  "secondaryAffiliations": [
    {
      "facilityCode": "tategami-rehabilitation",
      "department": "看護部",
      "section": "医療療養病棟",
      "jobCategory": "nurse",
      "employmentRate": 0.3,
      "permissionLevel": 3
    }
  ]
}
```

**実装タスク**:
- [ ] DB設計（兼任所属テーブル追加）
- [ ] Employee APIの拡張
- [ ] 兼任データの整理・入力
- [ ] 単体テスト
- [ ] 統合テスト
- [ ] VoiceDriveチームとの統合テスト

**完了予定**: 2025年12月15日

---

## 📊 実装スケジュール詳細

### Phase 1実装タイムライン

| 日付 | タスク | 担当 | 状態 |
|------|--------|------|------|
| **10/13（日）** | 要件確認・設計開始 | 医療システムチーム | 🟡 準備中 |
| **10/14（月）** | JobCategoryマスタ整備 | 医療システムチーム | ⏸️ 未着手 |
| **10/15（火）** | API-1実装開始（職種マスタ） | 医療システムチーム | ⏸️ 未着手 |
| **10/16（水）** | API-1単体テスト | 医療システムチーム | ⏸️ 未着手 |
| **10/17（木）** | API-2実装開始（部門別人数） | 医療システムチーム | ⏸️ 未着手 |
| **10/18（金）** | API-2単体テスト | 医療システムチーム | ⏸️ 未着手 |
| **10/21（月）** | 日次更新バッチ実装 | 医療システムチーム | ⏸️ 未着手 |
| **10/22（火）** | API-3実装開始（年齢・世代） | 医療システムチーム | ⏸️ 未着手 |
| **10/23（水）** | API-3単体テスト | 医療システムチーム | ⏸️ 未着手 |
| **10/24（木）** | API-3バッチ取得実装 | 医療システムチーム | ⏸️ 未着手 |
| **10/25（金）** | **API-1完成** | 医療システムチーム | ⏸️ 未着手 |
| **10/28（月）** | **API-2完成** | 医療システムチーム | ⏸️ 未着手 |
| **10/29（火）** | 統合テスト（全API） | 医療システムチーム | ⏸️ 未着手 |
| **10/30（水）** | **API-3完成** | 医療システムチーム | ⏸️ 未着手 |
| **10/31（木）** | **Phase 1完了** | 医療システムチーム | ⏸️ 未着手 |

---

## 🔐 セキュリティ・認証

### JWT認証

すべてのAPIで以下のセキュリティを実装：

```yaml
認証方式:
  - JWT Bearer Token認証
  - トークン有効期限: 24時間
  - リフレッシュトークン対応

Rate Limit:
  - 100 req/min/IP（職種マスタ）
  - 50 req/min/IP（部門別人数）
  - 200 req/min/IP（年齢バッチ取得）

CORS設定:
  - VoiceDriveドメインのみ許可
  - localhost:3001（開発環境）
  - voicedrive.example.com（本番環境）

ログ記録:
  - すべてのAPI呼び出しをログ記録
  - エラー発生時は詳細ログ
  - 個人情報はマスキング
```

---

## 📝 確認事項への回答

### 確認-1: 生年月日データの提供方法

**✅ 選択肢A（年齢・世代区分のみ提供 + データ同意システム連携）を採用します。**

**理由**:
- ✅ 個人情報保護と分析機能のバランスが最適
- ✅ VoiceDrive側の実装がシンプル
- ✅ 医療システム側の負荷も低い
- ✅ 週次更新で十分な精度
- ✅ **VoiceDrive側のデータ同意システムと完全連携**
- ✅ **同意済み職員のみ分析対象とし、未同意職員のプライバシーを完全保護**

**実装方針**:
```yaml
医療システムの責任:
  ✅ 年齢計算（生年月日から現在年齢）
  ✅ 世代区分計算（20代、30代、40代、50代以上）
  ✅ API提供（GET /api/v2/employees/{id}/age）
  ✅ バッチAPI提供（POST /api/v2/employees/age-batch）

VoiceDrive側の責任:
  ✅ 同意済み職員IDのフィルタリング（analyticsConsent = true）
  ✅ 同意済み職員IDのみをAPI呼び出し
  ✅ Userテーブルへのキャッシュ（age, generation, ageUpdatedAt）
  ✅ 週次更新バッチ実装
```

**⚠️ 重要**: 医療システム側は、**VoiceDriveから提供される職員IDリスト**に基づいてのみ年齢データを返却します。同意確認はVoiceDrive側で事前にフィルタリング済みのため、医療システム側での同意確認は不要です。

---

### 確認-2: 部門別人数API実装スケジュール

**✅ 2025年10月28日までに実装完了します。**

**実装内容**:
- Employeeテーブルから部門別の人数を集計
- 日次更新バッチ実装（深夜1:00）
- `GET /api/v2/departments/headcount` API実装
- キャッシュ機構（24時間TTL）

**更新頻度**:
- 日次更新（深夜1:00）
- 職員入社・退職時にリアルタイム更新

---

### 確認-3: 多様性スコア計算ロジックの承認

**✅ Simpson's Diversity Indexを使用することを承認します。**

**重み付け**:
- 職種多様性: 40% ✅
- 世代多様性: 35% ✅
- 階層多様性: 25% ✅

**医療業界特有の多様性指標**:
- Phase 1では不要
- Phase 2以降、運用実績を見て検討

**理由**:
- Simpson's Indexは広く使われている多様性指標
- 医療業界でも適用可能
- 重み付けは適切（職種が最も重要）

---

## 🔄 次のアクション

### 医療システムチーム側（10/13～10/31）

1. **Phase 1 API実装** （🔴 緊急）
   - [ ] API-1: 職種マスタ取得API（10/25完成）
   - [ ] API-2: 部門別人数取得API（10/28完成）
   - [ ] API-3: 年齢・世代取得API（10/30完成）
   - [ ] 統合テスト（10/29-10/31）

2. **VoiceDriveチームへの通知**
   - [ ] 各API完成時に通知
   - [ ] API仕様書の共有
   - [ ] テスト環境の提供

3. **Phase 2計画策定** （🟡 中期）
   - [ ] 兼任職員データの整理（11月上旬）
   - [ ] DB設計（11月中旬）
   - [ ] API実装（11月下旬～12月上旬）

---

### VoiceDriveチーム側（確認お願い）

1. **Phase 1対応**
   - [ ] 医療システムAPI呼び出し実装
   - [ ] Userテーブル拡張（age, generation, ageUpdatedAt）
   - [ ] 週次年齢データ同期バッチ実装
   - [ ] データ同意システムとの統合

2. **Phase 2対応**
   - [ ] User型の複数所属対応設計
   - [ ] 投票時の所属選択UI設計
   - [ ] 医療システムチームとの仕様協議

---

## 📞 連絡体制

### 質問・確認事項の連絡先

**医療システムチーム担当者**: [担当者名]
**Slack**: #medical-system-integration
**緊急連絡**: DM

### 定例ミーティング

**Phase 1期間中の週次ミーティング**:
- **日時**: 毎週火曜 15:00-15:30
- **参加者**: 医療システムチーム + VoiceDriveチーム
- **議題**: 進捗確認、課題共有、仕様調整

---

## 📝 まとめ

### ✅ 承認内容

1. **投票グループの動的変更**
   - VoiceDrive側の実装方針を承認
   - 医療システム側での追加実装は不要

2. **施設間連携議題**
   - タグ機能による柔軟な対応を承認
   - 医療システム側での追加実装は不要

3. **兼任職員の投票権**
   - Phase 1: 単一所属のみ対応
   - Phase 2: 複数所属対応（2025年12月中旬）

### 🚀 医療システム側の実装計画

**Phase 1（2025年10月末まで）**:
- ✅ API-1: 職種マスタ取得API
- ✅ API-2: 部門別人数取得API
- ✅ API-3: 年齢・世代取得API（データ同意システム連携）

**Phase 2（2025年12月中旬まで）**:
- ⏸️ 兼任職員対応（複数所属API）

### 🎯 次のマイルストーン

- **10/15（火）**: Phase 1実装開始
- **10/25（金）**: API-1完成
- **10/28（月）**: API-2完成
- **10/30（水）**: API-3完成
- **10/31（木）**: **Phase 1完了**
- **12/15（金）**: Phase 2完了

---

**ご協力ありがとうございます！**

VoiceDriveチームからの詳細な回答書により、医療システム側の実装方針が明確になりました。
Phase 1完了に向けて全力で取り組みます。

引き続きよろしくお願いいたします。

---

**作成者**: 医療職員管理システム開発チーム
**作成日**: 2025年10月12日
**バージョン**: 1.0
**ステータス**: VoiceDriveチーム確認待ち

**関連ドキュメント**:
- [医療システムチーム質問回答書_20251012.md](医療システムチーム質問回答書_20251012.md)
- [組織構造拡張実装_マスタープラン統合回答書_2通目_20251012.md](組織構造拡張実装_マスタープラン統合回答書_2通目_20251012.md)
- [データ管理責任分界点定義書_20251008.md](データ管理責任分界点定義書_20251008.md)
- [project-talent-analytics_DB要件分析_20251012.md](project-talent-analytics_DB要件分析_20251012.md)
- [project-talent-analytics暫定マスターリスト_20251012.md](project-talent-analytics暫定マスターリスト_20251012.md)
