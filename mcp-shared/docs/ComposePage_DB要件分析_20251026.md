# ComposePage DBè¦ä»¶åˆ†æ

**ä½œæˆæ—¥**: 2025å¹´10æœˆ26æ—¥
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: ComposePage
**URL**: https://voicedrive-v100.vercel.app/compose/:type
**Phase**: Phase 2.xï¼ˆæŠ•ç¨¿æ©Ÿèƒ½çµ±åˆï¼‰

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

ComposePageã¯ã€VoiceDriveã®3ç¨®é¡ã®æŠ•ç¨¿ï¼ˆã‚¢ã‚¤ãƒ‡ã‚¢ãƒœã‚¤ã‚¹ãƒ»ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çª“å£ï¼‰ã‚’ä½œæˆã™ã‚‹çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã¯100% VoiceDriveãŒç®¡ç†ã—ã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã¯ä¸è¦ã§ã™ã€‚

### ä¸»è¦ãªç™ºè¦‹
- âœ… **DBè¦ä»¶**: Post/Poll/Eventãƒ¢ãƒ‡ãƒ«ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ã€ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ä¸è¦
- âŒ **APIä¸è¶³**: POST /api/posts ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæœªå®Ÿè£…
- ğŸŸ¡ **ãƒ‡ãƒ¼ã‚¿åŒæ„**: åˆå›æŠ•ç¨¿æ™‚ã®ãƒ‡ãƒ¼ã‚¿åŒæ„ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆuseDataConsentï¼‰ã®å®Ÿè£…ç¢ºèªãŒå¿…è¦

---

## ğŸ” ãƒšãƒ¼ã‚¸æ©Ÿèƒ½åˆ†æ

### 1. ãƒšãƒ¼ã‚¸æ¦‚è¦

**URLæ§‹é€ **:
- `/compose/improvement` - ã‚¢ã‚¤ãƒ‡ã‚¢ãƒœã‚¤ã‚¹ï¼ˆæ”¹å–„ææ¡ˆï¼‰
- `/compose/community` - ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹ï¼ˆæƒ…å ±å…±æœ‰ãƒ»é›‘è«‡ï¼‰
- `/compose/report` - ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çª“å£ï¼ˆå†…éƒ¨é€šå ±ï¼‰

**ä¸»ãªæ©Ÿèƒ½**:
1. **æŠ•ç¨¿ã‚¿ã‚¤ãƒ—é¸æŠ** (improvementã®ã¿)
   - 4ç¨®é¡ã®ææ¡ˆã‚¿ã‚¤ãƒ—ï¼ˆæ¥­å‹™æ”¹å–„ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»æˆ¦ç•¥çš„ææ¡ˆï¼‰
2. **å†…å®¹å…¥åŠ›**
   - ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ï¼ˆ500æ–‡å­—åˆ¶é™ï¼‰
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
   - å»ºè¨­æ€§ã‚¹ã‚³ã‚¢è¡¨ç¤º
3. **è©³ç´°è¨­å®š**
   - é‡è¦åº¦é¸æŠï¼ˆä½ãƒ»ä¸­ãƒ»é«˜ãƒ»ç·Šæ€¥ï¼‰â€»improvementã®ã¿
   - åŒ¿åæ€§ãƒ¬ãƒ™ãƒ«é¸æŠï¼ˆ5æ®µéšï¼‰
   - ãƒ•ãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆcommunityã®ã¿ï¼‰
     - ã‚«ãƒ†ã‚´ãƒªé¸æŠï¼ˆã‚¢ã‚¤ãƒ‡ã‚¢å…±æœ‰ãƒ»é›‘è«‡ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆä¼ç”»ï¼‰
     - ã‚¹ã‚³ãƒ¼ãƒ—é¸æŠï¼ˆãƒãƒ¼ãƒ ãƒ»éƒ¨ç½²ãƒ»æ–½è¨­ãƒ»çµ„ç¹”ï¼‰
     - æŠ•ç¥¨æ©Ÿèƒ½ï¼ˆPollï¼‰
     - ã‚¤ãƒ™ãƒ³ãƒˆä¼ç”»æ©Ÿèƒ½ï¼ˆEventï¼‰
     - æœ‰åŠ¹æœŸé™è¨­å®š
4. **ç¢ºèªç”»é¢**
   - æŠ•ç¨¿å†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
   - æœ€çµ‚ç¢ºèªå¾Œã®æŠ•ç¨¿å®Ÿè¡Œ

### 2. ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼

#### ã‚¢ã‚¤ãƒ‡ã‚¢ãƒœã‚¤ã‚¹ï¼ˆimprovementï¼‰- 4ã‚¹ãƒ†ãƒƒãƒ—
1. **ææ¡ˆã‚¿ã‚¤ãƒ—é¸æŠ** - æ¥­å‹™æ”¹å–„/ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³/ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³/æˆ¦ç•¥çš„ææ¡ˆ
2. **å†…å®¹å…¥åŠ›** - ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› + ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
3. **è©³ç´°è¨­å®š** - é‡è¦åº¦ + åŒ¿åæ€§ãƒ¬ãƒ™ãƒ«
4. **ç¢ºèª** - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ + æŠ•ç¨¿å®Ÿè¡Œ

#### ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹ï¼ˆcommunityï¼‰- 3ã‚¹ãƒ†ãƒƒãƒ—
1. **å†…å®¹å…¥åŠ›** - ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› + ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
2. **è©³ç´°è¨­å®š** - ãƒ•ãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¹ã‚³ãƒ¼ãƒ—ãƒ»Pollãƒ»Eventãƒ»æœŸé™ï¼‰+ åŒ¿åæ€§ãƒ¬ãƒ™ãƒ«
3. **ç¢ºèª** - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ + æŠ•ç¨¿å®Ÿè¡Œ

#### ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çª“å£ï¼ˆreportï¼‰- 3ã‚¹ãƒ†ãƒƒãƒ—
1. **å†…å®¹å…¥åŠ›** - ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› + ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
2. **è©³ç´°è¨­å®š** - é‡è¦åº¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: mediumï¼‰+ åŒ¿åæ€§ï¼ˆå¼·åˆ¶: anonymousï¼‰
3. **ç¢ºèª** - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ + æŠ•ç¨¿å®Ÿè¡Œ

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿è¦ä»¶åˆ†æ

### æŠ•ç¨¿ã‚¿ã‚¤ãƒ—åˆ¥ã®ãƒ‡ãƒ¼ã‚¿é …ç›®

| ãƒ‡ãƒ¼ã‚¿é …ç›® | improvement | community | report | ãƒ‡ãƒ¼ã‚¿å‹ | å¿…é ˆ |
|-----------|-------------|-----------|--------|---------|------|
| **åŸºæœ¬æƒ…å ±** | | | | | |
| type | âœ“ | âœ“ | âœ“ | String | âœ“ |
| content | âœ“ | âœ“ | âœ“ | String | âœ“ |
| authorId | âœ“ | âœ“ | âœ“ | String | âœ“ |
| anonymityLevel | âœ“ | âœ“ | âœ“ | String | âœ“ |
| season | âœ“ | âœ“ | - | String | - |
| moderationScore | âœ“ | âœ“ | âœ“ | Int | - |
| **improvementå°‚ç”¨** | | | | | |
| proposalType | âœ“ | - | - | String | - |
| priority | âœ“ | - | âœ“ | String | - |
| **communityå°‚ç”¨** | | | | | |
| freespaceCategory | - | âœ“ | - | String | - |
| freespaceScope | - | âœ“ | - | String | - |
| expirationDate | - | âœ“ | - | DateTime | - |
| pollDataï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ | - | âœ“ | - | Poll | - |
| eventDataï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ | - | âœ“ | - | Event | - |

### Postãƒ¢ãƒ‡ãƒ«ã®ãƒãƒƒãƒ”ãƒ³ã‚°

#### Prisma schemaæ¤œè¨¼çµæœ: âœ… **ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ä¸è¦**

ComposeFormã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿é …ç›®ã¯ã€æ—¢å­˜ã®Postãƒ¢ãƒ‡ãƒ«ã§ã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ã¾ã™ã€‚

```prisma
model Post {
  id                  String    @id @default(cuid())
  type                String    // 'improvement' | 'community' | 'report'
  content             String    // æŠ•ç¨¿å†…å®¹
  authorId            String    // æŠ•ç¨¿è€…ID
  anonymityLevel      String    // åŒ¿åæ€§ãƒ¬ãƒ™ãƒ«
  proposalType        String?   // improvementå°‚ç”¨
  priority            String?   // improvement/reportç”¨
  freespaceCategory   String?   // communityå°‚ç”¨
  freespaceScope      String?   // communityå°‚ç”¨
  expirationDate      DateTime? // communityå°‚ç”¨
  season              String?   // å­£ç¯€æƒ…å ±
  moderationScore     Int?      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚³ã‚¢
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  // ...ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}
```

#### Pollãƒ¢ãƒ‡ãƒ«ï¼ˆcommunityå°‚ç”¨ï¼‰

```prisma
model Poll {
  id            String   @id @default(cuid())
  postId        String   @unique
  question      String
  description   String?
  totalVotes    Int      @default(0)
  deadline      DateTime
  isActive      Boolean  @default(true)
  allowMultiple Boolean  @default(false)
  showResults   String
  category      String
  scope         String
  createdById   String
  // ...ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

model PollOption {
  id        String @id @default(cuid())
  pollId    String
  text      String
  emoji     String?
  votes     Int    @default(0)
  sortOrder Int    @default(0)
}
```

#### Eventãƒ¢ãƒ‡ãƒ«ï¼ˆcommunityå°‚ç”¨ï¼‰

```prisma
model Event {
  id                   String    @id @default(cuid())
  postId               String    @unique
  title                String
  description          String
  type                 String
  registrationDeadline DateTime?
  finalDate            DateTime?
  finalStartTime       String?
  finalEndTime         String?
  organizerId          String
  maxParticipants      Int?
  venueName            String?
  venueAddress         String?
  cost                 Float?
  status               String    @default("planning")
  // ...ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

model ProposedDate {
  id        String   @id @default(cuid())
  eventId   String
  date      DateTime
  startTime String
  endTime   String
  votes     Int      @default(0)
}
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### æŠ•ç¨¿ä½œæˆãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as User
    participant CF as ComposeForm
    participant DCM as DataConsentModal
    participant CMS as ClientModerationService
    participant API as POST /api/posts
    participant DB as Database (Prisma)

    U->>CF: æŠ•ç¨¿ã‚¿ã‚¤ãƒ—é¸æŠ
    U->>CF: å†…å®¹å…¥åŠ›
    CF->>CMS: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    CMS-->>CF: moderationResult + å»ºè¨­æ€§ã‚¹ã‚³ã‚¢

    U->>CF: è©³ç´°è¨­å®šï¼ˆåŒ¿åæ€§ãƒ»é‡è¦åº¦ãƒ»ãƒ•ãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    U->>CF: ç¢ºèªç”»é¢ã§ã€ŒæŠ•ç¨¿ã™ã‚‹ã€ã‚¯ãƒªãƒƒã‚¯

    CF->>DCM: shouldShowModalåˆ¤å®šï¼ˆåˆå›æŠ•ç¨¿æ™‚ï¼‰
    alt åˆå›æŠ•ç¨¿
        DCM->>U: ãƒ‡ãƒ¼ã‚¿åŒæ„ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        U->>DCM: åŒæ„ or æ‹’å¦
        DCM->>CF: updateConsent()
    end

    CF->>CMS: æœ€çµ‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    CMS-->>CF: é•åãƒã‚§ãƒƒã‚¯çµæœ

    alt ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é•åã‚ã‚Š
        CF->>U: ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€Œå†…å®¹ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€
    else è­¦å‘Šãƒ¬ãƒ™ãƒ«
        CF->>U: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€Œãã‚Œã§ã‚‚æŠ•ç¨¿ã—ã¾ã™ã‹ï¼Ÿã€
        U->>CF: OK or Cancel
    else å•é¡Œãªã—
        CF->>API: POST /api/posts
        API->>DB: Postãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ

        opt ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹ + Poll
            API->>DB: Poll + PollOptionãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
        end

        opt ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹ + Event
            API->>DB: Event + ProposedDateãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
        end

        DB-->>API: ä½œæˆæˆåŠŸ
        API-->>CF: { success: true, data: createdPost }
        CF->>U: alert('æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼')
        CF->>U: onCancel() â†’ ãƒšãƒ¼ã‚¸é·ç§»
    end
```

### æœ‰åŠ¹æœŸé™è‡ªå‹•è¨ˆç®—ï¼ˆãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹å°‚ç”¨ï¼‰

```mermaid
graph TD
    A[ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹æŠ•ç¨¿] --> B{ã‚«ã‚¹ã‚¿ãƒ æœŸé™è¨­å®š?}
    B -->|Yes| C[ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šæ—¥æ™‚]
    B -->|No| D{ã‚«ãƒ†ã‚´ãƒªåˆ¤å®š}

    D -->|ã‚¢ã‚¤ãƒ‡ã‚¢å…±æœ‰| E[30æ—¥å¾Œ]
    D -->|é›‘è«‡| F[7æ—¥å¾Œ]
    D -->|ã‚¤ãƒ™ãƒ³ãƒˆä¼ç”»| G[ã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†æ—¥+1æ—¥]

    C --> H[expirationDateè¨­å®š]
    E --> H
    F --> H
    G --> H

    H --> I[POST /api/postsé€ä¿¡]
```

---

## ğŸ¯ ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹

### ãƒ‡ãƒ¼ã‚¿æ‰€æœ‰è€…: 100% VoiceDrive

ComposePageã§ä½œæˆã•ã‚Œã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯**VoiceDriveå˜ç‹¬ç®¡ç†**ã§ã™ã€‚

| ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ†ã‚´ãƒª | æ‰€æœ‰è€… | ç†ç”± |
|--------------|--------|------|
| æŠ•ç¨¿ï¼ˆPostï¼‰ | VoiceDrive | VoiceDriveç‹¬è‡ªã®æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ  |
| æŠ•ç¥¨ï¼ˆPollï¼‰ | VoiceDrive | ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹å°‚ç”¨æ©Ÿèƒ½ |
| ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆEventï¼‰ | VoiceDrive | ãƒ•ãƒªãƒ¼ãƒœã‚¤ã‚¹å°‚ç”¨æ©Ÿèƒ½ |
| ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | VoiceDrive | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å‡¦ç†ã€DBã«ã¯å»ºè¨­æ€§ã‚¹ã‚³ã‚¢ã®ã¿ä¿å­˜ |
| ãƒ‡ãƒ¼ã‚¿åŒæ„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | VoiceDrive | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ„ç®¡ç†ï¼ˆUserConsentãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº: ä¸è¦

- **æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿**: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¸ã®åŒæœŸä¸è¦
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±**: authorIdã®ã¿ã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã®employeeIdã¨ã¯ç‹¬ç«‹
- **Webhook**: ä¸è¦

---

## âŒ ä¸è¶³é …ç›®ã®æ´—ã„å‡ºã—

### 1. ä¸è¶³API

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | æ©Ÿèƒ½ | çŠ¶æ…‹ |
|--------------|---------|------|------|
| `/api/posts` | POST | æŠ•ç¨¿ä½œæˆ | âŒ **æœªå®Ÿè£…** |

**å®Ÿè£…è¦ä»¶ - POST /api/posts**:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£
{
  // åŸºæœ¬æƒ…å ±
  type: 'improvement' | 'community' | 'report',
  content: string,
  anonymityLevel: string,

  // improvementå°‚ç”¨
  proposalType?: 'operational' | 'communication' | 'innovation' | 'strategic',
  priority?: 'low' | 'medium' | 'high' | 'urgent',

  // communityå°‚ç”¨
  freespaceCategory?: 'idea_sharing' | 'casual_discussion' | 'event_planning',
  freespaceScope?: 'SAME_DEPARTMENT' | 'SAME_FACILITY' | 'ORGANIZATION_WIDE',
  expirationDate?: string (ISO 8601),
  pollData?: {
    question: string,
    description?: string,
    options: Array<{ text: string, emoji?: string }>,
    deadline: string (ISO 8601),
    allowMultiple: boolean,
    showResults: 'always' | 'after_voting' | 'after_deadline',
    category: string,
    scope: string
  },
  eventData?: {
    title: string,
    description: string,
    type: string,
    proposedDates: Array<{ date: string, startTime: string, endTime: string }>,
    maxParticipants?: number,
    venueName?: string,
    venueAddress?: string,
    cost?: number,
    requirements?: any,
    visibility: string
  },

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  season: string,
  moderationScore: number
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  success: boolean,
  data: {
    id: string,
    type: string,
    content: string,
    authorId: string,
    anonymityLevel: string,
    createdAt: string,
    // ...ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  },
  message?: string
}
```

**å®Ÿè£…ç®‡æ‰€**: `src/routes/apiRoutes.ts` ã¾ãŸã¯æ–°è¦ `src/routes/postRoutes.ts`

### 2. ä¸è¶³ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

Prisma schemaã®æ¤œè¨¼çµæœ: âœ… **ã™ã¹ã¦æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚«ãƒãƒ¼æ¸ˆã¿**

### 3. ä¸è¶³ãƒ†ãƒ¼ãƒ–ãƒ«

âœ… **ã™ã¹ã¦å®Ÿè£…æ¸ˆã¿**:
- Post
- Poll + PollOption + PollVote
- Event + ProposedDate + Participant

### 4. ç¢ºèªãŒå¿…è¦ãªé …ç›®

| é …ç›® | ç¾çŠ¶ | ç¢ºèªå†…å®¹ |
|------|------|---------|
| DataConsentModal | useDataConsent hookã‚ã‚Š | UserConsentãƒ†ãƒ¼ãƒ–ãƒ«ã®å®Ÿè£…ç¢ºèª |
| ClientModerationService | ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã‚ã‚Š | moderationScoreã®DBä¿å­˜ç¢ºèª |
| SeasonalCapacityIndicator | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚ã‚Š | å­£ç¯€åˆ¥ã®æŠ•ç¨¿ä¸Šé™æ©Ÿèƒ½ã®ç¢ºèª |

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 1. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**å®Ÿè£…ç®‡æ‰€**: `src/services/ClientModerationService.ts`

```typescript
class ClientModerationService {
  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒã‚§ãƒƒã‚¯ï¼ˆ300ms debounceï¼‰
  checkContentRealtime(content: string, callback: (result: ModerationResult) => void): void

  // é•åæ¤œçŸ¥
  moderateContent(content: string, title?: string): ModerationResult

  // å»ºè¨­æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆ0-100ï¼‰
  assessConstructiveness(content: string): number

  // ä»£æ›¿è¡¨ç¾ææ¡ˆ
  suggestAlternatives(phrase: string): string[]

  // æ”¹å–„ææ¡ˆç”Ÿæˆ
  generateImprovementSuggestions(content: string, violations: Violation[]): string[]
}
```

**é•åãƒ¬ãƒ™ãƒ«**:
- `critical`: æŠ•ç¨¿ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆãƒ»å€‹äººæ”»æ’ƒãƒ»æ³•çš„ãƒªã‚¹ã‚¯ï¼‰
- `high`: è­¦å‘Šè¡¨ç¤º
- `medium`: æ³¨æ„å–šèµ·
- `low`: æ”¹å–„ææ¡ˆã®ã¿

### 2. åŒ¿åæ€§ãƒ¬ãƒ™ãƒ«

| ãƒ¬ãƒ™ãƒ« | è¡¨ç¤ºå†…å®¹ | åˆ¶é™ |
|--------|---------|------|
| `real_name` | å®Ÿå + éƒ¨ç½² + è·ç¨® | - |
| `facility_department` | æ–½è¨­å + éƒ¨ç½²å | - |
| `facility_anonymous` | æ–½è¨­å + åŒ¿å | - |
| `department_only` | éƒ¨ç½²åã®ã¿ | - |
| `anonymous` | å®Œå…¨åŒ¿å | reportæŠ•ç¨¿æ™‚ã¯å¼·åˆ¶ |

### 3. ãƒ‡ãƒ¼ã‚¿åŒæ„ç®¡ç†

**åˆå›æŠ•ç¨¿æ™‚ã®ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º**:
- `shouldShowModal`: åˆå›æŠ•ç¨¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦true
- `updateConsent()`: åŒæ„/æ‹’å¦ã‚’ä¿å­˜
- `refreshStatus()`: åŒæ„çŠ¶æ…‹ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥

**ä¿å­˜å†…å®¹**:
- analyticsConsent: boolean
- consentDate: DateTime
- userId: string

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

### 1. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- **Debounce**: 300ms
- **å‡¦ç†æ™‚é–“**: < 50ms (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰)
- **UIå½±éŸ¿**: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã®ãƒ©ã‚°ãªã—

### 2. æŠ•ç¨¿ä½œæˆAPI

- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **: < 500ms
- **åŒæ™‚æŠ•ç¨¿**: 100req/minæƒ³å®š
- **ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º**: contentæœ€å¤§500æ–‡å­—

### 3. Poll/Eventä½œæˆ

- **Poll**: æœ€å¤§20ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- **Event**: æœ€å¤§10å€‹ã®å€™è£œæ—¥ç¨‹
- **åŒæ™‚ä½œæˆ**: Postã¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§ä¸€æ‹¬ä½œæˆ

---

## ğŸ¨ UI/UXè¦ä»¶

### 1. ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼

- improvement: 4ã‚¹ãƒ†ãƒƒãƒ—
- community/report: 3ã‚¹ãƒ†ãƒƒãƒ—
- ç¾åœ¨ã‚¹ãƒ†ãƒƒãƒ—ã‚’é’è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

| é …ç›® | ãƒ«ãƒ¼ãƒ« | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|------|--------|----------------|
| content | æœ€å°10æ–‡å­— | ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³disabled |
| content | æœ€å¤§500æ–‡å­— | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—æ•°è¡¨ç¤º |
| åŒ¿åæ€§ãƒ¬ãƒ™ãƒ« | reportæ™‚ã¯anonymouså¼·åˆ¶ | ä»–ã®é¸æŠè‚¢ã‚’disabled |
| ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | criticalé•å | ã€ŒæŠ•ç¨¿å†…å®¹ã«ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³é•åã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€ |
| å­£ç¯€åˆ¥ä¸Šé™ | ä¸Šé™åˆ°é” | ã€Œ{season}æœŸã®ææ¡ˆå—ä»˜ä¸Šé™ã«é”ã—ã¦ã„ã¾ã™ã€ |

### 3. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

- **æˆåŠŸ**: alert('æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼')
- **ã‚¨ãƒ©ãƒ¼**: alert(ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
- **å»ºè¨­æ€§ã‚¹ã‚³ã‚¢**: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆç·‘/é»„/èµ¤ï¼‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è­¦å‘Š**: é•åé …ç›® + ä»£æ›¿è¡¨ç¾ææ¡ˆ

---

## ğŸ“ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/pages/ComposePage.tsx` - ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ
- `src/components/ComposeForm.tsx` - ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
- `src/components/FreespaceOptions.tsx` - ãƒ•ãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¹è¨­å®š
- `src/components/consent/DataConsentModal.tsx` - ãƒ‡ãƒ¼ã‚¿åŒæ„ãƒ¢ãƒ¼ãƒ€ãƒ«
- `src/components/SeasonalCapacityIndicator.tsx` - å­£ç¯€åˆ¥å®¹é‡ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
- `src/components/ProposalEchoCard.tsx` - éå»ã®ææ¡ˆè¡¨ç¤º

### ã‚µãƒ¼ãƒ“ã‚¹
- `src/services/ClientModerationService.ts` - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- `src/services/ContentModerationService.ts` - ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
- `src/services/FreespaceExpirationService.ts` - æœ‰åŠ¹æœŸé™è¨ˆç®—

### ãƒ•ãƒƒã‚¯
- `src/hooks/useDataConsent.ts` - ãƒ‡ãƒ¼ã‚¿åŒæ„ç®¡ç†
- `src/hooks/useSeasonalCapacity.ts` - å­£ç¯€åˆ¥å®¹é‡ç®¡ç†

### å‹å®šç¾©
- `src/types/index.ts` - Post, Priority, AnonymityLevel, ProposalType
- `src/types/poll.ts` - Poll, PollOption, CreatePollData
- `src/types/event.ts` - Event, CreateEventData
- `src/types/visibility.ts` - StakeholderGroup

### è¨­å®š
- `src/config/proposalTypes.ts` - ææ¡ˆã‚¿ã‚¤ãƒ—è¨­å®š

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: APIå®Ÿè£…ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

1. **POST /api/posts ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - Postãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
   - Poll/EventåŒæ™‚ä½œæˆï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Phase 2: ãƒ‡ãƒ¼ã‚¿åŒæ„æ©Ÿèƒ½ç¢ºèªï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

1. UserConsentãƒ†ãƒ¼ãƒ–ãƒ«ã®å®Ÿè£…ç¢ºèª
2. useDataConsent hookã®å‹•ä½œç¢ºèª
3. DataConsentModalã®çµ±åˆãƒ†ã‚¹ãƒˆ

### Phase 3: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

1. 3ç¨®é¡ã®æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã®E2Eãƒ†ã‚¹ãƒˆ
2. Pollä½œæˆãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
3. Eventä½œæˆãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
4. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç²¾åº¦ç¢ºèª

---

## ğŸ“ é€£çµ¡å…ˆ

- **æŠ€è¡“çš„ãªè³ªå•**: VoiceDriveãƒãƒ¼ãƒ  (Slack #voicedrive-dev)
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…±æœ‰**: mcp-sharedçµŒç”±

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ26æ—¥
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: APIå®Ÿè£…å®Œäº†å¾Œ
