# æŠ•ç¨¿è¿½è·¡ï¼ˆPost Trackingï¼‰DBè¦ä»¶åˆ†æ

**æ–‡æ›¸ç•ªå·**: PT-DB-2025-1009-001
**ä½œæˆæ—¥**: 2025å¹´10æœˆ9æ—¥
**ä½œæˆè€…**: VoiceDriveãƒãƒ¼ãƒ 
**å¯¾è±¡æ©Ÿèƒ½**: æŠ•ç¨¿è¿½è·¡ï¼ˆå€‹äººãƒ»éƒ¨ç½²ãƒ»æ–½è¨­ãƒ»æ³•äººï¼‰
**é‡è¦åº¦**: ğŸ”´ è¶…é‡è¦
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è©³ç´°åˆ†æå®Œäº†

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### æ©Ÿèƒ½æ¦‚è¦

æŠ•ç¨¿è¿½è·¡æ©Ÿèƒ½ã¯ã€è·å“¡ãŒè‡ªèº«ã®æŠ•ç¨¿ãƒ»æŠ•ç¥¨ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæ´»å‹•ã‚’**6æ®µéšè­°é¡ŒåŒ–ãƒ¬ãƒ™ãƒ«ã”ã¨ã«è¿½è·¡**ã§ãã‚‹æœ€é‡è¦æ©Ÿèƒ½ã§ã™ã€‚

**ä¸»è¦æ©Ÿèƒ½**:
1. **å€‹äººè¿½è·¡** - æŠ•ç¨¿ãƒ»æŠ•ç¥¨ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸè­°é¡Œã®é€²æ—ã‚’å€‹åˆ¥è¿½è·¡
2. **éƒ¨ç½²è¿½è·¡** - ãƒãƒ¼ãƒ ã”ã¨ã®æŠ•ç¨¿å“è³ªãƒ»æ¡ç”¨ç‡ãƒ»ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆåˆ†æ
3. **æ–½è¨­è¿½è·¡** - éƒ¨ç½²é–“æ¯”è¼ƒãƒ»ROIåˆ†æãƒ»ãƒªã‚¹ã‚¯æ¤œå‡ºãƒ»æˆ¦ç•¥æ•´åˆæ€§
4. **æ³•äººè¿½è·¡** - æ–½è¨­é–“ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ»è²¡å‹™ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãƒ»ç«¶äº‰åŠ›åˆ†æ

**6æ®µéšè­°é¡ŒåŒ–ãƒ¬ãƒ™ãƒ«**:
- **PENDING** (0-29ç‚¹): æ¤œè¨ä¸­ï¼ˆéƒ¨ç½²å†…ï¼‰
- **DEPT_REVIEW** (30-49ç‚¹): éƒ¨ç½²æ¤œè¨
- **DEPT_AGENDA** (50-99ç‚¹): éƒ¨ç½²è­°é¡Œ
- **FACILITY_AGENDA** (100-299ç‚¹): æ–½è¨­è­°é¡Œï¼ˆå§”å“¡ä¼šæå‡ºå¯èƒ½ï¼‰
- **CORP_REVIEW** (300-599ç‚¹): æ³•äººæ¤œè¨
- **CORP_AGENDA** (600ç‚¹ä»¥ä¸Š): æ³•äººè­°é¡Œï¼ˆç†äº‹ä¼šæå‡ºãƒ¬ãƒ™ãƒ«ï¼‰

### ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»ã®åŸå‰‡

ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸ï¼ˆDM-DEF-2025-1008-001ï¼‰ã«åŸºã¥ãï¼š

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | æä¾›æ–¹æ³• |
|-----------|-----------|-------------|---------|
| **æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿** | âœ… ãƒã‚¹ã‚¿ | âŒ | - |
| **æŠ•ç¥¨å±¥æ­´** | âœ… ãƒã‚¹ã‚¿ | âŒ | - |
| **ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´** | âœ… ãƒã‚¹ã‚¿ | âŒ | - |
| **è­°é¡Œãƒ¬ãƒ™ãƒ«å±¥æ­´** | âœ… ãƒã‚¹ã‚¿ | âŒ | - |
| **æ´»å‹•ã‚¤ãƒ™ãƒ³ãƒˆ** | âœ… ãƒã‚¹ã‚¿ | âŒ | - |
| **è·å“¡æƒ…å ±** | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | API |
| **éƒ¨ç½²ãƒ»æ–½è¨­ãƒã‚¹ã‚¿** | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | API |

**åŸå‰‡**: æŠ•ç¨¿è¿½è·¡ãƒ‡ãƒ¼ã‚¿ã¯VoiceDrive 100%ç®¡è½„ã€è·å“¡ãƒ»çµ„ç¹”ãƒã‚¹ã‚¿ã®ã¿åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å–å¾—

---

## ğŸ¯ ç¾çŠ¶åˆ†æ

### A. IdeaVoiceTracking.tsx æ©Ÿèƒ½è©³ç´°ï¼ˆè­°é¡Œãƒ¢ãƒ¼ãƒ‰ï¼‰

**ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º**: 281è¡Œ

#### 1. ç”»é¢æ§‹æˆ

```
ãƒ˜ãƒƒãƒ€ãƒ¼ã€ŒæŠ•ç¨¿ã®è¿½è·¡ã€
  â†“
çµ±è¨ˆã‚µãƒãƒªãƒ¼ï¼ˆTrackingStatsï¼‰
  - æŠ•ç¨¿æ•°
  - æŠ•ç¥¨æ•°
  - ã‚³ãƒ¡ãƒ³ãƒˆæ•°
  - æ˜‡æ ¼æ¸ˆã¿ï¼ˆè­°é¡Œãƒ¬ãƒ™ãƒ«åˆ°é”æ•°ï¼‰
  â†“
3ã‚¿ãƒ–åˆ‡æ›¿
  - ğŸ“ æŠ•ç¨¿ã—ãŸè­°é¡Œ
  - ğŸ—³ï¸ æŠ•ç¥¨ã—ãŸè­°é¡Œ
  - ğŸ’¬ å‚åŠ ã—ãŸè­°é¡Œ
  â†“
å„ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  â†“
TrackingPostCardï¼ˆæŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ï¼‰
```

#### 2. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒ­ãƒ¼ (lines 26-38)

```typescript
useEffect(() => {
  if (activeUser) {
    loadTrackingData();
  }
}, [activeUser]);

const loadTrackingData = () => {
  // TODO: å®Ÿéš›ã®APIå®Ÿè£…
  // ä»®ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
  setMyPosts(getDemoMyPosts());
  setVotedPosts(getDemoVotedPosts());
  setCommentedPosts(getDemoCommentedPosts());
};
```

**å¿…è¦ãªAPI**:
1. `GET /api/my/posts` - è‡ªåˆ†ã®æŠ•ç¨¿ä¸€è¦§
2. `GET /api/my/voted-posts` - æŠ•ç¥¨ã—ãŸæŠ•ç¨¿ä¸€è¦§
3. `GET /api/my/commented-posts` - ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸæŠ•ç¨¿ä¸€è¦§

#### 3. è­°é¡Œãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (lines 40-48)

```typescript
const getAgendaLevel = (score: number): AgendaLevel => {
  if (score >= 600) return 'CORP_AGENDA';      // 600ç‚¹ä»¥ä¸Š
  if (score >= 300) return 'CORP_REVIEW';      // 300-599ç‚¹
  if (score >= 100) return 'FACILITY_AGENDA';  // 100-299ç‚¹
  if (score >= 50) return 'DEPT_AGENDA';       // 50-99ç‚¹
  if (score >= 30) return 'DEPT_REVIEW';       // 30-49ç‚¹
  return 'PENDING';                             // 0-29ç‚¹
};
```

#### 4. æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿è¨ˆç®— (lines 50-79)

```typescript
const getPostData = (post: Post) => {
  // ã‚¹ã‚³ã‚¢è¨ˆç®—
  const currentScore = calculateScore(
    convertVotesToEngagements(post.votes || {}),
    post.proposalType
  );

  // è­°é¡Œãƒ¬ãƒ™ãƒ«åˆ¤å®š
  const agendaLevel = getAgendaLevel(currentScore);

  // æ¨©é™åˆ¤å®š
  const permissions = agendaVisibilityEngine.getPermissions(
    post,
    activeUser!,
    currentScore
  );

  // æŠ•ç¥¨çµ±è¨ˆ
  const totalVotes = Object.values(post.votes).reduce((sum, count) => sum + count, 0);
  const supportVotes = (post.votes['strongly-support'] || 0) + (post.votes['support'] || 0);
  const supportRate = totalVotes > 0 ? Math.round((supportVotes / totalVotes) * 100) : 0;

  return {
    currentScore,
    agendaLevel,
    permissions,
    totalVotes,
    supportRate
  };
};
```

### B. TrackingPostCard.tsx æ©Ÿèƒ½è©³ç´°

**ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º**: 148è¡Œ

#### 1. è¡¨ç¤ºå†…å®¹ (lines 54-116)

```
æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ60æ–‡å­—ã¾ã§ï¼‰
  â†“
ç¾åœ¨åœ°ãƒãƒƒã‚¸ï¼ˆå¤§ããç›®ç«‹ã¤ï¼‰
  - è­°é¡Œãƒ¬ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ + åç§°
  - ç¾åœ¨ã‚¹ã‚³ã‚¢
  â†“
é€²æ—ãƒãƒ¼ï¼ˆTrackingProgressBarï¼‰
  - æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ã®é€²æ—
  - æ®‹ã‚Šå¿…è¦ç‚¹æ•°
  â†“
æ´»å‹•ã‚µãƒãƒªãƒ¼
  - ğŸ‘ æŠ•ç¥¨æ•°
  - ğŸ“Š æ”¯æŒç‡
  - ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆæ•°
  â†“
æœ€æ–°ã®å‹•ãï¼ˆ3ä»¶ï¼‰
  - ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
  - ğŸ‘ æ–°è¦æŠ•ç¥¨
  - ğŸ“Š ãƒ¬ãƒ™ãƒ«æ˜‡æ ¼
  â†“
ã€Œå…¨ã¦ã®å‹•ãã‚’è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³
  â†“ å±•é–‹
ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼ˆTrackingTimelineï¼‰
```

#### 2. è­°é¡Œãƒ¬ãƒ™ãƒ«è¨­å®š (lines 30-38)

```typescript
const levelConfig = {
  'PENDING': {
    label: 'æ¤œè¨ä¸­',
    icon: 'ğŸ’­',
    color: 'gray',
    bgColor: 'bg-gray-500/20',
    borderColor: 'border-gray-500/30'
  },
  'DEPT_REVIEW': {
    label: 'éƒ¨ç½²æ¤œè¨',
    icon: 'ğŸ“‹',
    color: 'blue',
    bgColor: 'bg-blue-500/20',
    borderColor: 'border-blue-500/30'
  },
  'DEPT_AGENDA': {
    label: 'éƒ¨ç½²è­°é¡Œ',
    icon: 'ğŸ‘¥',
    color: 'green',
    bgColor: 'bg-green-500/20',
    borderColor: 'border-green-500/30'
  },
  'FACILITY_AGENDA': {
    label: 'æ–½è¨­è­°é¡Œ',
    icon: 'ğŸ¥',
    color: 'yellow',
    bgColor: 'bg-yellow-500/20',
    borderColor: 'border-yellow-500/30'
  },
  'CORP_REVIEW': {
    label: 'æ³•äººæ¤œè¨',
    icon: 'ğŸ¢',
    color: 'orange',
    bgColor: 'bg-orange-500/20',
    borderColor: 'border-orange-500/30'
  },
  'CORP_AGENDA': {
    label: 'æ³•äººè­°é¡Œ',
    icon: 'ğŸ›ï¸',
    color: 'pink',
    bgColor: 'bg-pink-500/20',
    borderColor: 'border-pink-500/30'
  }
}[postData.agendaLevel];
```

### C. TrackingTimeline.tsx æ©Ÿèƒ½è©³ç´°

**ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º**: 206è¡Œ

#### 1. ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ— (lines 10-21)

```typescript
interface TimelineEvent {
  id: string;
  type: 'post_created' | 'comment_added' | 'vote_received' | 'level_upgraded';
  timestamp: string;
  description: string;
  details?: string;
  userName?: string;
  voteType?: string;
  points?: number;
  fromLevel?: string;
  toLevel?: string;
}
```

#### 2. ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© (lines 58-90)

```typescript
const getEventStyle = (type: TimelineEvent['type']) => {
  const styles = {
    post_created: {
      icon: <FileText className="w-4 h-4" />,
      bgColor: 'bg-blue-500/20',
      borderColor: 'border-blue-500',
      textColor: 'text-blue-400',
      label: 'æŠ•ç¨¿'
    },
    comment_added: {
      icon: <MessageSquare className="w-4 h-4" />,
      bgColor: 'bg-green-500/20',
      borderColor: 'border-green-500',
      textColor: 'text-green-400',
      label: 'ã‚³ãƒ¡ãƒ³ãƒˆ'
    },
    vote_received: {
      icon: <ThumbsUp className="w-4 h-4" />,
      bgColor: 'bg-purple-500/20',
      borderColor: 'border-purple-500',
      textColor: 'text-purple-400',
      label: 'æŠ•ç¥¨'
    },
    level_upgraded: {
      icon: <ArrowUp className="w-4 h-4" />,
      bgColor: 'bg-yellow-500/20',
      borderColor: 'border-yellow-500',
      textColor: 'text-yellow-400',
      label: 'ãƒ¬ãƒ™ãƒ«æ˜‡æ ¼'
    }
  };
  return styles[type];
};
```

#### 3. ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¡¨ç¤º (lines 92-112)

```typescript
const formatTimestamp = (timestamp: string) => {
  const date = new Date(timestamp);
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);

  if (diffMins < 1) return 'ãŸã£ãŸä»Š';
  if (diffMins < 60) return `${diffMins}åˆ†å‰`;
  if (diffHours < 24) return `${diffHours}æ™‚é–“å‰`;
  if (diffDays < 7) return `${diffDays}æ—¥å‰`;

  return date.toLocaleDateString('ja-JP', {
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};
```

### D. UserActivityService.ts æ©Ÿèƒ½è©³ç´°

**ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º**: 260è¡Œ

#### 1. æŠ•ç¥¨çµ±è¨ˆå–å¾— (lines 26-57)

```typescript
export async function getUserVoteStats(userId: string): Promise<VoteStats> {
  const now = new Date();
  const thisMonthStart = startOfMonth(now);

  // ç·æŠ•ç¥¨æ•°
  const totalVotes = await prisma.voteHistory.count({
    where: { userId }
  });

  // ä»Šæœˆã®æŠ•ç¥¨æ•°
  const thisMonthVotes = await prisma.voteHistory.count({
    where: {
      userId,
      votedAt: { gte: thisMonthStart }
    }
  });

  // å½±éŸ¿åŠ›ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆæŠ•ç¥¨é‡ã¿ã®åˆè¨ˆ Ã— 2ã€æœ€å¤§100ï¼‰
  const votes = await prisma.voteHistory.findMany({
    where: { userId },
    select: { voteWeight: true }
  });

  const totalWeight = votes.reduce((sum, v) => sum + v.voteWeight, 0);
  const impactScore = Math.min(100, Math.round(totalWeight * 2));

  return {
    total: totalVotes,
    thisMonth: thisMonthVotes,
    impactScore
  };
}
```

#### 2. ã‚«ãƒ†ã‚´ãƒªåˆ¥æŠ•ç¥¨çµ±è¨ˆ (lines 63-79)

```typescript
export async function getVoteStatsByCategory(userId: string): Promise<CategoryStats> {
  const votes = await prisma.voteHistory.groupBy({
    by: ['postCategory'],
    where: {
      userId,
      postCategory: { not: null }
    },
    _count: { id: true }
  });

  return {
    improvement: votes.find(v => v.postCategory === 'improvement')?._count.id || 0,
    communication: votes.find(v => v.postCategory === 'communication')?._count.id || 0,
    innovation: votes.find(v => v.postCategory === 'innovation')?._count.id || 0,
    strategy: votes.find(v => v.postCategory === 'strategy')?._count.id || 0,
  };
}
```

#### 3. æŠ•ç¥¨æ¸ˆã¿æŠ•ç¨¿ä¸€è¦§å–å¾— (lines 86-112)

```typescript
export async function getUserVotedPosts(userId: string, limit: number = 50) {
  const votedPosts = await prisma.voteHistory.findMany({
    where: { userId },
    include: {
      post: {
        include: {
          author: {
            select: {
              id: true,
              name: true,
              department: true,
              avatar: true
            }
          }
        }
      }
    },
    orderBy: { votedAt: 'desc' },
    take: limit
  });

  return votedPosts.map(v => ({
    ...v.post,
    userVote: v.voteOption,
    votedAt: v.votedAt
  }));
}
```

### E. éƒ¨ç½²ãƒ»æ–½è¨­ãƒ»æ³•äººè¿½è·¡æ©Ÿèƒ½

#### 1. DepartmentPostingAnalytics.tsxï¼ˆéƒ¨ç½²è¿½è·¡ï¼‰

**è¡¨ç¤ºå†…å®¹**:
- ãƒãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ã€ãƒ¡ãƒ³ãƒãƒ¼æ•°ã€æŠ•ç¨¿æ•°ã€æ¡ç”¨ç‡ã€ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆï¼‰
- ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆæŠ•ç¨¿æ–‡åŒ–ã€ãƒ¡ãƒ³ãƒãƒ¼è‚²æˆã€é©æ–°ã‚¹ã‚³ã‚¢ï¼‰
- ææ¡ˆå“è³ªï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥æ¡ç”¨ç‡ã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚¹ã‚³ã‚¢ã€æˆ¦ç•¥æ•´åˆæ€§ï¼‰
- ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆå¥å…¨æ€§ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–æŠ•ç¨¿è€…æ•°ã€éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
- ã‚¯ãƒ­ã‚¹ãƒãƒ¼ãƒ èª²é¡Œï¼ˆè¤‡æ•°ãƒãƒ¼ãƒ å…±é€šèª²é¡Œã€å„ªå…ˆåº¦ã€ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¦å¦ï¼‰

#### 2. FacilityPostingAnalytics.tsxï¼ˆæ–½è¨­è¿½è·¡ï¼‰

**è¡¨ç¤ºå†…å®¹**:
- æ–½è¨­KPIï¼ˆæŠ•ç¨¿æ´»æ€§åº¦ã€æ”¹å–„å®Ÿç¾ç‡ã€è·å“¡å‚åŠ ç‡ã€æˆ¦ç•¥æ•´åˆæ€§ï¼‰
- éƒ¨ç½²ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆç·æŠ•ç¨¿æ•°ã€æ¡ç”¨ç‡ã€ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ã€é©æ–°åº¦ï¼‰
- ROIãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæŠ•è³‡é¡ã€æœŸå¾…ROIã€å®Ÿç¸¾ROIã€å›åæœŸé–“ï¼‰
- ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«èª²é¡Œï¼ˆãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã€æ‚£è€…å®‰å…¨ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€è²¡å‹™ï¼‰
- ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆãƒãƒ¼ãƒ è‚²æˆã€é©æ–°ä¿ƒé€²ã€æ–‡åŒ–æ¨é€²ã€æˆ¦ç•¥æ•´åˆæ€§ï¼‰

#### 3. CorporatePostingAnalytics.tsxï¼ˆæ³•äººè¿½è·¡ï¼‰

**è¡¨ç¤ºå†…å®¹**:
- æ–½è¨­ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆæ”¹å–„ãƒ©ãƒ³ã‚¯ã€åç›Šè²¢çŒ®ã€åç›Šæ€§ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã€ãƒ–ãƒ©ãƒ³ãƒ‰è²¢çŒ®ã€ç«¶äº‰å„ªä½æ€§ï¼‰
- è²¡å‹™ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆï¼ˆæŠ•è³‡é¡ã€å®Ÿç¾å‰Šæ¸›ã€ROIã€å›åæœŸé–“ã€NPVã€ãƒªã‚¹ã‚¯èª¿æ•´ãƒªã‚¿ãƒ¼ãƒ³ï¼‰
- ç«¶äº‰åˆ†æï¼ˆæ¥­ç•Œå¹³å‡æ¯”è¼ƒã€ãƒˆãƒƒãƒ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ¼æ¯”è¼ƒã€ç«¶äº‰ã‚®ãƒ£ãƒƒãƒ—ã€æˆ¦ç•¥é‡è¦åº¦ï¼‰
- M&Açµ±åˆï¼ˆæ–‡åŒ–åŒåŒ–ã€æ”¹å–„æ¡ç”¨ç‡ã€ã‚·ãƒŠã‚¸ãƒ¼å®Ÿç¾ã€çµ±åˆèª²é¡Œï¼‰

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹ï¼ˆæŠ•ç¨¿è¿½è·¡å°‚ç”¨ï¼‰

### ã‚«ãƒ†ã‚´ãƒªA: æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | å‚™è€ƒ |
|-----------|-----------|-------------|------------|------|
| æŠ•ç¨¿ID (id) | âœ… ç”Ÿæˆ | âŒ | VoiceDriveç®¡è½„ | cuid() |
| æŠ•ç¨¿å†…å®¹ (content) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æŠ•ç¨¿ã‚¿ã‚¤ãƒ— (type) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | improvement/community/report |
| ææ¡ˆã‚¿ã‚¤ãƒ— (proposalType) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | operational/communication/innovation/strategic |
| è­°é¡Œã‚¹ã‚³ã‚¢ (agendaScore) | âœ… è¨ˆç®— | âŒ | VoiceDriveç®¡è½„ | æŠ•ç¥¨ã‹ã‚‰è‡ªå‹•è¨ˆç®— |
| è­°é¡Œãƒ¬ãƒ™ãƒ« (agendaLevel) | âœ… åˆ¤å®š | âŒ | VoiceDriveç®¡è½„ | ã‚¹ã‚³ã‚¢ã‹ã‚‰è‡ªå‹•åˆ¤å®š |
| æŠ•ç¨¿è€…ID (authorId) | âœ… ä¿æŒ | âœ… ãƒã‚¹ã‚¿ | åŒæ–¹å‘ | è·å“¡ID |
| ä½œæˆæ—¥æ™‚ (createdAt) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |

**åŸå‰‡**: æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã¯VoiceDrive 100%ç®¡è½„

### ã‚«ãƒ†ã‚´ãƒªB: æŠ•ç¥¨å±¥æ­´

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | å‚™è€ƒ |
|-----------|-----------|-------------|------------|------|
| æŠ•ç¥¨ID (id) | âœ… ç”Ÿæˆ | âŒ | VoiceDriveç®¡è½„ | cuid() |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (userId) | âœ… ä¿æŒ | âœ… ãƒã‚¹ã‚¿ | åŒæ–¹å‘ | è·å“¡ID |
| æŠ•ç¨¿ID (postId) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æŠ•ç¥¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (voteOption) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | strongly-support/support/neutral/oppose/strongly-oppose |
| æŠ•ç¥¨é‡ã¿ (voteWeight) | âœ… è¨ˆç®— | âŒ | VoiceDriveç®¡è½„ | æ¨©é™ãƒ¬ãƒ™ãƒ«ã‹ã‚‰è¨ˆç®— |
| æŠ•ç¥¨æ—¥æ™‚ (votedAt) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |

**åŸå‰‡**: æŠ•ç¥¨å±¥æ­´ã¯VoiceDrive 100%ç®¡è½„

### ã‚«ãƒ†ã‚´ãƒªC: ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | å‚™è€ƒ |
|-----------|-----------|-------------|------------|------|
| ã‚³ãƒ¡ãƒ³ãƒˆID (id) | âœ… ç”Ÿæˆ | âŒ | VoiceDriveç®¡è½„ | cuid() |
| æŠ•ç¨¿ID (postId) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| ä½œæˆè€…ID (authorId) | âœ… ä¿æŒ | âœ… ãƒã‚¹ã‚¿ | åŒæ–¹å‘ | è·å“¡ID |
| ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ (content) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| ã‚³ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒ— (commentType) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | proposal/question/support/concern |
| ä½œæˆæ—¥æ™‚ (createdAt) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |

**åŸå‰‡**: ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´ã¯VoiceDrive 100%ç®¡è½„

### ã‚«ãƒ†ã‚´ãƒªD: è­°é¡Œãƒ¬ãƒ™ãƒ«å±¥æ­´

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | å‚™è€ƒ |
|-----------|-----------|-------------|------------|------|
| å±¥æ­´ID (id) | âœ… ç”Ÿæˆ | âŒ | VoiceDriveç®¡è½„ | æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ« |
| æŠ•ç¨¿ID (postId) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æ—§ãƒ¬ãƒ™ãƒ« (fromLevel) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æ–°ãƒ¬ãƒ™ãƒ« (toLevel) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æ—§ã‚¹ã‚³ã‚¢ (fromScore) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æ–°ã‚¹ã‚³ã‚¢ (toScore) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| æ˜‡æ ¼æ—¥æ™‚ (upgradedAt) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |

**åŸå‰‡**: è­°é¡Œãƒ¬ãƒ™ãƒ«å±¥æ­´ã¯VoiceDrive 100%ç®¡è½„ï¼ˆæ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«å¿…è¦ï¼‰

### ã‚«ãƒ†ã‚´ãƒªE: æ´»å‹•ã‚¤ãƒ™ãƒ³ãƒˆ

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | å‚™è€ƒ |
|-----------|-----------|-------------|------------|------|
| ã‚¤ãƒ™ãƒ³ãƒˆID (id) | âœ… ç”Ÿæˆ | âŒ | VoiceDriveç®¡è½„ | æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ« |
| æŠ•ç¨¿ID (postId) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |
| ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ— (eventType) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | post_created/comment_added/vote_received/level_upgraded |
| ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´° (eventData) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | JSON |
| ç™ºç”Ÿæ—¥æ™‚ (occurredAt) | âœ… ä¿æŒ | âŒ | VoiceDriveç®¡è½„ | - |

**åŸå‰‡**: æ´»å‹•ã‚¤ãƒ™ãƒ³ãƒˆã¯VoiceDrive 100%ç®¡è½„ï¼ˆæ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«å¿…è¦ï¼‰

### ã‚«ãƒ†ã‚´ãƒªF: è·å“¡ãƒ»çµ„ç¹”ãƒã‚¹ã‚¿ï¼ˆå‚ç…§ã®ã¿ï¼‰

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ | å‚™è€ƒ |
|-----------|-----------|-------------|------------|------|
| è·å“¡ID (employeeId) | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | åŒ»ç™‚ â†’ VoiceDrive | APIçµŒç”± |
| è·å“¡å (name) | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | åŒ»ç™‚ â†’ VoiceDrive | APIçµŒç”± |
| éƒ¨ç½² (department) | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | åŒ»ç™‚ â†’ VoiceDrive | APIçµŒç”± |
| æ–½è¨­ (facilityId) | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | åŒ»ç™‚ â†’ VoiceDrive | APIçµŒç”± |
| æ¨©é™ãƒ¬ãƒ™ãƒ« (permissionLevel) | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | åŒ»ç™‚ â†’ VoiceDrive | APIçµŒç”± |

**åŸå‰‡**: è·å“¡ãƒ»çµ„ç¹”ãƒã‚¹ã‚¿ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãŒç®¡ç†ã€VoiceDriveã¯APIçµŒç”±ã§å‚ç…§

---

## ğŸ—„ï¸ VoiceDriveå´ã®DBè¦ä»¶

### å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆPrisma Schemaï¼‰

#### 1. Postï¼ˆæŠ•ç¨¿ï¼‰- **æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ‹¡å¼µå¿…è¦ï¼‰**

**ç¾çŠ¶** (schema.prisma lines 417-468):
```prisma
model Post {
  id                    String    @id @default(cuid())

  // åŸºæœ¬æƒ…å ±
  type                  String    // 'improvement' | 'community' | 'report'
  content               String
  authorId              String
  anonymityLevel        String
  status                String    @default("active")

  // improvementæŠ•ç¨¿å°‚ç”¨
  proposalType          String?
  priority              String?

  // communityæŠ•ç¨¿å°‚ç”¨ï¼ˆãƒ•ãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
  freespaceCategory     String?
  freespaceScope        String?
  expirationDate        DateTime?
  isExpired             Boolean   @default(false)

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  // è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç”¨
  agendaScore           Int?      @default(0)
  agendaLevel           String?   // 'PENDING' | 'DEPT_REVIEW' | 'DEPT_AGENDA' | 'FACILITY_AGENDA'

  // ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±
  moderationStatus      String    @default("pending")
  moderationScore       Int?

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  author                User      @relation("PostAuthor", fields: [authorId], references: [id])
  votes                 Vote[]
  comments              Comment[]

  @@index([authorId])
  @@index([type])
  @@index([agendaLevel]) // è¿½åŠ æ¨å¥¨
  @@index([agendaScore]) // è¿½åŠ æ¨å¥¨
  @@index([createdAt])
}
```

**å¿…è¦ãªæ‹¡å¼µ**:
```prisma
model Post {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...

  // è­°é¡Œãƒ¢ãƒ¼ãƒ‰ç”¨ï¼ˆæ‹¡å¼µï¼‰
  agendaScore           Int?      @default(0)
  agendaLevel           String?   // 'PENDING' | 'DEPT_REVIEW' | 'DEPT_AGENDA' | 'FACILITY_AGENDA' | 'CORP_REVIEW' | 'CORP_AGENDA'
  currentLevelStartedAt DateTime? // è¿½åŠ : ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ã«ãªã£ãŸæ—¥æ™‚
  lastLevelUpgrade      DateTime? // è¿½åŠ : æœ€å¾Œã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ãŸæ—¥æ™‚

  // çµ±è¨ˆæƒ…å ±ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  totalVotes            Int       @default(0)        // è¿½åŠ 
  supportVotes          Int       @default(0)        // è¿½åŠ 
  supportRate           Int       @default(0)        // è¿½åŠ : 0-100
  uniqueVoters          Int       @default(0)        // è¿½åŠ 
  commentCount          Int       @default(0)        // è¿½åŠ 
  viewCount             Int       @default(0)        // è¿½åŠ 

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆè¿½åŠ ï¼‰
  levelHistory          AgendaLevelHistory[]  // è¿½åŠ 
  activityEvents        PostActivityEvent[]   // è¿½åŠ 

  @@index([agendaLevel])  // è¿½åŠ 
  @@index([agendaScore])  // è¿½åŠ 
  @@index([currentLevelStartedAt]) // è¿½åŠ 
}
```

#### 2. VoteHistoryï¼ˆæŠ•ç¥¨å±¥æ­´ï¼‰- **æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆOKï¼‰**

**ç¾çŠ¶** (schema.prisma lines 369-387):
```prisma
model VoteHistory {
  id            String    @id @default(cuid())
  userId        String
  postId        String
  voteOption    String    // "strongly-support" | "support" | "neutral" | "oppose" | "strongly-oppose"
  voteWeight    Float     @default(1.0)
  votedAt       DateTime  @default(now())
  postCategory  String?
  postType      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([userId])
  @@index([postId])
  @@index([votedAt])
}
```

**åˆ¤å®š**: âœ… æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒã§ååˆ†

#### 3. Commentï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰- **æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆOKï¼‰**

**ç¾çŠ¶** (schema.prisma lines 487-508):
```prisma
model Comment {
  id              String    @id @default(cuid())
  postId          String
  parentId        String?
  authorId        String
  content         String
  commentType     String
  anonymityLevel  String
  likes           Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  post            Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  parent          Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies         Comment[] @relation("CommentReplies")
  author          User      @relation("CommentAuthor", fields: [authorId], references: [id])

  @@index([postId])
  @@index([parentId])
  @@index([authorId])
}
```

**åˆ¤å®š**: âœ… æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒã§ååˆ†

#### 4. AgendaLevelHistoryï¼ˆè­°é¡Œãƒ¬ãƒ™ãƒ«å±¥æ­´ï¼‰- **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¿…é ˆï¼‰**

```prisma
model AgendaLevelHistory {
  id              String    @id @default(cuid())
  postId          String

  // ãƒ¬ãƒ™ãƒ«å¤‰æ›´
  fromLevel       String?   // PENDING, DEPT_REVIEW, DEPT_AGENDA, FACILITY_AGENDA, CORP_REVIEW, CORP_AGENDA
  toLevel         String    // PENDING, DEPT_REVIEW, DEPT_AGENDA, FACILITY_AGENDA, CORP_REVIEW, CORP_AGENDA

  // ã‚¹ã‚³ã‚¢è¨˜éŒ²
  fromScore       Int?
  toScore         Int

  // ãƒˆãƒªã‚¬ãƒ¼æƒ…å ±
  triggeredBy     String?   // vote_received, committee_submission, manual_upgrade
  triggeringUserId String?  // æ˜‡æ ¼ã®ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã£ãŸæŠ•ç¥¨è€…IDï¼ˆvote_receivedã®å ´åˆï¼‰

  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  upgradedAt      DateTime  @default(now())

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  notes           String?   // å‚™è€ƒï¼ˆæ‰‹å‹•æ˜‡æ ¼æ™‚ã®ç†ç”±ãªã©ï¼‰

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  post            Post      @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([toLevel])
  @@index([upgradedAt])
}
```

#### 5. PostActivityEventï¼ˆæŠ•ç¨¿æ´»å‹•ã‚¤ãƒ™ãƒ³ãƒˆï¼‰- **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¿…é ˆï¼‰**

```prisma
model PostActivityEvent {
  id              String    @id @default(cuid())
  postId          String

  // ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—
  eventType       String    // post_created, comment_added, vote_received, level_upgraded, committee_submitted

  // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ï¼ˆJSONï¼‰
  eventData       Json?     // {
                            //   userName?: string,
                            //   voteType?: string,
                            //   points?: number,
                            //   fromLevel?: string,
                            //   toLevel?: string,
                            //   commentId?: string,
                            //   voteId?: string
                            // }

  // ãƒˆãƒªã‚¬ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼
  triggeredByUserId String? // ã‚¤ãƒ™ãƒ³ãƒˆã‚’èµ·ã“ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼

  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  occurredAt      DateTime  @default(now())

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  post            Post      @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([eventType])
  @@index([occurredAt])
  @@index([triggeredByUserId])
}
```

#### 6. UserActivitySummaryï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ã‚µãƒãƒªãƒ¼ï¼‰- **æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆOKï¼‰**

**ç¾çŠ¶** (schema.prisma lines 390-410):
```prisma
model UserActivitySummary {
  id                    String    @id @default(cuid())
  userId                String    @unique
  totalPosts            Int       @default(0)
  totalVotes            Int       @default(0)
  thisMonthVotes        Int       @default(0)
  impactScore           Float     @default(0)
  feedbackReceived      Int       @default(0)
  feedbackSent          Int       @default(0)
  projectsProposed      Int       @default(0)
  surveysCompleted      Int       @default(0)
  loginDays             Int       @default(0)
  lastCalculatedAt      DateTime  @default(now())
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([lastCalculatedAt])
}
```

**è¿½åŠ æ¨å¥¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
```prisma
model UserActivitySummary {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...

  // è­°é¡Œãƒ¬ãƒ™ãƒ«åˆ°é”æ•°
  achievedPending       Int       @default(0) // è¿½åŠ 
  achievedDeptReview    Int       @default(0) // è¿½åŠ 
  achievedDeptAgenda    Int       @default(0) // è¿½åŠ 
  achievedFacilityAgenda Int      @default(0) // è¿½åŠ 
  achievedCorpReview    Int       @default(0) // è¿½åŠ 
  achievedCorpAgenda    Int       @default(0) // è¿½åŠ 

  // æœ€é«˜åˆ°é”ãƒ¬ãƒ™ãƒ«
  highestAgendaLevel    String?   // è¿½åŠ : CORP_AGENDA, CORP_REVIEW, etc.
  highestLevelReachedAt DateTime? // è¿½åŠ 
}
```

---

## ğŸ”Œ å¿…è¦ãªAPIè¦ä»¶ï¼ˆVoiceDriveå´ï¼‰

### API-PT-1: è‡ªåˆ†ã®æŠ•ç¨¿ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/my/posts`

**Query Parameters**:
- `limit` (number, optional): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
- `offset` (number, optional): ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
- `orderBy` (string, optional): ã‚½ãƒ¼ãƒˆé †ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `createdAt_desc`ï¼‰

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "post-001",
      "content": "å¤œå‹¤ã®å¼•ç¶™ãæ™‚é–“ã‚’15åˆ†å»¶é•·ã—ã¦ã€ã‚ˆã‚Šè©³ç´°ãªæ‚£è€…æƒ…å ±ã®å…±æœ‰ã‚’ã—ãŸã„",
      "type": "improvement",
      "proposalType": "operational",
      "agendaScore": 78,
      "agendaLevel": "DEPT_AGENDA",
      "currentLevelStartedAt": "2025-10-01T10:00:00Z",
      "totalVotes": 23,
      "supportVotes": 20,
      "supportRate": 87,
      "commentCount": 5,
      "viewCount": 145,
      "createdAt": "2025-09-25T14:30:00Z",
      "updatedAt": "2025-10-08T09:15:00Z"
    }
  ],
  "pagination": {
    "total": 125,
    "limit": 50,
    "offset": 0,
    "hasMore": true
  }
}
```

### API-PT-2: æŠ•ç¥¨ã—ãŸæŠ•ç¨¿ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/my/voted-posts`

**Query Parameters**:
- `limit` (number, optional): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
- `offset` (number, optional): ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "post-002",
      "content": "éƒ¨ç½²é–“ã®æƒ…å ±å…±æœ‰ã‚’å††æ»‘ã«ã™ã‚‹ãŸã‚ã€é€±1å›ã®åˆåŒãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ææ¡ˆ",
      "author": {
        "id": "user-123",
        "name": "ç”°ä¸­å¤ªéƒ",
        "department": "çœ‹è­·éƒ¨",
        "avatar": "https://example.com/avatar.jpg"
      },
      "agendaScore": 54,
      "agendaLevel": "DEPT_AGENDA",
      "userVote": "strongly-support",
      "votedAt": "2025-10-05T11:20:00Z",
      "totalVotes": 18,
      "supportRate": 83,
      "createdAt": "2025-09-28T09:00:00Z"
    }
  ],
  "pagination": {
    "total": 342,
    "limit": 50,
    "offset": 0,
    "hasMore": true
  }
}
```

### API-PT-3: ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸæŠ•ç¨¿ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/my/commented-posts`

**Query Parameters**:
- `limit` (number, optional): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
- `offset` (number, optional): ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "post-003",
      "content": "é›»å­ã‚«ãƒ«ãƒ†ã®å…¥åŠ›é …ç›®ã‚’è¦‹ç›´ã—ã€é‡è¤‡å…¥åŠ›ã‚’å‰Šæ¸›ã—ãŸã„",
      "author": {
        "id": "user-456",
        "name": "ä½è—¤èŠ±å­",
        "department": "æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ éƒ¨"
      },
      "agendaScore": 112,
      "agendaLevel": "FACILITY_AGENDA",
      "myComments": [
        {
          "id": "comment-001",
          "content": "ç¾å ´ã®çœ‹è­·å¸«ã¨ã—ã¦ã‚‚ã€ã“ã®ææ¡ˆã¯éå¸¸ã«åŠ©ã‹ã‚Šã¾ã™",
          "commentType": "support",
          "createdAt": "2025-10-03T15:40:00Z"
        }
      ],
      "totalVotes": 45,
      "supportRate": 76,
      "commentCount": 12,
      "createdAt": "2025-09-20T10:00:00Z"
    }
  ],
  "pagination": {
    "total": 89,
    "limit": 50,
    "offset": 0,
    "hasMore": true
  }
}
```

### API-PT-4: æŠ•ç¨¿ã®æ´»å‹•ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/posts/:postId/activity-events`

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "event-001",
      "eventType": "level_upgraded",
      "eventData": {
        "fromLevel": "DEPT_REVIEW",
        "toLevel": "DEPT_AGENDA",
        "fromScore": 48,
        "toScore": 52
      },
      "occurredAt": "2025-10-05T09:30:00Z"
    },
    {
      "id": "event-002",
      "eventType": "vote_received",
      "eventData": {
        "userName": "ç”°ä¸­å¤ªéƒ",
        "voteType": "strongly-support",
        "points": 5
      },
      "occurredAt": "2025-10-05T09:29:00Z"
    },
    {
      "id": "event-003",
      "eventType": "comment_added",
      "eventData": {
        "userName": "å±±ç”°èŠ±å­",
        "commentId": "comment-123"
      },
      "occurredAt": "2025-10-04T14:15:00Z"
    },
    {
      "id": "event-004",
      "eventType": "post_created",
      "occurredAt": "2025-09-25T14:30:00Z"
    }
  ]
}
```

### API-PT-5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ã‚µãƒãƒªãƒ¼å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/my/activity-summary`

**Response**:
```json
{
  "success": true,
  "data": {
    "posts": {
      "total": 125,
      "agenda": 98,
      "project": 27
    },
    "votes": {
      "total": 342,
      "thisMonth": 45,
      "impactScore": 87
    },
    "categories": {
      "improvement": 156,
      "communication": 89,
      "innovation": 67,
      "strategy": 30
    },
    "achievements": {
      "achievedPending": 125,
      "achievedDeptReview": 89,
      "achievedDeptAgenda": 67,
      "achievedFacilityAgenda": 23,
      "achievedCorpReview": 8,
      "achievedCorpAgenda": 2,
      "highestAgendaLevel": "CORP_AGENDA",
      "highestLevelReachedAt": "2025-08-15T10:30:00Z"
    },
    "feedback": {
      "received": 56,
      "sent": 34
    },
    "lastCalculatedAt": "2025-10-09T08:00:00Z"
  }
}
```

### API-PT-6: éƒ¨ç½²æŠ•ç¨¿åˆ†æå–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/department/:departmentId/posting-analytics`

**Query Parameters**:
- `period` (string): `month` | `quarter` | `year`

**Response**:
```json
{
  "success": true,
  "data": {
    "teams": [
      {
        "id": "team-001",
        "name": "å¤–æ¥çœ‹è­·ãƒãƒ¼ãƒ ",
        "leader": "å±±ç”°å¤ªéƒ",
        "memberCount": 12,
        "totalPosts": 156,
        "adoptedPosts": 98,
        "adoptionRate": 62.8,
        "avgEngagement": 85,
        "lastActivityDays": 1
      }
    ],
    "proposalQuality": [
      {
        "category": "æ¥­å‹™åŠ¹ç‡åŒ–",
        "count": 145,
        "adoptionRate": 72,
        "avgImpactScore": 85,
        "strategicAlignment": 90
      }
    ],
    "engagementHealth": {
      "totalActivePosters": 45,
      "newPostersThisMonth": 7,
      "inactiveMembers": 12,
      "postingDistribution": {
        "heavy": 8,
        "moderate": 15,
        "light": 22,
        "none": 12
      }
    }
  }
}
```

### API-PT-7: æ–½è¨­æŠ•ç¨¿åˆ†æå–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/facility/:facilityId/posting-analytics`

**Query Parameters**:
- `period` (string): `month` | `quarter` | `year`

**Response**:
```json
{
  "success": true,
  "data": {
    "kpis": [
      {
        "label": "å…¨ä½“æŠ•ç¨¿æ´»æ€§åº¦",
        "current": 89,
        "target": 85,
        "trend": "up",
        "change": "+5.2%",
        "status": "excellent"
      }
    ],
    "departmentMetrics": [
      {
        "id": "dept-001",
        "name": "çœ‹è­·éƒ¨",
        "head": "å±±ç”°å¤ªéƒ",
        "totalPosts": 456,
        "adoptionRate": 68,
        "engagement": 85,
        "strategicAlignment": 92,
        "riskScore": 15,
        "innovation": 78
      }
    ],
    "roiProjects": [
      {
        "id": "proj-001",
        "title": "é›»å­ã‚«ãƒ«ãƒ†å…¥åŠ›é …ç›®æœ€é©åŒ–",
        "department": "æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ éƒ¨",
        "investment": 1200000,
        "expectedROI": 250,
        "actualROI": 280,
        "status": "completed",
        "timeline": "2025å¹´4æœˆ-6æœˆ"
      }
    ]
  }
}
```

### API-PT-8: æ³•äººæŠ•ç¨¿åˆ†æå–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/corporate/posting-analytics`

**Query Parameters**:
- `period` (string): `quarter` | `year` | `multi_year`

**Response**:
```json
{
  "success": true,
  "data": {
    "facilityBenchmarks": [
      {
        "facilityId": "fac-001",
        "facilityName": "å°åŸç—…é™¢",
        "region": "ä¹å·",
        "size": "large",
        "improvementRank": 1,
        "revenueContribution": 3200000000,
        "profitabilityImpact": 8.5,
        "brandContribution": 92,
        "riskLevel": "low",
        "competitiveAdvantage": 88
      }
    ],
    "financialImpacts": [
      {
        "category": "ITãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–æ”¹å–„",
        "investmentAmount": 125500000,
        "realizedSavings": 289300000,
        "roi": 130.4,
        "paybackPeriod": 18,
        "npv": 156800000,
        "riskAdjustedReturn": 124.2
      }
    ]
  }
}
```

---

## âš™ï¸ å‹•çš„é–¾å€¤è¨­å®šã‚·ã‚¹ãƒ†ãƒ ï¼ˆå°†æ¥æ‹¡å¼µï¼‰

### èƒŒæ™¯

çµ„ç¹”æ”¹ç·¨ãƒ»éƒ¨ç½²çµ±å»ƒåˆãƒ»äººæ•°å¤‰å‹•ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€è­°é¡Œãƒ¬ãƒ™ãƒ«æ˜‡æ ¼ã®é–¾å€¤ã‚’**å‹•çš„ã«èª¿æ•´å¯èƒ½**ãªè¨­è¨ˆãŒå¿…è¦ã§ã™ã€‚

### è¨­è¨ˆæ–¹é‡

#### 1. é–¾å€¤è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆAgendaLevelThresholdï¼‰

```prisma
model AgendaLevelThreshold {
  id                    String    @id @default(cuid())

  // é©ç”¨ç¯„å›²
  scopeType             String    // 'global' | 'facility' | 'department' | 'team'
  scopeId               String?   // facilityId or departmentId or teamId (globalã®å ´åˆã¯null)

  // ãƒ¬ãƒ™ãƒ«å®šç¾©
  level                 String    // 'PENDING' | 'DEPT_REVIEW' | 'DEPT_AGENDA' | 'FACILITY_AGENDA' | 'CORP_REVIEW' | 'CORP_AGENDA'
  minScore              Int       // æœ€å°ã‚¹ã‚³ã‚¢

  // å‹•çš„èª¿æ•´è¨­å®š
  isDynamic             Boolean   @default(false) // å‹•çš„èª¿æ•´ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹
  dynamicFormula        String?   // 'fixed' | 'member_count_ratio' | 'active_member_ratio' | 'custom'

  // å‹•çš„èª¿æ•´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆdynamicFormula='member_count_ratio'ã®å ´åˆï¼‰
  baseMemberCount       Int?      // åŸºæº–ãƒ¡ãƒ³ãƒãƒ¼æ•°ï¼ˆä¾‹: 30äººï¼‰
  baseScore             Int?      // åŸºæº–ã‚¹ã‚³ã‚¢ï¼ˆä¾‹: 30ç‚¹ï¼‰
  scalingFactor         Float?    // ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ä¿‚æ•°ï¼ˆä¾‹: 1.0ï¼‰
  minThreshold          Int?      // æœ€å°é–¾å€¤ï¼ˆä¾‹: 10ç‚¹ï¼‰
  maxThreshold          Int?      // æœ€å¤§é–¾å€¤ï¼ˆä¾‹: 100ç‚¹ï¼‰

  // ã‚«ã‚¹ã‚¿ãƒ å¼ï¼ˆdynamicFormula='custom'ã®å ´åˆï¼‰
  customFormula         String?   // ä¾‹: "baseSc ore * (sqrt(memberCount) / sqrt(baseMemberCount))"

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  createdBy             String?   // è¨­å®šè€…ã®userId
  notes                 String?   // è¨­å®šç†ç”±ã®ãƒ¡ãƒ¢

  @@unique([scopeType, scopeId, level]) // åŒã˜ã‚¹ã‚³ãƒ¼ãƒ—ãƒ»ãƒ¬ãƒ™ãƒ«ã«ã¯1ã¤ã®ã¿
  @@index([scopeType, scopeId])
  @@index([level])
}
```

#### 2. å‹•çš„é–¾å€¤è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

**è¨ˆç®—å¼ã®ä¾‹**:

##### â‘  å›ºå®šå€¤ï¼ˆfixedï¼‰
```typescript
threshold = minScore  // 30ç‚¹å›ºå®š
```

##### â‘¡ ãƒ¡ãƒ³ãƒãƒ¼æ•°æ¯”ç‡ï¼ˆmember_count_ratioï¼‰
```typescript
// å°‘äººæ•°éƒ¨ç½²ã¯ä½ã„é–¾å€¤ã€å¤§äººæ•°éƒ¨ç½²ã¯é«˜ã„é–¾å€¤
threshold = Math.max(
  minThreshold,
  Math.min(
    maxThreshold,
    baseScore * (Math.sqrt(currentMemberCount) / Math.sqrt(baseMemberCount)) * scalingFactor
  )
);

// ä¾‹:
// - 10äººéƒ¨ç½²: 30 * (âˆš10 / âˆš30) * 1.0 = 17ç‚¹
// - 30äººéƒ¨ç½²: 30 * (âˆš30 / âˆš30) * 1.0 = 30ç‚¹
// - 100äººéƒ¨ç½²: 30 * (âˆš100 / âˆš30) * 1.0 = 55ç‚¹ â†’ max(100)ã§100ç‚¹
```

##### â‘¢ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ³ãƒãƒ¼æ¯”ç‡ï¼ˆactive_member_ratioï¼‰
```typescript
// éå»30æ—¥é–“ã®æŠ•ç¨¿ãƒ»æŠ•ç¥¨ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆå®Ÿç¸¾è€…ã‚’ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ³ãƒãƒ¼ã€ã¨ã‚«ã‚¦ãƒ³ãƒˆ
activeMemberCount = getActiveMemberCount(departmentId, days=30);
threshold = baseScore * (activeMemberCount / baseMemberCount) * scalingFactor;

// ä¾‹:
// - 30äººä¸­10äººãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–: 30 * (10 / 30) * 1.0 = 10ç‚¹
// - 30äººä¸­30äººãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–: 30 * (30 / 30) * 1.0 = 30ç‚¹
```

##### â‘£ ã‚«ã‚¹ã‚¿ãƒ å¼ï¼ˆcustomï¼‰
```typescript
// JavaScriptå¼ã‚’evalã§å®Ÿè¡Œï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„ï¼‰
// ä½¿ç”¨å¯èƒ½å¤‰æ•°: memberCount, baseMemberCount, baseScore, activeMemberCount
const formula = "baseScore * (Math.log(memberCount + 1) / Math.log(baseMemberCount + 1))";
threshold = eval(formula);
```

#### 3. é–¾å€¤å–å¾—API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/agenda/thresholds`

**Query Parameters**:
- `scopeType` (string): `global` | `facility` | `department` | `team`
- `scopeId` (string, optional): facilityId or departmentId or teamId

**Response**:
```json
{
  "success": true,
  "data": {
    "scopeType": "department",
    "scopeId": "dept-001",
    "departmentName": "çœ‹è­·éƒ¨",
    "memberCount": 12,
    "activeMemberCount": 9,
    "thresholds": [
      {
        "level": "PENDING",
        "minScore": 0,
        "calculatedThreshold": 0,
        "isDynamic": false
      },
      {
        "level": "DEPT_REVIEW",
        "minScore": 30,
        "calculatedThreshold": 17,
        "isDynamic": true,
        "dynamicFormula": "member_count_ratio",
        "calculation": {
          "baseMemberCount": 30,
          "currentMemberCount": 12,
          "baseScore": 30,
          "scalingFactor": 1.0,
          "formula": "30 * (âˆš12 / âˆš30) * 1.0 = 17.32 â†’ 17"
        }
      },
      {
        "level": "DEPT_AGENDA",
        "minScore": 50,
        "calculatedThreshold": 28,
        "isDynamic": true,
        "dynamicFormula": "member_count_ratio"
      },
      {
        "level": "FACILITY_AGENDA",
        "minScore": 100,
        "calculatedThreshold": 100,
        "isDynamic": false
      },
      {
        "level": "CORP_REVIEW",
        "minScore": 300,
        "calculatedThreshold": 300,
        "isDynamic": false
      },
      {
        "level": "CORP_AGENDA",
        "minScore": 600,
        "calculatedThreshold": 600,
        "isDynamic": false
      }
    ]
  }
}
```

#### 4. é–¾å€¤è¨­å®šç®¡ç†ç”»é¢ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰

**æ©Ÿèƒ½**:
1. å…¨ç¤¾ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé–¾å€¤è¨­å®š
2. æ–½è¨­åˆ¥é–¾å€¤ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
3. éƒ¨ç½²åˆ¥é–¾å€¤ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
4. å‹•çš„èª¿æ•´å¼ã®é¸æŠãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
5. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆãƒ¡ãƒ³ãƒãƒ¼æ•°ã‚’å¤‰ãˆãŸå ´åˆã®é–¾å€¤è¨ˆç®—ï¼‰
6. å¤‰æ›´å±¥æ­´ã®è¨˜éŒ²

**æ¨©é™**:
- Lv.10ï¼ˆå½¹å“¡ï¼‰: å…¨ç¤¾ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¤‰æ›´å¯èƒ½
- Lv.9ï¼ˆæ–½è¨­é•·ï¼‰: è‡ªæ–½è¨­ã®é–¾å€¤å¤‰æ›´å¯èƒ½
- Lv.8ï¼ˆéƒ¨ç½²é•·ï¼‰: è‡ªéƒ¨ç½²ã®é–¾å€¤å¤‰æ›´å¯èƒ½ï¼ˆæ–½è¨­é•·æ‰¿èªå¿…è¦ï¼‰

#### 5. çµ„ç¹”æ”¹ç·¨å¯¾å¿œãƒ•ãƒ­ãƒ¼

```
çµ„ç¹”æ”¹ç·¨ï¼ˆéƒ¨ç½²çµ±åˆãƒ»åˆ†å‰²ãƒ»äººæ•°å¤‰å‹•ï¼‰
  â†“
åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰çµ„ç¹”ãƒã‚¹ã‚¿æ›´æ–°é€šçŸ¥ï¼ˆWebhookï¼‰
  â†“
VoiceDrive: éƒ¨ç½²ãƒ¡ãƒ³ãƒãƒ¼æ•°ã‚’å†å–å¾—
  â†“
å‹•çš„é–¾å€¤å†è¨ˆç®—
  â†“
æ—¢å­˜æŠ•ç¨¿ã®è­°é¡Œãƒ¬ãƒ™ãƒ«å†åˆ¤å®š
  â†“ (ãƒ¬ãƒ™ãƒ«å¤‰å‹•ãŒã‚ã£ãŸå ´åˆ)
AgendaLevelHistory ã«è¨˜éŒ²
  â†“
æŠ•ç¨¿è€…ã«é€šçŸ¥ï¼ˆã€Œçµ„ç¹”æ”¹ç·¨ã«ã‚ˆã‚Šè­°é¡Œãƒ¬ãƒ™ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€ï¼‰
```

#### 6. å®Ÿè£…ä¾‹ï¼ˆTypeScriptï¼‰

```typescript
// AgendaLevelThresholdService.ts

import { prisma } from '../lib/prisma';

export class AgendaLevelThresholdService {

  /**
   * è­°é¡Œãƒ¬ãƒ™ãƒ«ã®é–¾å€¤ã‚’å–å¾—ï¼ˆå‹•çš„è¨ˆç®—å«ã‚€ï¼‰
   */
  async getThresholds(
    scopeType: 'global' | 'facility' | 'department' | 'team',
    scopeId?: string,
    departmentId?: string
  ): Promise<AgendaLevelThreshold[]> {

    // 1. ã‚¹ã‚³ãƒ¼ãƒ—ã«å¿œã˜ãŸé–¾å€¤è¨­å®šã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½: team > department > facility > globalï¼‰
    const thresholdConfigs = await this.getThresholdConfigs(scopeType, scopeId);

    // 2. ãƒ¡ãƒ³ãƒãƒ¼æ•°å–å¾—ï¼ˆå‹•çš„èª¿æ•´ãŒå¿…è¦ãªå ´åˆï¼‰
    const memberCount = departmentId ? await this.getMemberCount(departmentId) : null;
    const activeMemberCount = departmentId ? await this.getActiveMemberCount(departmentId, 30) : null;

    // 3. å„ãƒ¬ãƒ™ãƒ«ã®é–¾å€¤ã‚’è¨ˆç®—
    const thresholds = await Promise.all(
      thresholdConfigs.map(async config => {
        const calculatedThreshold = this.calculateThreshold(
          config,
          memberCount,
          activeMemberCount
        );

        return {
          level: config.level,
          minScore: config.minScore,
          calculatedThreshold,
          isDynamic: config.isDynamic,
          dynamicFormula: config.dynamicFormula,
          calculation: config.isDynamic ? {
            baseMemberCount: config.baseMemberCount,
            currentMemberCount: memberCount,
            baseScore: config.baseScore,
            scalingFactor: config.scalingFactor,
            formula: this.getFormulaDescription(config, memberCount, calculatedThreshold)
          } : undefined
        };
      })
    );

    return thresholds;
  }

  /**
   * é–¾å€¤è¨ˆç®—ï¼ˆå‹•çš„èª¿æ•´ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
   */
  private calculateThreshold(
    config: AgendaLevelThresholdConfig,
    memberCount: number | null,
    activeMemberCount: number | null
  ): number {

    // å‹•çš„èª¿æ•´ãªã—ã®å ´åˆ
    if (!config.isDynamic) {
      return config.minScore;
    }

    // ãƒ¡ãƒ³ãƒãƒ¼æ•°ãŒå–å¾—ã§ããªã„å ´åˆã¯å›ºå®šå€¤
    if (!memberCount) {
      return config.minScore;
    }

    // å‹•çš„è¨ˆç®—å¼ã«å¿œã˜ã¦è¨ˆç®—
    switch (config.dynamicFormula) {
      case 'member_count_ratio':
        return this.calculateMemberCountRatio(config, memberCount);

      case 'active_member_ratio':
        return this.calculateActiveMemberRatio(config, memberCount, activeMemberCount || 0);

      case 'custom':
        return this.calculateCustomFormula(config, memberCount, activeMemberCount || 0);

      default:
        return config.minScore;
    }
  }

  /**
   * ãƒ¡ãƒ³ãƒãƒ¼æ•°æ¯”ç‡ã«ã‚ˆã‚‹é–¾å€¤è¨ˆç®—
   */
  private calculateMemberCountRatio(
    config: AgendaLevelThresholdConfig,
    currentMemberCount: number
  ): number {
    const { baseScore, baseMemberCount, scalingFactor, minThreshold, maxThreshold } = config;

    const calculated = baseScore! *
      (Math.sqrt(currentMemberCount) / Math.sqrt(baseMemberCount!)) *
      (scalingFactor || 1.0);

    return Math.round(
      Math.max(
        minThreshold || 0,
        Math.min(
          maxThreshold || 1000,
          calculated
        )
      )
    );
  }

  /**
   * éƒ¨ç½²ã®ãƒ¡ãƒ³ãƒãƒ¼æ•°ã‚’å–å¾—
   */
  private async getMemberCount(departmentId: string): Promise<number> {
    const count = await prisma.user.count({
      where: {
        department: departmentId,
        isRetired: false
      }
    });
    return count;
  }

  /**
   * ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ³ãƒãƒ¼æ•°ã‚’å–å¾—ï¼ˆéå»Næ—¥é–“ã«æŠ•ç¨¿ãƒ»æŠ•ç¥¨ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸäººæ•°ï¼‰
   */
  private async getActiveMemberCount(departmentId: string, days: number): Promise<number> {
    const since = new Date();
    since.setDate(since.getDate() - days);

    const activeUserIds = new Set<string>();

    // æŠ•ç¨¿è€…
    const posters = await prisma.post.findMany({
      where: {
        author: { department: departmentId },
        createdAt: { gte: since }
      },
      select: { authorId: true },
      distinct: ['authorId']
    });
    posters.forEach(p => activeUserIds.add(p.authorId));

    // æŠ•ç¥¨è€…
    const voters = await prisma.voteHistory.findMany({
      where: {
        user: { department: departmentId },
        votedAt: { gte: since }
      },
      select: { userId: true },
      distinct: ['userId']
    });
    voters.forEach(v => activeUserIds.add(v.userId));

    // ã‚³ãƒ¡ãƒ³ãƒˆè€…
    const commenters = await prisma.comment.findMany({
      where: {
        author: { department: departmentId },
        createdAt: { gte: since }
      },
      select: { authorId: true },
      distinct: ['authorId']
    });
    commenters.forEach(c => activeUserIds.add(c.authorId));

    return activeUserIds.size;
  }
}
```

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šä¾‹

| ãƒ¬ãƒ™ãƒ« | ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¾å€¤ | å°‘äººæ•°éƒ¨ç½²ï¼ˆ10äººï¼‰ | æ¨™æº–éƒ¨ç½²ï¼ˆ30äººï¼‰ | å¤§äººæ•°éƒ¨ç½²ï¼ˆ100äººï¼‰ |
|--------|--------------|-----------------|-----------------|------------------|
| PENDING | 0ç‚¹ | 0ç‚¹ | 0ç‚¹ | 0ç‚¹ |
| DEPT_REVIEW | 30ç‚¹ | 17ç‚¹ | 30ç‚¹ | 55ç‚¹ |
| DEPT_AGENDA | 50ç‚¹ | 28ç‚¹ | 50ç‚¹ | 91ç‚¹ |
| FACILITY_AGENDA | 100ç‚¹ | 100ç‚¹ | 100ç‚¹ | 100ç‚¹ |
| CORP_REVIEW | 300ç‚¹ | 300ç‚¹ | 300ç‚¹ | 300ç‚¹ |
| CORP_AGENDA | 600ç‚¹ | 600ç‚¹ | 600ç‚¹ | 600ç‚¹ |

**è¨­è¨ˆæ–¹é‡**:
- DEPT_REVIEWãƒ»DEPT_AGENDA: ãƒ¡ãƒ³ãƒãƒ¼æ•°ã«å¿œã˜ã¦å‹•çš„èª¿æ•´
- FACILITY_AGENDAä»¥ä¸Š: å…¨ç¤¾å…±é€šã®å›ºå®šå€¤

---

## ğŸ“ å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: å€‹äººè¿½è·¡åŸºæœ¬æ©Ÿèƒ½ï¼ˆæœ€å„ªå…ˆï¼‰

**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: 11/11-11/18ï¼ˆ8æ—¥é–“ï¼‰

**å®Ÿè£…å†…å®¹**:
1. âœ… Post ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µï¼ˆagendaLevel, çµ±è¨ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼‰
2. âœ… AgendaLevelHistory ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
3. âœ… PostActivityEvent ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
4. âœ… API-PT-1: è‡ªåˆ†ã®æŠ•ç¨¿ä¸€è¦§å–å¾—
5. âœ… API-PT-2: æŠ•ç¥¨ã—ãŸæŠ•ç¨¿ä¸€è¦§å–å¾—
6. âœ… API-PT-3: ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸæŠ•ç¨¿ä¸€è¦§å–å¾—
7. âœ… API-PT-4: æŠ•ç¨¿ã®æ´»å‹•ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
8. âœ… API-PT-5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ã‚µãƒãƒªãƒ¼å–å¾—

**æˆåŠŸåŸºæº–**:
- IdeaVoiceTracking.tsx ãŒå®ŸAPIã§å‹•ä½œ
- TrackingTimeline ã«å®Ÿã‚¤ãƒ™ãƒ³ãƒˆãŒè¡¨ç¤º
- 6æ®µéšè­°é¡Œãƒ¬ãƒ™ãƒ«ãŒæ­£ç¢ºã«åˆ¤å®šã•ã‚Œã‚‹

### Phase 2: è­°é¡Œãƒ¬ãƒ™ãƒ«è‡ªå‹•æ˜‡æ ¼æ©Ÿèƒ½

**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: 11/19-11/25ï¼ˆ7æ—¥é–“ï¼‰

**å®Ÿè£…å†…å®¹**:
1. âœ… æŠ•ç¥¨å—ä»˜æ™‚ã®è‡ªå‹•ã‚¹ã‚³ã‚¢å†è¨ˆç®—
2. âœ… è­°é¡Œãƒ¬ãƒ™ãƒ«è‡ªå‹•æ˜‡æ ¼åˆ¤å®š
3. âœ… AgendaLevelHistory è‡ªå‹•è¨˜éŒ²
4. âœ… PostActivityEvent è‡ªå‹•è¨˜éŒ²
5. âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ï¼ˆWebSocketï¼‰

**æˆåŠŸåŸºæº–**:
- æŠ•ç¥¨ãŒ50ç‚¹ã«åˆ°é”ã—ãŸã‚‰è‡ªå‹•çš„ã«DEPT_AGENDAã«æ˜‡æ ¼
- æ˜‡æ ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«å³åº§ã«è¡¨ç¤º
- æŠ•ç¨¿è€…ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ãŒå±Šã

### Phase 3: éƒ¨ç½²ãƒ»æ–½è¨­ãƒ»æ³•äººåˆ†æï¼ˆå…±é€šDBæ§‹ç¯‰å¾Œï¼‰

**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: å…±é€šDBæ§‹ç¯‰å¾Œï¼ˆ2025å¹´12æœˆä»¥é™ï¼‰

**å®Ÿè£…å†…å®¹**:
1. âœ… API-PT-6: éƒ¨ç½²æŠ•ç¨¿åˆ†æå–å¾—
2. âœ… API-PT-7: æ–½è¨­æŠ•ç¨¿åˆ†æå–å¾—
3. âœ… API-PT-8: æ³•äººæŠ•ç¨¿åˆ†æå–å¾—
4. âœ… DepartmentPostingAnalytics.tsx å®Ÿè£…
5. âœ… FacilityPostingAnalytics.tsx å®Ÿè£…
6. âœ… CorporatePostingAnalytics.tsx å®Ÿè£…

**æˆåŠŸåŸºæº–**:
- éƒ¨ç½²é•·ãŒè‡ªéƒ¨ç½²ã®æŠ•ç¨¿å“è³ªã‚’ç¢ºèªã§ãã‚‹
- æ–½è¨­é•·ãŒéƒ¨ç½²é–“æ¯”è¼ƒã¨ROIåˆ†æãŒã§ãã‚‹
- æ³•äººæœ¬éƒ¨ãŒæ–½è¨­é–“ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãŒã§ãã‚‹

---

**æ–‡æ›¸çµ‚äº†**
