# èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æœ€çµ‚è¨­è¨ˆæ›¸ï¼ˆQRã‚³ãƒ¼ãƒ‰ + PWAæ–¹å¼ï¼‰

**æ–‡æ›¸ç•ªå·**: AUTH-DESIGN-2025-1027-001
**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥
**æ±ºå®šäº‹é …**: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ èªè¨¼API + QRã‚³ãƒ¼ãƒ‰ + PWAæ–¹å¼ã‚’æ¡ç”¨
**å‚ç…§æ–‡æ›¸**:
- [UnauthorizedPage_DBè¦ä»¶åˆ†æ_20251027.md](./UnauthorizedPage_DBè¦ä»¶åˆ†æ_20251027.md)
- [UnauthorizedPageæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251027.md](./UnauthorizedPageæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251027.md)

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### æ¡ç”¨æ±ºå®š: QRã‚³ãƒ¼ãƒ‰ + PWAæ–¹å¼ â­â­â­â­â­

**æ±ºå®šç†ç”±ï¼ˆUXè¦³ç‚¹ï¼‰**:
1. **é«˜é½¢è·å“¡ãƒ»ãƒ‘ãƒ¼ãƒˆã‚¿ã‚¤ãƒ è·å“¡ã«ã¨ã£ã¦æœ€ã‚‚ä½¿ã„ã‚„ã™ã„**
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ä¸è¦
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨˜æ†¶ä¸è¦
   - QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã ã‘ã§ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†

2. **ç·Šæ€¥æ™‚ã®è¿…é€Ÿãªã‚¢ã‚¯ã‚»ã‚¹**
   - å¤œå‹¤å¸¯ã§ã®è¿…é€Ÿãªæƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹
   - ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—ã ã‘ã§å³èµ·å‹•

3. **åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ç°¡å˜ã•**
   - äººäº‹éƒ¨ã‹ã‚‰å—ã‘å–ã£ãŸç”¨ç´™ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
   - ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã ã‘
   - ä»¥é™ã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—ã®ã¿

### å®Ÿè£…ã‚¹ã‚³ãƒ¼ãƒ—

| é …ç›® | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ | VoiceDriveå´ | å·¥æ•° |
|-----|--------------|-------------|-----|
| **QRã‚³ãƒ¼ãƒ‰èªè¨¼** | OneTimeTokenç”ŸæˆAPI | ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ | åŒ»ç™‚: 2æ—¥<br>VD: 3æ—¥ |
| **åŸºæœ¬èªè¨¼** | èªè¨¼APIå®Ÿè£… | useAuthå®Ÿè£… | åŒ»ç™‚: 2æ—¥<br>VD: 5æ—¥ |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†** | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´API | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢ | åŒ»ç™‚: 1æ—¥<br>VD: 2æ—¥ |
| **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†** | LoginHistoryè¨˜éŒ² | Cookie/Sessionç®¡ç† | åŒ»ç™‚: 1æ—¥<br>VD: 3æ—¥ |
| **PWAå¯¾å¿œ** | - | manifest.jsonç­‰ | VD: 2æ—¥ |
| **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯** | LoginAttemptç®¡ç† | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | åŒ»ç™‚: 0.5æ—¥<br>VD: 1æ—¥ |
| **åˆè¨ˆå·¥æ•°** | **6.5æ—¥** | **16æ—¥** | **22.5æ—¥** |

---

## ğŸ¯ èªè¨¼ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### Pattern 1: QRã‚³ãƒ¼ãƒ‰åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ãƒ•ãƒ­ãƒ¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: äººäº‹éƒ¨ã§ã®æ–°å…¥è·å“¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´å‡¦ç†:                                             â”‚
â”‚                                                                â”‚
â”‚ POST /api/v2/auth/generate-onetime-token                      â”‚
â”‚ {                                                              â”‚
â”‚   "employeeId": "EMP2024123",                                 â”‚
â”‚   "purpose": "initial_setup",                                 â”‚
â”‚   "validityHours": 24                                         â”‚
â”‚ }                                                              â”‚
â”‚                                                                â”‚
â”‚ â†“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                                   â”‚
â”‚                                                                â”‚
â”‚ {                                                              â”‚
â”‚   "token": "a3f7c2e1d9b4...",  // 64æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—       â”‚
â”‚   "qrCodeUrl": "https://voicedrive.hospital.local/login?token=...", â”‚
â”‚   "qrCodeImage": "data:image/png;base64,...",  // Data URL    â”‚
â”‚   "expiresAt": "2025-10-28T15:30:00Z"                         â”‚
â”‚ }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚·ãƒ¼ãƒˆå°åˆ·                                â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚    å¤§åŸè¨˜å¿µç—…é™¢ VoiceDrive ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±            â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚    è·å“¡ID: EMP2024123                                 â”‚     â”‚
â”‚ â”‚    æ°å: å±±ç”° å¤ªéƒ                                     â”‚     â”‚
â”‚ â”‚    æ‰€å±: å¤–ç§‘                                          â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚    ã€åˆå›ãƒ­ã‚°ã‚¤ãƒ³ç”¨QRã‚³ãƒ¼ãƒ‰ã€‘                          â”‚     â”‚
â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚     â”‚
â”‚ â”‚    â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â”‚  â† QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³        â”‚     â”‚
â”‚ â”‚    â”‚  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ    â”‚                              â”‚     â”‚
â”‚ â”‚    â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚                              â”‚     â”‚
â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚    æœ‰åŠ¹æœŸé™: 2025å¹´10æœˆ28æ—¥ 15:30ã¾ã§                 â”‚     â”‚
â”‚ â”‚    ç™ºè¡Œæ—¥: 2025å¹´10æœˆ27æ—¥                             â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æ–°å…¥è·å“¡ãŒQRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³                           â”‚
â”‚                                                                â”‚
â”‚ ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹                      â”‚
â”‚ â†’ ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•èµ·å‹•                                           â”‚
â”‚ â†’ https://voicedrive.hospital.local/login?token=a3f7c2e1d9b4...â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: VoiceDriveå´å‡¦ç†ï¼ˆè‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼‰                       â”‚
â”‚                                                                â”‚
â”‚ VoiceDriveãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:                                      â”‚
â”‚ - URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰tokenå–å¾—                                   â”‚
â”‚ - POST /api/auth/verify-onetime-token                         â”‚
â”‚   {                                                            â”‚
â”‚     "token": "a3f7c2e1d9b4...",                               â”‚
â”‚     "ipAddress": "192.168.1.100",                             â”‚
â”‚     "userAgent": "Mozilla/5.0..."                             â”‚
â”‚   }                                                            â”‚
â”‚                                                                â”‚
â”‚ â†“ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã«è»¢é€                                           â”‚
â”‚                                                                â”‚
â”‚ POST /api/v2/auth/verify-onetime-token                        â”‚
â”‚                                                                â”‚
â”‚ â†“ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´å‡¦ç†                                           â”‚
â”‚ - OneTimeTokenãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª                                     â”‚
â”‚ - æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰                               â”‚
â”‚ - used = false ç¢ºèª                                           â”‚
â”‚ - Employeeãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è·å“¡æƒ…å ±å–å¾—                             â”‚
â”‚ - used = true, usedAt = NOW(), usedIpAddress, usedUserAgentæ›´æ–°â”‚
â”‚                                                                â”‚
â”‚ â†“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                                   â”‚
â”‚                                                                â”‚
â”‚ {                                                              â”‚
â”‚   "success": true,                                            â”‚
â”‚   "employee": {                                               â”‚
â”‚     "employeeId": "EMP2024123",                               â”‚
â”‚     "name": "å±±ç”° å¤ªéƒ",                                       â”‚
â”‚     "email": "yamada.taro@hospital.local",                    â”‚
â”‚     "permissionLevel": 3.5,                                   â”‚
â”‚     "accountType": "STAFF",                                   â”‚
â”‚     "role": "nurse",                                          â”‚
â”‚     "department": "å¤–ç§‘"                                       â”‚
â”‚   }                                                            â”‚
â”‚ }                                                              â”‚
â”‚                                                                â”‚
â”‚ â†“ VoiceDriveå´å‡¦ç†                                            â”‚
â”‚ - Userãƒ†ãƒ¼ãƒ–ãƒ«æ¤œç´¢ï¼ˆemployeeId = "EMP2024123"ï¼‰               â”‚
â”‚ - Userå­˜åœ¨ã—ãªã„ â†’ æ–°è¦ä½œæˆ                                    â”‚
â”‚ - ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ30æ—¥é–“æœ‰åŠ¹ã€Cookieä¿å­˜ï¼‰                      â”‚
â”‚ - ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç”»é¢è¡¨ç¤º                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†…                                    â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚  âœ… ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸï¼                           â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  ã‚ˆã‚Šä¾¿åˆ©ã«ä½¿ã†ãŸã‚ã«ã€ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¾ã›ã‚“ã‹ï¼Ÿ   â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚     â”‚
â”‚ â”‚  â”‚ ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ                 â”‚  â† ã‚¿ãƒƒãƒ—      â”‚     â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨...                             â”‚     â”‚
â”‚ â”‚  âœ… ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰èµ·å‹•ã§ãã¾ã™             â”‚     â”‚
â”‚ â”‚  âœ… æ¯å›ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“                   â”‚     â”‚
â”‚ â”‚  âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚ä¸€éƒ¨æ©Ÿèƒ½ãŒä½¿ãˆã¾ã™                   â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  [å¾Œã§] [è¿½åŠ ã™ã‚‹]                                     â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: ãƒ›ãƒ¼ãƒ ç”»é¢ã«ã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ å®Œäº†                           â”‚
â”‚                                                                â”‚
â”‚ ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ãƒ›ãƒ¼ãƒ ç”»é¢:                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”                             â”‚
â”‚ â”‚ğŸ“§  â”‚ â”‚ğŸ“·  â”‚ â”‚âš•ï¸  â”‚ â”‚ğŸµ  â”‚                             â”‚
â”‚ â”‚Mailâ”‚ â”‚Photoâ”‚ â”‚VD  â”‚ â”‚Musicâ”‚  â† VoiceDriveã‚¢ã‚¤ã‚³ãƒ³       â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                â”‚
â”‚ ä»¥é™ã®ã‚¢ã‚¯ã‚»ã‚¹:                                                 â”‚
â”‚ â‘  ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—                                             â”‚
â”‚ â‘¡ è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³30æ—¥é–“æœ‰åŠ¹ï¼‰                          â”‚
â”‚ â‘¢ ã™ãã«ä½¿ãˆã‚‹ï¼                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰€è¦æ™‚é–“**: ç´„3åˆ†ï¼ˆQRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ + PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰

---

### Pattern 2: å¾“æ¥å‹ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ‰‹æ®µï¼‰

QRã‚³ãƒ¼ãƒ‰ãŒåˆ©ç”¨ã§ããªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢                                           â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚  VoiceDrive ãƒ­ã‚°ã‚¤ãƒ³                                  â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  è·å“¡ID:   [EMP2024123        ]                       â”‚     â”‚
â”‚ â”‚  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: [****************  ]                       â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  [ãƒ­ã‚°ã‚¤ãƒ³]                                            â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  â€»åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„     â”‚     â”‚
â”‚ â”‚  åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å½¢å¼: {è·å“¡ID}_InitPass2025            â”‚     â”‚
â”‚ â”‚  ä¾‹: EMP2024123_InitPass2025                          â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ èªè¨¼APIå‘¼ã³å‡ºã—                            â”‚
â”‚                                                                â”‚
â”‚ POST /api/v2/auth/authenticate                                â”‚
â”‚ {                                                              â”‚
â”‚   "employeeId": "EMP2024123",                                 â”‚
â”‚   "password": "EMP2024123_InitPass2025"                       â”‚
â”‚ }                                                              â”‚
â”‚                                                                â”‚
â”‚ â†“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                                   â”‚
â”‚                                                                â”‚
â”‚ {                                                              â”‚
â”‚   "success": true,                                            â”‚
â”‚   "passwordMustChange": true,  // åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ¤œçŸ¥             â”‚
â”‚   "employee": { ... }                                         â”‚
â”‚ }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢ï¼ˆåˆå›ã®ã¿ï¼‰                          â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚  ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãŒå¿…è¦ã§ã™                          â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’      â”‚     â”‚
â”‚ â”‚  å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚                                    â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: [****************  ]                 â”‚     â”‚
â”‚ â”‚  æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: [****************  ]                 â”‚     â”‚
â”‚ â”‚  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª:   [****************  ]                 â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶:                                       â”‚     â”‚
â”‚ â”‚  âœ… 8æ–‡å­—ä»¥ä¸Š                                          â”‚     â”‚
â”‚ â”‚  âœ… å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»æ•°å­—ã‚’å«ã‚€                          â”‚     â”‚
â”‚ â”‚  âœ… è¨˜å·ã‚’1ã¤ä»¥ä¸Šå«ã‚€ï¼ˆæ¨å¥¨ï¼‰                          â”‚     â”‚
â”‚ â”‚                                                        â”‚     â”‚
â”‚ â”‚  [å¤‰æ›´ã™ã‚‹]                                            â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´APIå‘¼ã³å‡ºã—                              â”‚
â”‚                                                                â”‚
â”‚ PUT /api/v2/auth/change-password                              â”‚
â”‚ {                                                              â”‚
â”‚   "employeeId": "EMP2024123",                                 â”‚
â”‚   "currentPassword": "EMP2024123_InitPass2025",               â”‚
â”‚   "newPassword": "MySecurePass123!"                           â”‚
â”‚ }                                                              â”‚
â”‚                                                                â”‚
â”‚ â†“ åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´å‡¦ç†                                           â”‚
â”‚ - ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼                                         â”‚
â”‚ - æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒªã‚·ãƒ¼æ¤œè¨¼                                    â”‚
â”‚ - passwordHashæ›´æ–°ï¼ˆbcrypt cost=10ï¼‰                          â”‚
â”‚ - passwordMustChange = false è¨­å®š                             â”‚
â”‚ - passwordUpdatedAt = NOW()                                   â”‚
â”‚                                                                â”‚
â”‚ â†“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                                   â”‚
â”‚                                                                â”‚
â”‚ {                                                              â”‚
â”‚   "success": true,                                            â”‚
â”‚   "message": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ"                        â”‚
â”‚ }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ãƒ­ã‚°ã‚¤ãƒ³å®Œäº† â†’ PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†…                     â”‚
â”‚                                                                â”‚
â”‚ ï¼ˆPattern 1ã® Step 5 ã¨åŒã˜ï¼‰                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰€è¦æ™‚é–“**: ç´„5åˆ†ï¼ˆåˆå›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚’å«ã‚€ï¼‰

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ï¼ˆãƒã‚¹ã‚¿DBï¼‰

#### 1. Employeeãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¢å­˜ + æ‹¡å¼µï¼‰

```prisma
model Employee {
  employeeId          String    @id @map("employee_id")
  name                String
  email               String    @unique
  permissionLevel     Float     @map("permission_level")
  accountType         String    @map("account_type")  // 'ADMIN' | 'STAFF' | 'LIMITED'
  role                String?   // 'doctor' | 'nurse' | 'admin_staff' | etc.
  department          String?
  facilityId          String?   @map("facility_id")

  // ğŸ†• èªè¨¼é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆè¿½åŠ ï¼‰
  passwordHash        String    @map("password_hash")           // bcrypt hash
  passwordUpdatedAt   DateTime? @map("password_updated_at")    // æœ€çµ‚å¤‰æ›´æ—¥æ™‚
  passwordMustChange  Boolean   @default(true) @map("password_must_change")  // åˆå›å¤‰æ›´ãƒ•ãƒ©ã‚°

  isActive            Boolean   @default(true) @map("is_active")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  onetimeTokens       OnetimeToken[]
  loginHistory        LoginHistory[]
  loginAttempts       LoginAttempt[]

  @@map("employees")
}
```

**è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¬æ˜**:
- `passwordHash`: bcrypt(cost=10)ã§ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
- `passwordUpdatedAt`: æœ€çµ‚å¤‰æ›´æ—¥æ™‚ï¼ˆ90æ—¥å¾Œã«æœŸé™åˆ‡ã‚Œè­¦å‘Šã«ä½¿ç”¨ï¼‰
- `passwordMustChange`: åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ `true`ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å¾Œ `false`

---

#### 2. OnetimeToken ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰

```prisma
model OnetimeToken {
  id              String    @id @default(cuid())
  token           String    @unique  // crypto.randomBytes(32).toString('hex')
  employeeId      String    @map("employee_id")
  purpose         String    // 'initial_setup' | 'password_reset'
  expiresAt       DateTime  @map("expires_at")  // ç™ºè¡Œã‹ã‚‰24æ™‚é–“
  used            Boolean   @default(false)
  usedAt          DateTime? @map("used_at")
  usedIpAddress   String?   @map("used_ip_address")
  usedUserAgent   String?   @map("used_user_agent")
  createdAt       DateTime  @default(now()) @map("created_at")

  employee        Employee  @relation(fields: [employeeId], references: [employeeId])

  @@map("onetime_tokens")
  @@index([employeeId])
  @@index([expiresAt])
  @@index([used])
}
```

**ä½¿ç”¨æ–¹æ³•**:
1. äººäº‹éƒ¨ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ™‚ã« `generate-onetime-token` APIå‘¼ã³å‡ºã—
2. QRã‚³ãƒ¼ãƒ‰ã‚’å°åˆ·ã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚·ãƒ¼ãƒˆã«æ·»ä»˜
3. æ–°å…¥è·å“¡ãŒQRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ â†’ ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ï¼ˆ`used = true`ï¼‰
4. 24æ™‚é–“å¾Œã«è‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–ï¼ˆcronã‚¸ãƒ§ãƒ–ã§å‰Šé™¤ï¼‰

---

#### 3. LoginHistory ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰

```prisma
model LoginHistory {
  id              String    @id @default(cuid())
  employeeId      String    @map("employee_id")
  loginAt         DateTime  @default(now()) @map("login_at")
  ipAddress       String    @map("ip_address")
  userAgent       String    @map("user_agent")
  loginMethod     String    @map("login_method")  // 'password' | 'onetime_token'
  success         Boolean   @default(true)
  failureReason   String?   @map("failure_reason")  // 'invalid_credentials' | 'account_locked' | etc.

  employee        Employee  @relation(fields: [employeeId], references: [employeeId])

  @@map("login_history")
  @@index([employeeId])
  @@index([loginAt])
}
```

**ç›®çš„**: ç›£æŸ»ãƒ­ã‚°ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¾µå®³æ¤œçŸ¥

---

#### 4. LoginAttempt ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰

```prisma
model LoginAttempt {
  id              String    @id @default(cuid())
  employeeId      String    @map("employee_id")
  attemptAt       DateTime  @default(now()) @map("attempt_at")
  ipAddress       String    @map("ip_address")
  success         Boolean   @default(false)

  employee        Employee  @relation(fields: [employeeId], references: [employeeId])

  @@map("login_attempts")
  @@index([employeeId, attemptAt])
}
```

**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
// éå»30åˆ†é–“ã®å¤±æ•—å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
const failedAttempts = await prisma.loginAttempt.count({
  where: {
    employeeId: 'EMP2024123',
    success: false,
    attemptAt: { gte: new Date(Date.now() - 30 * 60 * 1000) }
  }
});

if (failedAttempts >= 5) {
  throw new Error('ACCOUNT_LOCKED'); // 30åˆ†é–“ãƒ­ãƒƒã‚¯
}
```

---

### VoiceDriveå´ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥DBï¼‰

#### User ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¢å­˜ï¼‰

```prisma
model User {
  id              String      @id @default(cuid())
  employeeId      String      @unique @map("employee_id")

  // åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰åŒæœŸã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  name            String
  email           String      @unique
  permissionLevel Float       @map("permission_level")
  accountType     String      @map("account_type")
  role            String?

  // VoiceDriveå›ºæœ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  lastLoginAt     DateTime?   @map("last_login_at")
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  @@map("users")
}
```

**å¤‰æ›´ä¸è¦**: æ—¢å­˜ã®Userãƒ†ãƒ¼ãƒ–ãƒ«ã§å¯¾å¿œå¯èƒ½

---

## ğŸ”Œ APIä»•æ§˜

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´API

#### API-1: QRã‚³ãƒ¼ãƒ‰ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v2/auth/generate-onetime-token`

**æ¨©é™**: äººäº‹éƒ¨ç®¡ç†è€…ã®ã¿ï¼ˆpermissionLevel >= 9.0ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "employeeId": "EMP2024123",
  "purpose": "initial_setup",
  "validityHours": 24
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "token": "a3f7c2e1d9b4f8e6c1a5d7b9e3f1c8d2a4f6e8c0b2d4f6a8e0c2d4f6a8e0c2d4",
  "qrCodeUrl": "https://voicedrive.hospital.local/login?token=a3f7c2e1d9b4...",
  "qrCodeImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
  "expiresAt": "2025-10-28T15:30:00Z"
}
```

**å®Ÿè£…ä¾‹**:
```typescript
import crypto from 'crypto';
import QRCode from 'qrcode';
import { prisma } from './prisma';

export async function generateOnetimeToken(req: Request, res: Response) {
  const { employeeId, purpose = 'initial_setup', validityHours = 24 } = req.body;

  // æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆäººäº‹éƒ¨ç®¡ç†è€…ã®ã¿ï¼‰
  if (req.session.user.permissionLevel < 9.0) {
    return res.status(403).json({ error: 'INSUFFICIENT_PERMISSION' });
  }

  // è·å“¡å­˜åœ¨ç¢ºèª
  const employee = await prisma.employee.findUnique({
    where: { employeeId }
  });

  if (!employee) {
    return res.status(404).json({ error: 'EMPLOYEE_NOT_FOUND' });
  }

  // æ—¢å­˜ã®æœªä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Œã°å‰Šé™¤
  await prisma.onetimeToken.deleteMany({
    where: {
      employeeId,
      used: false,
      expiresAt: { gt: new Date() }
    }
  });

  // æ–°è¦ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆï¼ˆ64æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼‰
  const token = crypto.randomBytes(32).toString('hex');

  // æœ‰åŠ¹æœŸé™è¨­å®š
  const expiresAt = new Date();
  expiresAt.setHours(expiresAt.getHours() + validityHours);

  // DBã«ä¿å­˜
  await prisma.onetimeToken.create({
    data: {
      token,
      employeeId,
      purpose,
      expiresAt,
      used: false
    }
  });

  // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
  const qrCodeUrl = `${process.env.VOICEDRIVE_URL}/login?token=${token}`;
  const qrCodeImage = await QRCode.toDataURL(qrCodeUrl, {
    width: 300,
    margin: 2,
    color: {
      dark: '#000000',
      light: '#FFFFFF'
    }
  });

  res.json({
    success: true,
    token,
    qrCodeUrl,
    qrCodeImage,
    expiresAt: expiresAt.toISOString()
  });
}
```

---

#### API-2: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v2/auth/verify-onetime-token`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "token": "a3f7c2e1d9b4f8e6c1a5d7b9e3f1c8d2a4f6e8c0b2d4f6a8e0c2d4f6a8e0c2d4",
  "ipAddress": "192.168.1.100",
  "userAgent": "Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X)"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**:
```json
{
  "success": true,
  "employee": {
    "employeeId": "EMP2024123",
    "name": "å±±ç”° å¤ªéƒ",
    "email": "yamada.taro@hospital.local",
    "permissionLevel": 3.5,
    "accountType": "STAFF",
    "role": "nurse",
    "department": "å¤–ç§‘"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰**:
```json
{
  "success": false,
  "error": "TOKEN_EXPIRED",
  "message": "ã“ã®QRã‚³ãƒ¼ãƒ‰ã¯æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã§ã™"
}
```

**ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰**:
- `TOKEN_NOT_FOUND`: ãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ã—ãªã„
- `TOKEN_EXPIRED`: æœ‰åŠ¹æœŸé™åˆ‡ã‚Œï¼ˆ24æ™‚é–“çµŒéï¼‰
- `TOKEN_ALREADY_USED`: ã™ã§ã«ä½¿ç”¨æ¸ˆã¿
- `EMPLOYEE_NOT_FOUND`: è·å“¡ãŒå­˜åœ¨ã—ãªã„
- `EMPLOYEE_INACTIVE`: é€€è·æ¸ˆã¿

**å®Ÿè£…ä¾‹**:
```typescript
export async function verifyOnetimeToken(req: Request, res: Response) {
  const { token, ipAddress, userAgent } = req.body;

  // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œç´¢
  const onetimeToken = await prisma.onetimeToken.findUnique({
    where: { token },
    include: { employee: true }
  });

  if (!onetimeToken) {
    return res.status(404).json({
      success: false,
      error: 'TOKEN_NOT_FOUND',
      message: 'QRã‚³ãƒ¼ãƒ‰ãŒç„¡åŠ¹ã§ã™'
    });
  }

  // æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
  if (new Date() > onetimeToken.expiresAt) {
    return res.status(400).json({
      success: false,
      error: 'TOKEN_EXPIRED',
      message: 'ã“ã®QRã‚³ãƒ¼ãƒ‰ã¯æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã§ã™ï¼ˆç™ºè¡Œã‹ã‚‰24æ™‚é–“ä»¥å†…ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼‰'
    });
  }

  // ä½¿ç”¨æ¸ˆã¿ãƒã‚§ãƒƒã‚¯
  if (onetimeToken.used) {
    return res.status(400).json({
      success: false,
      error: 'TOKEN_ALREADY_USED',
      message: 'ã“ã®QRã‚³ãƒ¼ãƒ‰ã¯ã™ã§ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™'
    });
  }

  // è·å“¡ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
  if (!onetimeToken.employee.isActive) {
    return res.status(403).json({
      success: false,
      error: 'EMPLOYEE_INACTIVE',
      message: 'ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™'
    });
  }

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨æ¸ˆã¿ã«ã™ã‚‹
  await prisma.onetimeToken.update({
    where: { id: onetimeToken.id },
    data: {
      used: true,
      usedAt: new Date(),
      usedIpAddress: ipAddress,
      usedUserAgent: userAgent
    }
  });

  // ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¨˜éŒ²
  await prisma.loginHistory.create({
    data: {
      employeeId: onetimeToken.employeeId,
      ipAddress,
      userAgent,
      loginMethod: 'onetime_token',
      success: true
    }
  });

  // è·å“¡æƒ…å ±ã‚’è¿”å´
  res.json({
    success: true,
    employee: {
      employeeId: onetimeToken.employee.employeeId,
      name: onetimeToken.employee.name,
      email: onetimeToken.employee.email,
      permissionLevel: onetimeToken.employee.permissionLevel,
      accountType: onetimeToken.employee.accountType,
      role: onetimeToken.employee.role,
      department: onetimeToken.employee.department
    }
  });
}
```

---

#### API-3: å¾“æ¥å‹èªè¨¼

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v2/auth/authenticate`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "employeeId": "EMP2024123",
  "password": "EMP2024123_InitPass2025"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "passwordMustChange": true,
  "employee": {
    "employeeId": "EMP2024123",
    "name": "å±±ç”° å¤ªéƒ",
    "email": "yamada.taro@hospital.local",
    "permissionLevel": 3.5,
    "accountType": "STAFF",
    "role": "nurse",
    "department": "å¤–ç§‘"
  }
}
```

**å®Ÿè£…ä¾‹**:
```typescript
import bcrypt from 'bcryptjs';

export async function authenticate(req: Request, res: Response) {
  const { employeeId, password } = req.body;

  // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ï¼ˆéå»30åˆ†é–“ã«5å›ä»¥ä¸Šå¤±æ•—ï¼‰
  const failedAttempts = await prisma.loginAttempt.count({
    where: {
      employeeId,
      success: false,
      attemptAt: { gte: new Date(Date.now() - 30 * 60 * 1000) }
    }
  });

  if (failedAttempts >= 5) {
    return res.status(403).json({
      success: false,
      error: 'ACCOUNT_LOCKED',
      message: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ30åˆ†å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ï¼‰'
    });
  }

  // è·å“¡æ¤œç´¢
  const employee = await prisma.employee.findUnique({
    where: { employeeId }
  });

  if (!employee || !employee.isActive) {
    // å¤±æ•—ã‚’è¨˜éŒ²
    await prisma.loginAttempt.create({
      data: {
        employeeId,
        ipAddress: req.ip,
        success: false
      }
    });

    return res.status(401).json({
      success: false,
      error: 'INVALID_CREDENTIALS',
      message: 'è·å“¡IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'
    });
  }

  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
  const passwordMatch = await bcrypt.compare(password, employee.passwordHash);

  if (!passwordMatch) {
    // å¤±æ•—ã‚’è¨˜éŒ²
    await prisma.loginAttempt.create({
      data: {
        employeeId,
        ipAddress: req.ip,
        success: false
      }
    });

    return res.status(401).json({
      success: false,
      error: 'INVALID_CREDENTIALS',
      message: 'è·å“¡IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'
    });
  }

  // æˆåŠŸã‚’è¨˜éŒ²
  await prisma.loginAttempt.create({
    data: {
      employeeId,
      ipAddress: req.ip,
      success: true
    }
  });

  await prisma.loginHistory.create({
    data: {
      employeeId,
      ipAddress: req.ip,
      userAgent: req.headers['user-agent'] || '',
      loginMethod: 'password',
      success: true
    }
  });

  // èªè¨¼æˆåŠŸ
  res.json({
    success: true,
    passwordMustChange: employee.passwordMustChange,
    employee: {
      employeeId: employee.employeeId,
      name: employee.name,
      email: employee.email,
      permissionLevel: employee.permissionLevel,
      accountType: employee.accountType,
      role: employee.role,
      department: employee.department
    }
  });
}
```

---

#### API-4: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `PUT /api/v2/auth/change-password`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "employeeId": "EMP2024123",
  "currentPassword": "EMP2024123_InitPass2025",
  "newPassword": "MySecurePass123!"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ"
}
```

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼**:
- 8æ–‡å­—ä»¥ä¸Š
- å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’å«ã‚€
- æ•°å­—ã‚’å«ã‚€
- è¨˜å·ã‚’1ã¤ä»¥ä¸Šå«ã‚€ï¼ˆæ¨å¥¨ï¼‰

**å®Ÿè£…ä¾‹**:
```typescript
export async function changePassword(req: Request, res: Response) {
  const { employeeId, currentPassword, newPassword } = req.body;

  // è·å“¡æ¤œç´¢
  const employee = await prisma.employee.findUnique({
    where: { employeeId }
  });

  if (!employee) {
    return res.status(404).json({ error: 'EMPLOYEE_NOT_FOUND' });
  }

  // ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
  const passwordMatch = await bcrypt.compare(currentPassword, employee.passwordHash);

  if (!passwordMatch) {
    return res.status(401).json({
      success: false,
      error: 'INVALID_CURRENT_PASSWORD',
      message: 'ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'
    });
  }

  // æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒªã‚·ãƒ¼æ¤œè¨¼
  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#])[A-Za-z\d@$!%*?&#]{8,}$/;

  if (!passwordRegex.test(newPassword)) {
    return res.status(400).json({
      success: false,
      error: 'WEAK_PASSWORD',
      message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§ã€å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»æ•°å­—ãƒ»è¨˜å·ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™'
    });
  }

  // æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆbcrypt cost=10ï¼‰
  const newPasswordHash = await bcrypt.hash(newPassword, 10);

  // DBã‚’æ›´æ–°
  await prisma.employee.update({
    where: { employeeId },
    data: {
      passwordHash: newPasswordHash,
      passwordUpdatedAt: new Date(),
      passwordMustChange: false
    }
  });

  res.json({
    success: true,
    message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ'
  });
}
```

---

### VoiceDriveå´API

#### API-5: ãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆVoiceDriveå´ãƒ—ãƒ­ã‚­ã‚·ï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/auth/verify-onetime-token`

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡
2. åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã® `POST /api/v2/auth/verify-onetime-token` ã‚’å‘¼ã³å‡ºã—
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡
4. Userãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢/ä½œæˆ
5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ30æ—¥é–“æœ‰åŠ¹ï¼‰
6. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹

**å®Ÿè£…ä¾‹**:
```typescript
import axios from 'axios';

export async function verifyOnetimeTokenProxy(req: Request, res: Response) {
  const { token } = req.body;

  try {
    // åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã®èªè¨¼APIã‚’å‘¼ã³å‡ºã—
    const authResponse = await axios.post(
      `${process.env.MEDICAL_SYSTEM_API}/api/v2/auth/verify-onetime-token`,
      {
        token,
        ipAddress: req.ip,
        userAgent: req.headers['user-agent']
      }
    );

    if (!authResponse.data.success) {
      return res.status(401).json(authResponse.data);
    }

    const employeeData = authResponse.data.employee;

    // VoiceDriveã®Userãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢ã¾ãŸã¯ä½œæˆ
    let user = await prisma.user.findUnique({
      where: { employeeId: employeeData.employeeId }
    });

    if (!user) {
      // åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚: Userã‚’ä½œæˆ
      user = await prisma.user.create({
        data: {
          employeeId: employeeData.employeeId,
          name: employeeData.name,
          email: employeeData.email,
          permissionLevel: employeeData.permissionLevel,
          accountType: employeeData.accountType,
          role: employeeData.role,
          lastLoginAt: new Date()
        }
      });
    } else {
      // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼: æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ã‚’æ›´æ–°
      await prisma.user.update({
        where: { id: user.id },
        data: { lastLoginAt: new Date() }
      });
    }

    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ30æ—¥é–“æœ‰åŠ¹ï¼‰
    req.session.userId = user.id;
    req.session.employeeId = user.employeeId;
    req.session.cookie.maxAge = 30 * 24 * 60 * 60 * 1000; // 30æ—¥

    await new Promise<void>((resolve, reject) => {
      req.session.save((err) => {
        if (err) reject(err);
        else resolve();
      });
    });

    res.json({
      success: true,
      user: {
        id: user.id,
        employeeId: user.employeeId,
        name: user.name,
        email: user.email,
        permissionLevel: user.permissionLevel,
        accountType: user.accountType,
        role: user.role
      }
    });
  } catch (error) {
    console.error('Token verification failed:', error);
    res.status(500).json({
      success: false,
      error: 'INTERNAL_ERROR',
      message: 'èªè¨¼å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
    });
  }
}
```

---

#### API-6: ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/auth/me`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "id": "clxyz123abc",
  "employeeId": "EMP2024123",
  "name": "å±±ç”° å¤ªéƒ",
  "email": "yamada.taro@hospital.local",
  "permissionLevel": 3.5,
  "accountType": "STAFF",
  "role": "nurse",
  "lastLoginAt": "2025-10-27T10:30:00Z"
}
```

**å®Ÿè£…ä¾‹**:
```typescript
export async function getCurrentUser(req: Request, res: Response) {
  if (!req.session.userId) {
    return res.status(401).json({ error: 'NOT_AUTHENTICATED' });
  }

  const user = await prisma.user.findUnique({
    where: { id: req.session.userId },
    select: {
      id: true,
      employeeId: true,
      name: true,
      email: true,
      permissionLevel: true,
      accountType: true,
      role: true,
      lastLoginAt: true
    }
  });

  if (!user) {
    return res.status(404).json({ error: 'USER_NOT_FOUND' });
  }

  res.json(user);
}
```

---

## ğŸ“± PWA (Progressive Web App) å®Ÿè£…

### manifest.json

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `public/manifest.json`

```json
{
  "name": "VoiceDrive - å¤§åŸè¨˜å¿µç—…é™¢",
  "short_name": "VoiceDrive",
  "description": "å¤§åŸè¨˜å¿µç—…é™¢ è·å“¡ãƒãƒ¼ã‚¿ãƒ« - éŸ³å£°æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ ",
  "start_url": "/",
  "display": "standalone",
  "theme_color": "#3b82f6",
  "background_color": "#1f2937",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "screenshots": [
    {
      "src": "/screenshots/home.png",
      "sizes": "540x720",
      "type": "image/png",
      "form_factor": "narrow"
    },
    {
      "src": "/screenshots/voice-post.png",
      "sizes": "540x720",
      "type": "image/png",
      "form_factor": "narrow"
    }
  ]
}
```

---

### Service Worker

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `public/service-worker.js`

```javascript
const CACHE_NAME = 'voicedrive-v1.0.0';
const urlsToCache = [
  '/',
  '/login',
  '/static/css/main.css',
  '/static/js/main.js',
  '/icons/icon-192x192.png',
  '/icons/icon-512x512.png'
];

// ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then((cache) => cache.addAll(urlsToCache))
  );
});

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request)
      .then((response) => {
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°ãã‚Œã‚’è¿”ã—ã€ãªã‘ã‚Œã°ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—
        return response || fetch(event.request);
      })
  );
});

// å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤
self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames.map((cacheName) => {
          if (cacheName !== CACHE_NAME) {
            return caches.delete(cacheName);
          }
        })
      );
    })
  );
});
```

---

### PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¿ƒé€²UI

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `src/components/PWAInstallPrompt.tsx`

```typescript
import React, { useState, useEffect } from 'react';

interface BeforeInstallPromptEvent extends Event {
  prompt: () => Promise<void>;
  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;
}

export const PWAInstallPrompt: React.FC = () => {
  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);
  const [showPrompt, setShowPrompt] = useState(false);

  useEffect(() => {
    const handler = (e: Event) => {
      e.preventDefault();
      setDeferredPrompt(e as BeforeInstallPromptEvent);
      setShowPrompt(true);
    };

    window.addEventListener('beforeinstallprompt', handler);

    return () => {
      window.removeEventListener('beforeinstallprompt', handler);
    };
  }, []);

  const handleInstallClick = async () => {
    if (!deferredPrompt) return;

    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;

    if (outcome === 'accepted') {
      console.log('User accepted the install prompt');
    }

    setDeferredPrompt(null);
    setShowPrompt(false);
  };

  const handleDismiss = () => {
    setShowPrompt(false);
    // 1é€±é–“å¾Œã«å†åº¦è¡¨ç¤º
    localStorage.setItem('pwa-prompt-dismissed', Date.now().toString());
  };

  if (!showPrompt) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 shadow-lg z-50">
      <div className="max-w-lg mx-auto flex items-center justify-between">
        <div className="flex-1">
          <h3 className="font-bold text-lg mb-1">ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ </h3>
          <p className="text-sm text-blue-100">
            ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¦ã€æ¯å›ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ï¼
          </p>
        </div>
        <div className="flex gap-2 ml-4">
          <button
            onClick={handleDismiss}
            className="px-4 py-2 text-sm text-white hover:bg-blue-800 rounded"
          >
            å¾Œã§
          </button>
          <button
            onClick={handleInstallClick}
            className="px-4 py-2 text-sm bg-white text-blue-600 font-bold rounded hover:bg-blue-50"
          >
            è¿½åŠ ã™ã‚‹
          </button>
        </div>
      </div>
    </div>
  );
};
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### 1. ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

**ç”Ÿæˆæ–¹æ³•**:
```typescript
import crypto from 'crypto';

// æš—å·å­¦çš„ã«å®‰å…¨ãª64æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
const token = crypto.randomBytes(32).toString('hex');
```

**ç‰¹å¾´**:
- 64æ–‡å­—ï¼ˆ256ãƒ“ãƒƒãƒˆï¼‰ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼
- æ¨æ¸¬ä¸å¯èƒ½
- å˜ä¸€ä½¿ç”¨ï¼ˆ`used = true`ã§ç„¡åŠ¹åŒ–ï¼‰
- 24æ™‚é–“ã®æœ‰åŠ¹æœŸé™

---

### 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥

**æ–¹å¼**: bcrypt (cost factor = 10)

```typescript
import bcrypt from 'bcryptjs';

// ãƒãƒƒã‚·ãƒ¥åŒ–
const passwordHash = await bcrypt.hash(password, 10);

// æ¤œè¨¼
const isValid = await bcrypt.compare(inputPassword, passwordHash);
```

---

### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `express-session` + `connect-redis`

**è¨­å®š**:
```typescript
import session from 'express-session';
import RedisStore from 'connect-redis';
import { createClient } from 'redis';

const redisClient = createClient({
  url: process.env.REDIS_URL || 'redis://localhost:6379'
});

await redisClient.connect();

app.use(session({
  store: new RedisStore({ client: redisClient }),
  secret: process.env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  cookie: {
    secure: process.env.NODE_ENV === 'production', // HTTPS only
    httpOnly: true,                                  // JavaScriptçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
    maxAge: 30 * 24 * 60 * 60 * 1000,               // 30æ—¥
    sameSite: 'lax'                                  // CSRFå¯¾ç­–
  }
}));
```

---

### 4. CORSè¨­å®š

**VoiceDriveå´**:
```typescript
import cors from 'cors';

app.use(cors({
  origin: process.env.MEDICAL_SYSTEM_URL,  // åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‰ãƒ¡ã‚¤ãƒ³
  credentials: true                          // Cookieã‚’å«ã‚ã‚‹
}));
```

---

### 5. Rate Limiting

**èªè¨¼APIç”¨**:
```typescript
import rateLimit from 'express-rate-limit';

const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†
  max: 5,                    // æœ€å¤§5å›
  message: {
    error: 'TOO_MANY_REQUESTS',
    message: 'ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãŒå¤šã™ãã¾ã™ã€‚15åˆ†å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'
  },
  standardHeaders: true,
  legacyHeaders: false
});

app.post('/api/auth/login', authLimiter, login);
app.post('/api/auth/verify-onetime-token', authLimiter, verifyOnetimeTokenProxy);
```

---

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Phase 1: åŸºç›¤å®Ÿè£…ï¼ˆWeek 1-2ï¼‰

#### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ï¼ˆWeek 1ï¼‰
- [ ] **Day 1**: Employeeãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µï¼ˆ3ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼‰
- [ ] **Day 2**: OnetimeTokenãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] **Day 3**: LoginHistoryãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] **Day 4**: LoginAttemptãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] **Day 5**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã€åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥

#### VoiceDriveå´ï¼ˆWeek 2ï¼‰
- [ ] **Day 1-2**: Redisã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€express-sessionå®Ÿè£…
- [ ] **Day 3-4**: useAuthãƒ•ãƒƒã‚¯å®Ÿè£…
- [ ] **Day 5**: GET /api/auth/me å®Ÿè£…

---

### Phase 2: QRã‚³ãƒ¼ãƒ‰èªè¨¼å®Ÿè£…ï¼ˆWeek 3-4ï¼‰

#### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ï¼ˆWeek 3ï¼‰
- [ ] **Day 1**: POST /api/v2/auth/generate-onetime-token å®Ÿè£…
- [ ] **Day 2**: POST /api/v2/auth/verify-onetime-token å®Ÿè£…
- [ ] **Day 3**: QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆï¼ˆqrcode npm packageï¼‰
- [ ] **Day 4**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚·ãƒ¼ãƒˆå°åˆ·æ©Ÿèƒ½
- [ ] **Day 5**: å˜ä½“ãƒ†ã‚¹ãƒˆ

#### VoiceDriveå´ï¼ˆWeek 4ï¼‰
- [ ] **Day 1-2**: POST /api/auth/verify-onetime-token ãƒ—ãƒ­ã‚­ã‚·å®Ÿè£…
- [ ] **Day 3**: QRã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼å®Ÿè£…
- [ ] **Day 4-5**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€E2Eãƒ†ã‚¹ãƒˆ

---

### Phase 3: PWAå®Ÿè£…ï¼ˆWeek 5ï¼‰

#### VoiceDriveå´ã®ã¿
- [ ] **Day 1**: manifest.jsonä½œæˆã€ã‚¢ã‚¤ã‚³ãƒ³æº–å‚™
- [ ] **Day 2**: Service Workerå®Ÿè£…
- [ ] **Day 3**: PWAInstallPromptã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] **Day 4**: iOS Safariã€Android Chromeå‹•ä½œç¢ºèª
- [ ] **Day 5**: PWAç›£æŸ»ï¼ˆLighthouseç­‰ï¼‰

---

### Phase 4: å¾“æ¥å‹èªè¨¼å®Ÿè£…ï¼ˆWeek 6-7ï¼‰

#### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ï¼ˆWeek 6ï¼‰
- [ ] **Day 1-2**: POST /api/v2/auth/authenticate å®Ÿè£…
- [ ] **Day 3**: PUT /api/v2/auth/change-password å®Ÿè£…
- [ ] **Day 4**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] **Day 5**: å˜ä½“ãƒ†ã‚¹ãƒˆ

#### VoiceDriveå´ï¼ˆWeek 7ï¼‰
- [ ] **Day 1-2**: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢å®Ÿè£…
- [ ] **Day 3**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢å®Ÿè£…
- [ ] **Day 4**: usePermissionsãƒ•ãƒƒã‚¯ä¿®æ­£
- [ ] **Day 5**: E2Eãƒ†ã‚¹ãƒˆ

---

### Phase 5: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆWeek 8ï¼‰

#### ä¸¡ã‚·ã‚¹ãƒ†ãƒ åˆåŒ
- [ ] **Day 1**: QRã‚³ãƒ¼ãƒ‰èªè¨¼ãƒ•ãƒ­ãƒ¼E2Eãƒ†ã‚¹ãƒˆ
- [ ] **Day 2**: å¾“æ¥å‹èªè¨¼ãƒ•ãƒ­ãƒ¼E2Eãƒ†ã‚¹ãƒˆ
- [ ] **Day 3**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] **Day 4**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] **Day 5**: ãƒã‚°ä¿®æ­£

---

### Phase 6: æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ï¼ˆWeek 9ï¼‰

- [ ] **Day 1**: ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] **Day 2-3**: äººäº‹éƒ¨ã‚¹ã‚¿ãƒƒãƒ•ã«ã‚ˆã‚‹å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆ
- [ ] **Day 4**: æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] **Day 5**: æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆï¼ˆéƒ¨ç½²å˜ä½ï¼‰

**åˆè¨ˆ**: ç´„9é€±é–“ï¼ˆ2ãƒ¶æœˆï¼‰

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰

### ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£

| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬å®šæ–¹æ³• |
|-----|------|---------|
| **åˆå›ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸç‡** | 95%ä»¥ä¸Š | LoginHistoryãƒ†ãƒ¼ãƒ–ãƒ«åˆ†æ |
| **QRã‚³ãƒ¼ãƒ‰åˆ©ç”¨ç‡** | 70%ä»¥ä¸Š | loginMethod = 'onetime_token' ã®å‰²åˆ |
| **PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç‡** | 60%ä»¥ä¸Š | PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆè¿½è·¡ |
| **å¹³å‡ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“ï¼ˆQRã‚³ãƒ¼ãƒ‰ï¼‰** | 30ç§’ä»¥å†… | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åˆ†æ |
| **å¹³å‡ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“ï¼ˆå¾“æ¥å‹ï¼‰** | 2åˆ†ä»¥å†… | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åˆ†æ |
| **ãƒ˜ãƒ«ãƒ—ãƒ‡ã‚¹ã‚¯å•ã„åˆã‚ã›ä»¶æ•°** | æœˆ10ä»¶ä»¥ä¸‹ | ãƒ˜ãƒ«ãƒ—ãƒ‡ã‚¹ã‚¯è¨˜éŒ² |

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬å®šæ–¹æ³• |
|-----|------|---------|
| **ä¸æ­£ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œæ¤œçŸ¥ç‡** | 100% | LoginAttemptãƒ†ãƒ¼ãƒ–ãƒ«ç›£è¦– |
| **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ç™ºå‹•ç‡** | 1%æœªæº€ | LoginAttemptãƒ†ãƒ¼ãƒ–ãƒ«åˆ†æ |
| **QRã‚³ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™å†…ä½¿ç”¨ç‡** | 98%ä»¥ä¸Š | OnetimeTokenãƒ†ãƒ¼ãƒ–ãƒ«åˆ†æ |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å®Œäº†ç‡ï¼ˆåˆå›ï¼‰** | 95%ä»¥ä¸Š | Employee.passwordMustChangeåˆ†æ |

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬å®šæ–¹æ³• |
|-----|------|---------|
| **èªè¨¼APIå¿œç­”æ™‚é–“** | 500msä»¥å†… | APMï¼ˆApplication Performance Monitoringï¼‰ |
| **QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ™‚é–“** | 2ç§’ä»¥å†… | APIå¿œç­”æ™‚é–“ç›£è¦– |
| **PWAèµ·å‹•æ™‚é–“** | 1ç§’ä»¥å†… | Lighthouse PWAç›£æŸ» |

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [ ] Employeeãƒ†ãƒ¼ãƒ–ãƒ«ã«3ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆpasswordHash, passwordUpdatedAt, passwordMustChangeï¼‰
- [ ] OnetimeTokenãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] LoginHistoryãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] LoginAttemptãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

#### APIå®Ÿè£…
- [ ] POST /api/v2/auth/generate-onetime-token
- [ ] POST /api/v2/auth/verify-onetime-token
- [ ] POST /api/v2/auth/authenticate
- [ ] PUT /api/v2/auth/change-password

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] bcryptçµ±åˆï¼ˆcost=10ï¼‰
- [ ] Rate Limitè¨­å®šï¼ˆ5 req/15minï¼‰
- [ ] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ5å›å¤±æ•—ã§30åˆ†ï¼‰
- [ ] CORSè¨­å®š

#### æ©Ÿèƒ½å®Ÿè£…
- [ ] QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ©Ÿèƒ½ï¼ˆqrcode npm packageï¼‰
- [ ] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚·ãƒ¼ãƒˆå°åˆ·æ©Ÿèƒ½
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œè‡ªå‹•å‰Šé™¤ï¼ˆcronã‚¸ãƒ§ãƒ–ï¼‰

---

### VoiceDriveå´

#### èªè¨¼åŸºç›¤
- [ ] useAuthãƒ•ãƒƒã‚¯å®Ÿè£…
- [ ] express-session + Redis ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] GET /api/auth/me å®Ÿè£…
- [ ] POST /api/auth/verify-onetime-token ãƒ—ãƒ­ã‚­ã‚·
- [ ] POST /api/auth/login ãƒ—ãƒ­ã‚­ã‚·

#### UIå®Ÿè£…
- [ ] QRã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- [ ] å¾“æ¥å‹ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢
- [ ] PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¿ƒé€²UI

#### PWAå¯¾å¿œ
- [ ] manifest.jsonä½œæˆ
- [ ] Service Workerå®Ÿè£…
- [ ] ã‚¢ã‚¤ã‚³ãƒ³æº–å‚™ï¼ˆ8ã‚µã‚¤ã‚º: 72x72 ~ 512x512ï¼‰
- [ ] iOS Safariå‹•ä½œç¢ºèª
- [ ] Android Chromeå‹•ä½œç¢ºèª

#### ãƒ•ãƒƒã‚¯ä¿®æ­£
- [ ] usePermissionsã‚’useAuthãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
- [ ] ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰/æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½

---

### ãƒ†ã‚¹ãƒˆ

#### å˜ä½“ãƒ†ã‚¹ãƒˆ
- [ ] åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ : å„APIå˜ä½“ãƒ†ã‚¹ãƒˆ
- [ ] VoiceDrive: useAuthãƒ•ãƒƒã‚¯å˜ä½“ãƒ†ã‚¹ãƒˆ

#### çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] QRã‚³ãƒ¼ãƒ‰èªè¨¼ãƒ•ãƒ­ãƒ¼E2E
- [ ] å¾“æ¥å‹èªè¨¼ãƒ•ãƒ­ãƒ¼E2E
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ•ãƒ­ãƒ¼E2E
- [ ] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯E2E

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ ] SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ç¢ºèª
- [ ] XSSå¯¾ç­–ç¢ºèª
- [ ] CSRFå¯¾ç­–ç¢ºèª
- [ ] Rate Limitå‹•ä½œç¢ºèª
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³å†åˆ©ç”¨æ”»æ’ƒå¯¾ç­–ç¢ºèª

#### ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ ] äººäº‹éƒ¨ã‚¹ã‚¿ãƒƒãƒ•ã«ã‚ˆã‚‹å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆ
- [ ] åŒ»ç™‚è·å“¡ï¼ˆé«˜é½¢è€…å«ã‚€ï¼‰ã«ã‚ˆã‚‹å®Ÿåœ°ãƒ†ã‚¹ãƒˆ
- [ ] PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ç¢ºèª

---

## ğŸ“ è£œè¶³è³‡æ–™

### å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. **UnauthorizedPage DBè¦ä»¶åˆ†æ**
   `mcp-shared/docs/UnauthorizedPage_DBè¦ä»¶åˆ†æ_20251027.md`

2. **UnauthorizedPage æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ**
   `mcp-shared/docs/UnauthorizedPageæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251027.md`

3. **ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸**
   `mcp-shared/docs/ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md`

---

## ğŸ”„ æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å†…å®¹ | æ‹…å½“ |
|------|------|------|
| 2025-10-27 | åˆç‰ˆä½œæˆï¼ˆQRã‚³ãƒ¼ãƒ‰ + PWAæ–¹å¼æ¡ç”¨æ±ºå®šï¼‰ | VoiceDriveé–‹ç™ºãƒãƒ¼ãƒ  |

---

## ğŸ“ é€£çµ¡å…ˆ

**VoiceDriveé–‹ç™ºãƒãƒ¼ãƒ **
Email: dev@voicedrive.hospital.local
Slack: #voicedrive-dev

**åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ **
Email: medical-it@hospital.local
Slack: #medical-system-integration

---

**ä½œæˆè€…**: VoiceDriveé–‹ç™ºãƒãƒ¼ãƒ 
**æ‰¿èªå¾…ã¡**: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ã‹ã‚‰ã®å®Ÿè£…å¯å¦å›ç­”
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Phase 1ï¼ˆWeek 1-2ï¼‰ã®ç€æ‰‹

---

**æ–‡æ›¸çµ‚äº†**
