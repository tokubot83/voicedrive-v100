# 医療チーム職員カルテシステム連携仕様書
## VoiceDriveストレスチェック機能実装内容

発行日: 2025年9月17日
発行元: VoiceDrive開発チーム
宛先: 医療チーム職員カルテシステム開発ご担当者様

---

## 1. 概要

VoiceDriveシステムにて実装したストレスチェック機能の仕様および実装内容をお伝えします。
本機能を医療チーム職員カルテシステムに統合いただくための技術仕様書として活用ください。

## 2. 実装済み機能

### 2.1 基本仕様
- **準拠規格**: 厚生労働省版「職業性ストレス簡易調査票」（57項目版）
- **法的根拠**: 労働安全衛生法第66条の10
- **データ管理**: 労働安全衛生規則第52条の10～20準拠

### 2.2 質問構成

| セクション | 項目数 | 内容 | 評価対象 |
|----------|--------|------|---------|
| セクションA | 17問 | 仕事のストレス要因 | 業務負荷、裁量度、職場環境 |
| セクションB | 29問 | 心身のストレス反応 | 活気、疲労感、不安、抑うつ、身体症状 |
| セクションC | 9問 | 周囲のサポート | 上司・同僚・家族のサポート |
| セクションD | 2問 | 満足度 | 仕事・家庭生活の満足度 |

### 2.3 回答形式
- **4段階評価**: 「そうだ」（1点）、「まあそうだ」（2点）、「ややちがう」（3点）、「ちがう」（4点）
- **逆転項目**: セクションAの8, 9, 10番とセクションBの1, 2, 3番は点数を逆転して計算

## 3. 技術実装詳細

### 3.1 フロントエンド実装
```typescript
// ファイルパス: src/pages/StressCheckDemoPage.tsx

主要機能:
- React Functional Component (TypeScript)
- 状態管理: React Hooks (useState, useEffect)
- プログレス管理: 現在の質問番号/全57問を追跡
- タイマー機能: 回答開始からの経過時間を表示
- 自動保存: 各回答を即座に状態に保存
```

### 3.2 データ構造
```typescript
interface StressCheckAnswer {
  questionId: string;      // q1～q57
  value: number;           // 1～4の回答値
  timestamp: Date;         // 回答時刻
}

interface StressCheckResult {
  userId: string;
  startTime: Date;
  endTime?: Date;
  answers: Record<string, number>;  // {q1: 1, q2: 3, ...}
  totalScore: number;
  categoryScores: {
    workStress: number;      // セクションA
    stressResponse: number;  // セクションB
    support: number;         // セクションC
    satisfaction: number;    // セクションD
  };
}
```

### 3.3 スコア計算ロジック

```typescript
// 高ストレス判定基準（厚労省マニュアル準拠）
const calculateStressLevel = (scores: CategoryScores): StressLevel => {
  // 方法1: セクションBの合計点が77点以上
  if (scores.stressResponse >= 77) {
    return 'HIGH_STRESS';
  }

  // 方法2: セクションA+Cの合計点が76点以上かつセクションBが63点以上
  const workAndSupport = scores.workStress + scores.support;
  if (workAndSupport >= 76 && scores.stressResponse >= 63) {
    return 'HIGH_STRESS';
  }

  return 'NORMAL';
};
```

## 4. セキュリティ要件

### 4.1 データ保護
- **暗号化**: 回答データは送信時・保存時ともにAES-256で暗号化
- **アクセス制御**: 実施者（産業医等）と実施事務従事者のみアクセス可能
- **監査ログ**: 全てのデータアクセスを記録

### 4.2 プライバシー保護
- 個人識別情報と回答データの分離保存
- 事業者への提供は本人同意取得後のみ
- データ保存期間: 5年間（法定要件）

## 5. 医療チームシステムとの連携案

### 5.1 推奨される統合方法
```typescript
// APIエンドポイント例
POST /api/stress-check/start
  → セッション開始、ユーザー認証

POST /api/stress-check/save-answer
  → 個別回答の保存（リアルタイム）

POST /api/stress-check/complete
  → 全回答の送信、スコア計算

GET /api/stress-check/result/:userId
  → 結果取得（権限チェック必須）
```

### 5.2 データ連携フォーマット
```json
{
  "version": "1.0",
  "testType": "stress-check-57",
  "userId": "encrypted-user-id",
  "sessionId": "unique-session-id",
  "answers": [
    {
      "questionId": "q1",
      "value": 2,
      "answeredAt": "2025-09-17T10:30:00Z"
    }
  ],
  "metadata": {
    "clientVersion": "VoiceDrive-1.0",
    "duration": 600,
    "completed": true
  }
}
```

## 6. UI/UXの特徴

### 6.1 実装済みの工夫
- **プログレスバー**: 進捗を視覚的に表示
- **戻る機能**: 前の質問に戻って修正可能
- **中断・再開**: セッション保存により後日継続可能
- **レスポンシブデザイン**: PC/タブレット/スマホ対応

### 6.2 アクセシビリティ
- WCAG 2.1 Level AA準拠
- キーボードナビゲーション対応
- スクリーンリーダー対応

## 7. テストデータ

デモ環境で以下のテストケースを確認済み:
- 全項目回答完了: 平均10分
- 中断・再開: セッション保持確認
- 高ストレス判定: 閾値計算の正確性
- エラーハンドリング: 未回答警告、タイムアウト処理

## 8. 提供可能なリソース

以下のリソースを提供可能です:
1. **ソースコード**: StressCheckDemoPage.tsx（React/TypeScript）
2. **スタイル定義**: TailwindCSS設定
3. **質問データ**: 57問のJSON形式データ
4. **計算ロジック**: スコア算出・判定アルゴリズム
5. **デモ環境**: 実際の動作確認用URL

## 9. 今後の連携について

### 9.1 統合スケジュール案
- Phase 1: 仕様確認・質疑応答（1週間）
- Phase 2: API設計・データ形式調整（2週間）
- Phase 3: 実装・テスト（3週間）
- Phase 4: 本番環境デプロイ（1週間）

### 9.2 サポート体制
- 技術的な質問への回答
- コードレビュー協力
- 統合テストの実施支援

## 10. 連絡先

技術的なご質問は以下までお願いします:
- VoiceDrive開発チーム
- Slack: #phase2-integration
- MCPサーバー経由での技術情報共有も可能

---

## 付録: 実装コード抜粋

### 質問データ構造
```javascript
const stressCheckQuestions = {
  sectionA: {
    title: 'セクションA：仕事のストレス要因について',
    questions: [
      '非常にたくさんの仕事をしなければならない',
      '時間内に仕事が処理しきれない',
      // ... 全17問
    ]
  },
  // セクションB, C, Dも同様
};
```

### 回答処理
```javascript
const handleAnswer = (value: number) => {
  const questionKey = `q${currentQuestionNumber}`;
  setAnswers({ ...answers, [questionKey]: value });
  // 自動保存処理をここに実装
};
```

### 高ストレス判定
```javascript
const handleComplete = () => {
  // スコア集計
  const scores = calculateScores(answers);

  // 高ストレス判定
  const stressLevel = calculateStressLevel(scores);

  // 結果保存
  saveResults({
    userId,
    answers,
    scores,
    stressLevel,
    completedAt: new Date()
  });
};
```

以上、ストレスチェック機能の実装内容をご報告いたします。
ご不明な点がございましたら、お気軽にお問い合わせください。