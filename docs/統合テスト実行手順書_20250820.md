# 異議申し立て機能 統合テスト実行手順書

## テスト実施日: 2025年8月20日
## 作成者: VoiceDriveチーム
## 対象: 両チーム合同テスト

---

## 📋 テスト概要

### 目的
医療職員管理システムとVoiceDrive間の異議申し立て機能の統合動作確認

### テスト範囲
- 評価期間マスタデータ取得
- 優先度別異議申し立て送信
- 審査者自動割り当て
- エラーハンドリング
- 通知機能

---

## 🚀 事前準備

### 1. 環境準備

#### VoiceDriveチーム側
```bash
# リポジトリ最新化
git pull origin main

# 依存パッケージインストール
npm install

# 開発サーバー起動（ターミナル1）
npm run dev
# → http://localhost:5173

# APIサーバー起動（ターミナル2）
cd server && npm run dev
# → http://localhost:3001
```

#### 医療システムチーム側
```bash
# APIサーバー起動
npm run dev
# → http://localhost:3000

# 評価期間マスタAPI確認
curl http://localhost:3000/api/v1/evaluation/periods
```

### 2. テストデータ確認

以下のファイルが存在することを確認：
- `test/integration/appeal-integration-test.js` - メインテストスクリプト
- `test/integration/test-data.json` - テストデータ
- `test/integration/run-tests.bat` - Windows用実行スクリプト
- `test/integration/run-tests.sh` - Mac/Linux用実行スクリプト

---

## 🧪 テスト実行手順

### 方法1: 自動実行（推奨）

#### Windows環境
```cmd
cd C:\projects\voicedrive-v100
test\integration\run-tests.bat
```

#### Mac/Linux環境
```bash
cd /path/to/voicedrive-v100
chmod +x test/integration/run-tests.sh
./test/integration/run-tests.sh
```

### 方法2: 手動実行

```bash
# 環境変数設定
export VOICEDRIVE_API=http://localhost:3001
export MEDICAL_API=http://localhost:3000
export AUTH_TOKEN=test-token-12345

# テスト実行
node test/integration/appeal-integration-test.js
```

---

## 📊 テストケース一覧

### 1. API連携テスト
| No | テスト項目 | 期待結果 |
|----|-----------|----------|
| 1-1 | 評価期間マスタ取得 | 有効な評価期間リストを取得 |
| 1-2 | appealDeadlineフィルタ | 期限内の期間のみ取得 |

### 2. 優先度判定テスト
| No | テスト項目 | 条件 | 期待優先度 |
|----|-----------|------|------------|
| 2-1 | 計算誤り | appealCategory=calculation_error | HIGH |
| 2-2 | 成果見落とし | appealCategory=achievement_oversight | MEDIUM |
| 2-3 | スコア差10点以上 | 差分≥10 | HIGH |
| 2-4 | スコア差5-9点 | 5≤差分<10 | MEDIUM |
| 2-5 | その他 | appealCategory=other, 差分<5 | LOW |

### 3. 審査者割り当てテスト
| No | 優先度 | 期待される審査者 |
|----|--------|-----------------|
| 3-1 | HIGH | 部門長（DEPT_HEAD_001） |
| 3-2 | MEDIUM | 課長（SECTION_CHIEF_001） |
| 3-3 | LOW | リーダー（TEAM_LEADER_001） |

### 4. エラーハンドリングテスト
| No | テスト項目 | 期待エラー |
|----|-----------|------------|
| 4-1 | 期限切れ評価期間 | E002エラー |
| 4-2 | 理由100文字未満 | INVALID_REASONエラー |
| 4-3 | 無効なカテゴリ | INVALID_CATEGORYエラー |

### 5. ステータス管理テスト
| No | テスト項目 | 期待結果 |
|----|-----------|----------|
| 5-1 | 取り下げ機能 | status=withdrawn |
| 5-2 | 追加情報提出 | status=additional_info |

---

## 📈 テスト結果確認

### 1. コンソール出力
```
✅ 成功: 緑色で表示
❌ 失敗: 赤色で表示
⏭️ スキップ: 黄色で表示
```

### 2. 結果ファイル
```
test/results/test-results-YYYY-MM-DD.json
```

### 3. HTMLレポート
テスト完了後、自動的にブラウザで開きます。
```
test/results/report-YYYYMMDD-HHMMSS.html
```

---

## 🔍 トラブルシューティング

### エラー: "VoiceDrive APIが起動していません"
```bash
# APIサーバーを起動
npm run dev
```

### エラー: "E002: 有効な評価期間が見つかりません"
```bash
# 医療システムAPIが正しく起動しているか確認
curl http://localhost:3000/api/v1/evaluation/periods
```

### エラー: "axiosが見つかりません"
```bash
# 依存パッケージをインストール
npm install axios colors
```

---

## 📝 チェックリスト

### テスト前
- [ ] 両システムのAPIサーバー起動確認
- [ ] 最新コードの取得（git pull）
- [ ] 依存パッケージのインストール
- [ ] MCPフォルダの作成確認

### テスト中
- [ ] 評価期間取得成功
- [ ] 高優先度案件の送信成功
- [ ] 中優先度案件の送信成功
- [ ] 低優先度案件の送信成功
- [ ] エラーケースの確認
- [ ] 審査者割り当て確認

### テスト後
- [ ] テスト結果の確認（成功率80%以上）
- [ ] HTMLレポートの生成
- [ ] 失敗ケースの原因調査
- [ ] 改善点の洗い出し

---

## 📞 連絡先

### 問題発生時
- Slack: #medical-voicedrive-integration
- VoiceDriveチーム: voicedrive-dev@example.com
- 医療システムチーム: medical-tech@example.com

---

## 🎯 成功基準

### 必須項目（MUST）
- ✅ すべてのAPIエンドポイントが正常動作
- ✅ 優先度判定が仕様通り
- ✅ エラーハンドリングが適切

### 推奨項目（SHOULD）
- ✅ 成功率80%以上
- ✅ レスポンスタイム3秒以内
- ✅ 通知機能の動作確認

---

## 📅 次のステップ

### テスト成功時
1. 本番環境への展開準備
2. 運用手順書の作成
3. ユーザートレーニング計画

### テスト失敗時
1. 失敗原因の分析
2. 修正実装
3. 再テストのスケジュール調整

---

**作成日**: 2025年1月16日  
**更新日**: 2025年8月20日（テスト実施予定）