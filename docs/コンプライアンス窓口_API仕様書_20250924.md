# ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çª“å£ APIä»•æ§˜æ›¸

## ğŸ“… ä½œæˆæ—¥ï¼š2025å¹´9æœˆ24æ—¥
## ğŸ“Œ æ–‡æ›¸ç•ªå·ï¼šAPI-COMP-SPEC-001
## ğŸ”„ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š1.0.0
## ğŸ¯ å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ï¼šVoiceDrive â‡” åŒ»ç™‚è·å“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„
æœ¬æ–‡æ›¸ã¯ã€VoiceDriveã‚·ã‚¹ãƒ†ãƒ ã¨åŒ»ç™‚è·å“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ é–“ã®ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çª“å£æ©Ÿèƒ½ã«é–¢ã™ã‚‹APIä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚

### 1.2 ã‚¹ã‚³ãƒ¼ãƒ—
- é€šå ±ãƒ‡ãƒ¼ã‚¿ã®é€å—ä¿¡
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- é€²æ—ç¢ºèª
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 1.3 APIåŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ—ãƒ­ãƒˆã‚³ãƒ« | HTTPS (TLS 1.3) |
| ãƒ‡ãƒ¼ã‚¿å½¢å¼ | JSON |
| æ–‡å­—ã‚³ãƒ¼ãƒ‰ | UTF-8 |
| èªè¨¼æ–¹å¼ | Bearer Token (JWT RS256) |
| ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ | UTC (ISO 8601) |
| APIãƒãƒ¼ã‚¸ãƒ§ãƒ³ | v3 |

---

## 2. èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 2.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant VD as VoiceDrive
    participant Auth as èªè¨¼ã‚µãƒ¼ãƒãƒ¼
    participant Med as åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ 

    VD->>Auth: èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Client Credentials)
    Auth->>Auth: ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æ¤œè¨¼
    Auth->>VD: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ (JWT)
    VD->>Med: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Bearer Token)
    Med->>Med: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    Med->>VD: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹
```

### 2.2 JWTæ§‹é€ 

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT",
    "kid": "2025-09-key-01"
  },
  "payload": {
    "iss": "https://auth.medical-system.jp",
    "sub": "voicedrive-compliance-client",
    "aud": "https://api.medical-system.jp",
    "exp": 1727123456,
    "iat": 1727119856,
    "jti": "550e8400-e29b-41d4-a716-446655440000",
    "scope": "compliance:write compliance:read",
    "client_id": "voicedrive-prod-001"
  },
  "signature": "..."
}
```

### 2.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

**å¿…é ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼š**

```http
Authorization: Bearer {jwt_token}
X-Request-ID: {uuid_v4}
X-Timestamp: {iso_8601_timestamp}
X-Client-Version: 1.0.0
Content-Type: application/json
Accept: application/json
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰ï¼š**

```http
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains
Content-Security-Policy: default-src 'none'
```

---

## 3. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

### 3.1 åŸºæœ¬URL

| ç’°å¢ƒ | URL |
|------|-----|
| é–‹ç™º | `https://api-dev.medical-system.jp/v3` |
| ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° | `https://api-stg.medical-system.jp/v3` |
| æœ¬ç•ª | `https://api.medical-system.jp/v3` |

### 3.2 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ¦‚è¦

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | èªè¨¼ |
|---------|------|------|------|
| POST | `/compliance/receive` | é€šå ±å—ä¿¡ | å¿…é ˆ |
| GET | `/compliance/status/{anonymousId}` | é€²æ—ç¢ºèª | å¿…é ˆ |
| POST | `/compliance/additional-info` | è¿½åŠ æƒ…å ±é€ä¿¡ | å¿…é ˆ |
| GET | `/compliance/categories` | ã‚«ãƒ†ã‚´ãƒªä¸€è¦§å–å¾— | å¿…é ˆ |
| POST | `/webhooks/register` | Webhookç™»éŒ² | å¿…é ˆ |
| DELETE | `/webhooks/{webhookId}` | Webhookå‰Šé™¤ | å¿…é ˆ |

---

## 4. APIè©³ç´°ä»•æ§˜

### 4.1 é€šå ±å—ä¿¡API

#### `POST /compliance/receive`

**æ¦‚è¦ï¼š** VoiceDriveã‹ã‚‰æš—å·åŒ–ã•ã‚ŒãŸé€šå ±ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼š**

```typescript
interface ComplianceReceiveRequest {
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆæš—å·åŒ–ãªã—ï¼‰
  version: "1.0";
  source: "voicedrive";
  timestamp: string;  // ISO 8601

  // æš—å·åŒ–ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰
  payload: {
    encrypted: string;    // Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæš—å·æ–‡
    iv: string;          // åˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ« (hex)
    authTag: string;     // èªè¨¼ã‚¿ã‚° (hex)
    algorithm: "aes-256-gcm";
  };

  // æ¤œè¨¼ç”¨
  checksum: string;      // SHA-256 (hex)

  // ç·Šæ€¥åº¦æƒ…å ±ï¼ˆå³åº§ã®æŒ¯ã‚Šåˆ†ã‘ç”¨ï¼‰
  metadata: {
    reportId: string;    // VD-2025-XXXX
    anonymousId: string; // ANON-XXXXXX
    severity: "low" | "medium" | "high" | "critical";
    category: string;
    requiresImmediateAction: boolean;
  };
}
```

**æš—å·åŒ–å‰ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ§‹é€ ï¼š**

```typescript
interface DecryptedPayload {
  report: {
    reportId: string;
    anonymousId: string;
    submittedAt: string;

    // é€šå ±è€…æƒ…å ±
    reporter: {
      disclosureLevel: "full_anonymous" | "conditional" | "disclosed";
      consentToDisclose?: {
        granted: boolean;
        conditions?: string[];
      };
      attributes?: {
        employmentType?: string;
        yearsOfService?: string;
        ageGroup?: string;
        gender?: string;
      };
    };

    // ã‚«ãƒ†ã‚´ãƒª
    category: {
      main: string;
      sub?: string;
      details?: {
        harassmentType?: string;
        violationType?: string;
      };
    };

    // äº‹æ¡ˆè©³ç´°
    incident: {
      description: string;
      location: {
        general: string;
        specific?: string;
      };
      timeline: {
        occurredAt?: string;
        startedAt?: string;
        frequency?: string;
        isOngoing: boolean;
      };
      accused?: {
        count: number;
        relationship: string;
        position?: string;
      };
    };

    // è¨¼æ‹ 
    evidence: {
      hasEvidence: boolean;
      types: string[];
      files: Array<{
        id: string;
        fileName: string;
        mimeType: string;
        size: number;
        checksum: string;
        encryptedUrl: string;
      }>;
      witnessCount?: number;
    };

    // ç·Šæ€¥åº¦è©•ä¾¡
    assessment: {
      severity: string;
      urgencyScore: number;
      riskFactors: string[];
      requiresImmediateAction: boolean;
    };
  };
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ 200ï¼‰ï¼š**

```json
{
  "success": true,
  "caseNumber": "MED-2025-0001",
  "acknowledgementId": "ack-550e8400-e29b-41d4",
  "receivedAt": "2025-09-24T10:30:00Z",
  "message": "Report received and processing initiated",
  "estimatedResponseTime": {
    "value": 24,
    "unit": "hours"
  },
  "status": "received",
  "nextSteps": "æ‹…å½“è€…ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œæ¬¡ç¬¬ã€èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã™"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼ 400ï¼‰ï¼š**

```json
{
  "success": false,
  "error": {
    "code": "INVALID_CHECKSUM",
    "message": "Checksum verification failed",
    "details": {
      "expected": "a665a45920422f9d417e4867efdc4fb8",
      "received": "b123c45920422f9d417e4867efdc4fb8"
    }
  },
  "requestId": "req-550e8400",
  "timestamp": "2025-09-24T10:30:00Z"
}
```

**ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼š**

| ã‚³ãƒ¼ãƒ‰ | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ |
|--------|---------------|------|
| INVALID_CHECKSUM | 400 | ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¸ä¸€è‡´ |
| DECRYPTION_FAILED | 400 | å¾©å·åŒ–å¤±æ•— |
| INVALID_PAYLOAD | 400 | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å½¢å¼ã‚¨ãƒ©ãƒ¼ |
| DUPLICATE_REPORT | 409 | é‡è¤‡é€šå ± |
| AUTHENTICATION_FAILED | 401 | èªè¨¼å¤±æ•— |
| RATE_LIMIT_EXCEEDED | 429 | ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é |
| INTERNAL_ERROR | 500 | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ |

**å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«ï¼ˆVoiceDriveå´ï¼‰ï¼š**

```typescript
// VoiceDriveå´ã®é€ä¿¡å®Ÿè£…
class ComplianceAPIClient {
  private readonly apiBase = process.env.MEDICAL_API_BASE;
  private readonly apiKey = process.env.MEDICAL_API_KEY;

  async submitReport(report: ComplianceReport): Promise<SubmissionResult> {
    // 1. ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®æº–å‚™
    const payload = this.preparePayload(report);

    // 2. æš—å·åŒ–
    const encrypted = await this.encryptPayload(payload);

    // 3. ãƒã‚§ãƒƒã‚¯ã‚µãƒ ç”Ÿæˆ
    const checksum = this.generateChecksum(encrypted);

    // 4. ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ§‹ç¯‰
    const request = {
      version: "1.0",
      source: "voicedrive",
      timestamp: new Date().toISOString(),
      payload: encrypted,
      checksum,
      metadata: {
        reportId: report.reportId,
        anonymousId: report.anonymousId,
        severity: report.assessment.severity,
        category: report.category.main,
        requiresImmediateAction: report.assessment.requiresImmediateAction
      }
    };

    // 5. APIå‘¼ã³å‡ºã—
    const response = await fetch(`${this.apiBase}/compliance/receive`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${await this.getToken()}`,
        'Content-Type': 'application/json',
        'X-Request-ID': crypto.randomUUID(),
        'X-Timestamp': new Date().toISOString()
      },
      body: JSON.stringify(request)
    });

    if (!response.ok) {
      throw new APIError(await response.json());
    }

    return await response.json();
  }

  private async encryptPayload(data: any): Promise<EncryptedPayload> {
    const algorithm = 'aes-256-gcm';
    const key = Buffer.from(process.env.ENCRYPTION_KEY, 'hex');
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipheriv(algorithm, key, iv);

    let encrypted = cipher.update(JSON.stringify(data), 'utf8', 'base64');
    encrypted += cipher.final('base64');

    return {
      encrypted,
      iv: iv.toString('hex'),
      authTag: cipher.getAuthTag().toString('hex'),
      algorithm
    };
  }
}
```

---

### 4.2 é€²æ—ç¢ºèªAPI

#### `GET /compliance/status/{anonymousId}`

**æ¦‚è¦ï¼š** åŒ¿åIDã‚’ä½¿ç”¨ã—ã¦é€šå ±ã®é€²æ—çŠ¶æ³ã‚’ç¢ºèª

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼š**

```http
GET /compliance/status/ANON-A8B9C2
Authorization: Bearer {token}
X-Request-ID: 550e8400-e29b-41d4
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ 200ï¼‰ï¼š**

```json
{
  "success": true,
  "anonymousId": "ANON-A8B9C2",
  "caseNumber": "MED-2025-0001",
  "currentStatus": {
    "code": "investigating",
    "label": "èª¿æŸ»ä¸­",
    "description": "æ‹…å½“è€…ãŒäº‹å®Ÿç¢ºèªã‚’è¡Œã£ã¦ã„ã¾ã™",
    "since": "2025-09-24T14:00:00Z"
  },
  "progress": {
    "percentage": 45,
    "phase": "äº‹å®Ÿç¢ºèª",
    "estimatedCompletion": "2025-09-27T17:00:00Z"
  },
  "history": [
    {
      "status": "received",
      "timestamp": "2025-09-24T10:30:00Z",
      "note": "é€šå ±ã‚’å—ä»˜ã—ã¾ã—ãŸ"
    },
    {
      "status": "triaging",
      "timestamp": "2025-09-24T11:00:00Z",
      "note": "å†…å®¹ã‚’ç¢ºèªã—ã€æ‹…å½“è€…ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã¾ã™"
    },
    {
      "status": "investigating",
      "timestamp": "2025-09-24T14:00:00Z",
      "note": "èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã—ãŸ"
    }
  ],
  "actions": {
    "canProvideAdditionalInfo": true,
    "canWithdraw": false,
    "canViewDetails": false,
    "canContact": true
  },
  "nextSteps": "èª¿æŸ»å®Œäº†å¾Œã€å¯¾å¿œæ–¹é‡ã‚’æ±ºå®šã—ã¾ã™",
  "lastUpdated": "2025-09-24T15:30:00Z"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼ 404ï¼‰ï¼š**

```json
{
  "success": false,
  "error": {
    "code": "REPORT_NOT_FOUND",
    "message": "æŒ‡å®šã•ã‚ŒãŸåŒ¿åIDã®é€šå ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
  },
  "requestId": "req-550e8400",
  "timestamp": "2025-09-24T10:30:00Z"
}
```

---

### 4.3 è¿½åŠ æƒ…å ±é€ä¿¡API

#### `POST /compliance/additional-info`

**æ¦‚è¦ï¼š** é€šå ±è€…ãŒè¿½åŠ æƒ…å ±ã‚’æä¾›

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼š**

```json
{
  "anonymousId": "ANON-A8B9C2",
  "type": "clarification",
  "content": {
    "message": "è¿½åŠ ã®è©³ç´°æƒ…å ±ã§ã™...",
    "attachments": [
      {
        "fileName": "evidence2.pdf",
        "mimeType": "application/pdf",
        "size": 2048576,
        "encryptedUrl": "https://secure-storage/..."
      }
    ]
  },
  "submittedAt": "2025-09-25T10:00:00Z"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ 200ï¼‰ï¼š**

```json
{
  "success": true,
  "message": "è¿½åŠ æƒ…å ±ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ",
  "referenceId": "info-123456",
  "receivedAt": "2025-09-25T10:00:00Z"
}
```

---

### 4.4 Webhookä»•æ§˜

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é€šçŸ¥

**åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  â†’ VoiceDrive**

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼š** VoiceDriveãŒç™»éŒ²ã—ãŸURL

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼š**

```json
{
  "webhookType": "status_update",
  "timestamp": "2025-09-24T15:00:00Z",
  "signature": "sha256=...",
  "data": {
    "reportId": "VD-2025-0001",
    "caseNumber": "MED-2025-0001",
    "anonymousId": "ANON-A8B9C2",
    "previousStatus": "triaging",
    "currentStatus": "investigating",
    "changedAt": "2025-09-24T14:00:00Z",
    "changedBy": {
      "role": "investigator",
      "department": "Compliance Team"
    },
    "message": "èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã—ãŸ",
    "estimatedCompletion": "2025-09-27T17:00:00Z",
    "requiresAction": false
  }
}
```

**ç½²åæ¤œè¨¼ï¼š**

```typescript
// Webhookç½²åã®æ¤œè¨¼
function verifyWebhookSignature(
  payload: string,
  signature: string,
  secret: string
): boolean {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');

  return `sha256=${expectedSignature}` === signature;
}
```

---

## 5. ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ä»•æ§˜

### 5.1 æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

| ç”¨é€” | ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | éµé•· | ãƒ¢ãƒ¼ãƒ‰ |
|------|-------------|------|--------|
| ãƒ‡ãƒ¼ã‚¿æš—å·åŒ– | AES | 256bit | GCM |
| éµäº¤æ› | RSA | 4096bit | OAEP |
| ãƒãƒƒã‚·ãƒ¥ | SHA | 256bit | - |
| HMAC | SHA | 256bit | - |

### 5.2 æš—å·åŒ–å®Ÿè£…ä¾‹

```typescript
// æš—å·åŒ–
function encryptData(plaintext: string, key: Buffer): EncryptedData {
  const iv = crypto.randomBytes(16);
  const cipher = crypto.createCipheriv('aes-256-gcm', key, iv);

  let encrypted = cipher.update(plaintext, 'utf8', 'base64');
  encrypted += cipher.final('base64');

  return {
    encrypted,
    iv: iv.toString('hex'),
    authTag: cipher.getAuthTag().toString('hex'),
    algorithm: 'aes-256-gcm'
  };
}

// å¾©å·åŒ–
function decryptData(encryptedData: EncryptedData, key: Buffer): string {
  const decipher = crypto.createDecipheriv(
    'aes-256-gcm',
    key,
    Buffer.from(encryptedData.iv, 'hex')
  );

  decipher.setAuthTag(Buffer.from(encryptedData.authTag, 'hex'));

  let decrypted = decipher.update(encryptedData.encrypted, 'base64', 'utf8');
  decrypted += decipher.final('utf8');

  return decrypted;
}
```

---

## 6. ãƒ¬ãƒ¼ãƒˆåˆ¶é™

### 6.1 åˆ¶é™å€¤

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | åˆ¶é™ | ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ | è¶…éæ™‚ã®å¾…æ©Ÿæ™‚é–“ |
|---------------|------|-----------|----------------|
| POST /compliance/receive | 100å› | 1æ™‚é–“ | 1æ™‚é–“ |
| GET /compliance/status/* | 1000å› | 1æ™‚é–“ | 5åˆ† |
| POST /compliance/additional-info | 50å› | 1æ™‚é–“ | 30åˆ† |
| ãã®ä»– | 500å› | 1æ™‚é–“ | 10åˆ† |

### 6.2 ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ˜ãƒƒãƒ€ãƒ¼

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1727123456
```

---

## 7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 7.1 æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Human readable error message",
    "details": {},
    "documentation": "https://docs.medical-system.jp/errors/ERROR_CODE"
  },
  "requestId": "req-uuid",
  "timestamp": "2025-09-24T10:30:00Z",
  "retryAfter": 60
}
```

### 7.2 HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ | å¯¾å‡¦æ³• |
|-----------|------|--------|
| 200 | æˆåŠŸ | - |
| 400 | ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèª |
| 401 | èªè¨¼ã‚¨ãƒ©ãƒ¼ | ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†å–å¾— |
| 403 | æ¨©é™ä¸è¶³ | æ¨©é™ã‚’ç¢ºèª |
| 404 | ãƒªã‚½ãƒ¼ã‚¹ãªã— | IDã‚’ç¢ºèª |
| 409 | ç«¶åˆ | é‡è¤‡ã‚’ç¢ºèª |
| 429 | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | å¾…æ©Ÿå¾Œãƒªãƒˆãƒ©ã‚¤ |
| 500 | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | ã‚µãƒãƒ¼ãƒˆã«é€£çµ¡ |
| 503 | ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ | å¾Œã§ãƒªãƒˆãƒ©ã‚¤ |

### 7.3 ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥

```typescript
// æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§ã®ãƒªãƒˆãƒ©ã‚¤å®Ÿè£…
async function retryWithBackoff<T>(
  fn: () => Promise<T>,
  maxRetries: number = 3,
  baseDelay: number = 1000
): Promise<T> {
  let lastError: Error;

  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error;

      if (!isRetryable(error)) {
        throw error;
      }

      const delay = baseDelay * Math.pow(2, i);
      const jitter = Math.random() * 1000;

      await sleep(delay + jitter);
    }
  }

  throw lastError;
}

function isRetryable(error: any): boolean {
  const retryableStatuses = [429, 500, 502, 503, 504];
  return retryableStatuses.includes(error.status);
}
```

---

## 8. ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### 8.1 ãƒ†ã‚¹ãƒˆç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ç’°å¢ƒ | URL | ç”¨é€” |
|------|-----|------|
| Sandbox | `https://sandbox.medical-system.jp/v3` | æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ |
| Mock | `https://mock.medical-system.jp/v3` | é–‹ç™ºæ™‚ãƒ¢ãƒƒã‚¯ |

### 8.2 ãƒ†ã‚¹ãƒˆç”¨èªè¨¼æƒ…å ±

```json
{
  "client_id": "voicedrive-test",
  "client_secret": "*** åˆ¥é€”æä¾› ***",
  "scope": "compliance:write compliance:read",
  "grant_type": "client_credentials"
}
```

### 8.3 ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

```typescript
// E2Eãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«
describe('Compliance API E2E Tests', () => {
  it('should submit and track report', async () => {
    // 1. é€šå ±é€ä¿¡
    const submission = await api.submitReport(testReport);
    expect(submission.success).toBe(true);
    expect(submission.caseNumber).toMatch(/^MED-\d{4}-\d{4}$/);

    // 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
    const status = await api.getStatus(submission.anonymousId);
    expect(status.currentStatus.code).toBe('received');

    // 3. Webhookå—ä¿¡å¾…æ©Ÿ
    const webhook = await waitForWebhook(submission.reportId);
    expect(webhook.data.currentStatus).toBe('triaging');
  });
});
```

---

## 9. ç§»è¡Œè¨ˆç”»

### 9.1 æ®µéšçš„ç§»è¡Œ

| Phase | æœŸé–“ | å†…å®¹ | ç’°å¢ƒ |
|-------|------|------|------|
| Phase 1 | 2é€±é–“ | é–‹ç™ºãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆ | Sandbox |
| Phase 2 | 1é€±é–“ | çµ±åˆãƒ†ã‚¹ãƒˆ | Staging |
| Phase 3 | 3æ—¥ | å—å…¥ãƒ†ã‚¹ãƒˆ | Staging |
| Phase 4 | 1æ—¥ | æœ¬ç•ªç§»è¡Œ | Production |

### 9.2 å¾Œæ–¹äº’æ›æ€§

- APIãƒãƒ¼ã‚¸ãƒ§ãƒ³: v3ï¼ˆv2ã¯2026å¹´3æœˆã¾ã§ç¶­æŒï¼‰
- éæ¨å¥¨æ©Ÿèƒ½ã®é€šçŸ¥: 6ãƒ¶æœˆå‰
- ã‚µãƒ³ã‚»ãƒƒãƒˆæœŸé–“: 3ãƒ¶æœˆ

---

## 10. SLAï¼ˆService Level Agreementï¼‰

### 10.1 å¯ç”¨æ€§

| é …ç›® | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------|--------|---------|
| æœˆé–“ç¨¼åƒç‡ | 99.9% | æ­£å¸¸å¿œç­”ç‡ |
| å¿œç­”æ™‚é–“ | 200msä»¥å†…ï¼ˆp99ï¼‰ | APIå¿œç­”æ™‚é–“ |
| ã‚¨ãƒ©ãƒ¼ç‡ | 0.1%ä»¥ä¸‹ | 5xxå¿œç­”ç‡ |

### 10.2 ã‚µãƒãƒ¼ãƒˆ

| å„ªå…ˆåº¦ | åˆå›å¿œç­” | è§£æ±ºç›®æ¨™ |
|--------|---------|---------|
| Critical | 1æ™‚é–“ | 4æ™‚é–“ |
| High | 4æ™‚é–“ | 1å–¶æ¥­æ—¥ |
| Medium | 1å–¶æ¥­æ—¥ | 3å–¶æ¥­æ—¥ |
| Low | 3å–¶æ¥­æ—¥ | 5å–¶æ¥­æ—¥ |

---

## 11. å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 1.0.0 | 2025-09-24 | åˆç‰ˆä½œæˆ | VoiceDriveé–‹ç™ºãƒãƒ¼ãƒ  |

---

## 12. ä»˜éŒ²

### 12.1 ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| Anonymous ID | é€šå ±è€…ã‚’ç‰¹å®šã—ãªã„ä¸€æ„ã®è­˜åˆ¥å­ |
| Case Number | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®ç®¡ç†ç•ªå· |
| Disclosure Level | å®Ÿåé–‹ç¤ºãƒ¬ãƒ™ãƒ« |
| GCM | Galois/Counter Modeï¼ˆèªè¨¼ä»˜ãæš—å·ï¼‰ |
| JWT | JSON Web Token |

### 12.2 å‚è€ƒè³‡æ–™

- [RFC 7519 - JSON Web Token](https://tools.ietf.org/html/rfc7519)
- [RFC 8018 - PKCS #5](https://tools.ietf.org/html/rfc8018)
- [NIST SP 800-38D - GCM](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf)

### 12.3 å•ã„åˆã‚ã›å…ˆ

**APIæŠ€è¡“ã‚µãƒãƒ¼ãƒˆ:**
- Email: api-support@medical-system.jp
- Slack: #compliance-api-support

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿®æ­£ä¾é ¼:**
- GitHub: medical-system/api-docs
- Email: docs@medical-system.jp

---

**æœ¬ä»•æ§˜æ›¸ã¯æ©Ÿå¯†æƒ…å ±ã‚’å«ã¿ã¾ã™ã€‚å–ã‚Šæ‰±ã„ã«ã¯ååˆ†æ³¨æ„ã—ã¦ãã ã•ã„ã€‚**

**Copyright Â© 2025 Medical System & VoiceDrive. All rights reserved.**