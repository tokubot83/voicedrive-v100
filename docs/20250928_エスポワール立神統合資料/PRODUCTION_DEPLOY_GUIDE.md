# ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥çµ±åˆ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸

**ä½œæˆæ—¥**: 2025å¹´9æœˆ28æ—¥
**å¯¾è±¡**: VoiceDrive & åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒãƒ¼ãƒ 
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

---

## ğŸ“‹ å‰ææ¡ä»¶

### å¿…è¦ãªæ¨©é™
- [ ] æœ¬ç•ªç’°å¢ƒã¸ã®SSHã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- [ ] GitHubãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼æ¨©é™
- [ ] AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…æ¨©é™

### äº‹å‰ç¢ºèª
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆãŒ100%æˆåŠŸã—ã¦ã„ã‚‹
- [ ] åŒ»ç™‚ãƒãƒ¼ãƒ ã‹ã‚‰ã®æ‰¿èªã‚’å–å¾—æ¸ˆã¿
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç¢ºèª

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### Phase 1: æº–å‚™ä½œæ¥­ï¼ˆ10åˆ†ï¼‰

#### 1.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
```bash
# æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
pg_dump -h production-db.example.com -U voicedrive_prod \
  -d voicedrive_production > backup_$(date +%Y%m%d_%H%M%S).sql

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp -r /app/config /app/config.backup.$(date +%Y%m%d_%H%M%S)
```

#### 1.2 ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
```bash
# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”»é¢ã‚’è¡¨ç¤º
touch /app/maintenance.flag

# Slackã«é€šçŸ¥
curl -X POST $SLACK_WEBHOOK_URL \
  -d '{"text":"ğŸ”§ VoiceDrive: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹ï¼ˆã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥çµ±åˆï¼‰"}'
```

---

### Phase 2: ã‚³ãƒ¼ãƒ‰å±•é–‹ï¼ˆ15åˆ†ï¼‰

#### 2.1 æœ€æ–°ã‚³ãƒ¼ãƒ‰ã®å–å¾—
```bash
cd /app/voicedrive
git fetch origin main
git checkout main
git pull origin main

# ã‚¿ã‚°ä»˜ã‘
git tag -a "v3.1.0-espoir-integration" -m "ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥çµ±åˆ"
git push origin --tags
```

#### 2.2 ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
```bash
npm ci --production
npm run build
```

#### 2.3 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®
```bash
# MCPã‚µãƒ¼ãƒãƒ¼å…±æœ‰è¨­å®šã‚’ã‚³ãƒ”ãƒ¼
cp mcp-shared/config/facility-mappings.json /app/config/
cp mcp-shared/interfaces/facility.interface.ts /app/src/interfaces/

# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
cat .env.production | grep FACILITY
```

---

### Phase 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ï¼ˆ10åˆ†ï¼‰

#### 3.1 æ–½è¨­ãƒã‚¹ã‚¿æ›´æ–°
```sql
-- æ–°è¦æ–½è¨­è¿½åŠ 
INSERT INTO facilities (
  facility_id,
  facility_name,
  facility_type,
  scale,
  created_at,
  updated_at
) VALUES (
  'espoir-tategami',
  'ä»‹è­·è€äººä¿å¥æ–½è¨­ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥',
  'geriatric_health_facility',
  'medium',
  NOW(),
  NOW()
);
```

#### 3.2 å½¹è·ãƒãƒƒãƒ”ãƒ³ã‚°è¿½åŠ 
```sql
-- 33å½¹è·åˆ†ã®INSERTæ–‡ã‚’å®Ÿè¡Œ
-- ï¼ˆåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«: position_mappings.sqlå‚ç…§ï¼‰
\i /app/sql/espoir_position_mappings.sql

-- ç¢ºèª
SELECT COUNT(*) FROM position_mappings
WHERE facility_id = 'espoir-tategami';
-- Expected: 39
```

---

### Phase 4: ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•ï¼ˆ5åˆ†ï¼‰

#### 4.1 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼
```bash
# PM2ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ
pm2 reload voicedrive --update-env

# systemdã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ
sudo systemctl restart voicedrive
```

#### 4.2 ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹
```bash
pm2 reload voicedrive-worker
```

#### 4.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
```bash
redis-cli FLUSHDB
```

---

### Phase 5: å‹•ä½œç¢ºèªï¼ˆ15åˆ†ï¼‰

#### 5.1 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
```bash
# APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
curl https://voicedrive.com/api/health

# æ–½è¨­ãƒ‡ãƒ¼ã‚¿å–å¾—ç¢ºèª
curl https://voicedrive.com/api/facilities/espoir-tategami \
  -H "Authorization: Bearer $API_TOKEN"
```

#### 5.2 çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# æœ¬ç•ªç’°å¢ƒç”¨ãƒ†ã‚¹ãƒˆ
npm run test:production:espoir

# Expected output:
# âœ… æ–½è¨­IDç¢ºèª: espoir-tategami
# âœ… 39è·ç¨®ãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª
# âœ… çµ±æ‹¬ä¸»ä»»ãƒ¬ãƒ™ãƒ«7ç¢ºèª
# âœ… å…¼ä»»ãƒã‚¸ã‚·ãƒ§ãƒ³å‡¦ç†ç¢ºèª
```

#### 5.3 ãƒ­ã‚°ç¢ºèª
```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª
tail -f /var/log/voicedrive/error.log

# ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ç¢ºèª
tail -f /var/log/voicedrive/access.log
```

---

### Phase 6: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹çµ‚äº†ï¼ˆ5åˆ†ï¼‰

#### 6.1 ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰è§£é™¤
```bash
rm /app/maintenance.flag
```

#### 6.2 é€šçŸ¥é€ä¿¡
```bash
# Slacké€šçŸ¥
curl -X POST $SLACK_WEBHOOK_URL \
  -d '{"text":"âœ… VoiceDrive: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†ï¼ˆã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥çµ±åˆæˆåŠŸï¼‰"}'

# åŒ»ç™‚ãƒãƒ¼ãƒ ã¸ã®é€šçŸ¥
echo "ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥çµ±åˆå®Œäº†" | \
  mail -s "VoiceDriveçµ±åˆå®Œäº†é€šçŸ¥" medical-team@example.com
```

---

## ğŸ”„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®å¾©æ—§æ‰‹é †ï¼š

### 1. å³åº§ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
```bash
touch /app/maintenance.flag
```

### 2. å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™
```bash
git checkout v3.0.0
npm ci --production
npm run build
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚¹ãƒˆã‚¢
```bash
psql -h production-db.example.com -U voicedrive_prod \
  -d voicedrive_production < backup_YYYYMMDD_HHMMSS.sql
```

### 4. ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
```bash
pm2 reload voicedrive --update-env
```

### 5. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Š
```bash
# ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
cat > incident_report.md << EOF
æ—¥æ™‚: $(date)
å½±éŸ¿: ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥çµ±åˆ
åŸå› : [è¨˜å…¥]
å¯¾å¿œ: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿæ–½
EOF
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰
- [ ] ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®å‹•ä½œç¢ºèªå®Œäº†
- [ ] åŒ»ç™‚ãƒãƒ¼ãƒ ã®æ‰¿èªå–å¾—
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆå®Œäº†
- [ ] ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚é–“ã®å‘¨çŸ¥å®Œäº†

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œ
- [ ] å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç–é€šç¢ºèª
- [ ] ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ç¢ºèª
- [ ] æ¨©é™ãƒ¬ãƒ™ãƒ«ã®å‹•ä½œç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèªï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®ç¢ºèª

### æœ€çµ‚ç¢ºèª
- [ ] åŒ»ç™‚ãƒãƒ¼ãƒ ã¸ã®å®Œäº†å ±å‘Š
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- [ ] æ¬¡å›ãƒ‡ãƒ—ãƒ­ã‚¤è¨ˆç”»ã®ç­–å®š

---

## ğŸ“ ç·Šæ€¥é€£çµ¡å…ˆ

- **æŠ€è¡“ãƒªãƒ¼ãƒ‰**: 080-xxxx-xxxx
- **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ æ‹…å½“**: 090-xxxx-xxxx
- **ã‚¤ãƒ³ãƒ•ãƒ©æ‹…å½“**: 070-xxxx-xxxx
- **Slackãƒãƒ£ãƒ³ãƒãƒ«**: #emergency-deploy

---

## ğŸ“ å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 1.0 | 2025-09-28 | åˆç‰ˆä½œæˆ | VoiceDrive Team |

---

**é‡è¦**: ã“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¨é€£æºã—ã¦å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
å˜ç‹¬ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯é¿ã‘ã€å¿…ãšä¸¡ãƒãƒ¼ãƒ ã§èª¿æ•´ã®ä¸Šå®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚