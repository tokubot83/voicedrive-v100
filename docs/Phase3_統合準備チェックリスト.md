# Phase 3 統合準備チェックリスト

## 両チーム実装完了確認（2025年9月26日）

### ✅ VoiceDrive側
- [x] 施設マスタ定義
- [x] FacilityPermissionService
- [x] MedicalSystemAPI拡張（facilityId対応）
- [x] Webhookハンドラー実装
- [x] UserContext施設情報統合
- [x] 立神リハビリテーション温泉病院マッピング

### ✅ 医療システム側
- [x] 型定義（facility-authority.ts）
- [x] 施設別マッピング実装
- [x] 権限計算API拡張
- [x] マッピング取得API
- [x] Webhook通知機能
- [x] テストケース作成

---

## 確認済み仕様

### 役職マッピング最終版（立神リハビリテーション温泉病院）

| 役職 | 最終レベル | 変更内容 | ステータス |
|------|----------|---------|-----------|
| 院長 | 13 | 変更なし | ✅ |
| 事務長 | 11 | 変更なし | ✅ |
| 総師長 | 10 | 変更なし | ✅ |
| 副総師長 | 9 | 変更なし | ✅ |
| 薬局長 | 8 | 変更なし | ✅ |
| **統括主任** | **7** | **6→7に調整** | ✅ |
| 師長 | 7 | 変更なし | ✅ |
| 各部門主任 | 5 | 変更なし | ✅ |
| 介護主任 | 5 | 変更なし | ✅ |

### API仕様確認

#### ✅ 権限計算API
- facilityIdパラメータ追加済み
- breakdown詳細レスポンス実装済み

#### ✅ Webhook
- Bearer Token認証実装
- リトライ3回（指数バックオフ）
- タイムアウト5秒

---

## テスト環境準備

### 環境設定
- [ ] VoiceDrive側：VITE_MEDICAL_API_URL設定
- [ ] 医療システム側：VOICEDRIVE_WEBHOOK_URL設定
- [ ] 認証トークン交換

### テストアカウント作成
- [ ] TEST_TATE_001（総師長）
- [ ] TEST_TATE_002（統括主任）※レベル7
- [ ] TEST_TATE_003（介護主任）

---

## 統合テストシナリオ（10/1-3実施予定）

### Day 1: 基本機能テスト
1. [ ] 立神職員の新規ログイン
2. [ ] 権限レベル正常取得（統括主任=7）
3. [ ] 施設選択UI動作確認

### Day 2: 連携機能テスト
1. [ ] 施設間異動シミュレーション
2. [ ] Webhook権限更新通知
3. [ ] リアルタイム反映確認

### Day 3: 負荷・エラーテスト
1. [ ] 複数同時アクセス
2. [ ] API障害時フォールバック
3. [ ] Webhookリトライ動作

---

## 9/30（月）会議準備

### 確認事項
- [x] 統括主任レベル7への調整承認
- [ ] テスト環境接続確認
- [ ] 本番デプロイ手順確認

### 必要資料
- [x] 実装完了報告書
- [x] API仕様書
- [ ] テスト結果レポート（9/27-29実施分）

---

## リスク管理

| リスク | 影響度 | 対策 | 担当 |
|-------|--------|------|------|
| 統括主任レベル変更の影響 | 中 | VoiceDrive側マッピング更新必要 | VoiceDrive |
| Webhook認証設定ミス | 高 | 事前の疎通テスト実施 | 両チーム |
| 施設ID不整合 | 高 | ID命名規則の再確認 | 両チーム |

---

## 本番デプロイ（10/4）準備

### 実施順序
1. 医療システム側API更新（メンテナンス不要）
2. VoiceDrive側更新（5分程度のメンテナンス）
3. 疎通確認
4. 段階的ユーザー開放

### ロールバック計画
- 両システム前バージョンタグ付け
- DBバックアップ取得
- 切り戻し手順書準備

---

最終更新: 2025年9月26日 11:30