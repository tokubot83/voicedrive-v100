# サイドバーメニュー変更案（既存システム統合版）

**作成日**: 2025年9月26日
**方針**: 既存の実装済み機能を維持しつつ、18段階権限システムを統合

---

## 🔴 変更不可（絶対維持）

### 既存の共通メニュー
```
📍 ステーション
├── 🏠 パーソナルステーション ← Dashboard.tsxの内容を統合
├── 📅 面談ステーション 【変更不可】
└── ⭐ 評価ステーション 【変更不可】
```

---

## 🟢 パーソナルステーションへの変更案

### 現在のパーソナルステーション
- 個人の基本情報表示
- 簡易的な活動表示

### 変更案：Dashboard.tsxの内容を統合
```typescript
// パーソナルステーションに表示する内容
1. 権限レベル表示
   - PermissionLevelBadge（18段階対応）
   - 看護師リーダー業務フラグ表示

2. 活動統計
   - 投稿したアイデア数
   - 投票参加数
   - 議題の進捗状況

3. アクセス可能機能一覧
   - 権限レベルに応じたメニュー表示
```

---

## 🔵 アイデアボイス機能の整理

### 既存
- アイデアボイス投稿ページ
- 投票ページ（別々）

### 変更案：統合ハブ化
```
💡 アイデアボイスハブ
├── 📝 新規投稿
├── 🗳️ 投票
├── 📊 議題進捗（ProposalLevelIndicator統合）
├── 📄 議題提案書作成（レベル5以上）
└── 📈 投票分析（レベル3.5以上）
```

---

## 📊 18段階権限レベル別メニュー案

### レベル1-2.5：新人・若手
```
基本メニューのみ
- パーソナルステーション
- 面談ステーション
- 評価ステーション
- アイデアボイスハブ（基本機能）
```

### レベル3-4.5：中堅・ベテラン
```
+ 追加機能
- 投票分析ダッシュボード（3.5以上）
- 法人レベル投票権限
```

### レベル5-6：副主任・主任
```
管理機能
├── 📝 議題レビュー
├── ✅ チーム承認（レベル5）
└── ⚡ 迅速実装（レベル6）
```

### レベル7-8：副師長・師長
```
管理機能
├── 📝 議題レビュー
├── 🔧 議題ジェネレーター（レベル7）
├── 🏛️ 委員会準備（レベル7）
└── 🌉 委員会提出（レベル8）
```

### レベル9-11：副部長～事務長
```
施設管理
├── 🎯 戦略的議題
├── 📊 施設分析
└── 🔄 部署横断調整
```

### レベル12-13：副院長・院長
```
経営機能
├── 🎯 戦略決定
├── 📊 医療ガバナンス
└── ✅ 最終承認
```

### レベル14-17：法人人事部
```
人事機能（既存維持）
├── 📊 ボイス分析
├── 💬 組織インサイト
└── 🎯 戦略HR計画
```

### レベル18：理事長
```
最高経営
├── 👑 最終決定権限
├── 🏛️ 理事会機能
└── 📊 戦略ガバナンス
```

### レベルX：システム管理者
```
システム管理（既存維持）
├── 👥 ユーザー管理
├── 🔐 権限管理
└── 🐛 デバッグツール
```

---

## 🔧 実装方法

### 1. EnhancedSidebar.tsxの修正

```typescript
// 既存の権限レベル（1-13）を18段階にマッピング
const mapOldLevelToNew = (oldLevel: number): PermissionLevel => {
  const mapping = {
    1: PermissionLevel.LEVEL_2,    // 一般職員 → 若手
    2: PermissionLevel.LEVEL_6,    // 主任
    3: PermissionLevel.LEVEL_8,    // 師長
    4: PermissionLevel.LEVEL_10,   // 部長・課長
    5: PermissionLevel.LEVEL_11,   // 事務長
    6: PermissionLevel.LEVEL_12,   // 副院長
    7: PermissionLevel.LEVEL_13,   // 院長
    8: PermissionLevel.LEVEL_14,   // 人事部門員
    9: PermissionLevel.LEVEL_15,   // キャリア支援
    10: PermissionLevel.LEVEL_16,  // 各部門長
    11: PermissionLevel.LEVEL_17,  // 統括管理部門長
    12: PermissionLevel.LEVEL_18,  // 理事長
    13: SpecialPermissionLevel.LEVEL_X // システム管理者
  };
  return mapping[oldLevel] || PermissionLevel.LEVEL_1;
};
```

### 2. menuConfig.tsの更新

```typescript
// 18段階に対応したメニュー可視性を追加
export const MENU_VISIBILITY_V2 = {
  [PermissionLevel.LEVEL_1]: {
    station: ['personal', 'interview', 'evaluation'],
    ideaVoice: ['create', 'vote']
  },
  // ... 18段階全て定義
};
```

### 3. パーソナルステーションの更新

```typescript
// src/pages/PersonalStation.tsx を更新
import { Dashboard } from './Dashboard'; // 新しいダッシュボード内容

const PersonalStation = () => {
  return (
    <div className="personal-station">
      {/* 既存の個人情報表示 */}
      <UserProfile />

      {/* 新規：18段階権限表示 */}
      <PermissionLevelDisplay />

      {/* 新規：活動統計 */}
      <ActivityStats />

      {/* 新規：アクセス可能機能 */}
      <AccessibleFeatures />
    </div>
  );
};
```

---

## ⚠️ 注意事項

### 変更してはいけないもの
1. **面談ステーション** - 医療チームと連携済み
2. **評価ステーション** - 既存実装維持
3. **InterviewBookingService** - 動作中のAPI
4. **AssistedBookingService** - おまかせ予約機能

### 変更可能なもの
1. **パーソナルステーション** - Dashboard.tsx統合
2. **権限レベル表示** - 18段階対応
3. **アイデアボイス関連** - 議題提出フロー統合
4. **管理機能メニュー** - 権限レベル別表示

---

## 📅 段階的実装計画

### Phase 1：権限表示統合（即実装可）
- パーソナルステーションに18段階表示
- PermissionLevelBadge統合

### Phase 2：メニュー調整（慎重に）
- 既存13段階→18段階マッピング
- 新規メニュー項目追加

### Phase 3：アイデアボイス統合
- 議題提出エスカレーション
- 委員会連携機能

---

**結論**:
- 面談・評価ステーションは**絶対に触らない**
- パーソナルステーションは**変更可能**
- 18段階権限は**表示とメニュー制御**で対応
- 新機能は**アイデアボイスハブ**に集約