# VoiceDriveæŠ€è¡“ä»•æ§˜å›ç­”æ›¸

**ä½œæˆæ—¥**: 2025å¹´9æœˆ26æ—¥
**å®›å…ˆ**: åŒ»ç™‚ãƒãƒ¼ãƒ è·å“¡ã‚«ãƒ«ãƒ†ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ‹…å½“è€…æ§˜
**ä½œæˆè€…**: VoiceDriveé–‹ç™ºãƒãƒ¼ãƒ 

## 1. APIä»•æ§˜ã®è©³ç´°

### 1.1 èªè¨¼æ–¹å¼
```typescript
// JWT Bearer Tokenæ–¹å¼ã‚’æ¡ç”¨
{
  "authentication": "Bearer Token (JWT)",
  "tokenLifetime": "1 hour",
  "refreshTokenLifetime": "7 days",
  "algorithm": "HS256"
}
```

### 1.2 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ—¥æœ¬èªï¼‰",
    "details": {
      "field": "è©³ç´°æƒ…å ±"
    },
    "timestamp": "2025-09-26T10:00:00Z",
    "traceId": "trace-id-12345"
  }
}
```

### 1.3 ãƒ¬ãƒ¼ãƒˆåˆ¶é™
| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¿ã‚¤ãƒ— | åˆ¶é™å€¤ |
|----------------------|--------|
| èªè¨¼ (/auth/*) | 5 req/min |
| æ¨©é™è¨ˆç®— (/calculate-level) | 100 req/min |
| Webhook | 20 req/sec |
| ãã®ä»–GET | 100 req/min |
| ãã®ä»–POST/PUT | 50 req/min |

### 1.4 ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
```yaml
defaultTimeout: 30s  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30ç§’
endpoints:
  /api/v1/calculate-level: 5s  # é«˜é€Ÿå¿œç­”å¿…é ˆ
  /api/v1/staff/bulk: 60s  # å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†
  /webhook/*: 10s
```

## 2. Webhooké€šçŸ¥ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

### 2.1 é€šçŸ¥å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ
```typescript
enum WebhookEventType {
  // å¿…é ˆé€šçŸ¥
  STAFF_CREATED = "staff.created",           // æ–°è¦ç™»éŒ²æ™‚
  STAFF_LEVEL_CHANGED = "staff.level_changed", // æ¨©é™ãƒ¬ãƒ™ãƒ«å¤‰æ›´æ™‚
  STAFF_LEADER_FLAG_CHANGED = "staff.leader_flag_changed", // ãƒªãƒ¼ãƒ€ãƒ¼æ¥­å‹™ãƒ•ãƒ©ã‚°å¤‰æ›´æ™‚
  STAFF_DELETED = "staff.deleted",           // é€€è·æ™‚

  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³é€šçŸ¥
  STAFF_DEPARTMENT_CHANGED = "staff.department_changed", // éƒ¨ç½²ç•°å‹•
  STAFF_POSITION_CHANGED = "staff.position_changed",     // å½¹è·å¤‰æ›´
}
```

### 2.2 Webhookãƒšã‚¤ãƒ­ãƒ¼ãƒ‰
```json
{
  "event": "staff.level_changed",
  "timestamp": "2025-09-26T10:00:00Z",
  "data": {
    "staffId": "STAFF001",
    "changes": {
      "accountLevel": {
        "old": 1,
        "new": 2
      }
    },
    "changedBy": "admin_user",
    "reason": "å®šæœŸæ˜‡æ ¼"
  },
  "signature": "HMAC-SHA256ç½²å"
}
```

### 2.3 ãƒªãƒˆãƒ©ã‚¤ãƒãƒªã‚·ãƒ¼
```yaml
retryPolicy:
  maxAttempts: 3
  backoffStrategy: "exponential"
  initialDelay: 1000ms
  maxDelay: 30000ms
  retryableStatuses: [500, 502, 503, 504]
```

### 2.4 é€šçŸ¥å¤±æ•—æ™‚ã®å¯¾å‡¦
```typescript
interface FailureHandling {
  deadLetterQueue: true,           // å¤±æ•—ã—ãŸWebhookã‚’DLQã«ä¿å­˜
  alertThreshold: 5,                // 5å›é€£ç¶šå¤±æ•—ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
  fallbackNotification: "email",    // ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  manualRetryEndpoint: "/api/webhook/retry/:webhookId"
}
```

## 3. åˆæœŸãƒ‡ãƒ¼ã‚¿ç§»è¡Œ

### 3.1 ç§»è¡Œãƒ•ãƒ­ãƒ¼
```mermaid
graph LR
    A[æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ] --> B[ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼]
    B --> C[ãƒãƒ«ã‚¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆ]
    C --> D[VoiceDriveã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”Ÿæˆ]
    D --> E[æ¨©é™ãƒ¬ãƒ™ãƒ«è¨ˆç®—]
    E --> F[ç¢ºèªãƒ¬ãƒãƒ¼ãƒˆ]
```

### 3.2 ãƒãƒ«ã‚¯APIä»•æ§˜
```typescript
POST /api/v1/staff/bulk-import
{
  "maxRecordsPerRequest": 1000,  // 1å›ã‚ãŸã‚Šæœ€å¤§1000ä»¶
  "format": "JSON",
  "validation": "strict",         // å³æ ¼ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  "dryRun": true                 // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³
}
```

### 3.3 ç§»è¡Œæ™‚ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
```typescript
interface MigrationAccount {
  // è‡ªå‹•ç”Ÿæˆé …ç›®
  voiceDriveId: string,           // "VD-" + staffId
  initialPassword: string,        // ãƒ©ãƒ³ãƒ€ãƒ 16æ–‡å­—
  passwordResetRequired: true,    // åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚å¤‰æ›´å¿…é ˆ

  // æ¨©é™è¨ˆç®—
  accountLevel: number,            // çµŒé¨“å¹´æ•°ã‹ã‚‰è‡ªå‹•è¨ˆç®—
  canPerformLeaderDuty: boolean,  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆfalseï¼ˆå¾Œã§æ›´æ–°ï¼‰

  // é€šçŸ¥è¨­å®š
  welcomeEmailSent: boolean,
  activationLink: string
}
```

### 3.4 ç§»è¡Œãƒãƒƒãƒå‡¦ç†
```yaml
batchConfiguration:
  chunkSize: 100
  parallelWorkers: 5
  progressReporting: true
  rollbackOnError: true
  validationReport: "/reports/migration-{timestamp}.csv"
```

## 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 4.1 APIé€šä¿¡ã®æš—å·åŒ–
```typescript
interface SecurityConfig {
  protocol: "HTTPS only",
  tlsVersion: "1.3",
  cipherSuites: [
    "TLS_AES_256_GCM_SHA384",
    "TLS_AES_128_GCM_SHA256"
  ],
  hsts: {
    enabled: true,
    maxAge: 31536000,
    includeSubDomains: true
  }
}
```

### 4.2 IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆè¨­å®š
```json
{
  "ipWhitelist": {
    "enabled": true,
    "allowedIPs": [
      "192.168.1.0/24",     // åŒ»ç™‚ãƒãƒ¼ãƒ å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
      "10.0.0.0/16",        // VPNæ¥ç¶š
      "203.0.113.0/24"      // MCPã‚µãƒ¼ãƒãƒ¼
    ],
    "bypassForHealthCheck": true,
    "dynamicUpdate": "/api/admin/whitelist"
  }
}
```

### 4.3 ç›£æŸ»ãƒ­ã‚°è¦ä»¶
```typescript
interface AuditLog {
  // å¿…é ˆè¨˜éŒ²é …ç›®
  timestamp: Date,
  userId: string,
  action: string,
  resource: string,
  ipAddress: string,
  userAgent: string,
  result: "success" | "failure",

  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®
  changes?: object,
  errorDetails?: string,
  duration?: number,

  // ä¿å­˜è¦ä»¶
  retention: "3 years",
  storage: "encrypted",
  immutable: true,
  searchable: true
}
```

### 4.4 è¿½åŠ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
```yaml
additionalSecurity:
  # APIã‚­ãƒ¼ç®¡ç†
  apiKeyRotation: "quarterly"
  apiKeyScopes: ["read", "write", "admin"]

  # èªè¨¼å¼·åŒ–
  mfa:
    enabled: true
    methods: ["totp", "sms"]
    requiredForAdmin: true

  # ãƒ‡ãƒ¼ã‚¿ä¿è­·
  encryption:
    atRest: "AES-256"
    inTransit: "TLS 1.3"
    keyManagement: "AWS KMS"

  # è„†å¼±æ€§å¯¾ç­–
  security headers:
    - X-Content-Type-Options: nosniff
    - X-Frame-Options: DENY
    - X-XSS-Protection: 1; mode=block
    - Content-Security-Policy: default-src 'self'
```

## 5. å®Ÿè£…å„ªå…ˆé †ä½ï¼ˆå†ç¢ºèªï¼‰

åŸºã¥ãã€ä»¥ä¸‹ã®å„ªå…ˆé †ä½ã§å®Ÿè£…ã‚’é€²ã‚ã¾ã™ï¼š

### ğŸ”´ æœ€å„ªå…ˆï¼ˆ9/26-9/27ï¼‰
1. JWTèªè¨¼ã®å®Ÿè£…
2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¨™æº–åŒ–
3. `/api/v1/calculate-level` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ğŸŸ¡ é«˜å„ªå…ˆï¼ˆ9/30-10/2ï¼‰
1. Webhooké€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
2. ãƒãƒ«ã‚¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆAPI
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼å®Ÿè£…

### ğŸŸ¢ æ¨™æº–ï¼ˆ10/3-10/4ï¼‰
1. IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ
2. ç›£æŸ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…

## 6. è³ªå•äº‹é …ã¸ã®è¿½åŠ å›ç­”

### Q: VoiceDriveå´ã§æ—¢ã«å®Ÿè£…æ¸ˆã¿ã®ä»•æ§˜ã¯ï¼Ÿ

ä»¥ä¸‹ãŒå®Ÿè£…æ¸ˆã¿ã§ã™ï¼š
- âœ… 18æ®µéšæ¨©é™ã‚·ã‚¹ãƒ†ãƒ ï¼ˆPermissionLevel enumï¼‰
- âœ… ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æŠ•ç¥¨è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³
- âœ… è­°é¡Œã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³
- âœ… æŠ•ç¥¨æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
- âœ… è­°é¡Œææ¡ˆæ›¸ç·¨é›†æ©Ÿèƒ½

æœªå®Ÿè£…ï¼ˆã“ã‚Œã‹ã‚‰å®Ÿè£…ï¼‰ï¼š
- â³ JWTèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- â³ RESTful API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- â³ Webhooké€šçŸ¥
- â³ ãƒãƒ«ã‚¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

## 7. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### æœ¬æ—¥ï¼ˆ9/26ï¼‰ã®ä¼šè­°ã§ç¢ºèªã—ãŸã„äº‹é …
1. IP ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã®å…·ä½“çš„ãªIPãƒ¬ãƒ³ã‚¸
2. ç›£æŸ»ãƒ­ã‚°ã®å‡ºåŠ›å½¢å¼ï¼ˆJSON/CSV/ãã®ä»–ï¼‰
3. åˆæœŸãƒ‡ãƒ¼ã‚¿ç§»è¡Œã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
4. MFAï¼ˆå¤šè¦ç´ èªè¨¼ï¼‰ã®å¿…è¦æ€§

### å®Ÿè£…é–‹å§‹é …ç›®
ä¼šè­°å¾Œã€å³åº§ã«ä»¥ä¸‹ã®å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ï¼š
- JWTèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- `/api/v1/calculate-level` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

---

**VoiceDriveé–‹ç™ºãƒãƒ¼ãƒ **
é€£çµ¡å…ˆ: [é–‹ç™ºãƒãƒ¼ãƒ Slack]
æœ€çµ‚æ›´æ–°: 2025å¹´9æœˆ26æ—¥ 09:00