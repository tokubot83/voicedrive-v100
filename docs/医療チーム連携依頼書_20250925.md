# VoiceDrive × 職員カルテシステム 連携実装依頼書

**作成日**: 2025年9月25日
**作成者**: VoiceDrive開発チーム（徳留）
**宛先**: 医療チーム 職員カルテシステム開発担当者様

## 1. 背景と目的

VoiceDriveシステムの本稼働に向けて、職員の声を効果的に組織改善につなげるため、18段階の権限レベル体系を新たに設計しました。この権限体系を職員カルテシステムと完全に連携させることで、以下の効果を実現します：

- 職員の経験年数・役職・資格に応じた適切な発言権の付与
- 組織階層に応じた透明性のある意思決定プロセス
- 施設ごとの組織実態に即した柔軟な運用

## 2. 連携全体像

```
職員カルテシステム（医療チーム）     MCPサーバー      VoiceDrive（こちら）
        ↓                          ↓                    ↓
  [職員マスター管理]  →→→  [データ同期]  →→→  [権限判定・投票管理]
  [組織マスター管理]          [API提供]         [提案・議題化管理]
  [権限レベル決定]            [整合性保証]       [委員会連携]
```

## 3. 新18段階権限レベル体系

### 3.1 権限レベル定義（職員カルテ側で管理をお願いしたい内容）

| レベル | 区分 | 役職・経験 | 備考 |
|--------|------|------------|------|
| **一般職員層** |
| 1 | 新人 | 入職1年目 | 全職種共通 |
| 1.5 | 新人（リーダー可） | 看護師・准看護師のみ | リーダー業務可能な新人（稀） |
| 2 | 若手 | 2-3年目 | 全職種共通 |
| 2.5 | 若手（リーダー可） | 看護師・准看護師のみ | リーダー業務可能 |
| 3 | 中堅 | 4-10年目 | 全職種共通 |
| 3.5 | 中堅（リーダー可） | 看護師・准看護師のみ | リーダー業務可能 |
| 4 | ベテラン | 11年以上 | 全職種共通 |
| 4.5 | ベテラン（リーダー可） | 看護師・准看護師のみ | リーダー業務可能 |
| **役職層** |
| 5 | 副主任 | - | 主任補佐 |
| 6 | 主任 | - | 各部署主任 |
| 7 | 副師長・副科長 | - | 中間管理職補佐 |
| 8 | 師長・科長・課長 | - | 中間管理職 |
| 9 | 副部長 | - | 部長補佐 |
| 10 | 部長・医局長 | - | 部門責任者 |
| 11 | 事務長 | - | 施設事務統括 |
| **施設経営層** |
| 12 | 副院長 | - | 院長補佐 |
| 13 | 院長・施設長 | - | 施設最高責任者 |
| **法人人事部** |
| 14 | 人事部門員 | - | 面談実施、相談対応 |
| 15 | 各部門長 | - | 採用、教育、相談、業務革新 |
| 16 | 戦略企画・統括管理部門員 | - | 廻総師長、徳留 |
| 17 | 戦略企画・統括管理部門長 | - | 人事部統括 |
| **最高経営層** |
| 18 | 理事長・法人事務局長 | - | 最終決定権者 |

### 3.2 看護職のリーダー業務フラグ（重要）

看護師・准看護師については、リーダー業務（日勤・夜勤リーダー、医師指示受け等）の可否を別途管理する必要があります。

```json
{
  "staffId": "NSG_001",
  "profession": "看護師",
  "experienceYears": 3,
  "baseLevel": 2,  // 若手（2-3年目）
  "canPerformLeaderDuty": true,  // リーダー業務可能
  "effectiveLevel": 2.5  // 実効レベル（0.5加算）
}
```

## 4. 必要なAPI・データ構造

### 4.1 職員マスターデータ（職員カルテ → VoiceDrive）

```typescript
interface StaffMasterData {
  staffId: string;                    // 職員ID
  name: string;                        // 氏名
  facility: string;                    // 所属施設（"小原病院" 等）
  department: string;                  // 所属部署
  position: string;                    // 役職
  profession: string;                  // 職種（医師、看護師、薬剤師等）
  hireDate: Date;                      // 入職日
  experienceYears: number;             // 経験年数（自動計算可）

  // 看護職専用
  canPerformLeaderDuty?: boolean;     // リーダー業務可否

  // 資格情報
  certifications?: string[];           // 認定看護師、専門医等

  // 兼務情報
  additionalPositions?: {
    department: string;
    position: string;
  }[];

  // 最終的な権限レベル
  accountLevel: number;                // 1-18の値（小数点対応）
}
```

### 4.2 組織マスターデータ（職員カルテ → VoiceDrive）

```typescript
interface OrganizationMasterData {
  // 施設情報
  facilities: {
    facilityId: string;
    facilityName: string;               // "小原病院"、"立神リハビリテーション温泉病院"
    facilityType: string;               // "急性期"、"回復期"等
  }[];

  // 部署情報
  departments: {
    departmentId: string;
    departmentName: string;
    facilityId: string;
    parentDepartmentId?: string;        // 階層構造対応
    staffCount: number;                 // 部署人数（動的閾値計算用）
  }[];

  // 役職マッピング
  positionLevelMapping: {
    facility: string;
    mappings: {
      positionCode: string;
      positionName: string;
      accountLevel: number;
    }[];
  }[];
}
```

### 4.3 権限レベル決定ロジック（職員カルテ側で実装をお願いしたい内容）

```typescript
class AccountLevelCalculator {

  calculateAccountLevel(staff: StaffData): number {
    // 1. 役職による判定
    if (staff.position) {
      const positionLevel = this.getPositionLevel(staff.position, staff.facility);
      if (positionLevel) return positionLevel;
    }

    // 2. 経験年数による判定
    let baseLevel = this.getExperienceLevelMapping(staff.experienceYears);

    // 3. 看護職のリーダー業務加算
    if (['看護師', '准看護師'].includes(staff.profession)) {
      if (staff.canPerformLeaderDuty === true) {
        baseLevel += 0.5;
      }
    }

    // 4. 兼務の場合は最高レベルを採用
    if (staff.additionalPositions?.length > 0) {
      const levels = staff.additionalPositions.map(pos =>
        this.getPositionLevel(pos.position, staff.facility)
      );
      baseLevel = Math.max(baseLevel, ...levels.filter(l => l !== null));
    }

    return baseLevel;
  }

  private getExperienceLevelMapping(years: number): number {
    if (years <= 1) return 1;    // 新人
    if (years <= 3) return 2;    // 若手
    if (years <= 10) return 3;   // 中堅
    return 4;                     // ベテラン
  }
}
```

## 5. 施設別委員会マスター（VoiceDrive側で管理、参考情報共有）

各施設の委員会情報をVoiceDrive側で管理し、議題提出を自動化します：

### 小原病院
- 医療安全管理委員会（第2火曜）
- 感染対策委員会（第3水曜）
- 業務改善委員会（第4木曜）
- 小原病院運営委員会（月2回）
- 病院意思決定会議（月1回）

※他施設の委員会は施設展開時に追加

## 6. API仕様（MCPサーバー経由）

### 6.1 職員情報取得

```http
GET /api/v1/staff/{staffId}
Response: StaffMasterData

GET /api/v1/staff/facility/{facilityName}
Response: StaffMasterData[]
```

### 6.2 組織情報取得

```http
GET /api/v1/organization/facilities
Response: Facility[]

GET /api/v1/organization/departments/{facilityId}
Response: Department[]

GET /api/v1/organization/position-mapping/{facilityId}
Response: PositionLevelMapping[]
```

### 6.3 アカウントレベル決定

```http
POST /api/v1/account-level/calculate
Body: { staffId: string }
Response: {
  staffId: string,
  accountLevel: number,
  calculationDetails: {
    baseLevel: number,
    leaderBonus: number,
    finalLevel: number
  }
}
```

### 6.4 変更通知（WebSocket or Webhook）

```typescript
// 人事異動、昇格、組織変更時の通知
{
  event: "STAFF_UPDATE",
  data: {
    staffId: string,
    changes: {
      department?: string,
      position?: string,
      accountLevel?: number
    },
    timestamp: Date
  }
}
```

## 7. 実装スケジュール案

| フェーズ | 期間 | 医療チーム側作業 | VoiceDrive側作業 |
|----------|------|------------------|------------------|
| Phase 1 | 2025年10月第1週 | データ構造設計・レビュー | 権限システム基盤実装 |
| Phase 2 | 2025年10月第2週 | アカウントレベル計算ロジック実装 | 投票システム改修 |
| Phase 3 | 2025年10月第3週 | API開発・テスト | 議題提出フロー実装 |
| Phase 4 | 2025年10月第4週 | マスターデータ登録画面 | UI/UX更新 |
| Phase 5 | 2025年11月第1週 | 統合テスト | 統合テスト |
| Phase 6 | 2025年11月第2週 | 本番データ移行準備 | 本番環境準備 |

## 8. 期待される効果

1. **一元管理による整合性**
   - 職員情報の重複管理を排除
   - 人事異動時の自動反映

2. **柔軟な権限管理**
   - 施設ごとの組織実態に対応
   - 看護職のリーダー業務考慮

3. **透明性の向上**
   - 権限レベルに基づく公平な投票
   - 議題化プロセスの可視化

## 9. 技術的な考慮事項

### 9.1 データ同期
- リアルタイム同期 or バッチ同期の選択
- エラーハンドリングとリトライ機構
- データ整合性チェック

### 9.2 パフォーマンス
- 職員数1,000人規模での応答速度
- キャッシュ戦略
- 負荷分散

### 9.3 セキュリティ
- 個人情報の暗号化
- API認証（JWT等）
- 監査ログ

## 10. 連絡先・質問事項

**VoiceDrive開発チーム**
- 担当: 徳留
- 連絡先: [連絡先情報]

### ご相談したい事項
1. 看護職のリーダー業務フラグの管理方法（師長が定期更新？）
2. 兼務職員の扱い（複数部署・役職の優先順位）
3. データ更新頻度とタイミング
4. エラー時の fallback 処理

## 11. 添付資料

- 18段階権限レベル詳細定義書
- VoiceDrive投票システム仕様書
- 小原病院組織図（参考）
- API仕様詳細（OpenAPI形式）

---

以上、ご検討のほど、よろしくお願いいたします。
より良い医療現場の実現に向けて、共に取り組めることを楽しみにしております。