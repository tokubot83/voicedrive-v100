# 🚀 Phase 2 相互接続テスト - クイックガイド

**テスト開始時刻:** 10:00
**参加チーム:** VoiceDrive × 医療職員管理システム

---

## ✅ 事前確認チェックリスト

### VoiceDrive側
- [x] 開発サーバー起動済み（http://localhost:5174）
- [x] テストパネルアクセス可能（http://localhost:5174/api-test）
- [x] JWT認証実装済み
- [x] CORS設定確認済み

### 医療システム側（確認済み）
- [x] APIエンドポイント稼働中（http://localhost:3000/api/v1/calculate-level）
- [x] CORS設定済み（localhost:3001, localhost:5174許可）
- [x] テストデータ準備完了
- [x] ログ監視体制整備

---

## 🔬 テスト手順

### Step 1: 接続確認（10:00-10:10）

```bash
# 1. VoiceDrive → 医療システム
curl -X POST http://localhost:3000/api/v1/calculate-level \
  -H "Authorization: Bearer test_token_123" \
  -H "Content-Type: application/json" \
  -d '{"staffId": "STAFF005"}'

# 期待される応答
{
  "staffId": "STAFF005",
  "permissionLevel": 3.5,
  "details": {
    "baseLevel": 3.5,
    "adjustments": [],
    "finalLevel": 3.5
  }
}
```

### Step 2: テストパネルでの動作確認（10:10-10:20）

1. ブラウザで http://localhost:5174/api-test を開く
2. 「接続テスト」ボタンをクリック
3. 接続成功を確認
4. 「権限レベル計算テスト実行」をクリック
5. 10件のテストデータが正しく処理されることを確認

### Step 3: 全テストケース実行（10:20-10:30）

| テストケース | スタッフID | 期待レベル | 検証ポイント |
|------------|-----------|-----------|------------|
| 新人 | STAFF001 | 1.0 | 最小レベル |
| 若手 | STAFF003 | 2.0 | 基本レベル |
| 中堅 | STAFF005 | 3.5 | 小数点対応 |
| 管理職 | STAFF008 | 6.0 | 中間管理職 |
| 戦略職 | STAFF010 | 16.0 | 最高レベル |

### Step 4: エラーケース確認（10:30-10:35）

```bash
# 1. 認証なし
curl -X POST http://localhost:3000/api/v1/calculate-level \
  -H "Content-Type: application/json" \
  -d '{"staffId": "STAFF001"}'
# → 401 Unauthorized

# 2. 存在しないスタッフ
curl -X POST http://localhost:3000/api/v1/calculate-level \
  -H "Authorization: Bearer test_token_123" \
  -H "Content-Type: application/json" \
  -d '{"staffId": "INVALID_ID"}'
# → 404 Not Found

# 3. タイムアウトテスト（5秒以上）
# → 408 Request Timeout
```

---

## 📊 テスト結果記録フォーム

### 接続テスト
- [ ] VoiceDrive → 医療システム：成功 / 失敗
- [ ] 医療システム → VoiceDrive（Webhook）：成功 / 失敗 / 未実施

### 機能テスト
- [ ] 権限レベル計算API：10件中___件成功
- [ ] JWT認証：正常動作 / 要修正
- [ ] タイムアウト処理：正常動作 / 要修正
- [ ] エラーハンドリング：正常動作 / 要修正

### パフォーマンス
- [ ] 平均レスポンス時間：___ms
- [ ] 最大レスポンス時間：___ms
- [ ] タイムアウト発生：有 / 無

---

## 🔍 トラブルシューティング

### よくある問題と解決法

| 問題 | 原因 | 解決法 |
|-----|------|--------|
| CORS エラー | オリジン未許可 | 医療システム側でlocalhost:5174を許可 |
| 401 エラー | トークン不正 | AuthTokenService.generateMockToken()を使用 |
| ネットワークエラー | サーバー未起動 | 両チームのサーバー起動を確認 |
| タイムアウト | レスポンス遅延 | ネットワーク状況確認、5秒制限確認 |

---

## 📝 会議での確認事項

### 技術仕様
- [ ] JWT公開鍵の受け渡し方法（ファイル？API？）
- [ ] MCPサーバーのエンドポイントURL
- [ ] Webhook仕様（イベントタイプ、ペイロード形式）

### セキュリティ
- [ ] 本番環境でのJWT署名アルゴリズム（RS256確定？）
- [ ] APIキーの管理方法
- [ ] 監査ログの保存期間

### 運用
- [ ] 障害時のエスカレーションフロー
- [ ] 定期メンテナンスのスケジュール
- [ ] バージョンアップの通知方法

---

## 🎯 成功基準

✅ **必須項目**
- 10件のテストデータが全て正しいレベルを返す
- JWT認証が正常に動作する
- エラーケースが適切に処理される

⭐ **推奨項目**
- 平均レスポンスタイムが500ms以下
- エラーメッセージが分かりやすい
- ログが適切に記録される

---

## 📞 テスト中の連絡先

**Slack:** #phase2-integration
**緊急連絡:** 両チームの担当者携帯番号を事前共有

---

## 次のステップ

1. **10:35-10:45** - テスト結果のレビュー
2. **10:45-11:00** - 課題リスト作成と優先順位付け
3. **来週月曜** - Phase 3計画策定

---

**Good Luck! 🍀**